# パフォーマンス改善計画

**作成日:** 2025-01-27  
**目的:** アプリ全体の読み込み速度を1-2秒から0.5秒以下に改善

---

## 問題の特定

### 1. SWR設定の問題
- `dedupingInterval: 1000` や `dedupingInterval: 0` が短すぎる
- `revalidateOnMount: true` が毎回再検証している
- グローバルなSWR設定がない（各ページで個別設定）

### 2. ページコンポーネントの問題
- 複数のSWR呼び出しが並列実行されているが、最適化されていない
- 重い計算がメモ化されていない箇所がある
- 動的インポートが使われていない（コード分割が不十分）

### 3. Next.js設定の問題
- バンドルサイズの最適化が不十分
- コード分割が不十分

---

## 改善提案

### 1. SWRグローバル設定の最適化

**問題点:**
- 各ページで個別にSWR設定をしている
- `dedupingInterval`が短すぎる（1000msや0）
- `revalidateOnMount: true`が毎回再検証している

**改善案:**
- グローバルなSWR設定を作成
- `dedupingInterval`を5分（300000ms）に設定
- `revalidateOnMount`を条件付きにする（初回のみ、またはキャッシュがない場合のみ）

### 2. ページコンポーネントの動的インポート

**問題点:**
- 重いコンポーネントが初回ロード時にすべて読み込まれている
- コード分割が不十分

**改善案:**
- 重いダイアログやモーダルを動的インポート
- ページコンポーネント自体を動的インポート（必要に応じて）

### 3. SWRキャッシュ戦略の最適化

**問題点:**
- キャッシュが適切に活用されていない
- 同じデータを複数回取得している

**改善案:**
- `fallbackData`を使用して即座に表示
- `keepPreviousData: true`でスムーズな遷移
- プリフェッチングの実装

### 4. Next.js設定の最適化

**問題点:**
- バンドルサイズが大きい
- コード分割が不十分

**改善案:**
- `next.config.ts`でバンドル分析を有効化
- 動的インポートの最適化
- 画像最適化の強化

### 5. コンポーネントの最適化

**問題点:**
- 大きなコンポーネントが分割されていない
- React.memoが使われていない箇所がある

**改善案:**
- 大きなコンポーネントを分割
- React.memoで不要な再レンダリングを防止
- useMemo/useCallbackの適切な使用

---

## 実装優先順位

### 優先度: 高（即座に実装）
1. **SWRグローバル設定の最適化** - 最も影響が大きい
2. **SWRキャッシュ戦略の最適化** - データ取得の高速化

### 優先度: 中（次に実装）
3. **ページコンポーネントの動的インポート** - 初回ロード時間の短縮
4. **Next.js設定の最適化** - バンドルサイズの削減

### 優先度: 低（時間があるときに実装）
5. **コンポーネントの最適化** - 細かい改善

---

## 期待される効果

- 初回ロード時間: **2秒 → 0.5秒以下**
- ページ遷移時間: **1-2秒 → 0.3秒以下**
- バンドルサイズ: **20-30%削減**
- メモリ使用量: **10-20%削減**














