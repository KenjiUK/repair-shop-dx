# UXレビュー - 課題リスト

**作成日:** 2024年
**目的:** UXレビューで発見された課題の一覧

**更新履歴:**
- 2025-01-XX: Phase 0.5の実装完了（入庫区分判定ロジック修正、UI改善、UX改善）

---

## 🔴 緊急度：高（システムの不整合・動作不良）

### 1. 入庫区分と表示内容の不一致

#### 1-1. エンジンオイル交換なのに車検用の項目が表示される

**問題:**
- エンジンオイル交換で入庫した場合、診断画面に車検用の項目（`InspectionDiagnosisView`）が表示される可能性がある

**影響:**
- メカニックが誤った診断項目を入力する可能性がある
- 業務フローが混乱する

**原因の可能性:**
1. 入庫区分の判定ロジックが正しく動作していない
2. 複数の入庫区分が設定されている場合、`isInspection`が`true`になる可能性がある
3. データの不整合（Zoho CRM側で「車検」と「エンジンオイル交換」の両方が設定されている）

**確認箇所:**
- `src/app/mechanic/diagnosis/[id]/page.tsx`（行567-611）
  - `isInspection`の判定：`serviceKinds.includes("車検") || serviceKinds.includes("12ヵ月点検")`
  - `isEngineOilChange`の判定：`serviceKinds.includes("エンジンオイル交換")`
  - 表示ロジック：`isInspection`を先に判定しているため、複数の入庫区分が設定されている場合、車検が優先される可能性がある

**推奨対応:**
- 入庫区分の判定ロジックを確認
- 複数の入庫区分が設定されている場合の処理を明確化
- デバッグログを追加して、実際の値を確認

---

#### 1-2. エンジンオイル交換なのに分解整備記録簿PDF生成が実行される

**問題:**
- エンジンオイル交換で入庫した場合、作業画面で分解整備記録簿PDF生成が実行される可能性がある

**影響:**
- 不要なPDFが生成される
- エラーが発生する可能性がある

**原因の可能性:**
- `isInspection`の判定が正しく動作していない
- エンジンオイル交換なのに`isInspection`が`true`になっている

**確認箇所:**
- `src/app/mechanic/work/[id]/page.tsx`（行485-498, 619-716）
  - `isInspection`の判定：`serviceKinds.includes("車検") || serviceKinds.includes("12ヵ月点検")`
  - 分解整備記録簿PDF生成：`if (isInspection) { ... }`

**推奨対応:**
- `isInspection`の判定ロジックを確認
- デバッグログを追加して、実際の値を確認

---

#### 1-3. 顧客レポート画面の「STEP2」に「分解整備記録簿（電子版）」と表示される

**問題:**
- エンジンオイル交換で入庫した場合、顧客レポート画面の「STEP2（診断）」に「分解整備記録簿（電子版）」と表示される

**影響:**
- 顧客に誤った情報が表示される
- 信頼性が損なわれる

**原因の可能性:**
- 別の場所で表示されている
- 動的に生成されている
- 表示条件が適切でない

**確認箇所:**
- `src/app/customer/report/[id]/page.tsx`（全体）
- `src/components/features/customer-progress-view.tsx`（行84-123）
  - STEP2は「診断」で、説明は「車両の診断を実施中です」
  - 「分解整備記録簿（電子版）」という文字列は見つからない

**推奨対応:**
- 実際の画面を確認
- 「分解整備記録簿（電子版）」という文字列を検索
- 表示条件を確認（車検・12ヵ月点検の場合のみ表示すべき）

---

#### 1-4. 入庫区分の判定ロジックが正しく動作していない

**問題:**
- 複数の入庫区分が設定されている場合、最初の入庫区分のみを使用している可能性がある
- 判定の順序が不適切（`isInspection`を先に判定しているため、エンジンオイル交換でも車検が優先される可能性）

**影響:**
- 各画面で適切なビューが表示されない
- 業務フローが混乱する

**原因の可能性:**
- `serviceKinds = job.field_service_kinds || (job.serviceKind ? [job.serviceKind] : [])`
- 複数の入庫区分が設定されている場合の処理が不明確

**確認箇所:**
- 各画面の入庫区分判定ロジック
  - `src/app/mechanic/diagnosis/[id]/page.tsx`（行567-611）
  - `src/app/mechanic/work/[id]/page.tsx`（行485-498）
  - `src/app/admin/estimate/[id]/page.tsx`（行540-642）

**推奨対応:**
- 入庫区分の判定ロジックを統一
- 複数の入庫区分が設定されている場合の処理を明確化
- データの整合性チェックを追加

---

## 🟡 緊急度：中（UX的な課題・業務効率）

### 2. UI的な課題

#### 2-1. 診断画面のカテゴリタブ（車検の場合）がスマホで収まらない

**問題:**
- 車検診断画面のカテゴリタブ（6タブ）がスマホで収まらない可能性がある
- タブのテキストが長い（「エンジン・ルーム点検」「室内点検」など）
- タブ内にアイコン、チェックマーク、バッジが表示されるため、さらにスペースが不足する

**影響:**
- タブがはみ出して使いにくくなる
- タブの切り替えが困難になる

**確認箇所:**
- `src/components/features/inspection-category-tabs.tsx`
  - `grid-cols-3 lg:grid-cols-6`：スマホでは3列表示、6タブが2行になる
  - `text-xs sm:text-sm`：フォントサイズを調整

**推奨対応:**
- タブのテキストを短縮（「エンジン・ルーム点検」→「エンジン」など）
- または、スクロール可能なタブにする
- または、ドロップダウンメニューにする

---

#### 2-2. ジョブカードの文字がはみ出す

**問題:**
- 顧客名、車両名、入庫区分名が長い場合、はみ出す可能性がある
- `whitespace-nowrap`を使用しているが、親要素の幅制限がない場合、はみ出す

**影響:**
- 文字が読めなくなる
- レイアウトが崩れる

**確認箇所:**
- `src/components/features/job-card.tsx`
  - 顧客名、車両名、入庫区分名の表示

**推奨対応:**
- `truncate`クラスを追加
- または、`min-w-0`を親要素に追加して、flexboxの幅制限を有効化

---

#### 2-3. 見積画面の項目リストが長い場合、スクロールが大変

**問題:**
- 見積項目が多くなると、スクロールが大変になる
- 項目名が長い場合、はみ出す可能性がある

**影響:**
- 操作が困難になる
- 必要な情報を見つけにくくなる

**確認箇所:**
- `src/app/admin/estimate/[id]/page.tsx`
  - 見積項目の表示

**推奨対応:**
- 項目名の`truncate`対応
- スクロール位置の最適化
- または、折りたたみ機能の追加

---

#### 2-4. 顧客承認画面の文字がはみ出す

**問題:**
- 見積項目名が長い場合、はみ出す可能性がある
- 顧客名、車両名が長い場合、はみ出す可能性がある

**影響:**
- 文字が読めなくなる
- レイアウトが崩れる

**確認箇所:**
- `src/app/customer/approval/[id]/page.tsx`
  - 見積項目の表示

**推奨対応:**
- `truncate`クラスを追加
- または、`min-w-0`を親要素に追加

---

### 3. UX的な課題

#### 3-1. 診断完了後、見積画面への遷移が分かりにくい

**問題:**
- 診断完了後、トップページに戻るが、見積画面に直接遷移できない
- 見積画面への遷移が分かりにくい

**影響:**
- メカニックが次の作業に移りにくい
- 業務効率が低下する

**推奨対応:**
- 診断完了後、見積画面へのリンクを表示
- または、自動で見積画面に遷移

---

#### 3-2. 見積画面の情報が多すぎて、見つけにくい

**問題:**
- 診断結果、見積項目、部品リスト、送信ボタンが縦に並んでいる
- 情報が多すぎて、見つけにくい

**影響:**
- 必要な情報を見つけるのに時間がかかる
- 業務効率が低下する

**推奨対応:**
- タブで情報を分類
- または、折りたたみ可能にする

---

#### 3-3. エラーハンドリングが不十分

**問題:**
- エラーメッセージが分かりにくい場合がある
- エラー時のリカバリー方法が明確でない場合がある

**影響:**
- ユーザーがエラーに対処できない
- 業務が停滞する

**推奨対応:**
- エラーメッセージを改善
- リトライボタンを追加

---

## 🟢 緊急度：低（機能追加・改善）

### 4. 業務的に抜けている部分

#### 4-1. 事前チェックイン機能

**問題:**
- 事前チェックインページが未実装
- 顧客が事前に入力できる機能がない
- メール送信機能が未実装

**影響:**
- 顧客が事前に入力できない
- 受付時の作業が増える

**推奨対応:**
- 事前チェックインページを実装
- メール送信機能を実装

---

#### 4-2. 部品管理機能

**問題:**
- 部品の発注先、到着状況、在庫場所の管理機能が未実装
- 全部品到着時の自動通知機能が未実装

**影響:**
- 部品の到着状況が分からない
- 全部品到着時の連絡が手動になる

**推奨対応:**
- 部品管理機能を実装
- 全部品到着時の自動通知機能を実装

---

#### 4-3. 診断料金管理機能

**問題:**
- 診断料金の管理機能が未実装
- 診断料金の自動割引機能が未実装

**影響:**
- 診断料金の管理ができない
- 見積もりに診断料金が含まれない

**推奨対応:**
- 診断料金管理機能を実装
- 診断料金の自動割引機能を実装

---

#### 4-4. ジョブメモ機能

**問題:**
- ジョブメモ機能が未実装
- 時間軸でのメモ管理ができない

**影響:**
- ジョブに関するメモが残せない
- 情報の共有が困難

**推奨対応:**
- ジョブメモ機能を実装

---

#### 4-5. 車検チェックリスト機能

**問題:**
- 車検入庫時チェックリストが未実装
- 車検出庫時チェックリストが未実装

**影響:**
- 車検時のチェックリストが手動になる
- ミスが発生する可能性がある

**推奨対応:**
- 車検チェックリスト機能を実装

---

#### 4-6. 作業指示書PDF出力機能

**問題:**
- 作業指示書PDF出力機能が未実装

**影響:**
- アナログ整備士が作業指示書を印刷できない
- 紙とデジタルの併用ができない

**推奨対応:**
- 作業指示書PDF出力機能を実装

---

### 5. システム連携の問題

#### 5-1. Zoho CRM連携

**問題:**
- 2回予約フローの自動紐付けワークフローが未設定（外部作業）
- カスタムフィールド（`ID_BookingId_2`、`field26`、`field23`）が未追加（外部作業）

**影響:**
- 2回目の予約が自動で紐付けられない
- 手動で紐付ける必要がある

**推奨対応:**
- Zoho CRM側でワークフローを設定
- カスタムフィールドを追加

---

#### 5-2. LINE通知

**問題:**
- 全部品到着通知が未実装

**影響:**
- 全部品到着時の連絡が手動になる

**推奨対応:**
- 全部品到着通知を実装

---

## 確認が必要な箇所（詳細）

### 1. 入庫区分の判定ロジック

**確認箇所:**
- `src/app/mechanic/diagnosis/[id]/page.tsx`（行567-611）
- `src/app/mechanic/work/[id]/page.tsx`（行485-498）
- `src/app/admin/estimate/[id]/page.tsx`（行540-642）

**確認内容:**
- `serviceKinds`の取得方法が正しいか
- 複数の入庫区分が設定されている場合の処理が適切か
- 判定の順序が適切か（`isInspection`を先に判定しているため、エンジンオイル交換でも車検が優先される可能性）

---

### 2. 「分解整備記録簿（電子版）」の表示箇所

**確認箇所:**
- `src/app/customer/report/[id]/page.tsx`（全体）
- `src/components/features/customer-progress-view.tsx`（全体）
- その他の顧客向け画面

**確認内容:**
- 「分解整備記録簿（電子版）」という文字列がどこで表示されているか
- 表示条件が適切か（車検・12ヵ月点検の場合のみ表示すべき）

---

### 3. スマホ表示の確認

**確認箇所:**
- すべての画面

**確認内容:**
- コンポーネントがはみ出していないか
- 文字がはみ出していないか
- ボタンがタップしやすいか
- スクロールが適切に動作しているか

---

## 参照

- `docs/UX_REVIEW_COMPREHENSIVE.md` - 包括的なレビュー結果
- `SPECIFICATION.md` - システム仕様書







