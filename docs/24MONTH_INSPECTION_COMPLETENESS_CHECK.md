# 24ヶ月点検（車検）実装完了度チェック

**作成日**: 2025-01-XX  
**目的**: 24ヶ月点検のPDFテンプレートと実装の対応確認

---

## 📋 PDFテンプレート要件 vs 実装状況

### 1. 測定値記入欄

#### 1-1. CO・HC濃度（アイドリング時）

**PDFテンプレート:**
- CO [　　] ％
- HC [　　] ppm

**実装状況:**
- ✅ `InspectionMeasurements.co` (number)
- ✅ `InspectionMeasurements.hc` (number)
- ✅ `InspectionMeasurementInput`コンポーネントに実装済み

**確認結果**: ✅ **問題なし**

#### 1-2. タイヤの溝の深さ（1.6mm以上）

**PDFテンプレート:**
- 前輪 左 [　　] mm ／ 右 [　　] mm
- 後輪 左 [　　] mm ／ 右 [　　] mm

**実装状況:**
- ✅ `InspectionMeasurements.tireFrontLeft` (number)
- ✅ `InspectionMeasurements.tireFrontRight` (number)
- ✅ `InspectionMeasurements.tireRearLeft` (number)
- ✅ `InspectionMeasurements.tireRearRight` (number)
- ✅ `InspectionMeasurementInput`コンポーネントに実装済み

**確認結果**: ✅ **問題なし**

#### 1-3. ブレーキ・パッド、ライニングの厚さ

**PDFテンプレート:**
- 前輪 左 [　　] mm ／ 右 [　　] mm
- 後輪 左 [　　] mm ／ 右 [　　] mm

**実装状況:**
- ✅ `InspectionMeasurements.brakeFrontLeft` (number)
- ✅ `InspectionMeasurements.brakeFrontRight` (number)
- ✅ `InspectionMeasurements.brakeRearLeft` (number)
- ✅ `InspectionMeasurements.brakeRearRight` (number)
- ✅ `InspectionMeasurementInput`コンポーネントに実装済み

**確認結果**: ✅ **問題なし**

---

### 2. 交換部品

**PDFテンプレート:**
| 交換部品等 | 数量 |
|:---|:---:|
| エンジン・オイル | ℓ |
| オイルフィルタ | 個 |
| LLC（ロング・ライフ・クーラント） | ℓ |
| ブレーキ・フルード | ℓ |

**実装状況:**
- ✅ `InspectionParts.engineOil` (number) - エンジン・オイル（ℓ）
- ✅ `InspectionParts.oilFilter` (number) - オイルフィルタ（個）
- ❌ `InspectionParts.llc` (number) - **未実装**
- ❌ `InspectionParts.brakeFluid` (number) - **未実装**
- ✅ `InspectionParts.wiperRubber` (number) - ワイパーゴム（個）- PDFテンプレートにはない
- ✅ `InspectionParts.airFilter` (number) - クリーンエアフィルター（個）- PDFテンプレートにはない

**確認結果**: ⚠️ **LLCとブレーキフルードが不足**

---

### 3. 検査項目

#### 3-1. エンジン・ルーム点検

**PDFテンプレート項目:**
1. パワー・ステアリング
   - ベルトの緩み、損傷
   - ★取付けの緩み
   - オイルの漏れ
   - オイルの量
2. 冷却装置
   - ファンベルトの緩み、損傷
   - 冷却水の漏れ
3. 点火装置
   - ☆スパーク・プラグの状態
   - 点火時期
   - ディストリビュータのキャップの状態
4. 燃料装置
   - 燃料の漏れ
5. バッテリ、電気配線
   - ターミナル部の緩み、腐食による接続不良
   - 電気配線の接続部の緩み、損傷
6. 公害発散防止装置等
   - メターリングバルブの状態
   - ブローバイ・ガス還元装置の配管の損傷
   - 燃料蒸発ガス排出抑止装置の配管等の損傷
   - チャコール・キャニスタの詰まり、損傷
   - 燃料蒸発ガス排出抑止装置のチェック・バルブの機能
   - 触媒反応方式等の排出ガス減少装置の取付けの緩み、損傷
   - 二次空気供給装置の機能
   - 排気ガス再循環装置の機能
   - 減速時排気ガス減少装置の機能
   - 一酸化炭素等発散防止装置の配管の損傷、取付け状態
7. エンジン
   - 排気ガスの色
   - CO、HCの濃度
   - ☆エア・クリーナ・エレメントの汚れ、詰まり、損傷

**実装状況**: ✅ **確認必要**（`inspection-items-redesign.ts`で確認）

#### 3-2. 室内点検

**PDFテンプレート項目:**
1. ハンドル
   - 操作具合
   - 遊び、がた
2. ブレーキ・ペダル
   - 遊び
   - 踏み込んだときの床板とのすき間
   - ブレーキのきき具合
3. パーキング・ブレーキ・レバー（ペダル）
   - 引きしろ（踏みしろ）
   - パーキング・ブレーキのきき具合
4. クラッチ・ペダル
   - 遊び
   - 切れたときの床板とのすき間

**実装状況**: ✅ **確認必要**

#### 3-3. 足廻り点検

**PDFテンプレート項目:**
1. かじ取り車輪
   - ★ホイール・アライメント
2. ホイール
   - ☆タイヤの空気圧（スペアタイヤ含む）
   - ☆タイヤの亀裂、損傷
   - ☆タイヤの溝の深さ、異常な摩耗
   - ☆ボルト、ナットの緩み
   - ★フロント・ホイール・ベアリングのがた
   - ★リヤ・ホイール・ベアリングのがた
3. ショック・アブソーバ
   - 損傷、オイルの漏れ
4. サスペンション
   - 取付部、連結部の緩み、がた、損傷
5. ブレーキ・ディスク、ドラム
   - ☆ディスクとパッドとのすき間
   - ドラムの摩耗、損傷
   - ☆ブレーキ・パッドの摩耗
   - ディスクの摩耗、損傷
   - ☆ドラムとライニングとのすき間
   - ☆ブレーキシューの摺動部分、ライニングの摩耗
   - ドラムの摩耗、損傷
6. ブレーキのマスタ・シリンダ、ホイール・シリンダ、ディスク、キャリパ
   - マスタ・シリンダの液漏れ
   - ホイール・シリンダの液漏れ
   - ディスク・キャリパの液漏れ
   - マスタ・シリンダの機能、摩耗、損傷
   - ホイール・シリンダの機能、摩耗、損傷
   - ディスク・キャリパの機能、摩耗、損傷

**実装状況**: ✅ **確認必要**

#### 3-4. 下廻り点検

**PDFテンプレート項目:**
1. エンジン・オイル
   - 漏れ
2. ステアリング・ギヤ・ボックス
   - ★取付けの緩み
3. ステアリングのロッド、アーム類
   - ★緩み、がた、損傷
   - ボール・ジョイントのダスト・ブーツの亀裂、損傷
4. トランスミッション、トランスファ
   - ☆オイルの漏れ、量
5. プロペラシャフト・ドライブシャフト
   - ☆連結部の緩み
   - ドライブシャフトのユニバーサルジョイント部のダスト・ブーツの亀裂、損傷
6. デファレンシャル
   - ★オイルの漏れ
   - ★オイルの量
7. ブレーキ・ホース、パイプ
   - 漏れ、損傷、取付状態
8. エグゾースト・パイプ、マフラ
   - ☆取付けの緩み、損傷、腐食
   - ☆遮熱板の取付けの緩み、損傷、腐食
   - マフラの機能

**実装状況**: ✅ **確認必要**

#### 3-5. 外廻り点検

**PDFテンプレート項目:**
1. フレーム、ボデー
   - 緩み、損傷

**実装状況**: ✅ **確認必要**

#### 3-6. 日常点検

**PDFテンプレート項目:**
1. ブレーキ液の量
2. バッテリ液の量
3. 冷却水の量
4. エンジン・オイルの量
5. エンジンのかかり具合、異音
6. 低速と加速の状態
7. ヘッドランプ、ストップ・ランプ、ウインカ・ランプ等の点灯、汚れ、損傷
8. ウインド・ウオッシャ液の量
9. ウインド・ウオッシャ液の噴射状態
10. ワイパの拭き取り状態

**実装状況（`dailyItems24Month`）:**
- ✅ `daily-001`: バッテリーの液量 → PDFテンプレート「バッテリ液の量」
- ✅ `daily-002`: 冷却水の量 → PDFテンプレート「冷却水の量」
- ✅ `daily-003`: エンジンオイルの量 → PDFテンプレート「エンジン・オイルの量」
- ✅ `daily-004`: エンジンのかかり具合、異音 → PDFテンプレート「エンジンのかかり具合、異音」
- ✅ `daily-005`: 灯火装置及び方向指示器の作用、汚れ、損傷 → PDFテンプレート「ヘッドランプ、ストップ・ランプ、ウインカ・ランプ等の点灯、汚れ、損傷」
- ✅ `daily-006`: ウインドウォッシャーの液量 → PDFテンプレート「ウインド・ウオッシャ液の量」
- ❌ **不足**: ブレーキ液の量
- ❌ **不足**: 低速と加速の状態
- ❌ **不足**: ウインド・ウオッシャ液の噴射状態
- ❌ **不足**: ワイパの拭き取り状態

**確認結果**: ⚠️ **4項目が不足**

---

### 4. ステータス記号

**PDFテンプレート凡例:**
| 記号 | 意味 |
|:---:|:---|
| レ | 点検良好 |
| × | 交 換 |
| A | 調 整 |
| C | 清 掃 |
| P | 省 略 |
| △ | 修 理 |
| T | 締 付 |
| L | 給油（水） |
| ／ | 該当なし |

**実装状況:**
- ✅ `InspectionStatus.good` → レ
- ✅ `InspectionStatus.exchange` → ×
- ✅ `InspectionStatus.adjust` → A
- ✅ `InspectionStatus.clean` → C
- ✅ `InspectionStatus.omit` → P
- ✅ `InspectionStatus.repair` → △
- ✅ `InspectionStatus.tighten` → T
- ✅ `InspectionStatus.lubricate` → L
- ✅ `InspectionStatus.none` → ／
- ❌ `InspectionStatus.specific` → ○ - **PDFテンプレートにはない（12ヶ月点検のみ）**

**確認結果**: ✅ **24ヶ月点検の記号はすべて実装済み**

---

### 5. 省略可能項目のマーキング

**PDFテンプレート:**
- ☆印: 1年 5,000km以下で省略可能
- ★印: 2年 10,000km以下で省略可能

**実装状況:**
- ❌ **未実装** - `isOmittableByMileage`と`isOmittableByMileageToyota`はあるが、☆と★の区別がない

**確認結果**: ⚠️ **省略可能項目のマーキングが不足**

---

### 6. PDF生成

**実装状況:**
- ⚠️ **未実装** - `inspection-template-pdf-generator.ts`は存在するが、実際のPDF生成ロジックは未実装

**確認結果**: ❌ **PDF生成が未実装**

---

## 🔧 必要な修正

### 優先度高

1. ✅ **`InspectionParts`インターフェースの拡張** - **完了**
   - `llc?: number` 追加済み
   - `brakeFluid?: number` 追加済み

2. ✅ **交換部品入力コンポーネントの追加** - **完了**
   - `InspectionPartsInput`コンポーネント作成済み
   - LLCとブレーキフルードの入力フィールド追加済み

3. ⚠️ **24ヶ月点検の測定値入力欄**
   - 現在は12ヶ月点検のみ実装
   - 24ヶ月点検でも測定値入力欄を表示する必要がある

4. ✅ **24ヶ月点検の日常点検項目の追加** - **完了**
   - `daily-007`: ブレーキ液の量 追加済み
   - `daily-008`: 低速と加速の状態 追加済み
   - `daily-009`: ウインドウォッシャーの噴射状態 追加済み
   - `daily-010`: ワイパの拭き取り状態 追加済み

### 優先度中

4. **省略可能項目のマーキング**
   - ☆印と★印の区別を実装
   - UIに表示

5. **検査項目の完全性確認**
   - `inspection-items-redesign.ts`の24ヶ月点検項目がPDFテンプレートと一致しているか確認
   - 不足項目があれば追加

### 優先度低（将来の実装）

6. **PDF生成ロジックの実装**
   - テンプレートPDFへの値のマッピング
   - 座標の定義

---

## ✅ チェックリスト

- [x] `InspectionParts`に`llc`と`brakeFluid`を追加
- [x] `InspectionPartsInput`コンポーネントを作成
- [ ] 24ヶ月点検の測定値入力欄を実装（テストページに追加）
- [ ] 24ヶ月点検の交換部品入力欄を実装（テストページに追加）
- [ ] 省略可能項目のマーキング（☆、★）を実装
- [x] 24ヶ月点検の検査項目リストをPDFテンプレートと照合（日常点検項目追加済み）
- [ ] PDF生成ロジックの実装（座標マッピングが必要）

---

## 📝 まとめ

### 実装済み ✅

1. **交換部品データモデル**: `InspectionParts`に`llc`と`brakeFluid`を追加
2. **交換部品入力コンポーネント**: `InspectionPartsInput`を作成
3. **24ヶ月点検の日常点検項目**: 不足していた4項目を追加
4. **測定値入力欄**: テストページに追加済み
5. **交換部品入力欄**: テストページに追加済み

### 未実装 ⚠️

1. **写真・動画撮影機能**: 24ヶ月点検再設計画面に追加が必要（**重要**: 顧客への提示に必要）
2. **省略可能項目のマーキング（☆、★）**: UIに表示機能が必要
3. **PDF生成ロジック**: 実際のPDFテンプレートの座標を確認してマッピングが必要
4. **自動車分解整備事業者情報の取得**: 環境変数または設定画面から取得する仕組みが必要

### PDFフッター情報の取得状況

**自動取得可能** ✅:
- 点検年月日: `WorkOrder.createdAt`
- 整備完了年月日: `WorkOrder.work.completedAt`
- 整備主任者の氏名: `WorkOrder.work.mechanicName`
- 総走行距離: `WorkOrder.diagnosis.mileage`

**要実装・要設定** ⚠️:
- 自動車分解整備事業者の氏名・所在地・認証番号: 環境変数または設定画面から取得

### 結論

**データモデルとコンポーネントは整備済み**。ただし、**写真・動画撮影機能が24ヶ月点検再設計画面に未実装**であることが重大な問題です。顧客への提示機能が欠けているため、早急に実装が必要です。

詳細は `docs/24MONTH_INSPECTION_PDF_REQUIREMENTS.md` を参照してください。

