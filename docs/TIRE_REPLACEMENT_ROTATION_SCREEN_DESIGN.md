# タイヤ交換・ローテーション 画面設計書

## ドキュメント情報

- **作成日**: 2025-01-XX
- **バージョン**: 1.0
- **対象**: タイヤ交換・ローテーションの各画面の詳細設計
- **設計方針**: 世界最高のUI/UX、ITコンサルの目線での推奨を元に設計
- **業務フローパターン**: パターンB（事前見積→了承→入庫→作業）
- **注意**: タイヤ交換とローテーションは別々の入庫区分だが、同じ画面設計を共有

---

## 1. 画面一覧

### 1-1. 整備士向け画面

1. **診断画面** (`/mechanic/diagnosis/[id]`)
   - 簡易検査項目の入力（3カテゴリ）
   - 写真撮影（必要に応じて）
   - 測定値入力画面への遷移

2. **測定値入力画面** (`/mechanic/diagnosis/[id]/measurements`)
   - タイヤ溝深さの入力（前後左右）
   - 空気圧の入力（前後左右）

3. **作業画面** (`/mechanic/work/[id]`)
   - 作業記録の入力
   - Before/After写真の撮影
   - バランス調整結果の記録
   - 空気圧設定値の記録

### 1-2. 特徴

- **見積もり画面・承認画面は不要**: 予約時に実施が確定しているため
- **簡易検査**: 3カテゴリ（タイヤの状態確認、空気圧の確認、ホイールの状態確認）
- **測定値入力**: タイヤ溝深さ、空気圧の測定値入力が必要
- **所要時間**: 2時間で完了
- **写真撮影**: Before（交換前のタイヤ）、After（交換後のタイヤ）
- **タイヤ交換とローテーション**: 別々の入庫区分だが、同じ画面設計を共有

---

## 2. 診断画面の詳細設計

### 2-1. 画面構成

#### レイアウト構造

```
┌─────────────────────────────────────────┐
│ [←] 田中様 BMW X3 タイヤ交換診断          │
│ 整備士: 中村                             │
├─────────────────────────────────────────┤
│ 📋 車両情報（自動入力済み・編集不可）     │
│ ┌─────────────────────────────────────┐ │
│ │ 登録番号: 堺 330 す 1669            │ │
│ │ 車台番号: VF3CUHNZTHY061316         │ │
│ │ 初度登録: H29.10                    │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 🔍 簡易検査項目                          │
│ 進捗: ████████░░ 2/3カテゴリ完了 (67%) │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ 1. タイヤの状態確認                  │ │
│ │ ─────────────────────────────────── │ │
│ │ タイヤの溝の深さ:                    │ │
│ │ [正常] [注意] [要交換]              │ │
│ │                                      │ │
│ │ タイヤの摩耗状態:                    │ │
│ │ [正常] [偏摩耗] [片減り] [要交換]   │ │
│ │                                      │ │
│ │ タイヤの損傷:                        │ │
│ │ [正常] [キズ] [パンク痕] [バルジ]   │ │
│ │                                      │ │
│ │ タイヤの製造年（DOT表示）:           │ │
│ │ [正常] [古い] [要交換]              │ │
│ │                                      │ │
│ │ [📷 写真を追加] [💬 コメント]       │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ 2. 空気圧の確認                      │ │
│ │ ─────────────────────────────────── │ │
│ │ 前後左右の空気圧:                    │ │
│ │ [正常] [不足] [過多] [不均一]       │ │
│ │                                      │ │
│ │ 推奨空気圧との比較:                  │ │
│ │ [正常] [不足] [過多]                │ │
│ │ （推奨空気圧: 前 230kPa / 後 230kPa）│ │
│ │                                      │ │
│ │ [📷 写真を追加] [💬 コメント]       │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ 3. ホイールの状態確認                │ │
│ │ ─────────────────────────────────── │ │
│ │ ホイールの損傷:                      │ │
│ │ [正常] [クラック] [曲がり] [要修理] │ │
│ │                                      │ │
│ │ ホイールナットの緩み:                │ │
│ │ [正常] [緩みあり] [要調整]          │ │
│ │                                      │ │
│ │ ホイールバランスの状態:              │ │
│ │ [正常] [バランス不良] [要調整]      │ │
│ │                                      │ │
│ │ [📷 写真を追加] [💬 コメント]       │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ [測定値入力] [一時保存] [診断完了]       │
└─────────────────────────────────────────┘
```

### 2-2. コンポーネント設計

#### 2-2-1. 車両情報カード

**目的**: 診断対象の車両情報を表示（誤操作防止のため編集不可）

**表示項目**:
- 依頼者(使用者)の氏名又は名称
- 車名及び型式
- 自動車登録番号又は車両番号
- 原動機の型式
- 初度登録年又は初度検査年
- 車台番号

**データソース**: Google Sheets「【DB】車両マスタ」から自動取得

**UI/UXのポイント**:
- 背景色を薄くして、編集不可であることを視覚的に示す
- アイコン（🔒）で編集不可であることを示す

#### 2-2-2. 簡易検査項目カード

**目的**: 3つのカテゴリの簡易検査項目の状態を入力

**検査カテゴリ**:
1. **タイヤの状態確認**
   - タイヤの溝の深さ: 正常/注意/要交換
   - タイヤの摩耗状態: 正常/偏摩耗/片減り/要交換
   - タイヤの損傷: 正常/キズ/パンク痕/バルジ/要交換
   - タイヤの製造年（DOT表示）: 正常/古い/要交換
2. **空気圧の確認**
   - 前後左右の空気圧: 正常/不足/過多/不均一
   - 推奨空気圧との比較: 正常/不足/過多
   - 推奨空気圧の表示（車両情報から自動取得）
3. **ホイールの状態確認**
   - ホイールの損傷: 正常/クラック/曲がり/要修理
   - ホイールナットの緩み: 正常/緩みあり/要調整
   - ホイールバランスの状態: 正常/バランス不良/要調整

**状態選択ボタンのデザイン**:
- **正常**: 緑色、チェックマークアイコン
- **注意**: 黄色、警告アイコン
- **要交換/要修理/要調整**: 赤色、Xアイコン
- **偏摩耗/片減り/不均一**: 黄色、警告アイコン
- **キズ/パンク痕/バルジ/クラック/曲がり**: 黄色、警告アイコン
- **古い**: 黄色、警告アイコン

**UI/UXのポイント**:
- ボタンは画面幅いっぱいに配置（タッチしやすい）
- 選択された状態は明確に表示（背景色、アイコン）
- 写真ボタンは撮影済みの場合、サムネイルを表示
- コメントがある場合、アイコンで表示
- 各カテゴリは独立したカードとして表示（視認性向上）
- 推奨空気圧は車両情報から自動取得して表示

#### 2-2-3. 進捗バー

**目的**: 簡易検査の進捗を可視化

**表示内容**:
- 完了カテゴリ数 / 全カテゴリ数（3カテゴリ）
- 進捗パーセンテージ
- プログレスバー（視覚的）

**UI/UXのポイント**:
- 色で進捗を表現（0-50%: 赤、50-80%: 黄、80-100%: 緑）
- 数値と視覚的表現の両方で進捗を表示

#### 2-2-4. 測定値入力ボタン

**目的**: 測定値入力画面への遷移

**表示内容**:
- アイコン（📏）
- ラベル「測定値入力」
- 未入力の場合、バッジで「未入力」を表示
- 入力済みの場合、バッジで「入力済み」を表示

**UI/UXのポイント**:
- 測定値入力画面への遷移ボタンとして機能
- 入力状態を視覚的に表示

#### 2-2-5. 一時保存ボタン

**目的**: 現在の入力内容を保存（自動保存も実施）

**UI/UXのポイント**:
- 保存成功時にトースト通知（邪魔にならない程度に）
- オフライン時も保存可能（ローカルストレージ）
- 自動保存も実施（30秒ごと、または項目変更時）

#### 2-2-6. 診断完了ボタン

**目的**: 診断を完了し、作業画面への遷移を可能にする

**UI/UXのポイント**:
- 全てのカテゴリが完了していない場合、警告を表示（任意）
- 測定値が未入力の場合、警告を表示（推奨）
- 確認ダイアログを表示（任意、簡易検査のため）
- 完了後、作業画面への遷移を可能にする

### 2-3. データフロー

```
1. 画面読み込み
   ↓
2. 車両情報を取得（Google Sheets）
   ↓
3. 推奨空気圧を取得（車両情報から）
   ↓
4. 既存の診断結果を取得（Zoho CRM）
   ↓
5. 簡易検査項目を表示
   ↓
6. 整備士が各カテゴリの状態を選択
   ↓
7. 自動保存（30秒ごと、または項目変更時）
   ↓
8. 測定値入力画面で測定値を入力
   ↓
9. 診断完了ボタンをタップ
   ↓
10. 診断結果を保存（Zoho CRM）
   ↓
11. 作業画面への遷移を可能にする
```

### 2-4. インタラクション設計

#### 2-4-1. 状態選択

- **タップ**: 状態を選択
- **選択済み**: 背景色とアイコンで明確に表示
- **変更**: 別の状態をタップすると、前の選択が解除され、新しい状態が選択される

#### 2-4-2. 写真撮影

- **タップ**: カメラを起動
- **撮影**: 写真を撮影
- **確認**: 撮影後、確認画面を表示（再撮影可能）
- **保存**: 確認後、写真を保存（Google Drive）
- **表示**: 撮影済みの場合、サムネイルを表示

#### 2-4-3. コメント入力

- **タップ**: コメント入力ダイアログを表示
- **入力**: テキストを入力
- **保存**: 保存ボタンをタップして保存
- **表示**: コメントがある場合、アイコンで表示

#### 2-4-4. 測定値入力画面への遷移

- **タップ**: 測定値入力画面に遷移
- **入力済み**: バッジで「入力済み」を表示

#### 2-4-5. エラーハンドリング

- **ネットワークエラー**: オフライン時はローカルストレージに保存、オンライン時に自動同期
- **保存エラー**: エラーメッセージを表示、再試行ボタンを表示
- **写真アップロードエラー**: エラーメッセージを表示、再アップロードボタンを表示

### 2-5. 状態管理

- **ローディング**: 車両情報取得中、診断結果保存中
- **エラー**: ネットワークエラー、保存エラー
- **成功**: 診断完了、作業画面への遷移可能

---

## 3. 測定値入力画面の詳細設計

### 3-1. 画面構成

#### レイアウト構造

```
┌─────────────────────────────────────────┐
│ [←] 測定値入力                            │
├─────────────────────────────────────────┤
│ 📏 タイヤ溝深さ（1.6mm以上）              │
│ ┌─────────────────────────────────────┐ │
│ │ 前輪左: [____] mm                   │ │
│ │ 前輪右: [____] mm                   │ │
│ │ 後輪左: [____] mm                   │ │
│ │ 後輪右: [____] mm                   │ │
│ │                                      │ │
│ │ 法定基準: 1.6mm以上                  │ │
│ │ 推奨基準: 3mm以上（輸入車の場合）    │ │
│ │                                      │ │
│ │ [📷 タイヤの写真を追加]             │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 💨 空気圧                                │
│ ┌─────────────────────────────────────┐ │
│ │ 推奨空気圧（車両情報から自動取得）   │ │
│ │ 前輪: 230 kPa                        │ │
│ │ 後輪: 230 kPa                        │ │
│ │                                      │ │
│ │ 前輪左: [____] kPa                   │ │
│ │ 前輪右: [____] kPa                   │ │
│ │ 後輪左: [____] kPa                   │ │
│ │ 後輪右: [____] kPa                   │ │
│ │                                      │ │
│ │ 比較結果:                            │ │
│ │ 前輪左: [正常] [不足] [過多]        │ │
│ │ 前輪右: [正常] [不足] [過多]        │ │
│ │ 後輪左: [正常] [不足] [過多]        │ │
│ │ 後輪右: [正常] [不足] [過多]        │ │
│ │                                      │ │
│ │ [📷 空気圧計の写真を追加]           │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ [保存] [診断画面に戻る]                  │
└─────────────────────────────────────────┘
```

### 3-2. コンポーネント設計

#### 3-2-1. タイヤ溝深さ入力セクション

**目的**: 前後左右のタイヤ溝深さを入力

**入力項目**:
- 前輪左: 数値入力（mm単位）
- 前輪右: 数値入力（mm単位）
- 後輪左: 数値入力（mm単位）
- 後輪右: 数値入力（mm単位）

**バリデーション**:
- 法定基準: 1.6mm以上（警告表示）
- 推奨基準: 3mm以上（輸入車の場合、警告表示）
- 範囲チェック: 0-20mm（リアルタイムバリデーション）

**UI/UXのポイント**:
- 数字キーパッドを表示（テンキー）
- 単位を明示（mm）
- 範囲チェック（リアルタイムバリデーション）
- 法定基準・推奨基準を表示
- 基準を下回る場合、警告色で表示

#### 3-2-2. 空気圧入力セクション

**目的**: 前後左右の空気圧を入力

**入力項目**:
- 推奨空気圧: 車両情報から自動取得（表示のみ）
- 前輪左: 数値入力（kPa単位）
- 前輪右: 数値入力（kPa単位）
- 後輪左: 数値入力（kPa単位）
- 後輪右: 数値入力（kPa単位）

**比較機能**:
- 実際の空気圧と推奨空気圧を自動比較
- 比較結果を表示（正常/不足/過多）
- 比較結果に応じて色分け（正常: 緑、不足/過多: 黄/赤）

**バリデーション**:
- 範囲チェック: 0-500kPa（リアルタイムバリデーション）
- 推奨空気圧との差を計算

**UI/UXのポイント**:
- 数字キーパッドを表示（テンキー）
- 単位を明示（kPa）
- 推奨空気圧を自動表示（車両情報から）
- 比較結果を自動表示（正常/不足/過多）
- 比較結果に応じて色分け

#### 3-2-3. 写真追加ボタン

**目的**: 測定値に関連する写真を追加

**機能**:
- タイヤの写真を追加（タイヤ溝深さセクション）
- 空気圧計の写真を追加（空気圧セクション）

**UI/UXのポイント**:
- 各セクションに写真追加ボタンを配置
- 撮影済みの場合、サムネイルを表示

#### 3-2-4. 保存ボタン

**目的**: 測定値を保存

**UI/UXのポイント**:
- 保存成功時にトースト通知
- 保存後、診断画面に戻る

### 3-3. データフロー

```
1. 画面読み込み
   ↓
2. 車両情報を取得（推奨空気圧を含む）
   ↓
3. 既存の測定値を取得（Zoho CRM）
   ↓
4. 測定値入力フィールドを表示
   ↓
5. 整備士が測定値を入力
   ↓
6. リアルタイムバリデーション
   ↓
7. 推奨空気圧との比較（空気圧の場合）
   ↓
8. 保存ボタンをタップ
   ↓
9. 測定値を保存（Zoho CRM）
   ↓
10. 診断画面に戻る
```

### 3-4. インタラクション設計

#### 3-4-1. 数値入力

- **タップ**: 数字キーパッドを表示
- **入力**: 数値を入力
- **バリデーション**: リアルタイムで範囲チェック
- **比較**: 空気圧の場合、推奨空気圧と自動比較

#### 3-4-2. エラーハンドリング

- **範囲外の値**: エラーメッセージを表示
- **保存エラー**: エラーメッセージを表示、再試行ボタンを表示

### 3-5. 状態管理

- **ローディング**: 車両情報取得中、測定値保存中
- **エラー**: ネットワークエラー、保存エラー、バリデーションエラー
- **成功**: 測定値保存完了、診断画面への遷移

---

## 4. 作業画面の詳細設計

### 4-1. 画面構成

#### レイアウト構造

```
┌─────────────────────────────────────────┐
│ [←] 田中様 BMW X3 タイヤ交換作業          │
│ 整備士: 中村                             │
├─────────────────────────────────────────┤
│ 📋 車両情報（自動入力済み・編集不可）     │
│ ┌─────────────────────────────────────┐ │
│ │ 登録番号: 堺 330 す 1669            │ │
│ │ 車台番号: VF3CUHNZTHY061316         │ │
│ │ 初度登録: H29.10                    │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📝 作業記録                              │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ 【タイヤ交換の場合】                │ │
│ │ 交換したタイヤ                       │ │
│ │ ─────────────────────────────────── │ │
│ │ メーカー: [ブリヂストン]            │ │
│ │ サイズ:   [225/45R17]               │ │
│ │ 種類:     [ポテンザ RE050A]        │ │
│ │                                      │ │
│ │ 交換位置:                            │ │
│ │ [✓] 前輪左 [✓] 前輪右               │ │
│ │ [✓] 後輪左 [✓] 後輪右               │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ 【タイヤローテーションの場合】       │ │
│ │ ローテーション位置                   │ │
│ │ ─────────────────────────────────── │ │
│ │ 前左 → [後右]                       │ │
│ │ 前右 → [後左]                       │ │
│ │ 後左 → [前左]                       │ │
│ │ 後右 → [前右]                       │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ バランス調整結果                    │ │
│ │ ─────────────────────────────────── │ │
│ │ 前輪左: [____] g                    │ │
│ │ 前輪右: [____] g                    │ │
│ │ 後輪左: [____] g                    │ │
│ │ 後輪右: [____] g                    │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ 空気圧設定値                        │ │
│ │ ─────────────────────────────────── │ │
│ │ 前輪左: [230] kPa                   │ │
│ │ 前輪右: [230] kPa                   │ │
│ │ 後輪左: [230] kPa                   │ │
│ │ 後輪右: [230] kPa                   │ │
│ │ （推奨空気圧から自動入力可能）       │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📸 Before/After写真                     │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ Before: 交換前のタイヤの状態        │ │
│ │ [📷 写真を追加]                      │ │
│ │                                      │ │
│ │ [写真1] [写真2] [写真3] [写真4]     │ │
│ │ （サムネイル表示、タップで拡大）     │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ After: 交換後のタイヤの状態          │ │
│ │ [📷 写真を追加]                      │ │
│ │                                      │ │
│ │ [写真1] [写真2] [写真3] [写真4]     │ │
│ │ （サムネイル表示、タップで拡大）     │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📋 簡易検査結果（診断画面から引き継ぎ）  │
│ ┌─────────────────────────────────────┐ │
│ │ 1. タイヤの状態確認: [正常]          │ │
│ │ 2. 空気圧の確認: [注意]             │ │
│ │ 3. ホイールの状態確認: [正常]       │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📏 測定値（診断画面から引き継ぎ）        │
│ ┌─────────────────────────────────────┐ │
│ │ タイヤ溝深さ:                       │ │
│ │ 前輪左: 3.5mm / 前輪右: 3.2mm       │ │
│ │ 後輪左: 4.0mm / 後輪右: 3.8mm       │ │
│ │                                      │ │
│ │ 空気圧（作業前）:                   │ │
│ │ 前輪左: 220kPa / 前輪右: 225kPa     │ │
│ │ 後輪左: 215kPa / 後輪右: 220kPa     │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 💬 作業メモ                             │
│ ┌─────────────────────────────────────┐ │
│ │                                     │ │
│ │  自由記述欄                          │ │
│ │  （複数行入力可能）                  │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ [一時保存] [作業完了]                    │
└─────────────────────────────────────────┘
```

### 4-2. コンポーネント設計

#### 4-2-1. 車両情報カード

**目的**: 作業対象の車両情報を表示（誤操作防止のため編集不可）

**表示項目**: 診断画面と同様

**データソース**: Google Sheets「【DB】車両マスタ」から自動取得

#### 4-2-2. 作業記録セクション

**目的**: 作業内容を記録

**タイヤ交換の場合**:
- **交換したタイヤ**
  - メーカー: テキスト入力またはドロップダウン選択
  - サイズ: テキスト入力（例: 225/45R17）
  - 種類: テキスト入力（例: ポテンザ RE050A）
- **交換位置**: チェックボックス（前輪左、前輪右、後輪左、後輪右）

**タイヤローテーションの場合**:
- **ローテーション位置**: ドロップダウン選択
  - 前左 → 後右/後左/前右
  - 前右 → 後右/後左/前左
  - 後左 → 前左/前右/後右
  - 後右 → 前左/前右/後左

**共通項目**:
- **バランス調整結果**: 前後左右のバランス値（g単位）
- **空気圧設定値**: 前後左右の空気圧（kPa単位）
  - 推奨空気圧から自動入力可能

**UI/UXのポイント**:
- タイヤ交換とローテーションで表示内容を切り替え
- メーカーはドロップダウンまたはテキスト入力
- サイズはテキスト入力（形式: 225/45R17）
- バランス値は数字キーパッドを表示
- 空気圧は推奨空気圧から自動入力可能

#### 4-2-3. Before/After写真セクション

**目的**: 作業前後の写真を撮影・表示

**Before写真**:
- **タイヤ交換の場合**: 交換前のタイヤ全体（4本）
- **タイヤローテーションの場合**: ローテーション前のタイヤ位置
- **撮影枚数**: 1-4枚推奨

**After写真**:
- **タイヤ交換の場合**: 交換後のタイヤ全体（4本）
- **タイヤローテーションの場合**: ローテーション後のタイヤ位置
- **撮影枚数**: 1-4枚推奨

**UI/UXのポイント**:
- 写真ボタンは大きく表示（タッチしやすい）
- 撮影済みの場合、サムネイルを表示
- サムネイルをタップすると拡大表示
- 複数枚撮影可能
- 写真の削除機能

#### 4-2-4. 簡易検査結果表示

**目的**: 診断画面で入力した簡易検査結果を表示（参考用）

**表示内容**:
- 各カテゴリの状態（正常/注意/要交換）
- 診断画面から自動で引き継ぎ

**UI/UXのポイント**:
- 読み取り専用（編集不可）
- 背景色を薄くして、参考情報であることを示す

#### 4-2-5. 測定値表示

**目的**: 診断画面で入力した測定値を表示（参考用）

**表示内容**:
- タイヤ溝深さ（前後左右）
- 空気圧（作業前、前後左右）
- 診断画面から自動で引き継ぎ

**UI/UXのポイント**:
- 読み取り専用（編集不可）
- 背景色を薄くして、参考情報であることを示す
- 作業前の測定値として表示

#### 4-2-6. 作業メモ入力欄

**目的**: 作業に関する自由記述

**機能**:
- 複数行入力可能
- 文字数制限なし（ただし、システムの制限内）

**UI/UXのポイント**:
- テキストエリアで入力
- プレースホルダーで入力例を表示

#### 4-2-7. 一時保存ボタン

**目的**: 現在の入力内容を保存（自動保存も実施）

**UI/UXのポイント**:
- 保存成功時にトースト通知
- オフライン時も保存可能（ローカルストレージ）
- 自動保存も実施（30秒ごと、または項目変更時）

#### 4-2-8. 作業完了ボタン

**目的**: 作業を完了し、フロントスタッフに通知

**UI/UXのポイント**:
- Before/After写真が撮影されていない場合、警告を表示（推奨）
- バランス調整結果が未入力の場合、警告を表示（推奨）
- 空気圧設定値が未入力の場合、警告を表示（推奨）
- 確認ダイアログを表示
- 完了後、フロントスタッフに通知
- ステータスを「作業完了」に更新

### 4-3. データフロー

```
1. 画面読み込み
   ↓
2. 車両情報を取得（Google Sheets）
   ↓
3. 診断結果を取得（Zoho CRM）
   ↓
4. 測定値を取得（Zoho CRM）
   ↓
5. 作業記録を表示（既存の記録がある場合）
   ↓
6. 整備士が作業記録を入力
   ↓
7. Before/After写真を撮影
   ↓
8. 自動保存（30秒ごと、または項目変更時）
   ↓
9. 作業完了ボタンをタップ
   ↓
10. 作業記録を保存（Zoho CRM）
   ↓
11. 写真をアップロード（Google Drive）
   ↓
12. フロントスタッフに通知
   ↓
13. ステータスを「作業完了」に更新
```

### 4-4. インタラクション設計

#### 4-4-1. 作業記録入力

- **タイヤ交換の場合**:
  - メーカー: テキスト入力またはドロップダウン選択
  - サイズ: テキスト入力
  - 種類: テキスト入力
  - 交換位置: チェックボックスで選択
- **タイヤローテーションの場合**:
  - ローテーション位置: ドロップダウンで選択
- **共通**:
  - バランス調整結果: 数字キーパッドを表示
  - 空気圧設定値: 数字キーパッドを表示（推奨空気圧から自動入力可能）

#### 4-4-2. 写真撮影

- **タップ**: カメラを起動
- **撮影**: 写真を撮影
- **確認**: 撮影後、確認画面を表示（再撮影可能）
- **保存**: 確認後、写真を保存（Google Drive）
- **表示**: 撮影済みの場合、サムネイルを表示
- **拡大**: サムネイルをタップすると拡大表示
- **削除**: 写真を削除（確認ダイアログ表示）

#### 4-4-3. エラーハンドリング

- **ネットワークエラー**: オフライン時はローカルストレージに保存、オンライン時に自動同期
- **保存エラー**: エラーメッセージを表示、再試行ボタンを表示
- **写真アップロードエラー**: エラーメッセージを表示、再アップロードボタンを表示

### 4-5. 状態管理

- **ローディング**: 車両情報取得中、作業記録保存中、写真アップロード中
- **エラー**: ネットワークエラー、保存エラー、写真アップロードエラー
- **成功**: 作業完了、フロントスタッフへの通知完了

---

## 5. データモデル

### 5-1. タイヤ交換・ローテーションジョブデータ

```typescript
/**
 * タイヤ交換・ローテーションジョブ
 */
export interface TireReplacementRotationJob {
  /** Job ID */
  jobId: string;
  /** 入庫区分 */
  serviceKind: "タイヤ交換" | "タイヤローテーション";
  /** 作業タイプ */
  workType: "タイヤ交換" | "タイヤローテーション";
  
  /** 車両情報 */
  vehicle: {
    /** 車両ID */
    vehicleId: string;
    /** 走行距離 */
    mileage: number;
    /** 推奨空気圧（前輪） */
    recommendedTirePressureFront?: number;
    /** 推奨空気圧（後輪） */
    recommendedTirePressureRear?: number;
  };
  
  /** 診断情報 */
  diagnosis: {
    /** 簡易検査結果 */
    inspectionResults: InspectionResult[];
    /** 診断写真 */
    photos: Photo[];
    /** コメント（整備士の所見） */
    comments: string;
  };
  
  /** 測定値 */
  measurements: {
    /** タイヤ溝深さ（作業前） */
    tireTreadDepth: {
      frontLeft: number;
      frontRight: number;
      rearLeft: number;
      rearRight: number;
    };
    /** 空気圧（作業前） */
    tirePressure: {
      frontLeft: number;
      frontRight: number;
      rearLeft: number;
      rearRight: number;
    };
    /** 測定値の写真 */
    photos: Photo[];
  };
  
  /** 作業情報 */
  work: {
    /** タイヤ交換の場合 */
    tireReplacement?: {
      /** メーカー */
      manufacturer: string;
      /** サイズ */
      size: string;
      /** 種類 */
      type: string;
      /** 交換位置 */
      positions: ("前輪左" | "前輪右" | "後輪左" | "後輪右")[];
    };
    /** タイヤローテーションの場合 */
    tireRotation?: {
      /** ローテーション位置 */
      rotation: {
        frontLeft: "後右" | "後左" | "前右";
        frontRight: "後右" | "後左" | "前左";
        rearLeft: "前左" | "前右" | "後右";
        rearRight: "前左" | "前右" | "後左";
      };
    };
    /** バランス調整結果 */
    balanceAdjustment: {
      frontLeft: number; // g
      frontRight: number; // g
      rearLeft: number; // g
      rearRight: number; // g
    };
    /** 空気圧設定値 */
    tirePressureSetting: {
      frontLeft: number; // kPa
      frontRight: number; // kPa
      rearLeft: number; // kPa
      rearRight: number; // kPa
    };
    /** Before写真 */
    beforePhotos: Photo[];
    /** After写真 */
    afterPhotos: Photo[];
    /** 作業メモ */
    notes: string;
    /** 作業完了日時 */
    completedAt?: Date;
  };
  
  /** ステータス */
  status: "入庫待ち" | "診断中" | "作業待ち" | "作業中" | "作業完了" | "出庫待ち";
}

/**
 * 簡易検査結果
 */
export interface InspectionResult {
  /** カテゴリ名 */
  categoryName: string;
  /** 項目名 */
  itemName: string;
  /** 状態 */
  condition: "正常" | "注意" | "要交換" | "要修理" | "要調整" | "偏摩耗" | "片減り" | "不均一" | "キズ" | "パンク痕" | "バルジ" | "クラック" | "曲がり" | "古い" | "緩みあり" | "バランス不良";
  /** 写真 */
  photo?: Photo;
  /** コメント */
  comment?: string;
}
```

---

## 6. API設計

### 6-1. 診断結果の保存API

**エンドポイント**: `POST /api/jobs/[id]/diagnosis`

**リクエストボディ**:
```typescript
{
  inspectionResults: InspectionResult[];
  photos: Photo[];
  comments: string;
}
```

**レスポンス**:
```typescript
{
  success: boolean;
  jobId: string;
  status: string;
}
```

### 6-2. 測定値の保存API

**エンドポイント**: `POST /api/jobs/[id]/measurements`

**リクエストボディ**:
```typescript
{
  tireTreadDepth: {
    frontLeft: number;
    frontRight: number;
    rearLeft: number;
    rearRight: number;
  };
  tirePressure: {
    frontLeft: number;
    frontRight: number;
    rearLeft: number;
    rearRight: number;
  };
  photos: Photo[];
}
```

**レスポンス**:
```typescript
{
  success: boolean;
  jobId: string;
}
```

### 6-3. 作業記録の保存API

**エンドポイント**: `POST /api/jobs/[id]/work`

**リクエストボディ**:
```typescript
{
  workType: "タイヤ交換" | "タイヤローテーション";
  tireReplacement?: {
    manufacturer: string;
    size: string;
    type: string;
    positions: string[];
  };
  tireRotation?: {
    rotation: {
      frontLeft: string;
      frontRight: string;
      rearLeft: string;
      rearRight: string;
    };
  };
  balanceAdjustment: {
    frontLeft: number;
    frontRight: number;
    rearLeft: number;
    rearRight: number;
  };
  tirePressureSetting: {
    frontLeft: number;
    frontRight: number;
    rearLeft: number;
    rearRight: number;
  };
  beforePhotos: Photo[];
  afterPhotos: Photo[];
  notes: string;
}
```

**レスポンス**:
```typescript
{
  success: boolean;
  jobId: string;
  status: string;
}
```

### 6-4. 写真アップロードAPI

**エンドポイント**: `POST /api/photos/upload`

**リクエスト**: FormData（multipart/form-data）

**レスポンス**:
```typescript
{
  success: boolean;
  photoId: string;
  photoUrl: string;
  googleDriveFileId: string;
}
```

---

## 7. ユーザージャーニー

### 7-1. パターンBのフロー（事前見積→了承→入庫→作業）

**タイヤ交換の場合**:
```
【予約時】
1. 顧客がタイヤ交換を予約
2. フロントスタッフがメール等で見積もりを送信
   - タイヤ代（顧客が選択したタイヤ）
   - 工賃: ¥30,800（バランス調整込、16インチ迄、タイヤ代別）
3. 顧客が了承
4. タイヤを発注・用意（またはタイヤ持ち込みの場合もある）
5. 入庫日を確定

【入庫当日】
6. フロントスタッフが受付
   - 走行距離を入力
   - 車両情報を確認
   - ステータスを「診断中」に更新

7. 整備士が診断画面を開く
   - 車両情報を確認（自動入力済み）
   - 簡易検査を実施
     - タイヤの状態確認
     - 空気圧の確認
     - ホイールの状態確認
   - 必要に応じて写真を撮影
   - 「測定値入力」ボタンをタップ

8. 整備士が測定値入力画面を開く
   - タイヤ溝深さを入力（前後左右）
   - 空気圧を入力（前後左右）
   - 推奨空気圧との比較を確認
   - 必要に応じて写真を追加
   - 「保存」ボタンをタップ
   - 診断画面に戻る

9. 整備士が診断画面で「診断完了」ボタンをタップ
   - ステータスを「作業待ち」に更新

10. 整備士が作業画面を開く
    - 診断結果を確認（参考用）
    - 測定値を確認（参考用）
    - 作業を実施
    - 作業記録を入力
      - 交換したタイヤの種類・サイズ・メーカー
      - 交換位置
      - バランス調整結果
      - 空気圧設定値
    - Before写真を撮影（交換前のタイヤ）
    - After写真を撮影（交換後のタイヤ）
    - 作業メモを入力（必要に応じて）
    - 「作業完了」ボタンをタップ
    - ステータスを「作業完了」に更新
    - フロントスタッフに通知

11. フロントスタッフが引渡し・説明
    - 作業内容を確認
    - 顧客に説明
    - ステータスを「出庫待ち」に更新

12. 出庫完了
    - ステータスを「完了」に更新
```

**タイヤローテーションの場合**:
```
【予約時】
1. 顧客がタイヤローテーションを予約
2. フロントスタッフがメール等で見積もりを送信
   - 工賃: ¥X,XXX（バランス調整込、16インチ迄、タイヤ代別）
3. 顧客が了承
4. 入庫日を確定

【入庫当日】
5. フロントスタッフが受付
   - 走行距離を入力
   - 車両情報を確認
   - ステータスを「診断中」に更新

6. 整備士が診断画面を開く
   - 車両情報を確認（自動入力済み）
   - 簡易検査を実施
     - タイヤの状態確認
     - 空気圧の確認
     - ホイールの状態確認
   - 必要に応じて写真を撮影
   - 「測定値入力」ボタンをタップ

7. 整備士が測定値入力画面を開く
   - タイヤ溝深さを入力（前後左右）
   - 空気圧を入力（前後左右）
   - 推奨空気圧との比較を確認
   - 必要に応じて写真を追加
   - 「保存」ボタンをタップ
   - 診断画面に戻る

8. 整備士が診断画面で「診断完了」ボタンをタップ
   - ステータスを「作業待ち」に更新

9. 整備士が作業画面を開く
    - 診断結果を確認（参考用）
    - 測定値を確認（参考用）
    - 作業を実施
    - 作業記録を入力
      - ローテーション位置
      - バランス調整結果
      - 空気圧設定値
    - Before写真を撮影（ローテーション前のタイヤ位置）
    - After写真を撮影（ローテーション後のタイヤ位置）
    - 作業メモを入力（必要に応じて）
    - 「作業完了」ボタンをタップ
    - ステータスを「作業完了」に更新
    - フロントスタッフに通知

10. フロントスタッフが引渡し・説明
    - 作業内容を確認
    - 顧客に説明
    - ステータスを「出庫待ち」に更新

11. 出庫完了
    - ステータスを「完了」に更新
```

### 7-2. 各画面でのユーザー操作の詳細

#### 7-2-1. 診断画面での操作

1. **画面を開く**
   - 車両情報が自動で表示される
   - 推奨空気圧が自動で表示される（車両情報から）
   - 既存の診断結果がある場合、自動で読み込まれる

2. **簡易検査を実施**
   - 各カテゴリの状態を選択
   - 必要に応じて写真を撮影
   - コメントを入力

3. **測定値入力画面への遷移**
   - 「測定値入力」ボタンをタップ
   - 測定値入力画面に遷移

4. **診断完了**
   - 「診断完了」ボタンをタップ
   - 確認ダイアログを表示（任意）
   - 診断結果を保存
   - 作業画面への遷移を可能にする

#### 7-2-2. 測定値入力画面での操作

1. **画面を開く**
   - 推奨空気圧が自動で表示される（車両情報から）
   - 既存の測定値がある場合、自動で読み込まれる

2. **タイヤ溝深さを入力**
   - 前後左右の溝深さを入力（mm単位）
   - 数字キーパッドを表示
   - 法定基準・推奨基準を確認
   - 基準を下回る場合、警告色で表示

3. **空気圧を入力**
   - 前後左右の空気圧を入力（kPa単位）
   - 数字キーパッドを表示
   - 推奨空気圧と自動比較
   - 比較結果を表示（正常/不足/過多）

4. **写真を追加**
   - タイヤの写真を追加（タイヤ溝深さセクション）
   - 空気圧計の写真を追加（空気圧セクション）

5. **保存**
   - 「保存」ボタンをタップ
   - 測定値を保存
   - 診断画面に戻る

#### 7-2-3. 作業画面での操作

1. **画面を開く**
   - 車両情報が自動で表示される
   - 診断結果が自動で表示される（参考用）
   - 測定値が自動で表示される（参考用）
   - 既存の作業記録がある場合、自動で読み込まれる

2. **作業記録を入力**
   - **タイヤ交換の場合**:
     - 交換したタイヤの種類・サイズ・メーカーを入力
     - 交換位置を選択
   - **タイヤローテーションの場合**:
     - ローテーション位置を選択
   - バランス調整結果を入力（前後左右）
   - 空気圧設定値を入力（前後左右、推奨空気圧から自動入力可能）

3. **Before/After写真を撮影**
   - Before写真を撮影（交換前のタイヤまたはローテーション前のタイヤ位置）
   - After写真を撮影（交換後のタイヤまたはローテーション後のタイヤ位置）
   - 写真を確認・削除（必要に応じて）

4. **作業メモを入力**
   - 作業に関する自由記述を入力

5. **作業完了**
   - 「作業完了」ボタンをタップ
   - Before/After写真が撮影されていない場合、警告を表示（推奨）
   - バランス調整結果が未入力の場合、警告を表示（推奨）
   - 空気圧設定値が未入力の場合、警告を表示（推奨）
   - 確認ダイアログを表示
   - 作業記録を保存
   - 写真をアップロード
   - フロントスタッフに通知

---

## 8. 実装の優先順位

### Phase 1: MVP（最小限の機能）

1. **診断画面の基本機能**
   - 簡易検査項目の表示・入力（3カテゴリ）
   - 状態の選択（正常/注意/要交換など）
   - データの保存

2. **測定値入力画面の基本機能**
   - タイヤ溝深さの入力（前後左右）
   - 空気圧の入力（前後左右）
   - 推奨空気圧との比較
   - データの保存

3. **作業画面の基本機能**
   - 作業記録の入力
   - Before/After写真の撮影
   - データの保存

### Phase 2: 拡張機能

1. **写真機能の強化**
   - 写真の拡大表示
   - 写真の削除機能

2. **バリデーション機能の強化**
   - タイヤ溝深さの基準チェック
   - 空気圧の推奨値との比較

3. **自動保存機能**
   - 30秒ごとの自動保存
   - オフライン対応

### Phase 3: 高度な機能

1. **通知機能**
   - フロントスタッフへの通知

2. **レポート機能**
   - 顧客向けレポート画面での表示

---

## 更新履歴

- 2025-01-XX: 初版作成（詳細画面設計書）

























