# 未実装機能一覧

## Phase 3: 見積作成

### 1. 見積プレビュー機能 ❌ 未実装
**仕様書参照:** Phase 3-4 Step 1

**現在の実装:**
- `handlePreview` 関数は存在するが、`console.log` と `toast.info("プレビュー機能は準備中です")` のみ
- `EstimatePreviewDialog` コンポーネントが存在しない

**必要な実装:**
- 診断プレビュー（`DiagnosisPreviewDialog`）を参考に、見積プレビューダイアログを実装
- 見積項目の表示、写真・動画の紐付け確認、金額合計の表示
- 顧客向け承認画面（`/customer/approval/[id]`）に近い表示形式

**実装場所:**
- `src/components/features/estimate-preview-dialog.tsx` (新規作成)
- `src/app/admin/estimate/[id]/page.tsx` (プレビューボタンからの呼び出し)

---

### 2. メール送信機能 ❌ 未実装
**仕様書参照:** Phase 3-4 Step 2

**現在の実装:**
- `handleSendLine` 関数で LINE 送信は実装済み
- メール送信は `toast.info("メール送信機能は今後実装予定です")` のみ

**必要な実装:**
- Zoho `Contacts` の `Email` または `Secondary_Email` を取得
- 見積もりページのURLを生成（マジックリンク方式）
- Gmail API または Nodemailer を使用したメール送信
- メッセージ本文に見積もりページへのリンクを挿入

**実装場所:**
- `src/lib/email-api.ts` (新規作成)
- `src/app/admin/estimate/[id]/page.tsx` (メール送信ハンドラの実装)

---

### 3. 見積もりページのURL発行（マジックリンク）❌ 未実装
**仕様書参照:** Phase 3-4 Step 3, Phase 4-1 Step 2

**現在の実装:**
- `generateMagicLink` 関数は `src/lib/line-api.ts` に存在するが、実装が不完全な可能性

**必要な実装:**
- 見積もりページ（`/customer/approval/[id]`）への一意なURLを生成
- UUIDまたはトークンベースの認証不要アクセス
- セキュリティ: 有効期限の設定、ワンタイムアクセスの検討

**確認が必要:**
- `src/lib/line-api.ts` の `generateMagicLink` 実装状況
- `/customer/approval/[id]` の認証不要アクセスの実装状況

---

## Phase 4: 承認（顧客体験）

### 4. メカニックからのコメント表示 ❌ 未実装
**仕様書参照:** Phase 6-2 Step 2 D

**現在の実装:**
- レポート画面（`/customer/report/[id]`）は実装済み
- メカニックからのコメント表示部分が未確認

**必要な実装:**
- Phase 2 の音声入力コメントを表示
- アドバイザーが整えたコメントを表示
- 「次回の整備時期」などのアドバイス表示

---

## Phase 6: アフターフォロー

### 5. 自動フォローメール機能 ❌ 未実装
**仕様書参照:** Phase 6-3 Step 2

**必要な実装:**
- **1ヶ月後:** 「お車の調子はいかがですか？」の自動フォローメール
- **12ヶ月点検の時期（11ヶ月後）:** 「法定12ヶ月点検のご案内」
- **車検の時期（23ヶ月後）:** 「車検のご案内」
- 前回の整備記録へのリンクを添付

**実装場所:**
- Vercel Cron Jobs または 外部スケジューラー（Zoho Automation 推奨）
- `src/lib/reminder-email.ts` (新規作成)

---

### 6. アンケート機能 ✅ 実装済み
**仕様書参照:** Phase 6-1 Step 2（仕様書から削除済み）

**実装状況:**
- ✅ レポート画面（`/customer/report/[id]`）にアンケートボタンを追加
- ✅ Tally.so へのリンク（https://tally.so/r/mVapBN）
- ✅ 「500円分QUOカードプレゼント」の案内を表示

**実装場所:**
- `src/app/customer/report/[id]/page.tsx`（Googleレビューセクションの後）

---

### 7. Googleレビューリンク ❌ 部分実装
**仕様書参照:** Phase 6-3 Step 3

**現在の実装:**
- `handleGoogleReview` 関数は存在するが、`toast.info` のみ
- 実際のGoogle Maps URLが未設定

**必要な実装:**
- Google Maps レビューページのURLを設定
- レビューボタンの配置（レポート画面のフッター）

---

## その他の確認が必要な機能

### 8. 請求書PDF検索機能 ✅ 実装済み（要確認）
**仕様書参照:** Phase 6-2 Step 2 C

**確認が必要:**
- Google Drive API でのPDF検索（部分一致: "invoice", "seikyu", "請求書"）
- `/customer/report/[id]` での表示実装状況

---

### 9. テンプレート機能 ✅ 実装済み
**仕様書参照:** Phase 3-3 Step 3

**実装状況:**
- `EstimateTemplateDialog` コンポーネントが存在
- 過去の見積・案件参照機能も実装済み（`HistoricalEstimateDialog`, `HistoricalJobDialog`）

---

## まとめ

### 未実装（優先度: 高）
1. **見積プレビュー機能** - アドバイザーが顧客に送る前に確認する必要がある
2. **メール送信機能** - 法人客への見積もり送信に必要

### 未実装（優先度: 中）
3. **見積もりページのURL発行（マジックリンク）** - セキュリティ面での確認が必要
4. **メカニックからのコメント表示** - レポート画面の機能拡張

### 未実装（優先度: 低）
5. **自動フォローメール機能** - 不要（仕様書には残すが実装しない）
6. **Googleレビューリンク** - URL設定のみ

### 実装済み（更新）
6. **アンケート機能** - ✅ 実装済み（Tally.so へのリンク追加済み）

### 確認が必要
8. **請求書PDF検索機能** - 実装済みの可能性あり（要確認）

