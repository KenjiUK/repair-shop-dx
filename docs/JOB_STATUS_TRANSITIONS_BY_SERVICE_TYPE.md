# 入庫区分別ステータス推移整理

**作成日**: 2025-01-XX  
**目的**: 入庫区分別のステータス（field5）推移を整理し、呼び方を統一

---

## 📋 現在のステータス定義（field5）

### 基本ステータス（JobStage型で定義）
- `入庫待ち`: 初期状態
- `入庫済み`: 受付完了
- `見積作成待ち`: 診断完了、見積作成待ち
- `見積提示済み`: 見積作成完了、顧客承認待ち
- `作業待ち`: 顧客承認完了、作業開始待ち
- `出庫待ち`: 作業完了、出庫準備中
- `出庫済み`: 出庫完了

### 特殊ステータス（JobStage型で定義）
- `部品調達待ち`: 部品調達待ち
- `部品発注待ち`: 部品発注待ち
- `再入庫待ち`: 一時帰宅中の再入庫待ち状態

### ✅ 修正完了: 型定義にないステータスの置き換え

以下のステータスがコード内で使用されていましたが、`JobStage`型の定義には含まれていませんでした。これらを実際の`JobStage`型のステータスに置き換えました：

| 旧ステータス | 新ステータス | 理由 |
|------------|------------|------|
| `診断中` | `入庫済み` | 診断は`入庫済み`の状態で実施される |
| `顧客承認待ち` | `見積提示済み` | `見積提示済み`は顧客承認待ちの状態 |
| `作業中` | `作業待ち` | 作業は`作業待ち`の状態で実施される |
| `完了` | `出庫済み` | `完了`は`出庫済み`と同じ意味 |

**修正箇所**:
- `src/app/mechanic/work/[id]/page.tsx`: `completedPhases`の判定を修正
- `src/app/mechanic/diagnosis/[id]/page.tsx`: `completedPhases`の判定を修正

**注意**: `WorkOrder`の`status`フィールドやUI表示用の文字列（例：`"完了"`、`"作業中"`）は、`JobStage`型とは別のフィールドなので、そのまま使用可能です。

---

## 🔄 入庫区分別のステータス推移

### 1. 車検（24ヶ月点検）

#### パターンA: 追加見積もりがある場合
```
入庫待ち → 入庫済み → 見積作成待ち → 見積提示済み → 作業待ち → 出庫待ち → 出庫済み
```

#### パターンB: 追加見積もりがない場合
```
入庫待ち → 入庫済み → 作業待ち → 出庫待ち → 出庫済み
```
- **スキップ**: `見積作成待ち`と`見積提示済み`をスキップ
- **理由**: 追加見積もりがないため、見積・承認プロセスが不要

### 2. 12ヵ月点検

#### パターンA: 追加見積もりがある場合
```
入庫待ち → 入庫済み → 見積作成待ち → 見積提示済み → 作業待ち → 出庫待ち → 出庫済み
```

#### パターンB: 追加見積もりがない場合
```
入庫待ち → 入庫済み → 作業待ち → 出庫待ち → 出庫済み
```
- **スキップ**: `見積作成待ち`と`見積提示済み`をスキップ
- **理由**: 追加見積もりがないため、見積・承認プロセスが不要

### 3. その他のメンテナンス（エンジンオイル交換、タイヤ交換など）

```
入庫待ち → 入庫済み → 見積作成待ち → 見積提示済み → 作業待ち → 出庫待ち → 出庫済み
```

### 4. 修理・整備

```
入庫待ち → 入庫済み → 見積作成待ち → 見積提示済み → 作業待ち → 出庫待ち → 出庫済み
```

### 5. 故障診断

```
入庫待ち → 入庫済み → 見積作成待ち → 見積提示済み → 作業待ち → 出庫待ち → 出庫済み
```

### 6. 板金・塗装（外注管理）

```
入庫待ち → 入庫済み → 見積作成待ち → 見積提示済み → 作業待ち → 部品発注待ち → 作業待ち → 出庫待ち → 出庫済み
```
- **特殊**: 外注発注時に`部品発注待ち`を経由

### 7. レストア（長期プロジェクト管理）

```
入庫待ち → 入庫済み → 見積作成待ち → 見積提示済み → 作業待ち → 出庫待ち → 出庫済み
```
- **注意**: レストアは長期プロジェクトだが、field5のステータスは通常のフローと同じ
- **特殊管理**: ワークオーダーの`status`フィールドで「作業中」などの詳細状態を管理

---

## 🎯 ステータスとフェーズの対応関係

| ステータス（field5） | Phase | フェーズ名 | 備考 |
|---------------------|-------|-----------|------|
| 入庫待ち | 1 | 受付 | 初期状態 |
| 入庫済み | 2 | 診断 | 診断開始可能 |
| 見積作成待ち | 3 | 見積 | 診断完了、見積作成待ち |
| 見積提示済み | 4 | 承認 | 見積作成完了、顧客承認待ち |
| 作業待ち | 5 | 作業 | 顧客承認完了、作業開始待ち |
| 出庫待ち | 6 | 報告 | 作業完了、出庫準備中 |
| 出庫済み | 6 | 報告 | 出庫完了 |

**注意**: 車検・12ヵ月点検で追加見積もりがない場合、`見積作成待ち`と`見積提示済み`をスキップし、`入庫済み`から直接`作業待ち`に遷移

---

## 📝 実装上の注意点

1. **ステータス遷移の判定**: 追加見積もりの有無を判定して、スキップするステータスを決定
2. **ワークフローインジケーター**: スキップされたフェーズを点線で表示
3. **JOBカード**: ステータスラベルにPhase情報は表示しない（シンプルにステータスのみ）

---

## ✅ 確認事項

- [ ] 各入庫区分のステータス推移が正しいか確認
- [ ] スキップされるステータスの判定ロジックが正しいか確認
- [ ] ワークフローインジケーターの表示が正しいか確認
- [ ] JOBカードのステータスラベルがシンプルに表示されているか確認

