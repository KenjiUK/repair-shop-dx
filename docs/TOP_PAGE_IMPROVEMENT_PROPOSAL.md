# TOPページ改善提案書

## 現状分析

### 現在のTOPページの機能
1. **サマリーカード（3つ）**
   - 本日の状況（ステータス別件数）
   - スマートタグ在庫
   - 代車在庫

2. **検索・フィルター機能**
   - 検索バー（顧客名、車両名、タグ番号）
   - 入庫区分フィルター（車検、故障診断、修理・整備など）

3. **ジョブカードリスト**
   - 今日の入庫予定を一覧表示
   - 各カードにアクションボタン（受付開始、診断開始など）

### 問題点

#### 1. **タイトルと実際の表示内容の不一致**
- タイトル：「本日の入庫予定」
- 実際：入庫済みの車両も表示される
- **問題**：フロント担当や整備士は「入庫済み」の車両も見る必要がある

#### 2. **ステータス別の整理が不十分**
- 現在：すべてのステータスが混在して表示
- **問題**：
  - フロント担当は「入庫待ち」を優先して見たい
  - 整備士は「入庫済み（診断待ち）」を優先して見たい
  - アドバイザーは「見積作成待ち」を優先して見たい

#### 3. **整備士の担当案件フィルターがない**
- 現在：すべての案件が表示される
- **問題**：整備士は自分の担当案件だけを見たい場合がある

#### 4. **時系列での並び替えがない**
- 現在：データ取得順で表示
- **問題**：入庫時間順、予約時間順などで並び替えできない

#### 5. **緊急度・優先度の表示がない**
- 現在：すべての案件が同じ重要度で表示
- **問題**：作業指示あり、事前入力ありなどの重要案件が埋もれる

---

## 業務フロー分析

### フロント担当（石塚・岡島）の業務

#### Phase 1: 来店・受付
- **必要な情報**：
  - 「入庫待ち」の案件を優先表示
  - 事前入力あり、作業指示ありの案件を強調
  - 入庫予定時間順で並び替え

#### Phase 3: 見積作成
- **必要な情報**：
  - 「見積作成待ち」の案件を優先表示
  - 診断結果（写真、コメント）を確認

#### Phase 5: 出庫対応
- **必要な情報**：
  - 「出庫待ち」の案件を優先表示
  - 引取予約時間を確認

### 整備士（中村・永見・谷口）の業務

#### Phase 2: 診断・撮影
- **必要な情報**：
  - 「入庫済み（診断待ち）」の案件を優先表示
  - 自分の担当案件をフィルター
  - 作業指示ありの案件を強調

#### Phase 5: 作業
- **必要な情報**：
  - 「作業待ち」の案件を優先表示
  - 自分の担当案件をフィルター

---

## 改善提案

### 提案1: ステータス別タブ表示（推奨）

**実装内容：**
- タブでステータス別に切り替え可能にする
- タブ構成：
  1. **すべて**（デフォルト）
  2. **入庫待ち**（フロント優先）
  3. **診断待ち**（整備士優先）
  4. **見積作成待ち**（アドバイザー優先）
  5. **作業待ち**（整備士優先）
  6. **出庫待ち**（フロント優先）

**メリット：**
- 各担当者が自分の業務に必要な案件をすぐに見つけられる
- 視覚的に整理され、見やすくなる

**デメリット：**
- タブが多くなりすぎる可能性
- モバイル表示でタブが横スクロールになる可能性

---

### 提案2: ステータスフィルター + デフォルト表示の改善（推奨）

**実装内容：**
1. **ステータスフィルターを追加**
   - 入庫区分フィルターの下に配置
   - ドロップダウンまたはバッジ形式

2. **デフォルト表示を改善**
   - ステータス別にグループ化して表示
   - 各グループにヘッダーを追加
   - 例：
     ```
     【入庫待ち】2件
     [カード1] [カード2]
     
     【診断待ち】3件
     [カード3] [カード4] [カード5]
     
     【見積作成待ち】1件
     [カード6]
     ```

3. **整備士フィルターを追加**
   - 「自分の担当のみ」チェックボックス
   - localStorageから現在の整備士名を取得

**メリット：**
- すべての案件を一画面で確認できる
- ステータス別に整理されて見やすい
- 整備士が自分の案件だけを見られる

**デメリット：**
- 案件数が多い場合、スクロールが長くなる

---

### 提案3: ハイブリッド方式（最推奨）

**実装内容：**
1. **クイックフィルター（バッジ形式）**
   - 画面上部にステータス別のバッジを配置
   - クリックでフィルター切り替え
   - 例：[すべて] [入庫待ち] [診断待ち] [見積作成待ち] [作業待ち] [出庫待ち]

2. **整備士フィルター**
   - 「自分の担当のみ」トグルスイッチ
   - 整備士の場合のみ表示

3. **並び替え機能**
   - 入庫時間順（デフォルト）
   - 予約時間順
   - ステータス順

4. **優先表示**
   - 作業指示あり、事前入力ありの案件を上部に表示
   - バッジやアイコンで強調

5. **タイトル変更**
   - 「本日の入庫予定」→「本日の案件一覧」または「入庫車両一覧」

**メリット：**
- 柔軟なフィルタリングが可能
- すべての案件を確認しつつ、必要なものだけを絞り込める
- 整備士とフロント担当の両方のニーズに対応

---

## 推奨実装：提案3（ハイブリッド方式）

### 実装詳細

#### 1. クイックフィルター（ステータス別）
```typescript
// ステータスフィルターの選択肢
type StatusFilter = 
  | "すべて"
  | "入庫待ち"
  | "診断待ち" 
  | "見積作成待ち"
  | "お客様承認待ち"
  | "作業待ち"
  | "出庫待ち"
  | "出庫済み";
```

#### 2. 整備士フィルター
```typescript
// 整備士の場合のみ表示
const [showMyJobsOnly, setShowMyJobsOnly] = useState(false);
const currentMechanic = localStorage.getItem("currentMechanic");
```

#### 3. 並び替え機能
```typescript
type SortOption = 
  | "入庫時間順（新しい順）"
  | "入庫時間順（古い順）"
  | "予約時間順"
  | "ステータス順";
```

#### 4. 優先表示ロジック
```typescript
// 優先度の計算
const getPriority = (job: ZohoJob): number => {
  let priority = 0;
  if (job.field) priority += 10; // 作業指示あり
  if (job.field7) priority += 5; // 事前入力あり
  return priority;
};
```

#### 5. UI構成
```
[ヘッダー]
[サマリーカード3つ]
[クイックフィルター（バッジ）]
[検索バー]
[入庫区分フィルター]
[整備士フィルター（条件付き表示）]
[並び替えセレクト]
[件数表示]
[ジョブカードリスト（優先度順 → 選択した並び替え順）]
```

---

## 実装優先度

### 高優先度（必須）
1. ✅ **タイトル変更**：「本日の入庫予定」→「本日の案件一覧」
2. ✅ **ステータスフィルター追加**：クイックフィルター（バッジ形式）
3. ✅ **整備士フィルター追加**：「自分の担当のみ」トグル

### 中優先度（推奨）
4. ⚠️ **並び替え機能**：入庫時間順、予約時間順など
5. ⚠️ **優先表示**：作業指示あり、事前入力ありを上部に

### 低優先度（将来的に）
6. 📋 **グループ化表示**：ステータス別にセクション分け
7. 📋 **カレンダー表示**：日付別の表示切り替え

---

## 実装イメージ

### 画面構成（改善後）
```
┌─────────────────────────────────────────┐
│ ヘッダー（ロゴ、日時、リフレッシュ）      │
├─────────────────────────────────────────┤
│ [サマリーカード3つ]                      │
├─────────────────────────────────────────┤
│ [すべて] [入庫待ち] [診断待ち] [見積...] │ ← クイックフィルター
├─────────────────────────────────────────┤
│ [🔍 検索バー]                            │
├─────────────────────────────────────────┤
│ [入庫区分フィルター]                      │
├─────────────────────────────────────────┤
│ [✓ 自分の担当のみ] [並び替え: ▼]        │ ← 整備士フィルター + 並び替え
├─────────────────────────────────────────┤
│ 全 12件 / 検索結果: 8件                  │
├─────────────────────────────────────────┤
│ [ジョブカード1] ← 作業指示あり（優先表示）│
│ [ジョブカード2] ← 事前入力あり（優先表示）│
│ [ジョブカード3]                          │
│ ...                                      │
└─────────────────────────────────────────┘
```

---

## 次のステップ

1. **提案3（ハイブリッド方式）を実装**
2. **ユーザーフィードバックを収集**
3. **必要に応じて調整**

この提案に基づいて実装を進めますか？
