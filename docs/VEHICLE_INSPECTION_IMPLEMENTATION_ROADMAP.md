# 車検の全フロー修正ロードマップ

**作成日**: 2025-01-XX  
**目的**: 車検の全フローを最終版仕様に基づいて修正する進捗管理

---

## 📋 修正対象ページ一覧

### Phase 2: 診断画面
- **URL**: `/mechanic/diagnosis/[id]`
- **ファイル**: `src/app/mechanic/diagnosis/[id]/page.tsx`
- **コンポーネント**: `src/components/features/diagnosis-additional-estimate-section.tsx`
- **注意**: UIサイズやスタイル（文字サイズなど）は変更しない（DESIGN_SYSTEM.md準拠）

### Phase 3: 見積画面
- **URL**: `/admin/estimate/[id]`
- **ファイル**: `src/app/admin/estimate/[id]/page.tsx`
- **注意**: DESIGN_SYSTEM.mdに沿った内容にする

### Phase 4: 承認画面（顧客向け）
- **URL**: `/customer/approval/[id]`（想定）
- **注意**: DESIGN_SYSTEM.mdに沿った内容にする

### Phase 5: 作業画面
- **URL**: `/mechanic/work/[id]`
- **ファイル**: `src/app/mechanic/work/[id]/page.tsx`
- **注意**: 診断ページと同じスタイルで40歳以上の整備士が現場でスマホで使うことを前提に修正

### Phase 6: 報告・出庫画面
- **URL**: `/mechanic/work/[id]`（作業画面内）
- **注意**: DESIGN_SYSTEM.mdに沿った内容にする

---

## 🎯 修正内容の詳細

### Phase 2: 診断画面の修正

#### 2-1. 「追加見積内容」セクションの修正

**修正内容:**
- [ ] タイトルを「追加見積内容」から「車検外提案（車検とは切り分けて説明した方が分かりやすい内容）」に変更
- [ ] 説明文を追加:
  - 「車検とは関係ない、車検とは切り分けて説明した方が分かりやすい内容を記録してください。」
  - 「点検項目で発見された問題（車検の説明の中でそのまま伝えられる内容）は、点検項目のステータスで記録してください。」
- [ ] 「判断軸」という言葉をUIから削除
- [ ] 3分類のラベルを確認（「今回絶対必要」「やったほうがいい」「お客さん次第」は維持）

**対象ファイル:**
- `src/components/features/diagnosis-additional-estimate-section.tsx`

**注意事項:**
- UIサイズやスタイル（文字サイズなど）は変更しない
- 既存のスタイルを維持

#### 2-2. 不要なコンテンツの削除

**確認・削除対象:**
- [ ] 診断画面で不要なセクションがないか確認
- [ ] 使用されていないコンポーネントがないか確認
- [ ] コメントアウトされたコードを削除

**対象ファイル:**
- `src/app/mechanic/diagnosis/[id]/page.tsx`

---

### Phase 3: 見積画面の修正

#### 3-1. 「追加見積内容」セクションの修正

**修正内容:**
- [ ] タイトルを「追加見積内容」から「車検外提案（車検とは切り分けて説明した方が分かりやすい内容）」に変更
- [ ] 説明文を追加
- [ ] 「判断軸」という言葉をUIから削除

**対象ファイル:**
- `src/app/admin/estimate/[id]/page.tsx`

#### 3-2. 「独立作業にする」ボタンの追加

**修正内容:**
- [ ] 追加見積内容の各項目に「独立作業にする」ボタンを追加
- [ ] ボタンをクリックすると確認ダイアログを表示
- [ ] 確認後、新しいワークオーダーを作成し、追加見積内容から該当項目を削除
- [ ] API実装: `/api/jobs/[id]/work-orders` (POST)

**対象ファイル:**
- `src/app/admin/estimate/[id]/page.tsx`
- `src/app/api/jobs/[id]/work-orders/route.ts`（新規作成または既存を修正）

**UI実装:**
- 追加見積内容の各項目の行に「独立作業にする」ボタンを配置
- ボタンは右側に配置（削除ボタンの隣など）

#### 3-3. 見積履歴の差分表示機能

**修正内容:**
- [ ] 見積履歴機能を実装（見積 v1、v2、v3を履歴として記録）
- [ ] 見積変更時に変更理由を必須入力する機能を実装
- [ ] 見積履歴を差分表示で実装:
  - 追加された項目
  - 削除された項目
  - 金額差分
  - 変更理由

**対象ファイル:**
- `src/app/admin/estimate/[id]/page.tsx`
- `src/components/features/estimate-change-history-section.tsx`（既存を修正）

**UI実装例:**
```
見積履歴
├── v1（事前）: ¥50,000
├── v2（受入れ）: ¥80,000
│   └── 差分: +¥30,000
│       ├── 追加: ブレーキパッド交換 +¥30,000
│       └── 理由: 受入れ点検で発見
└── v3（作業中）: ¥90,000
    └── 差分: +¥10,000
        ├── 追加: バッテリー交換 +¥10,000
        └── 理由: 作業中に発見
```

#### 3-4. 不要なコンテンツの削除

**確認・削除対象:**
- [ ] 見積画面で不要なセクションがないか確認
- [ ] 使用されていないコンポーネントがないか確認
- [ ] コメントアウトされたコードを削除

**対象ファイル:**
- `src/app/admin/estimate/[id]/page.tsx`

---

### Phase 4: 承認画面の修正

#### 4-1. 箱①・②・③の視覚的区別

**修正内容:**
- [ ] 箱①（法定必須）: 自動承認、視覚的に区別
- [ ] 箱②（車検推奨）: 承認・却下を選択可能、「車検の説明の中でそのまま伝えられる内容」と表示
- [ ] 箱③（追加見積内容）: 承認・却下を選択可能、別セクションで表示、「車検とは切り分けて説明した方が分かりやすい内容」と表示
- [ ] 「判断軸」という言葉をUIから削除

**対象ファイル:**
- 承認画面のファイル（要確認）

---

### Phase 5: 作業画面の修正

#### 5-1. 診断ページと同じスタイルで修正

**修正内容:**
- [ ] 診断ページと同じスタイル（文字サイズ、ボタンサイズなど）を適用
- [ ] 40歳以上の整備士が現場でスマホで使うことを前提に最適化
- [ ] 作業項目の表示を確認（承認された項目のみ表示）

**対象ファイル:**
- `src/app/mechanic/work/[id]/page.tsx`

**注意事項:**
- 診断ページのスタイルを参考にする
- 既存のスタイルを維持しつつ、診断ページと統一

#### 5-2. 不要なコンテンツの削除

**確認・削除対象:**
- [ ] 作業画面で不要なセクションがないか確認
- [ ] 使用されていないコンポーネントがないか確認
- [ ] コメントアウトされたコードを削除

**対象ファイル:**
- `src/app/mechanic/work/[id]/page.tsx`

---

### Phase 6: 報告・出庫画面の修正

#### 6-1. 報告内容の確認

**修正内容:**
- [ ] 箱①・②・③の作業結果が正しく報告されることを確認
- [ ] 新しい作業（独立作業）の報告が正しく表示されることを確認

**対象ファイル:**
- 報告・出庫画面のファイル（要確認）

---

## 📊 進捗管理

### Phase 2: 診断画面
- [ ] 2-1. 「追加見積内容」セクションの修正
- [ ] 2-2. 不要なコンテンツの削除

### Phase 3: 見積画面
- [ ] 3-1. 「追加見積内容」セクションの修正
- [ ] 3-2. 「独立作業にする」ボタンの追加
- [ ] 3-3. 見積履歴の差分表示機能
- [ ] 3-4. 不要なコンテンツの削除

### Phase 4: 承認画面
- [ ] 4-1. 箱①・②・③の視覚的区別

### Phase 5: 作業画面
- [ ] 5-1. 診断ページと同じスタイルで修正
- [ ] 5-2. 不要なコンテンツの削除

### Phase 6: 報告・出庫画面
- [ ] 6-1. 報告内容の確認

---

## 🔧 実装の優先順位

### 優先度: 高（必須）
1. Phase 2: 診断画面の「追加見積内容」セクションの修正
2. Phase 3: 見積画面の「追加見積内容」セクションの修正
3. Phase 3: 「独立作業にする」ボタンの追加

### 優先度: 中（重要）
4. Phase 3: 見積履歴の差分表示機能
5. Phase 5: 作業画面のスタイル統一

### 優先度: 低（改善）
6. Phase 4: 承認画面の視覚的区別
7. Phase 6: 報告・出庫画面の確認

---

## 📝 実装時の注意事項

### デザインシステムの遵守

1. **診断ページ（Phase 2）**
   - UIサイズやスタイル（文字サイズなど）は変更しない
   - DESIGN_SYSTEM.mdに書いてある内容を遵守

2. **作業ページ（Phase 5）**
   - 診断ページと同じスタイルで修正
   - 40歳以上の整備士が現場でスマホで使うことを前提に最適化

3. **その他のページ（Phase 3, 4, 6）**
   - DESIGN_SYSTEM.mdに沿った内容にする

### 不要なコンテンツの削除

- 各ページで不要なセクションがないか確認
- 使用されていないコンポーネントがないか確認
- コメントアウトされたコードを削除

### テスト項目

- [ ] 診断画面で「追加見積内容」セクションが正しく表示される
- [ ] 見積画面で「独立作業にする」ボタンが正しく動作する
- [ ] 見積履歴の差分表示が正しく表示される
- [ ] 作業画面のスタイルが診断画面と統一されている
- [ ] 不要なコンテンツが削除されている

---

## 🔗 関連ドキュメント

- [VEHICLE_INSPECTION_ADDITIONAL_ESTIMATE_SPEC_FINAL.md](./VEHICLE_INSPECTION_ADDITIONAL_ESTIMATE_SPEC_FINAL.md) - 最終版仕様書
- [VEHICLE_INSPECTION_PROCESS_FLOW.md](./VEHICLE_INSPECTION_PROCESS_FLOW.md) - プロセスフロー
- [DESIGN_SYSTEM.md](./DESIGN_SYSTEM.md) - デザインシステム
- [PAGE_SPECIFICATION.md](./PAGE_SPECIFICATION.md) - ページ単位詳細設計仕様書

---

**End of Document**

