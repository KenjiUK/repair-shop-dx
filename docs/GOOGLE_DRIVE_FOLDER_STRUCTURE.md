# Google Drive フォルダ構造

> **⚠️ 注意**: このドキュメントは提案段階の内容も含みます。**最新の実装仕様については、`docs/GOOGLE_DRIVE_SPECIFICATION.md`を参照してください。**

## 現在の実装されているフォルダ構造

### 基本構造

```
repair-shop-dx/
└── customers/
    └── {customerId}_{customerName}/
        └── vehicles/
            └── {vehicleId}_{vehicleName}/
                ├── documents/
                │   └── (車検証等の書類)
                └── jobs/
                    └── {jobDate}_{jobId}/
                        └── wo-{workOrderId}/
                            └── (Work Orderフォルダ内に写真やデータを保存)
```

### 実際のサンプル例

**例：田中太郎様のプジョー308で2024年12月25日に12ヶ月点検を受けた場合**

```
repair-shop-dx/
└── customers/
    └── 田中太郎_1234567890/
        └── vehicles/
            └── プジョー308_9876543210/
                ├── documents/
                │   ├── shaken_9876543210_20241201.pdf  (車検証)
                │   └── ...
                └── jobs/
                    └── 20241225_job-abc123/
                        └── wo-workorder-xyz789/
                            ├── work.json  (作業データ)
                            └── (写真ファイルなど)
```

**具体的なフォルダ名の例**:
- 顧客フォルダ: `田中太郎_1234567890` （名前を先頭に配置）
- 車両フォルダ: `プジョー308_9876543210` （車両名を先頭に配置）
- ジョブフォルダ: `20241225_job-abc123`
- Work Orderフォルダ: `wo-workorder-xyz789`

### 実装コード

**`src/lib/google-drive.ts`** で定義されている関数：

1. **`getOrCreateRootFolder()`**
   - フォルダ名: `repair-shop-dx`

2. **`getOrCreateCustomerFolder()`**
   - パス: `repair-shop-dx/customers/{customerName}_{customerId}` （名前を先頭に配置）

3. **`getOrCreateVehicleFolder()`**
   - パス: `repair-shop-dx/customers/{customerName}_{customerId}/vehicles/{vehicleName}_{vehicleId}` （車両名を先頭に配置）

4. **`getOrCreateJobFolder()`**
   - パス: `.../vehicles/{vehicleId}_{vehicleName}/jobs/{jobDate}_{jobId}`

5. **`getOrCreateWorkOrderFolder()`**
   - パス: `.../jobs/{jobDate}_{jobId}/wo-{workOrderId}`

## 仕様書に記載されているフォルダ構造

### Phase 2-2: 整備撮影フロー

**保存先**（仕様書より）:
```
Drive/車両写真/[年]/[月]/[日付]_[顧客名]_[車両]_[ナンバー]/01_入庫写真/
```

**実際の例（仕様書に基づく想定）**:
```
Drive/
└── 車両写真/
    └── 2024/
        └── 12/
            └── 20241225_田中太郎_プジョー308_品川300あ1234/
                └── 01_入庫写真/
                    ├── 00_前面_20241225_12ヶ月点検_プジョー308.jpg
                    ├── 01_後面_20241225_12ヶ月点検_プジョー308.jpg
                    ├── 02_左側面_20241225_12ヶ月点検_プジョー308.jpg
                    └── 03_右側面_20241225_12ヶ月点検_プジョー308.jpg
```

**命名規則**（仕様書より）:
```
{位置番号}_{位置名}_{日付}_{サービス名}_{車両名}.jpg
```

### Phase 2-3: 診断・所見入力

**保存先**（仕様書より）:
```
Drive/.../02_証拠写真/
```

**実際の例**:
```
Drive/
└── 車両写真/
    └── 2024/
        └── 12/
            └── 20241225_田中太郎_プジョー308_品川300あ1234/
                └── 02_証拠写真/
                    ├── 04_ブレーキパッド_20241225_12ヶ月点検_プジョー308.jpg
                    ├── 05_エンジンオイル_20241225_12ヶ月点検_プジョー308.jpg
                    ├── 06_傷・凹み_20241225_修理_ルノーカングー.jpg
                    └── 07_異音_20241225_12ヶ月点検_プジョー308.mp4  (動画)
```

**注意**: `02_証拠写真/` フォルダには写真だけでなく動画ファイルも保存されます。動画は「異音」など写真で伝わりにくい不具合を録画する際に使用されます（15秒程度の短い動画）。

### Phase 5-2: 作業実施・証拠撮影

**保存先**（仕様書より）:
```
Drive/.../03_作業報告/
```

**実際の例**:
```
Drive/
└── 車両写真/
    └── 2024/
        └── 12/
            └── 20241225_田中太郎_プジョー308_品川300あ1234/
                └── 03_作業報告/
                    ├── after_01_エンジンオイル交換_20241225_12ヶ月点検_プジョー308.jpg
                    └── after_02_ブレーキパッド交換_20241225_12ヶ月点検_プジョー308.jpg
```

## 実装状況（2025年1月更新）

### ✅ 実装完了

1. **サブフォルダ構造**: Work Orderフォルダ内に以下のサブフォルダが実装されています：
   - `01_入庫写真/` - 入庫時の4点撮影写真（⚠️ 将来実装予定）
   - `02_証拠写真/` - 診断時の証拠写真・動画・PDF（✅ 実装完了）
   - `03_作業報告/` - 作業前/作業後写真（✅ 実装完了）

2. **ファイル命名規則**: 統一された命名規則が実装されています
   - 詳細は `docs/GOOGLE_DRIVE_SPECIFICATION.md` を参照

3. **実装関数**: フォルダ操作・ファイル名生成関数が実装されています
   - 詳細は `docs/GOOGLE_DRIVE_SPECIFICATION.md` を参照

### 📝 最新の実装仕様

**最新の実装仕様については、`docs/GOOGLE_DRIVE_SPECIFICATION.md`を必ず参照してください。**

## 提案されているファイル命名規則

ユーザーが提案しているファイル名の例：

1. `00_前面_20241225_12ヶ月点検_プジョー308.jpg`
2. `01_後面_01_20241225_12ヶ月点検_プジョー308.jpg`
3. `02_左側面_20241225_コーティング_シトロエンC3.webp`
4. `06_傷・凹み_20241225_修理_ルノーカングー.jpg`

### 命名規則のパターン分析

```
{位置番号}_{位置名}_{日付}_{サービス種類}_{車種名}.{拡張子}
```

**フィールド説明**:
- **位置番号**: `00`, `01`, `02`, `06` など（ソート順を保証）
- **位置名**: `前面`, `後面`, `左側面`, `傷・凹み` など
- **日付**: `20241225` (YYYYMMDD形式)
- **サービス種類**: `12ヶ月点検`, `コーティング`, `修理` など
- **車種名**: `プジョー308`, `シトロエンC3`, `ルノーカングー` など
- **拡張子**: `.jpg`, `.webp` など

### 注意点

- 同じ位置から複数枚撮影する場合（例: `01_後面_01_...`, `01_後面_02_...`）の対応が必要
- 位置名に特殊文字（`・`など）が含まれる場合の処理
- 車種名に特殊文字が含まれる場合のサニタイズが必要

## 推奨される実装方針

### オプション1: サブフォルダ構造を実装（推奨）⭐

Work Orderフォルダ内に以下のサブフォルダを作成：

```
wo-{workOrderId}/
├── 01_入庫写真/
│   ├── 00_前面_20241225_12ヶ月点検_プジョー308.jpg
│   ├── 01_後面_20241225_12ヶ月点検_プジョー308.jpg
│   ├── 02_左側面_20241225_12ヶ月点検_プジョー308.jpg
│   └── 03_右側面_20241225_12ヶ月点検_プジョー308.jpg
├── 02_証拠写真/
│   ├── 06_傷・凹み_20241225_修理_ルノーカングー.jpg
│   ├── 07_異音_20241225_12ヶ月点検_プジョー308.mp4  (動画)
│   └── ...
└── 03_作業報告/
    ├── after_01_エンジンオイル交換_20241225_プジョー308.jpg
    └── ...
```

**実際のサンプル例（田中太郎様、プジョー308、12ヶ月点検）**:

```
repair-shop-dx/
└── customers/
    └── 田中太郎_1234567890/
        └── vehicles/
            └── プジョー308_9876543210/
                ├── documents/
                │   └── shaken_9876543210_20241201.pdf
                └── jobs/
                    └── 20241225_job-abc123/
                        └── wo-workorder-xyz789/
                            ├── 01_入庫写真/
                            │   ├── 00_前面_20241225_12ヶ月点検_プジョー308.jpg
                            │   ├── 01_後面_20241225_12ヶ月点検_プジョー308.jpg
                            │   ├── 02_左側面_20241225_12ヶ月点検_プジョー308.jpg
                            │   └── 03_右側面_20241225_12ヶ月点検_プジョー308.jpg
                            ├── 02_証拠写真/
                            │   ├── 04_ブレーキパッド_20241225_12ヶ月点検_プジョー308.jpg
                            │   ├── 05_エンジンオイル_20241225_12ヶ月点検_プジョー308.jpg
                            │   └── 07_異音_20241225_12ヶ月点検_プジョー308.mp4  (動画)
                            ├── 03_作業報告/
                            │   ├── after_01_エンジンオイル交換_20241225_12ヶ月点検_プジョー308.jpg
                            │   └── after_02_ブレーキパッド交換_20241225_12ヶ月点検_プジョー308.jpg
                            └── work.json
```

**メリット**:
- 仕様書通り
- 写真の種類ごとに分類され、管理しやすい
- ファイル検索が容易

### オプション2: フラット構造（現在の実装に近い）

Work Orderフォルダに直接保存し、ファイル名で分類：

```
wo-{workOrderId}/
├── 00_前面_20241225_12ヶ月点検_プジョー308.jpg
├── 01_後面_20241225_12ヶ月点検_プジョー308.jpg
├── 02_左側面_20241225_12ヶ月点検_プジョー308.jpg
├── 06_傷・凹み_20241225_修理_ルノーカングー.jpg
└── ...
```

**実際のサンプル例（フラット構造）**:

```
repair-shop-dx/
└── customers/
    └── 田中太郎_1234567890/
        └── vehicles/
            └── プジョー308_9876543210/
                ├── documents/
                │   └── shaken_9876543210_20241201.pdf
                └── jobs/
                    └── 20241225_job-abc123/
                        └── wo-workorder-xyz789/
                            ├── 00_前面_20241225_12ヶ月点検_プジョー308.jpg
                            ├── 01_後面_20241225_12ヶ月点検_プジョー308.jpg
                            ├── 02_左側面_20241225_12ヶ月点検_プジョー308.jpg
                            ├── 03_右側面_20241225_12ヶ月点検_プジョー308.jpg
                            ├── 04_ブレーキパッド_20241225_12ヶ月点検_プジョー308.jpg
                            ├── 05_エンジンオイル_20241225_12ヶ月点検_プジョー308.jpg
                            ├── 07_異音_20241225_12ヶ月点検_プジョー308.mp4  (動画)
                            ├── after_01_エンジンオイル交換_20241225_12ヶ月点検_プジョー308.jpg
                            ├── after_02_ブレーキパッド交換_20241225_12ヶ月点検_プジョー308.jpg
                            └── work.json
```

**メリット**:
- 実装が簡単
- ファイル一覧が見やすい

**デメリット**:
- ファイル数が多い場合、管理が難しい
- 仕様書との不整合

## ファイル種類の整理

### 各フォルダに保存されるファイル

#### `01_入庫写真/`
- **ファイル種類**: 画像ファイル（`.jpg`）
- **内容**: 入庫時の4点撮影写真（前面、後面、左側面、右側面）

#### `02_証拠写真/`
- **ファイル種類**: 画像ファイル（`.jpg`）および動画ファイル（`.mp4`）
- **内容**: 
  - 診断時の証拠写真（不具合箇所の写真）
  - 異音などの動画（15秒程度の短い動画）
- **命名例**: 
  - `04_ブレーキパッド_20241225_12ヶ月点検_プジョー308.jpg`
  - `07_異音_20241225_12ヶ月点検_プジョー308.mp4`

#### `03_作業報告/`
- **ファイル種類**: 画像ファイル（`.jpg`）
- **内容**: 作業完了後のAfter写真

### 動画ファイルについて

- **用途**: 写真では伝わりにくい不具合（異音、動作不良など）を録画
- **長さ**: 約15秒（MVP仕様）
- **保存先**: `02_証拠写真/` フォルダ
- **命名規則**: 写真と同じ命名規則（拡張子が`.mp4`になる）

## 次のステップ

1. ✅ **サブフォルダ構造の実装**: 完了（2025年1月）
2. ✅ **ファイル命名関数の実装**: 完了（2025年1月）
3. ⚠️ **入庫写真の実装**: 将来実装予定
4. ⚠️ **レストア・板金・塗装の写真アップロード**: 将来実装予定

## 関連ドキュメント

- **`docs/GOOGLE_DRIVE_SPECIFICATION.md`** - 最新の実装仕様（必読）
- `docs/FOLDER_STRUCTURE_PROPOSAL.md` - フォルダ構造の再設計提案

