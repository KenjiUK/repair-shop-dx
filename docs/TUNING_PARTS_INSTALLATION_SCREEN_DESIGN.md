# チューニング・パーツ取付 画面設計書

## ドキュメント情報

- **作成日**: 2025-01-XX
- **バージョン**: 1.0
- **対象**: チューニング・パーツ取付の各画面の詳細設計
- **設計方針**: 世界最高のUI/UX、ITコンサルの目線での推奨を元に設計
- **業務フローパターン**: パターンA（入庫→診断→見積→承認→作業）
- **注意**: チューニングとパーツ取付は同じ入庫区分だが種類選択で区別、性能測定不要、部品取り寄せ対応、PDF生成不要

---

## 複数作業管理対応

この画面設計書は、1つの入庫に対して複数の作業を管理する「複数作業管理」に対応しています。

**対応内容**:
- 各画面は特定のワークオーダー（作業）に対応
- URLパラメータ `workOrderId` で対象ワークオーダーを識別
- 画面ヘッダーに現在の作業名を表示
- 「他の作業を表示」ボタンで同じJobの他のワークオーダーに切替可能
- データはZoho CRM `field_work_orders` フィールドに作業ごとに保存
- **パーツ取り寄せ**: パーツの取り寄せ状況を管理し、到着予定日も追跡

**詳細は [統合仕様書](./INTEGRATED_SPECIFICATION.md) の「2-4. 複数作業管理の実装」を参照してください。**

---

## 1. 画面一覧

### 1-1. フロントスタッフ向け画面

1. **受付画面** (`/admin/reception/[id]`)
   - カスタム内容の確認
   - 種類の選択（チューニング/パーツ取付）
   - 走行距離の入力
   - 前回整備履歴の表示

### 1-2. 整備士向け画面

1. **診断画面** (`/mechanic/diagnosis/[id]`)
   - カスタム箇所の確認
   - 関連箇所の簡易点検
   - Before写真の撮影（必要に応じて）
   - コメント入力

2. **見積画面** (`/admin/estimate/[id]`)
   - パーツ代・工賃の見積もり
   - 作業時間の見積もり
   - 部品リストの管理（取り寄せ状況）
   - 承認方法の記録（口頭/事前/システム）

3. **作業画面** (`/mechanic/work/[id]`)
   - 作業記録の入力
   - Before/After写真の撮影（必要に応じて）
   - 取り付けたパーツの記録
   - 動作確認の結果

### 1-3. 特徴

- **種類選択**: チューニングとパーツ取付は同じ入庫区分だが、受付時に種類を選択
- **動的UI**: 種類選択により、診断項目・見積項目・作業項目が動的に変化
- **性能測定不要**: チューニングでも性能測定は不要
- **部品取り寄せ**: 部品取り寄せが必要な場合は、複数日にまたがる
- **PDF生成不要**: 作業記録はシステム内で管理
- **所要時間**: 1-4時間（部品取り寄せの場合は複数日）

---

## 2. 受付画面の詳細設計

### 2-1. 画面構成

#### レイアウト構造

```
┌─────────────────────────────────────────┐
│ [←] 田中様 BMW X3 チューニング・パーツ取付受付 │
├─────────────────────────────────────────┤
│ 📋 車両情報（自動入力済み・編集不可）     │
│ ┌─────────────────────────────────────┐ │
│ │ 登録番号: 堺 330 す 1669            │ │
│ │ 車台番号: VF3CUHNZTHY061316         │ │
│ │ 初度登録: H29.10                    │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 🔧 種類選択                             │
│ ┌─────────────────────────────────────┐ │
│ │ [✓] チューニング                     │ │
│ │ [ ] パーツ取付                       │ │
│ │                                      │ │
│ │ チューニング: 社外品などのカスタム   │ │
│ │ パーツ取付: ナビなど純正・付属品の   │ │
│ │           取り付け                   │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 🔧 カスタム内容                          │
│ ┌─────────────────────────────────────┐ │
│ │ カスタム内容:                        │ │
│ │ ─────────────────────────────────── │ │
│ │                                     │ │
│ │  どのようなカスタムを希望しますか？  │ │
│ │  カスタム箇所、希望する内容など      │ │
│ │                                     │ │
│ │  （複数行入力可能）                 │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📏 走行距離                            │
│ ┌─────────────────────────────────────┐ │
│ │ 現在の走行距離: [____] km           │ │
│ │                                      │ │
│ │ 前回整備履歴:                        │ │
│ │ 2024年5月: オイル交換（15,000km）  │ │
│ │ 2024年3月: チューニング（12,000km） │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📝 備考                                │
│ ┌─────────────────────────────────────┐ │
│ │                                     │ │
│ │  その他の情報、特記事項など          │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│           [入庫確定]                    │
└─────────────────────────────────────────┘
```

### 2-2. コンポーネント設計

#### 種類選択セクション

**目的**: チューニングかパーツ取付かを選択し、以降の画面を動的に変化

**UI要素**:
- **種類選択**: ラジオボタン
  - チューニング / パーツ取付
- **説明テキスト**: 各種類の説明を表示

**動作**:
- 種類選択により、以降の診断画面・見積画面・作業画面が動的に変化
- チューニングの場合: 社外品などのカスタムに特化した項目
- パーツ取付の場合: 純正・付属品の取り付けに特化した項目

#### カスタム内容セクション

**目的**: 顧客が希望するカスタム内容を記録

**UI要素**:
- **カスタム内容入力**: テキストエリア（自由入力、複数行入力可能）

**バリデーション**:
- カスタム内容は必須

#### 走行距離セクション

**目的**: 現在の走行距離を記録し、前回の整備履歴を表示

**UI要素**:
- **走行距離入力**: 数値入力フィールド（km単位）
- **前回履歴表示**: 過去の整備履歴をリスト表示

**データソース**:
- 前回履歴: Zoho CRMから取得（同じ車両IDの過去のジョブ）

### 2-3. データフロー

1. **画面表示時**:
   - 車両情報を自動入力（編集不可）
   - 前回整備履歴を取得して表示

2. **種類選択時**:
   - 選択した種類を記録
   - 以降の画面で種類に応じた項目を表示

3. **入庫確定時**:
   - 種類、カスタム内容、走行距離を保存
   - Jobステータスを「診断中」に更新

---

## 3. 診断画面の詳細設計

### 3-1. 画面構成

#### レイアウト構造

```
┌─────────────────────────────────────────┐
│ [←] 田中様 BMW X3 チューニング・パーツ取付診断 │
│ 整備士: 中村                             │
├─────────────────────────────────────────┤
│ 📋 車両情報（参照のみ）                  │
│ ┌─────────────────────────────────────┐ │
│ │ 登録番号: 堺 330 す 1669            │ │
│ │ 車台番号: VF3CUHNZTHY061316         │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 🔧 カスタム内容（受付画面から引き継ぎ）    │
│ ┌─────────────────────────────────────┐ │
│ │ 種類: チューニング                   │ │
│ │ カスタム内容: エンジンチューニング   │ │
│ │ 走行距離: 25,000km                  │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 🔍 カスタム箇所の確認                     │
│ 進捗: ████████░░ 2/3項目完了 (67%)     │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ 1. カスタム箇所の状態確認             │ │
│ │ ─────────────────────────────────── │ │
│ │ 状態:                                │ │
│ │ [正常] [注意] [要カスタム]          │ │
│ │                                      │ │
│ │ [📷 写真を追加] [💬 コメント]       │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ 2. 関連箇所の簡易点検                │ │
│ │ ─────────────────────────────────── │ │
│ │ 状態:                                │ │
│ │ [正常] [注意] [要点検]              │ │
│ │                                      │ │
│ │ [📷 写真を追加] [💬 コメント]       │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ （カスタム箇所に応じて動的に表示）        │
├─────────────────────────────────────────┤
│ 📷 Before写真（必要に応じて）            │
│ ┌─────────────────────────────────────┐ │
│ │ [写真を撮影]                        │ │
│ │                                      │ │
│ │ [画像1] [画像2]                     │ │
│ │                                      │ │
│ │ （必要に応じて撮影）                 │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 💬 整備士の所見                          │
│ ┌─────────────────────────────────────┐ │
│ │                                     │ │
│ │  カスタム箇所の状態や所見を記録      │ │
│ │  （複数行入力可能）                  │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ [一時保存] [診断完了]                    │
└─────────────────────────────────────────┘
```

### 3-2. コンポーネント設計

#### カスタム内容表示セクション

**目的**: 受付画面で入力したカスタム内容を表示（参考用）

**表示内容**:
- 種類（チューニング/パーツ取付）
- カスタム内容
- 走行距離

**UI/UXのポイント**:
- 読み取り専用（編集不可）
- 背景色を薄くして、参考情報であることを示す
- 受付画面から自動で引き継ぎ

#### カスタム箇所の確認セクション

**目的**: カスタム箇所の状態を確認し、関連箇所の簡易点検を実施

**UI要素**:
- **確認項目カード**: 各項目ごとにカード表示
  - **項目名**: カスタム箇所に応じて動的に表示
  - **状態選択**: ラジオボタンまたはボタン
    - 正常 / 注意 / 要カスタム（チューニングの場合）
    - 正常 / 注意 / 要点検（パーツ取付の場合）
  - **写真追加ボタン**: カメラボタン（任意）
  - **コメント入力**: テキストエリア（任意）

**動作**:
- 種類（チューニング/パーツ取付）に応じて、確認項目が動的に変化
- チューニングの場合: エンジン、排気系、サスペンションなど
- パーツ取付の場合: 取り付け箇所、配線、固定方法など

#### Before写真セクション

**目的**: カスタム前の状態を記録（必要に応じて）

**UI要素**:
- **写真撮影ボタン**: カメラボタン
- **画像プレビュー**: 撮影した写真をプレビュー表示

**動作**:
- 写真撮影は任意（必須ではない）
- 必要に応じて複数枚撮影可能

### 3-3. データフロー

1. **画面表示時**:
   - 車両情報を表示
   - 受付画面で入力したカスタム内容を表示
   - 種類に応じた確認項目を動的に表示
   - 既存の診断情報を表示（あれば）

2. **診断完了時**:
   - 確認項目の結果、Before写真、コメントを保存
   - Jobステータスを「見積作成待ち」に更新

---

## 4. 見積画面の詳細設計

### 4-1. 画面構成

#### レイアウト構造

```
┌─────────────────────────────────────────┐
│ [←] 田中様 BMW X3 チューニング・パーツ取付見積 │
├─────────────────────────────────────────┤
│ 📋 車両情報（参照のみ）                  │
│ ┌─────────────────────────────────────┐ │
│ │ 登録番号: 堺 330 す 1669            │ │
│ │ 走行距離: 25,000 km                 │ │
│ │ 種類: チューニング                   │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 💰 パーツ代                             │
│ ┌─────────────────────────────────────┐ │
│ │ [+ パーツを追加]                    │ │
│ │                                      │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ パーツ名: [エンジンチューニング] │ │ │
│ │ │ 数量: [1] 単価: [50,000] 円    │ │ │
│ │ │ 金額: [50,000] 円              │ │ │
│ │ │                                │ │ │
│ │ │ 取り寄せ状況: [▼] 在庫あり     │ │ │
│ │ │  在庫あり / 発注済み /          │ │ │
│ │ │  取り寄せ中 / 到着済み          │ │ │
│ │ │                                │ │ │
│ │ │ 到着予定日: [____/__/__]        │ │ │
│ │ │                                │ │ │
│ │ │ 備考:                           │ │ │
│ │ │ ────────────────────────────── │ │ │
│ │ │                                │ │ │
│ │ │ [削除]                          │ │ │
│ │ └────────────────────────────────┘ │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 🔧 工賃                                 │
│ ┌─────────────────────────────────────┐ │
│ │ 工賃: [30,000] 円                   │ │
│ │                                      │ │
│ │ 作業時間見積もり: [3.0] 時間         │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 💰 見積合計                             │
│ ┌─────────────────────────────────────┐ │
│ │ パーツ代: 50,000円                  │ │
│ │ 工賃: 30,000円                      │ │
│ │ 小計: 80,000円                      │ │
│ │ 消費税(10%): 8,000円               │ │
│ │ ──────────────────────────────      │ │
│ │ 合計: 88,000円                      │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ ✅ 承認方法                             │
│ ┌─────────────────────────────────────┐ │
│ │ [✓] 口頭承認                        │ │
│ │ [ ] 事前承認                        │ │
│ │ [ ] システム承認                    │ │
│ │                                      │ │
│ │ （承認方法を記録）                   │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📝 備考                                │
│ ┌─────────────────────────────────────┐ │
│ │                                     │ │
│ │  顧客への説明事項など                │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│           [見積もり確定]                │
└─────────────────────────────────────────┘
```

### 4-2. コンポーネント設計

#### パーツ代セクション

**目的**: 必要なパーツを管理し、取り寄せ状況を追跡

**UI要素**:
- **パーツ追加ボタン**: 「+ パーツを追加」ボタン
- **パーツカード**: 各パーツごとにカード表示
  - **パーツ名入力**: テキスト入力（自由入力）
  - **数量入力**: 数値入力
  - **単価入力**: 数値入力（円単位）
  - **金額表示**: 自動計算（数量 × 単価）
  - **取り寄せ状況選択**: ドロップダウン
    - 在庫あり / 発注済み / 取り寄せ中 / 到着済み
  - **到着予定日入力**: 日付ピッカー（発注済み以降の場合）
  - **備考入力**: テキストエリア（任意）
  - **削除ボタン**: パーツを削除

**バリデーション**:
- パーツ名、数量、単価は必須
- 数量と単価は0より大きい値

**動作**:
- パーツを追加すると、見積合計に自動反映
- 取り寄せ状況が変更された場合、履歴を記録

#### 工賃セクション

**目的**: 工賃と作業時間見積もりを入力

**UI要素**:
- **工賃入力**: 数値入力（円単位）
- **作業時間見積もり入力**: 数値入力（時間単位、小数点以下も可）

**バリデーション**:
- 工賃は必須
- 作業時間見積もりは推奨（任意）

#### 見積合計セクション

**目的**: 見積合計を自動計算して表示

**基幹システム連携フロー**:
1. アドバイザー（フロントスタッフ）がWebアプリの見積作成画面を開く
2. カスタム内容と診断情報を確認
3. **基幹システム（スマートカーディーラー）で該当作業の見積書を作成**（アドバイザーが実施）
4. **Webアプリに「品名」と「金額（税込）」を転記**（アドバイザーが実施）
5. 見積情報を保存（Zoho CRM field_work_orders内の該当作業の見積情報を更新）

**制約**:
- 見積計算は基幹システムで実施（Webアプリは転記のみ）
- パーツ取り寄せがある場合は、到着予定日も管理

**UI要素**:
- **パーツ代表示**: 自動計算
- **工賃表示**: 入力値
- **小計表示**: 自動計算（パーツ代 + 工賃）
- **消費税表示**: 自動計算（小計 × 10%）
- **合計表示**: 自動計算（小計 + 消費税）

#### 承認方法セクション

**目的**: 承認方法を記録

**UI要素**:
- **承認方法選択**: ラジオボタン
  - 口頭承認 / 事前承認 / システム承認

**動作**:
- 承認方法を記録（後続の承認フローで使用）

### 4-3. データフロー

1. **画面表示時**:
   - 車両情報を表示
   - カスタム内容を表示
   - 診断情報を表示（参照のみ）
   - 既存の見積もり情報を表示（あれば）

2. **パーツ追加時**:
   - 新しいパーツカードを追加
   - 金額を自動計算

3. **見積もり確定時**:
   - 見積もり情報を保存
   - 承認方法を保存
   - Jobステータスを「顧客承認待ち」に更新

---

## 5. 作業画面の詳細設計

### 5-1. 画面構成

#### レイアウト構造

```
┌─────────────────────────────────────────┐
│ [←] 田中様 BMW X3 チューニング・パーツ取付作業 │
│ 整備士: 中村                             │
├─────────────────────────────────────────┤
│ 📋 車両情報（参照のみ）                  │
│ ┌─────────────────────────────────────┐ │
│ │ 登録番号: 堺 330 す 1669            │ │
│ │ 車台番号: VF3CUHNZTHY061316         │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📄 見積もり内容（参照のみ）              │
│ ┌─────────────────────────────────────┐ │
│ │ 見積合計: 88,000円                 │ │
│ │ 作業時間見積もり: 3.0時間           │ │
│ │                                      │ │
│ │ パーツ:                              │ │
│ │ - エンジンチューニング: 50,000円    │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 🔧 作業記録                             │
│ ┌─────────────────────────────────────┐ │
│ │                                     │ │
│ │  実施した作業内容を入力してください。 │ │
│ │                                     │ │
│ │  例:                                 │ │
│ │  - エンジンチューニングを実施        │ │
│ │  - ECUの書き換えを完了              │ │
│ │  - 動作確認を実施                    │ │
│ │                                     │ │
│ │  （複数行入力可能）                  │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📷 Before/After写真（必要に応じて）      │
│ ┌─────────────────────────────────────┐ │
│ │ [写真を撮影]                        │ │
│ │                                      │ │
│ │ Before: [画像1] [画像2]             │ │
│ │ After: [画像1] [画像2]              │ │
│ │                                      │ │
│ │ （必要に応じて撮影）                 │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 🔧 取り付けたパーツ                      │
│ ┌─────────────────────────────────────┐ │
│ │ [+ パーツを追加]                    │ │
│ │                                      │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ パーツ名: [エンジンチューニング] │ │ │
│ │ │ 数量: [1] 単価: [50,000] 円   │ │ │
│ │ │ 金額: [50,000] 円              │ │ │
│ │ │                                │ │ │
│ │ │ 備考:                           │ │ │
│ │ │ ────────────────────────────── │ │ │
│ │ │                                │ │ │
│ │ │ [削除]                          │ │ │
│ │ └────────────────────────────────┘ │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ ✅ 動作確認                             │
│ ┌─────────────────────────────────────┐ │
│ │ [✓] 動作確認済み                    │ │
│ │                                      │ │
│ │ 確認内容:                           │ │
│ │ ─────────────────────────────────── │ │
│ │                                     │ │
│ │  動作確認の結果、特記事項など        │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ ⏱️ 作業時間                             │
│ ┌─────────────────────────────────────┐ │
│ │ 作業時間: [3.5] 時間                 │ │
│ │                                      │ │
│ │ （実施した作業にかかった時間）        │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📝 作業メモ                             │
│ ┌─────────────────────────────────────┐ │
│ │                                     │ │
│ │  作業時の特記事項、注意事項など      │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│           [作業完了]                    │
└─────────────────────────────────────────┘
```

### 5-2. コンポーネント設計

#### 作業記録セクション

**目的**: 実施した作業内容を記録

**UI要素**:
- **作業記録入力**: テキストエリア（自由入力、複数行入力可能）

**バリデーション**:
- 作業記録は必須

#### Before/After写真セクション

**目的**: カスタム前後の状態を記録（必要に応じて）

**UI要素**:
- **写真撮影ボタン**: カメラボタン
- **Before写真表示**: 画像ギャラリー
- **After写真表示**: 画像ギャラリー

**動作**:
- 写真撮影は任意（必須ではない）
- Before/Afterを区別して撮影可能

#### 取り付けたパーツセクション

**目的**: 実際に取り付けたパーツを記録

**UI要素**:
- **パーツ追加ボタン**: 「+ パーツを追加」ボタン
- **パーツカード**: 各部品ごとにカード表示
  - **パーツ名入力**: テキスト入力（見積画面で登録したパーツから選択可能）
  - **数量入力**: 数値入力
  - **単価入力**: 数値入力（円単位）
  - **金額表示**: 自動計算（数量 × 単価）
  - **備考入力**: テキストエリア（任意）
  - **削除ボタン**: パーツを削除

**動作**:
- 見積画面で登録したパーツから選択可能（オプション）
- または、新しいパーツを追加可能

#### 動作確認セクション

**目的**: カスタム後の動作確認結果を記録

**UI要素**:
- **動作確認チェックボックス**: チェックボックス
- **確認内容入力**: テキストエリア（任意）

**バリデーション**:
- 動作確認チェックボックスは推奨（任意）

#### 作業時間セクション

**目的**: 実施した作業にかかった時間を記録

**UI要素**:
- **作業時間入力**: 数値入力（時間単位、小数点以下も可）

**バリデーション**:
- 作業時間は必須
- 作業時間は0より大きい値

### 5-3. データフロー

1. **画面表示時**:
   - 車両情報を表示
   - カスタム内容を表示
   - 見積もり内容を表示（参照のみ）
   - 既存の作業情報を表示（あれば）

2. **作業完了時**:
   - 作業記録、Before/After写真、取り付けたパーツ、動作確認結果、作業時間、作業メモを保存
   - Jobステータスを「出庫待ち」に更新

---

## 6. データモデル

### 6-1. TuningPartsInstallationJob

```typescript
/**
 * チューニング・パーツ取付ジョブ
 */
export interface TuningPartsInstallationJob {
  /** Job ID */
  jobId: string;
  /** 入庫区分 */
  serviceKind: "チューニング" | "パーツ取付";
  /** 種類 */
  type: "チューニング" | "パーツ取付";
  
  /** 車両情報 */
  vehicle: {
    /** 車両ID */
    vehicleId: string;
    /** 走行距離 */
    mileage: number;
  };
  
  /** カスタム情報 */
  custom: {
    /** カスタム内容（顧客の説明） */
    description: string;
  };
  
  /** 診断情報 */
  diagnosis: {
    /** 確認項目の結果 */
    inspectionResults: InspectionResult[];
    /** Before写真 */
    beforePhotos: Photo[];
    /** コメント（整備士の所見） */
    comments: string;
  };
  
  /** 見積情報 */
  estimate: {
    /** パーツリスト */
    parts: PartItem[];
    /** 工賃 */
    labor: number;
    /** 作業時間見積もり */
    estimatedDuration: number;
    /** 小計 */
    subtotal: number;
    /** 消費税 */
    tax: number;
    /** 合計金額 */
    total: number;
    /** 承認方法 */
    approvalMethod: "口頭承認" | "事前承認" | "システム承認";
    /** 承認日時 */
    approvedAt?: Date;
  };
  
  /** 作業情報 */
  work: {
    /** 作業記録 */
    workContent: string;
    /** Before/After写真 */
    beforePhotos: Photo[];
    afterPhotos: Photo[];
    /** 取り付けたパーツ */
    installedParts: PartItem[];
    /** 動作確認結果 */
    operationCheck: {
      /** 確認済み */
      checked: boolean;
      /** 確認内容 */
      content?: string;
    };
    /** 作業時間 */
    workDuration: number;
    /** 作業メモ */
    notes: string;
  };
  
  /** ステータス */
  status: "入庫待ち" | "診断中" | "見積作成待ち" | "顧客承認待ち" | "部品取り寄せ中" | "作業待ち" | "作業中" | "出庫待ち";
}

/**
 * 確認項目の結果
 */
export interface InspectionResult {
  /** 項目名 */
  name: string;
  /** 状態 */
  condition: "正常" | "注意" | "要カスタム" | "要点検";
  /** 写真 */
  photo?: Photo;
  /** コメント */
  comment?: string;
}

/**
 * パーツ項目
 */
export interface PartItem {
  /** パーツ名 */
  name: string;
  /** 数量 */
  quantity: number;
  /** 単価 */
  unitPrice: number;
  /** 金額 */
  amount: number;
  /** 取り寄せ状況 */
  status?: "在庫あり" | "発注済み" | "取り寄せ中" | "到着済み";
  /** 到着予定日 */
  expectedArrivalDate?: Date;
  /** 備考 */
  note?: string;
}

/**
 * 写真
 */
export interface Photo {
  /** 写真ID */
  photoId: string;
  /** ファイルパス（Google Drive） */
  filePath: string;
  /** 撮影日時 */
  takenAt: Date;
  /** 説明 */
  description?: string;
}
```

---

## 7. API設計

### 7-1. 受付画面

#### POST /api/jobs/[id]/reception

**目的**: チューニング・パーツ取付の受付情報を保存

**リクエストボディ**:
```typescript
{
  serviceKind: "チューニング" | "パーツ取付";
  type: "チューニング" | "パーツ取付";
  custom: {
    description: string;
  };
  mileage: number;
  notes?: string;
}
```

**レスポンス**:
```typescript
{
  success: boolean;
  job: TuningPartsInstallationJob;
}
```

### 7-2. 診断画面

#### GET /api/jobs/[id]/diagnosis

**目的**: 診断情報を取得

**レスポンス**:
```typescript
{
  job: TuningPartsInstallationJob;
  diagnosis: TuningPartsInstallationJob["diagnosis"];
}
```

#### POST /api/jobs/[id]/diagnosis

**目的**: 診断情報を保存

**リクエストボディ**:
```typescript
{
  inspectionResults: InspectionResult[];
  beforePhotos: Photo[];
  comments: string;
}
```

**レスポンス**:
```typescript
{
  success: boolean;
  job: TuningPartsInstallationJob;
}
```

### 7-3. 見積画面

#### GET /api/jobs/[id]/estimate

**目的**: 見積情報を取得

**レスポンス**:
```typescript
{
  job: TuningPartsInstallationJob;
  estimate: TuningPartsInstallationJob["estimate"];
}
```

#### POST /api/jobs/[id]/estimate

**目的**: 見積情報を保存

**リクエストボディ**:
```typescript
{
  parts: PartItem[];
  labor: number;
  estimatedDuration: number;
  approvalMethod: "口頭承認" | "事前承認" | "システム承認";
  notes?: string;
}
```

**レスポンス**:
```typescript
{
  success: boolean;
  job: TuningPartsInstallationJob;
}
```

### 7-4. 作業画面

#### GET /api/jobs/[id]/work

**目的**: 作業情報を取得

**レスポンス**:
```typescript
{
  job: TuningPartsInstallationJob;
  work: TuningPartsInstallationJob["work"];
}
```

#### POST /api/jobs/[id]/work

**目的**: 作業情報を保存

**リクエストボディ**:
```typescript
{
  workContent: string;
  beforePhotos: Photo[];
  afterPhotos: Photo[];
  installedParts: PartItem[];
  operationCheck: {
    checked: boolean;
    content?: string;
  };
  workDuration: number;
  notes: string;
}
```

**レスポンス**:
```typescript
{
  success: boolean;
  job: TuningPartsInstallationJob;
}
```

---

## 8. ユーザージャーニー

### 8-1. チューニングの場合

1. **受付** (フロントスタッフ)
   - 車両情報を確認
   - 種類を「チューニング」に選択
   - カスタム内容を入力
   - 走行距離を入力
   - 入庫確定

2. **診断** (整備士)
   - カスタム箇所の確認
   - 関連箇所の簡易点検
   - 必要に応じてBefore写真を撮影
   - 診断完了

3. **見積作成** (フロントスタッフ)
   - パーツ代・工賃の見積もりを作成
   - 作業時間見積もりを設定
   - 部品の取り寄せ状況を管理
   - 承認方法を記録
   - 見積もり確定

4. **顧客承認** (顧客)
   - 見積もりを確認して承認

5. **作業実施** (整備士)
   - 作業記録を入力
   - 必要に応じてBefore/After写真を撮影
   - 取り付けたパーツを記録
   - 動作確認を実施
   - 作業時間を記録
   - 作業完了

6. **引渡** (フロントスタッフ)
   - 作業内容を説明
   - 顧客に引渡

### 8-2. パーツ取付の場合

1. **受付** (フロントスタッフ)
   - 車両情報を確認
   - 種類を「パーツ取付」に選択
   - カスタム内容を入力（例: ナビ取り付け）
   - 走行距離を入力
   - 入庫確定

2. **診断** (整備士)
   - 取り付け箇所の確認
   - 配線、固定方法などの簡易点検
   - 必要に応じてBefore写真を撮影
   - 診断完了

3. **見積作成** (フロントスタッフ)
   - パーツ代・工賃の見積もりを作成
   - 作業時間見積もりを設定
   - 部品の取り寄せ状況を管理
   - 承認方法を記録
   - 見積もり確定

4. **顧客承認** (顧客)
   - 見積もりを確認して承認

5. **作業実施** (整備士)
   - 作業記録を入力
   - 必要に応じてBefore/After写真を撮影
   - 取り付けたパーツを記録
   - 動作確認を実施
   - 作業時間を記録
   - 作業完了

6. **引渡** (フロントスタッフ)
   - 作業内容を説明
   - 顧客に引渡

---

## 9. 実装上の注意点

### 9-1. 種類選択の実装

- 受付時に種類（チューニング/パーツ取付）を選択
- 種類選択により、以降の画面が動的に変化
- 種類設定をマスタデータとして管理

### 9-2. 動的UIの実装

- 種類に応じて、診断項目・見積項目・作業項目が動的に変化
- チューニングの場合: エンジン、排気系、サスペンションなど
- パーツ取付の場合: 取り付け箇所、配線、固定方法など

### 9-3. 部品取り寄せ管理

- 部品の取り寄せが必要な場合は、複数日にまたがる
- 取り寄せ状況を管理（在庫あり、発注済み、取り寄せ中、到着済み）
- 到着予定日を管理

### 9-4. 性能測定

- チューニングでも性能測定は不要
- 診断・作業記録は通常の項目のみ

### 9-5. PDF生成

- チューニング・パーツ取付ではPDF生成は不要
- 作業記録はシステム内で管理

---

## 10. 関連ドキュメント

- [統合仕様書](./INTEGRATED_SPECIFICATION.md): システム全体の統合仕様
  - 「2-3. データフローの統一」: マスタデータ同期の制約と対応方法
  - 「2-4. 複数作業管理の実装」: 複数作業管理の実装方法
  - 「4-2-6. 請求書統合フロー」: 基幹システムでの統合請求書作成手順
- [システム進化計画](./SYSTEM_EVOLUTION_PLAN.md): 基幹システム制約下での設計変更方針
- [ユーザーワークフロー詳細設計 v2.0](./USER_WORKFLOW_DETAILED_DESIGN_V2.md): ユーザー別業務・システム利用詳細設計

**マスタデータ同期の制約**:
- 車両マスタ・顧客マスタはGoogle Sheets経由で取得（基幹システムからGAS経由で同期）
- マスタデータの更新は基幹システムで実施（Webアプリからは更新不可）
- データ不整合が発生した場合は、「Human Middleware」（スタッフ）が基幹システムを修正

---

## 11. 更新履歴

- 2025-01-XX: 初版作成
- 2025-01-XX: 基幹システム連携フローを追加、関連ドキュメントへの参照を追加
- 2025-01-XX: マスタデータ同期の制約を追加

























