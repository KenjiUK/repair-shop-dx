# 診断ページ（12カ月点検）レビュー・改善提案

**作成日**: 2025-01-XX  
**対象ページ**: `/mechanic/diagnosis/[id]`  
**対象ファイル**: `src/app/mechanic/diagnosis/[id]/page.tsx`

---

## 🔴 発見された問題

### 1. 背景色が途中で変わる問題

**現象**: スクロールすると、ページの背景色が`bg-slate-50`から`bg-white`に変わる

**原因**:
- ページ全体: `bg-slate-50` (3585行目)
- 固定フッター: `bg-white` (4403行目)
- スクロール時に固定フッターの白背景が表示され、ページ全体の`bg-slate-50`と色が不一致

**影響**: 
- 視覚的な不統一感
- ユーザー体験の低下

### 2. ヘッダーが消える問題

**現象**: スクロールが半分くらいになると、縮小版のヘッダーまで消える

**原因**:
- `AppHeader`のスクロール検知ロジックで、`isHeaderExpanded`が`false`になると縮小版が表示される
- しかし、スクロール位置の計算が不正確で、特定の位置でヘッダーが完全に非表示になっている可能性
- `app-layout-client.tsx`の`overflow-auto`要素と`window`のスクロールの混在が原因の可能性

**影響**:
- 重要な情報（顧客名、車両名、ステータス）へのアクセスが困難
- 戻るボタンが使えなくなる

### 3. レイアウト構造の問題

**問題点**:
- ページ全体が`min-h-screen bg-slate-50`で、その中に`main`要素がある
- 固定フッターが`bg-white`で、ページ全体と色が不一致
- `app-layout-client.tsx`の`overflow-auto`がスクロール可能要素になっているが、診断ページは`window`のスクロールを使用している

---

## ✅ 改善提案

### 1. 背景色の統一

**提案**: 固定フッターの背景色を`bg-slate-50`に統一

```typescript
// 修正前
<div className="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 p-4 shadow-lg">

// 修正後
<div className="fixed bottom-0 left-0 right-0 bg-slate-50 border-t border-slate-200 p-4 shadow-lg">
```

**理由**:
- ページ全体の背景色と統一することで、視覚的な一貫性を保つ
- 業界ベストプラクティス: 固定要素の背景色はページ全体の背景色と統一する

### 2. ヘッダーの表示ロジック改善

**提案**: ヘッダーは常に表示し、縮小版のみを表示する

**修正内容**:
1. `AppHeader`のスクロール検知ロジックを改善
2. `window`のスクロールを優先的に使用（`app-layout-client.tsx`の`overflow-auto`は無視）
3. 縮小版が表示される条件を明確化

**実装**:
```typescript
// app-header.tsx の修正
const getScrollableElement = (): Element | Window => {
  // 診断ページなどでは常にwindowのスクロールを使用
  return window;
};
```

**理由**:
- ヘッダーは常に表示されるべき（重要な情報へのアクセス）
- スクロール検知のロジックを簡素化し、予測可能な動作にする

### 3. レイアウト構造の改善

**提案**: ページ全体の背景色を統一し、固定フッターの背景色も統一

**修正内容**:
1. ページ全体: `bg-slate-50`を維持
2. 固定フッター: `bg-slate-50`に変更
3. メインコンテンツ: 背景色を明示的に設定しない（親要素の背景色を継承）

**理由**:
- 視覚的な一貫性を保つ
- 業界ベストプラクティス: 固定要素とページ全体の背景色を統一する

### 4. コンテンツの流れの改善

**提案**: 診断ページのコンテンツ構造を改善

**現在の構造**:
```
1. ヘッダー（AppHeader）
2. ワークオーダー選択UI
3. メインコンテンツ（main）
   - 一時帰宅/入庫選択セクション
   - 診断項目（カテゴリ別）
   - 写真撮影
   - その他の機能
4. 固定フッター（完了ボタン）
```

**改善提案**:
1. **情報階層の明確化**
   - ヘッダー: 常に表示（縮小版でも基本情報を表示）
   - ワークオーダー選択: 複数作業がある場合のみ表示
   - メインコンテンツ: 診断項目をカテゴリ別に整理
   - 固定フッター: 完了ボタンを常に表示

2. **スクロール体験の改善**
   - 固定フッターの高さ分のパディングを追加（`pb-32`は維持）
   - スクロール位置インジケーターを追加（オプション）

3. **視覚的な階層の明確化**
   - カテゴリごとにセクションを分ける
   - 各セクションに明確なタイトルとアイコンを配置
   - 進捗インジケーターを追加（12カ月点検の場合、5カテゴリの進捗を表示）

### 5. 12カ月点検特有の改善

**提案**: 12カ月点検の診断フローを最適化

**現在の問題**:
- 5つのカテゴリ（かじ取り装置、制動装置、走行装置、緩衝装置、動力伝達装置）が表示されるが、進捗が分かりにくい
- 各カテゴリの完了状況が視覚的に分かりにくい

**改善提案**:
1. **カテゴリタブの改善**
   - 各カテゴリの完了状況をバッジで表示
   - 完了したカテゴリは視覚的に区別（例: チェックマークアイコン）

2. **進捗バーの追加**
   - 全体の進捗を表示（例: 「3/5 カテゴリ完了」）
   - 各カテゴリの進捗も表示（例: 「10/15 項目完了」）

3. **ナビゲーションの改善**
   - 次のカテゴリへの移動ボタンを追加
   - 前のカテゴリへの移動ボタンを追加

### 6. 業界ベストプラクティスに基づく改善

**提案**: 整備工場業務アプリのベストプラクティスを適用

1. **作業フローの明確化**
   - 診断項目を「必須項目」と「任意項目」に分類
   - 必須項目が未完了の場合、完了ボタンを無効化（または警告表示）

2. **データ入力の効率化**
   - よく使うコメントをテンプレート化
   - 音声入力の活用（手が汚れている時）

3. **視覚的フィードバック**
   - 各項目の状態（OK/注意/要交換）を色で明確に表示
   - 写真撮影が必要な項目にはアイコンを表示

4. **エラー防止**
   - 必須項目の未入力チェック
   - 診断完了前の確認ダイアログ

---

## 📋 実装優先順位

### 高優先度（即座に修正）
1. ✅ 背景色の統一（固定フッターを`bg-slate-50`に変更）
2. ✅ ヘッダーの表示ロジック改善（常に表示されるように）

### 中優先度（次のスプリントで実装）
3. カテゴリタブの改善（進捗表示）
4. 進捗バーの追加
5. ナビゲーションの改善

### 低優先度（将来的な改善）
6. 作業フローの明確化
7. データ入力の効率化
8. エラー防止機能の強化

---

## 🎯 期待される効果

### ユーザー体験の向上
- 視覚的な一貫性により、ストレスが軽減
- ヘッダーが常に表示されることで、重要な情報へのアクセスが容易に
- 進捗が分かりやすくなることで、作業効率が向上

### 業務効率の向上
- 診断項目の完了状況が一目で分かる
- 必須項目の未入力チェックにより、ミスが減少
- ナビゲーションの改善により、作業時間が短縮

### 業界標準への準拠
- 整備工場業務アプリのベストプラクティスに準拠
- ユーザビリティの向上により、競合他社との差別化

---

## 📝 実装チェックリスト

- [ ] 固定フッターの背景色を`bg-slate-50`に変更
- [ ] ヘッダーのスクロール検知ロジックを改善
- [ ] カテゴリタブに進捗表示を追加
- [ ] 進捗バーを追加
- [ ] ナビゲーションボタンを追加
- [ ] 必須項目の未入力チェックを実装
- [ ] 診断完了前の確認ダイアログを追加

---

## 🔗 関連ドキュメント

- [PAGE_SPECIFICATION.md](./PAGE_SPECIFICATION.md) - ページ単位詳細設計仕様書
- [DESIGN_SYSTEM.md](./DESIGN_SYSTEM.md) - デザインシステム
- [12MONTH_INSPECTION_CONFIRMED_SPEC.md](./12MONTH_INSPECTION_CONFIRMED_SPEC.md) - 12カ月点検確認済み仕様書

---

**End of Document**









