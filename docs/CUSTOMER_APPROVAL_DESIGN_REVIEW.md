# 顧客承認ページ デザインレビュー

**作成日**: 2025-01-XX  
**対象ページ**: `/customer/approval/[id]`  
**基準**: `DESIGN_SYSTEM.md`

---

## 1. デザインシステム準拠状況

### 1-1. ボタンサイズ ✅

**現状**:
- 承認ボタン: `h-12` (48px) ✅
- 却下ボタン: `h-12` (48px) ✅
- 動画を見るボタン: `h-12` (48px) ✅

**DESIGN_SYSTEM.md準拠**: ✅ すべて`h-12` (48px) を使用しており、40歳以上ユーザー向け最適化を満たしています。

### 1-2. テキストサイズ ✅

**現状**:
- ページタイトル: `text-2xl` (24px) ✅
- セクションタイトル: `text-xl` (20px) ✅
- 本文: `text-base` (16px) ✅
- 合計金額: `text-2xl` (24px) ✅

**DESIGN_SYSTEM.md準拠**: ✅ すべて`text-base` (16px) 以上を使用しており、視認性を確保しています。

### 1-3. アイコンサイズ ✅

**現状**:
- セクションタイトルアイコン: `h-5 w-5` (20px) ✅
- ボタン内アイコン: `h-5 w-5` (20px) ✅
- チェックボックス: `h-6 w-6` (24px) ✅

**DESIGN_SYSTEM.md準拠**: ✅ すべて`h-4 w-4` (16px) 以上を使用しており、視認性を確保しています。

### 1-4. カラーシステム ✅

**現状**:
- 必須整備バッジ: `bg-red-600 text-white` ✅
- 推奨整備バッジ: `bg-blue-600 text-white` ✅
- 任意整備バッジ: `bg-slate-500 text-white` ✅

**DESIGN_SYSTEM.md準拠**: ✅ 見積ページバッジ色の仕様に準拠しています。

### 1-5. スペーシング ✅

**現状**:
- セクション間: `mb-6` (24px) ✅
- カード間: `space-y-3` (12px) ✅
- ボタン間: `gap-2` (8px) ✅

**DESIGN_SYSTEM.md準拠**: ✅ 適切なスペーシングを使用しています。

---

## 2. 改善提案

### 2-1. チェックボックスのサイズ ⚠️

**現状**:
- チェックボックス: `h-6 w-6` (24px)

**DESIGN_SYSTEM.md推奨**:
- チェックボックス: `size-4` (16px × 16px)

**提案**: チェックボックスのサイズを`h-6 w-6`から`size-4`に変更することを検討してください。ただし、現在のサイズでも視認性は十分確保されているため、優先度は低めです。

### 2-2. バッジのテキストサイズ ⚠️

**現状**:
- バッジ: `text-base` (16px) ✅

**DESIGN_SYSTEM.md準拠**: ✅ 問題ありません。

---

## 3. 表現の修正

### 3-1. 「注文が確定します」の表現

**現状**:
```
ボタンを押すと注文が確定します
```

**問題点**:
- 「注文が確定します」という表現は、ユーザーにとって曖昧で誤解を招く可能性があります。
- 自動車整備工場の文脈では、「注文」よりも「作業依頼」や「見積承認」の方が適切です。

**修正案**:
```
このボタンを押すと、選択した内容で作業を依頼します
```

または

```
このボタンを押すと、見積もりが承認され、作業が開始されます
```

**推奨**: 「このボタンを押すと、選択した内容で作業を依頼します」を使用することを推奨します。

---

## 4. 承認の確証方法について

### 4-1. 現状の実装

**マジックリンク認証**:
- URLパラメータに`token`を含むマジックリンクを生成
- トークンから顧客IDを取得して認証
- 有効期限: 7日間（デフォルト）

**問題点**:
- マジックリンクが第三者に渡った場合、本人以外が承認できてしまう可能性がある
- 実際に本人が操作したかどうかの確証が得られない

### 4-2. CitNOWの承認確証方法について

**調査結果**:
CitNOWの具体的な承認確証方法（マジックリンクの実装詳細、二要素認証の有無、電子署名の使用など）について、公開されている情報が限られており、詳細な実装方法を確認することはできませんでした。

**CitNOWの特徴**:
- 整備担当者が作業内容をビデオで撮影し、顧客に配信
- 顧客がビデオを視聴して修理作業を承認
- ビデオベースの承認プロセス

**参考情報**:
CitNOWの公式ドキュメントやサポート情報を直接参照することで、より詳細な実装方法を確認できる可能性があります。

### 4-3. 一般的な業界のベストプラクティス

#### 4-3-1. 二要素認証（2FA）の導入

**事例**: 電子契約サービス、金融サービス、一般的なWebアプリケーション

**実装方法**:
- マジックリンクに加えて、SMSや認証アプリを使用したワンタイムパスワード（OTP）を送信
- ユーザーがOTPを入力することで本人確認を強化

**メリット**:
- 本人性の担保が強化される
- マジックリンクが漏洩しても、OTPがなければ承認できない

**デメリット**:
- 実装コストが高い
- ユーザーの操作が複雑になる

#### 4-3-2. デバイス・IPアドレスの制限

**事例**: セキュリティ重視のWebアプリケーション、企業向けシステム

**実装方法**:
- マジックリンクの使用を特定のデバイスやIPアドレスに限定
- 初回アクセス時にデバイス登録を要求

**メリット**:
- 不正アクセスのリスクを低減
- 実装が比較的簡単

**デメリット**:
- ユーザーが異なるデバイスからアクセスできない
- IPアドレスが動的に変わる場合に問題が発生する可能性

#### 4-3-3. 有効期限の短縮

**事例**: 一般的なWebアプリケーション、電子契約サービス（Box: 7日間、SmartHR: 2週間）

**実装方法**:
- マジックリンクの有効期限を短く設定（例: 15分、30分）
- 有効期限切れの場合は再送信を要求

**メリット**:
- 実装が簡単
- リンクの不正使用を防ぎやすい

**デメリット**:
- ユーザーの利便性が低下する可能性

#### 4-3-4. 承認ログの記録

**事例**: 監査要件があるシステム、企業向け承認システム

**実装方法**:
- 承認時のIPアドレス、デバイス情報、タイムスタンプを記録
- 承認履歴を保存し、後から確認可能にする

**メリット**:
- 承認の証跡を残せる
- 問題発生時に原因を特定しやすい

**デメリット**:
- 本人性の担保には直接つながらない

### 4-4. 推奨実装

**段階的アプローチ**:

1. **Phase 1（現状改善）**:
   - 有効期限を7日間から24時間に短縮
   - 承認ログの記録（IPアドレス、デバイス情報、タイムスタンプ）

2. **Phase 2（セキュリティ強化）**:
   - SMSによる二要素認証（OTP）の導入
   - 初回アクセス時のデバイス登録

3. **Phase 3（高度なセキュリティ）**:
   - 生体認証（指紋、顔認証）の導入
   - 電子署名の導入

**実装優先度**:
- **高**: 有効期限の短縮、承認ログの記録
- **中**: SMSによる二要素認証
- **低**: 生体認証、電子署名

---

## 5. まとめ

### 5-1. デザインシステム準拠状況

✅ **良好**: ボタンサイズ、テキストサイズ、アイコンサイズ、カラーシステム、スペーシングすべてDESIGN_SYSTEM.mdに準拠しています。

### 5-2. 改善点

1. **表現の修正**: 「注文が確定します」→「このボタンを押すと、選択した内容で作業を依頼します」
2. **チェックボックスのサイズ**: `h-6 w-6`から`size-4`への変更を検討（優先度: 低）

### 5-3. 承認の確証方法

**推奨実装**:
1. 有効期限を24時間に短縮
2. 承認ログの記録（IPアドレス、デバイス情報、タイムスタンプ）
3. SMSによる二要素認証（OTP）の導入（将来的に）

**実装優先度**:
- **高**: 有効期限の短縮、承認ログの記録
- **中**: SMSによる二要素認証

---

## 6. 参考資料

- [DESIGN_SYSTEM.md](./DESIGN_SYSTEM.md)
- [マジックリンク認証のベストプラクティス](https://blog.logto.io/ja/magic-link-authentication)
- [二要素認証（2FA）の実装ガイド](https://smslink.nexway.co.jp/case/01)

