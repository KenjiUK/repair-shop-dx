# モバイルヘッダー改善提案

## 現在の実装

- トップページ以外のページで、`AppHeader` が `sticky` で固定
- `CompactJobHeader` に顧客情報、車両情報、ステータスなどが常時表示
- スクロールしても常に表示され続ける

## 問題点

### モバイル環境での課題

1. **画面スペースの浪費**: モバイルの小さな画面で、ヘッダーが多くのスペースを占有
2. **コンテンツエリアの縮小**: 実際の作業コンテンツが表示できる領域が少ない
3. **視覚的なノイズ**: 常時表示される情報が多すぎて、作業に集中しにくい
4. **スクロール効率の低下**: 頻繁にスクロールが必要になる

## 業界のベストプラクティス

### 1. **Collapsible Header（折りたたみヘッダー）**
- **例**: Gmail、Twitter、Instagram
- **特徴**: スクロール時に縮小、上スクロール時に展開
- **メリット**: コンテンツエリアを最大化しつつ、必要な時に情報を確認可能

### 2. **Hide on Scroll Down, Show on Scroll Up**
- **例**: Medium、Reddit、YouTube
- **特徴**: 下スクロールで非表示、上スクロールで表示
- **メリット**: コンテンツに集中できる

### 3. **Minimal Header on Scroll（最小化ヘッダー）**
- **例**: GitHub、Notion、Linear
- **特徴**: スクロール時に最小限の情報（タイトル、戻るボタン）のみ表示
- **メリット**: コンテキストを保ちつつ、スペースを節約

### 4. **Expandable Header（展開可能ヘッダー）**
- **例**: Slack、Discord
- **特徴**: タップで展開/折りたたみ可能
- **メリット**: ユーザーが制御できる

## 推奨実装: ハイブリッドアプローチ

### 提案1: スクロール時に最小化 + 上スクロールで展開（推奨）

**動作:**
- **下スクロール時**: ヘッダーを最小化（戻るボタン + ページタイトル + ステータスバッジのみ）
- **上スクロール時**: ヘッダーを展開（顧客情報、車両情報など詳細を表示）
- **スクロール停止時**: 3秒後に自動的に最小化（オプション）

**メリット:**
- ✅ コンテンツエリアを最大化
- ✅ 必要な時に情報を確認可能
- ✅ 直感的な操作（上スクロール = 情報を確認したい）
- ✅ 業界標準のパターン

**実装例:**
```tsx
// スクロール方向を検知
const [scrollDirection, setScrollDirection] = useState<"up" | "down" | null>(null);
const [isHeaderExpanded, setIsHeaderExpanded] = useState(true);

// 下スクロール時: 最小化
// 上スクロール時: 展開
// トップ付近: 常に展開
```

### 提案2: タップで展開/折りたたみ

**動作:**
- **デフォルト**: 最小化されたヘッダー（戻るボタン + ページタイトル）
- **タップ時**: 詳細情報を展開
- **再タップ時**: 折りたたみ

**メリット:**
- ✅ ユーザーが完全に制御できる
- ✅ 予測可能な動作
- ✅ 実装がシンプル

**デメリット:**
- ❌ 情報を見るためにタップが必要（発見性が低い）

### 提案3: 段階的な縮小

**動作:**
- **スクロール0-50px**: フル表示
- **スクロール50-100px**: 中程度の縮小（顧客名、車両名のみ）
- **スクロール100px以上**: 最小化（戻るボタン + タイトルのみ）

**メリット:**
- ✅ スムーズな遷移
- ✅ 段階的に情報を非表示

**デメリット:**
- ❌ 実装が複雑
- ❌ 中間状態が分かりにくい可能性

## 推奨: 提案1（スクロール方向ベースの展開/縮小）

### 実装詳細

#### 1. スクロール方向の検知
```typescript
const [scrollDirection, setScrollDirection] = useState<"up" | "down" | null>(null);
const [lastScrollY, setLastScrollY] = useState(0);

useEffect(() => {
  const handleScroll = () => {
    const currentScrollY = window.scrollY;
    
    if (currentScrollY < 50) {
      // トップ付近は常に展開
      setIsHeaderExpanded(true);
    } else if (currentScrollY > lastScrollY) {
      // 下スクロール: 縮小
      setIsHeaderExpanded(false);
      setScrollDirection("down");
    } else {
      // 上スクロール: 展開
      setIsHeaderExpanded(true);
      setScrollDirection("up");
    }
    
    setLastScrollY(currentScrollY);
  };
  
  window.addEventListener("scroll", handleScroll, { passive: true });
  return () => window.removeEventListener("scroll", handleScroll);
}, [lastScrollY]);
```

#### 2. ヘッダーの状態管理
```typescript
// 最小化時: 戻るボタン + ページタイトル + ステータスバッジ
// 展開時: フル情報（CompactJobHeader）
```

#### 3. アニメーション
```css
transition: height 0.3s ease-in-out, opacity 0.2s ease-in-out;
```

### モバイル最適化

- **最小化時の高さ**: 約48-56px（戻るボタン + タイトル）
- **展開時の高さ**: 約120-150px（フル情報）
- **閾値**: スクロール50px以上で縮小開始

### ユーザビリティの考慮

1. **トップ付近は常に展開**: ページ読み込み時やトップ付近では情報を確認しやすい
2. **上スクロールで展開**: 情報を確認したい時に自然に表示される
3. **スムーズなアニメーション**: 視覚的な違和感を最小化
4. **タッチフレンドリー**: 最小化時も戻るボタンは十分なタップ領域を確保

## 実装優先度

1. **高**: スクロール方向ベースの展開/縮小（提案1）
2. **中**: タップで展開/折りたたみ（提案2）
3. **低**: 段階的な縮小（提案3）

## まとめ

**推奨実装**: スクロール方向ベースの展開/縮小
- 下スクロール時: 最小化（コンテンツエリア最大化）
- 上スクロール時: 展開（情報確認）
- トップ付近: 常に展開（初期状態の確認）

これにより、モバイル環境での使いやすさを大幅に改善できます。





