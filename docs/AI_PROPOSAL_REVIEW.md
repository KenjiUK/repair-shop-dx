# AI提案レビュー結果（統合版・最終整理）

**レビュー日**: 2025-01-20  
**レビュアー**: Auto (Cursor AI)  
**対象**: 複数のAIからの改善提案（統合・整理後: 42項目）

---

## レビュー方針

各提案について、以下の観点で評価します：
- **必要性**: 現在のシステムに本当に必要か
- **優先度**: 高 / 中 / 低
- **実装難易度**: 高 / 中 / 低
- **推奨**: ✅ 推奨 / ⚠️ 検討 / ❌ 非推奨
- **重複・類似項目**: 統合して整理

---

## カテゴリ別提案レビュー

### A. UI/UX改善（モバイル対応・操作性向上）

#### A1. 見積画面のモバイル対応（統合: 4, 12）

**提案内容**
- 見積作成画面の5列グリッド（作業名、数量、単価、部品代、技術量、削除）は、スマホやタブレットでの操作が困難
- 改善案: モバイル時は「カード型レイアウト」に切り替えるか、横スクロール固定

**現状確認**
- 見積画面のグリッド: `grid-cols-[2fr_80px_100px_100px_120px_auto]`（固定幅、約400px以上）
- モバイル対応: 未実装

**評価**
- **必要性**: ✅ **高** - 40代以上の整備士がスマホで操作することを考慮すると必須
- **優先度**: ✅ **高** - モバイルでの操作性は重要
- **実装難易度**: ⚠️ **中** - レスポンシブレイアウトの実装が必要
- **推奨**: ✅ **推奨** - 早急に実装すべき

**実装方針**
- モバイル時（`sm`以下）: カード型レイアウトに切り替え
- タブレット時（`md`）: 横スクロール可能なグリッド
- PC時（`lg`以上）: 現状の6列グリッドを維持

---

#### A2. 診断画面の縦スクロール問題（統合: 6, 25）

**提案内容**
- 診断項目が非常に多い（車検で50項目以上）ため、スクロールが長大になる
- 改善案: カテゴリごとに「アコーディオンUI」で閉じておく、完了カテゴリは自動で閉じる

**現状確認**
- 診断画面: `src/app/mechanic/diagnosis/[id]/page.tsx`
- 診断項目: カテゴリ別に表示されているが、アコーディオンUIは未実装

**評価**
- **必要性**: ✅ **高** - 50項目以上のスクロールは操作性が悪い
- **優先度**: ✅ **高** - UX向上のため重要
- **実装難易度**: ⚠️ **中** - アコーディオンUIまたはタブUIの実装が必要
- **推奨**: ✅ **推奨** - 早急に実装すべき

**実装方針**
- カテゴリごとに`Collapsible`コンポーネントを使用
- 未入力項目があるカテゴリには「！」マークを表示
- デフォルトで開いているカテゴリ: 最初のカテゴリのみ
- 完了カテゴリは自動で閉じる

---

#### A3. 受付画面のオフライン対応（7）

**提案内容**
- `fetchTodayJobs`でデータを取る際、オフラインだったらどうなるか？
- 改善案: SWRのキャッシュ戦略を`stale-while-revalidate`にし、前回のキャッシュを即座に見せる

**現状確認**
- SWRの設定: 確認が必要
- オフライン対応: `useOnlineStatus`フックで実装済み
- オフラインストレージ: `offline-storage.ts`で実装済み（IndexedDB）

**評価**
- **必要性**: ✅ **高** - 朝のラッシュ時にネットが遅いと画面が出ない問題は重要
- **優先度**: ✅ **高** - 業務に直接影響する
- **実装難易度**: ✅ **低** - SWRの設定変更のみ
- **推奨**: ✅ **推奨** - 早急に実装すべき

**実装方針**
- SWRの`revalidateOnFocus: false`、`revalidateOnReconnect: true`を設定
- `fallbackData`を使用して、前回のキャッシュを即座に表示

---

#### A4. 日本語フォントスタックの追加（11）

**提案内容**
- Geist Sansは欧文フォントであり、日本語の表示（特に漢字の視認性）がOS依存になる
- 改善案: 日本語フォントスタックを明記

**現状確認**
- フォント設定: `DESIGN_SYSTEM.md`で確認が必要

**評価**
- **必要性**: ✅ **高** - 日本語表示の一貫性のため重要
- **優先度**: ✅ **高** - デザインシステムの基本
- **実装難易度**: ✅ **低** - CSSのフォントスタック定義のみ
- **推奨**: ✅ **推奨** - 早急に実装すべき

**実装方針**
- `tailwind.config.ts`または`globals.css`で日本語フォントスタックを定義
- `font-family: "Geist Sans", "Noto Sans JP", "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif;`

---

#### A5. アイコンの視認性向上（13）

**提案内容**
- 整備工場は「屋外」や「照明が暗いピット内」など、オフィスより光環境が悪い
- slate-500の細いアイコン（1pxストロークのLucideアイコン）は、老眼傾向のあるユーザーには「薄すぎて見えない」リスク
- 改善案: 重要なアイコンはslate-600またはslate-700に格上げ、strokeWidthを2.5程度に太くする

**現状確認**
- アイコンカラー: `DESIGN_SYSTEM.md`で`slate-500`が多用されている
- アイコンサイズ: `h-4 w-4`（16px）以上を使用（既に修正済み）

**評価**
- **必要性**: ✅ **高** - 整備工場の環境を考慮すると重要
- **優先度**: ✅ **高** - 40代以上ユーザー向け最適化の一環
- **実装難易度**: ⚠️ **中** - アイコンカラーとstrokeWidthの一括変更が必要
- **推奨**: ✅ **推奨** - 早急に実装すべき

**実装方針**
- 重要なアイコン（カードタイトル、第1階層）: `slate-600`または`slate-700`に変更
- Lucideアイコンの`strokeWidth`を2.5に設定（デフォルトは2）
- `DESIGN_SYSTEM.md`にルールを追加

---

#### A6. 「戻る」挙動とDirty Check（17）

**提案内容**
- モバイルでの「ブラウザバック」と「アプリ内の戻るボタン」の挙動統一
- 提案: データ入力中に戻るボタンを押した際、「変更が破棄されますがよろしいですか？」という確認ダイアログ（Dirty Check）を必須とする

**現状確認**
- ナビゲーション履歴: `navigation-history.ts`で実装済み
- Dirty Check: 未実装

**評価**
- **必要性**: ✅ **高** - データ損失を防ぐため重要
- **優先度**: ✅ **高** - ユーザーの誤操作を防ぐため重要
- **実装難易度**: ⚠️ **中** - Dirty Check機能の実装が必要
- **推奨**: ✅ **推奨** - 早急に実装すべき

**実装方針**
- フォーム入力中に変更があった場合、`beforeunload`イベントで確認ダイアログを表示
- ページ遷移時も同様に確認ダイアログを表示

---

#### A7. 「保存」のアクションフィードバック（5）

**提案内容**
- 自動保存機能があるが、ユーザーは「本当に保存されたか」不安になる
- 改善案: 入力完了時やページ遷移時に明確に「保存完了」のトースト（緑色）を出す

**現状確認**
- 自動保存機能: `use-auto-save.ts`で実装済み
- 保存状態の表示: `auto-save-indicator.tsx`で実装済み

**評価**
- **必要性**: ✅ **中** - ユーザーの不安を解消するため重要
- **優先度**: ⚠️ **中** - 現状でも動作しているが、UX向上のため推奨
- **実装難易度**: ✅ **低** - トースト通知の追加のみ
- **推奨**: ✅ **推奨** - 簡単に実装できるため推奨

**実装方針**
- 自動保存成功時: 緑色のトースト通知を表示（「保存しました」）
- 自動保存失敗時: 赤色のトースト通知を表示（「保存に失敗しました」）
- ページ遷移時: 未保存の変更がある場合は確認ダイアログを表示

---

#### A8. 診断画面の写真連携（8）

**提案内容**
- 診断結果（NG項目）が、後の「見積画面」にどう渡るか
- 改善案: 見積明細行をクリックすると、診断時の「NG写真」がポップアップする連携を強化

**現状確認**
- 診断結果から見積項目への変換: `diagnosis-to-estimate.ts`で実装済み
- 写真の紐付け: 実装済み（`linkedPhotoUrls`）

**評価**
- **必要性**: ✅ **中** - 顧客への説得材料として重要
- **優先度**: ⚠️ **中** - UX向上のため推奨
- **実装難易度**: ⚠️ **中** - 写真ポップアップ機能の実装が必要
- **推奨**: ✅ **推奨** - 実装を推奨

**実装方針**
- 見積明細行に写真アイコンを表示
- クリックで写真をポップアップ表示（Lightbox）

---

#### A9. 作業画面のBefore/After写真のゴースト機能（9）

**提案内容**
- Before写真（診断時の写真）を半透明で重ねてカメラを起動できる「ゴースト機能」を追加
- 同じアングルで撮らないと、Before/Afterの比較効果が半減する

**現状確認**
- 作業画面: `src/app/mechanic/work/[id]/page.tsx`
- Before/After写真の表示: 実装済み
- ゴースト機能: 未実装

**評価**
- **必要性**: ✅ **中** - Before/Afterの比較効果を高めるため重要
- **優先度**: ⚠️ **低** - 現状でも動作しているが、UX向上のため推奨
- **実装難易度**: ⚠️ **中** - カメラ起動時のオーバーレイ表示機能が必要
- **推奨**: ⚠️ **検討** - 実装を検討（優先度は低め）

**実装方針**
- カメラ起動時、Before写真を半透明でオーバーレイ表示
- 透明度を調整可能にする

---

#### A10. Z-Index管理の定義（15）

**提案内容**
- ヘッダー、サイドパネル、ダイアログ、トースト通知が重なった際、どちらが上に来るかのルールがない
- 提案: zIndexの階層ルール（例：Header=40, Sheet=50, Dialog=60, Toast=100）を定義

**現状確認**
- Z-Indexの定義: `DESIGN_SYSTEM.md`で確認が必要

**評価**
- **必要性**: ✅ **中** - レイヤー管理の一貫性のため重要
- **優先度**: ⚠️ **中** - 現状でも動作しているが、保守性向上のため推奨
- **実装難易度**: ✅ **低** - Z-Indexの定義のみ
- **推奨**: ✅ **推奨** - 実装を推奨

**実装方針**
- `DESIGN_SYSTEM.md`にZ-Indexの階層ルールを追加
- 例: Header=40, Sheet=50, Dialog=60, Toast=100
- `tailwind.config.ts`でZ-Indexを定義

---

#### A11. 入力フォームのIME対応（16）

**提案内容**
- 金額入力フィールドなどで`type="number"`を使うと、日本語入力（全角数字）をした際に挙動がおかしくなるブラウザがある
- 提案: 数値入力でも`type="text"` + `inputmode="numeric"`を使用し、JS側で全角→半角変換とバリデーションを行う

**現状確認**
- 数値入力: `type="number"`を使用している箇所が多い

**評価**
- **必要性**: ✅ **中** - 日本語入力環境での操作性向上のため重要
- **優先度**: ⚠️ **中** - 現状でも動作しているが、UX向上のため推奨
- **実装難易度**: ⚠️ **中** - 全角→半角変換とバリデーションの実装が必要
- **推奨**: ✅ **推奨** - 実装を推奨

**実装方針**
- 数値入力フィールドを`type="text"` + `inputmode="numeric"`に変更
- 全角→半角変換のユーティリティ関数を作成
- バリデーションを追加

---

### B. API設計・データ整合性

#### B1. チェックインAPIの整合性（トランザクション処理）（19）

**提案内容**
- `checkIn(jobId, tagId, courtesyCarId)`で3つの処理を同時実行
- タグ使用中チェック→代車貸出→ステータス更新の順で処理されるが、途中で失敗した場合のロールバックが不明
- 提案: トランザクション的な処理（全て成功 or 全てロールバック）を実装

**現状確認**
- `checkIn` APIの実装を確認: タグの更新、代車の貸出、ジョブの更新が順次実行されている
- 途中で失敗した場合のロールバック処理は未実装
- 例: タグ更新成功 → 代車更新失敗 → タグは更新されたまま（不整合状態）

**評価**
- **必要性**: ✅ **高** - データ整合性のため重要
- **優先度**: ✅ **高** - 不整合状態を防ぐため重要
- **実装難易度**: ⚠️ **中** - ロールバック処理の実装が必要
- **推奨**: ✅ **推奨** - 早急に実装すべき

**実装方針**
- 全ての検証を先に実行（タグ、代車、ジョブの存在確認）
- 全て成功したら更新処理を実行
- 途中で失敗した場合は、既に更新した項目をロールバック

---

#### B2. API設計の一貫性（WorkOrderベースへの統一）（統合: 22, 33, 41）

**提案内容**
- 複数のAPIがJobIDベースで実装されているが、WorkOrderベースであるべき
- 1案件に複数ワークオーダーがある場合、どのワークオーダーにデータを保存するか不明
- 対象API: `saveDiagnosis`, `createEstimate`, `approveEstimate`

**現状確認**
- `saveDiagnosis` APIは`jobId`ベースで実装されている
- `createEstimate` APIは`jobId`ベースで実装されている
- `approveEstimate` APIは`jobId`ベースで実装されている
- 複数ワークオーダーの管理: `useWorkOrders`フックで実装済み

**評価**
- **必要性**: ✅ **高** - 複数ワークオーダーがある場合のデータ整合性のため重要
- **優先度**: ✅ **高** - データ構造の一貫性のため重要
- **実装難易度**: ⚠️ **中** - APIの変更と既存コードの修正が必要
- **推奨**: ✅ **推奨** - 実装を推奨（ただし、段階的に実装）

**実装方針**
- `saveDiagnosis(jobId, workOrderId, data)`に変更
- `createEstimate(workOrderId, items)`に変更
- `approveEstimate(workOrderId, selectedItems)`に変更
- 既存のJobIDベースAPIは後方互換性のために残し、`workOrderId`が指定されていない場合は最初のワークオーダーに保存

---

#### B3. 診断完了時のステータス更新ロジック（23）

**提案内容**
- `saveDiagnosis()`で常に「見積作成待ち」に更新されるが、診断途中の保存は？
- 提案: 「一時保存」と「診断完了」を分離

**現状確認**
- `saveDiagnosis` APIの実装を確認が必要

**評価**
- **必要性**: ✅ **中** - 診断途中の保存と完了を区別するため重要
- **優先度**: ⚠️ **中** - UX向上のため推奨
- **実装難易度**: ⚠️ **中** - ステータス管理の変更が必要
- **推奨**: ✅ **推奨** - 実装を推奨

**実装方針**
- `saveDiagnosis`に`isComplete`フラグを追加
- `isComplete: false`の場合は一時保存（ステータス変更なし）
- `isComplete: true`の場合は「見積作成待ち」に更新

---

#### B4. completeWork APIの設計課題（27）

**提案内容**
- `completeWork(jobId, workOrderId, workData)`で1つのワークオーダーを完了
- 「全ワークオーダーが完了した場合」の判定ロジックがAPI側にあるが、クライアント側での事前確認が不明

**現状確認**
- `completeWork` APIの実装を確認が必要

**評価**
- **必要性**: ✅ **中** - クライアント側での事前確認はUX向上のため重要
- **優先度**: ⚠️ **中** - UX向上のため推奨
- **実装難易度**: ✅ **低** - クライアント側のロジック追加のみ
- **推奨**: ✅ **推奨** - 実装を推奨

**実装方針**
- クライアント側で「全ワークオーダーが完了した場合」の判定を実装
- 完了前に確認メッセージを表示（「全作業を完了しますか？」）

---

#### B5. WorkData型の不整合（28）

**提案内容**
- APIでは`WorkData`を受け取るが、`WorkRecord`型との関係が不明確
- `WorkData.records: WorkRecord[]`とあるが、個別項目の完了状態管理は？

**現状確認**
- 型定義を確認が必要

**評価**
- **必要性**: ✅ **中** - 型の整合性のため重要
- **優先度**: ⚠️ **中** - コード品質向上のため推奨
- **実装難易度**: ✅ **低** - 型定義の明確化のみ
- **推奨**: ✅ **推奨** - 実装を推奨

**実装方針**
- `WorkData`と`WorkRecord`の関係を明確化
- 型定義を整理し、ドキュメント化

---

#### B6. Before写真の取得元（29）

**提案内容**
- `item.beforePhotos`は診断時の写真を参照するはずだが、診断データからの取得方法が不明
- 提案: `fetchDiagnosis(jobId, workOrderId)`で診断写真を取得し、作業項目と紐付け

**現状確認**
- 作業画面でのBefore写真の取得方法を確認が必要

**評価**
- **必要性**: ✅ **中** - Before/After写真の比較のため重要
- **優先度**: ⚠️ **中** - UX向上のため推奨
- **実装難易度**: ⚠️ **中** - 診断データからの写真取得ロジックが必要
- **推奨**: ✅ **推奨** - 実装を推奨

**実装方針**
- `fetchDiagnosis(jobId, workOrderId)`で診断データを取得
- 診断時の写真を作業項目と紐付け

---

#### B7. checkOut APIの設計（代車返却処理）（統合: 37, 38）

**提案内容**
- `checkOut(jobId)`でタグを解放するが、代車の返却処理がない
- 提案: `checkOut(jobId, { returnCourtesyCar: true })`のようなオプション追加
- 出庫処理時に代車返却確認ダイアログを表示

**現状確認**
- `checkOut` APIはタグの解除のみ実装されている
- 代車返却は別API（`returnCourtesyCar`）として存在

**評価**
- **必要性**: ✅ **中** - 出庫時に代車も同時に返却するケースが多いため重要
- **優先度**: ⚠️ **中** - UX向上のため推奨
- **実装難易度**: ✅ **低** - オプションパラメータの追加のみ
- **推奨**: ✅ **推奨** - 実装を推奨

**実装方針**
- `checkOut(jobId, options?: { returnCourtesyCar?: boolean })`に変更
- 代車が紐付けられている場合、確認ダイアログを表示

---

#### B8. タグ使用中エラーの業務対応（20）

**提案内容**
- `TAG_IN_USE`エラー時のUI対応が不明
- 提案: 「このタグは別の案件で使用中です。解除しますか？」の確認ダイアログ

**現状確認**
- `checkIn` APIで`TAG_IN_USE`エラーを返すが、UI側での対応は確認が必要

**評価**
- **必要性**: ✅ **中** - ユーザーがエラー原因を理解し、対処できるようにするため重要
- **優先度**: ⚠️ **中** - UX向上のため推奨
- **実装難易度**: ✅ **低** - 確認ダイアログの追加のみ
- **推奨**: ✅ **推奨** - 実装を推奨

**実装方針**
- `TAG_IN_USE`エラー時に確認ダイアログを表示
- 「解除しますか？」を選択した場合、既存のタグ紐付けを解除してから新しいタグを紐付け

---

#### B9. 代車の二重貸出防止（21）

**提案内容**
- `CAR_UNAVAILABLE`エラーはあるが、リアルタイムでの空き状況更新が不明
- 同時に2人が同じ代車を選択した場合の競合解決

**現状確認**
- `checkIn` APIで`CAR_NOT_AVAILABLE`エラーを返す
- リアルタイム更新: `useRealtime`フックで実装済み（Server-Sent Events）

**評価**
- **必要性**: ✅ **中** - 同時操作時の競合を防ぐため重要
- **優先度**: ⚠️ **中** - 現状でも動作しているが、競合が発生する可能性がある
- **実装難易度**: ⚠️ **中** - 楽観的ロックまたは悲観的ロックの実装が必要
- **推奨**: ✅ **推奨** - 実装を推奨

**実装方針**
- 代車選択時に楽観的ロックを実装（バージョン番号による競合検知）
- または、代車選択時に一時的に「選択中」ステータスを設定

---

#### B10. 関数名の統一（統合: 40, 47）

**提案内容**
- API定義とページ仕様で関数名が不一致
- `fetchJobsByCustomerId` vs `fetchCustomerJobs`
- `fetchVehiclesByCustomerId` vs `fetchVehicleMaster`

**現状確認**
- 関数名を確認が必要

**評価**
- **必要性**: ✅ **中** - コードの一貫性のため重要
- **優先度**: ⚠️ **中** - コード品質向上のため推奨
- **実装難易度**: ✅ **低** - 関数名の統一のみ
- **推奨**: ✅ **推奨** - 実装を推奨

**実装方針**
- 関数名を統一（`fetchJobsByCustomerId`、`fetchVehiclesByCustomerId`に統一を推奨）

---

#### B11. 画像アップロードAPI（Google Driveへのアップロード）（46）

**提案内容**
- `addImageToJobField12(jobId, imageUrl, fileName)`で画像を追加
- しかしGoogle Driveへのアップロード後のURL取得方法が不明

**現状確認**
- 画像アップロードの実装を確認が必要

**評価**
- **必要性**: ✅ **中** - 画像アップロードのワークフローを明確にするため重要
- **優先度**: ⚠️ **中** - コード品質向上のため推奨
- **実装難易度**: ⚠️ **中** - アップロードロジックの確認と修正が必要
- **推奨**: ✅ **推奨** - 実装を推奨

**実装方針**
- Google Driveへのアップロード → URL取得 → `addImageToJobField12`の順で実行
- エラーハンドリングを追加

---

#### B12. API関数とAPIルートの関係（50）

**提案内容**
- `src/lib/api.ts`の関数と`/api/*`ルートの関係が不明確
- クライアントは`api.ts`を直接呼ぶ？APIルート経由？
- 提案: クライアント → APIルート → `api.ts`関数の呼び出しチェーンを明確化

**現状確認**
- APIの呼び出しチェーンを確認が必要

**評価**
- **必要性**: ✅ **中** - アーキテクチャの明確化のため重要
- **優先度**: ⚠️ **中** - コード品質向上のため推奨
- **実装難易度**: ⚠️ **中** - アーキテクチャの整理が必要
- **推奨**: ✅ **推奨** - 実装を推奨

**実装方針**
- クライアント → APIルート → `api.ts`関数の呼び出しチェーンに統一
- または、クライアント → `api.ts`関数（APIルートは内部実装）に統一

---

### C. 見積・承認機能

#### C1. 見積行の構造に関する矛盾（30）

**提案内容**
- 仕様書では「5列形式」と記載があるが、実際は6要素（作業内容、数量、単価、部品代、技術量、削除ボタン）
- 「小計」列の位置が不明確（部品代の後？技術量の後？）

**現状確認**
- 見積画面のグリッド: `grid-cols-[2fr_80px_100px_100px_120px_auto]` = 6列
- 作業内容(2fr) + 数量(80px) + 単価(100px) + 部品代(100px) + 技術量(120px) + 削除(auto)
- 「小計」列は存在しない（部品代 + 技術量 = 小計は計算フィールドとして表示されていない）

**評価**
- **必要性**: ✅ **中** - 仕様書と実装の整合性のため重要
- **優先度**: ⚠️ **中** - ドキュメントの正確性のため推奨
- **実装難易度**: ✅ **低** - 仕様書の修正のみ
- **推奨**: ✅ **推奨** - 仕様書を実装に合わせて修正

**実装方針**
- 仕様書を「6列形式」に修正
- または、「小計」列を追加（部品代 + 技術量）

---

#### C2. 消費税計算の実装（32）

**提案内容**
- 仕様書内に消費税計算の記述がない
- 提案: 税込/税抜切り替え、内税/外税選択を追加

**現状確認**
- 消費税計算は未実装

**評価**
- **必要性**: ✅ **高** - 日本の業務システムとして必須
- **優先度**: ✅ **高** - 法的要件のため重要
- **実装難易度**: ⚠️ **中** - 計算ロジックとUIの実装が必要
- **推奨**: ✅ **推奨** - 早急に実装すべき

**実装方針**
- 見積画面に「税込/税抜」切り替えを追加
- 消費税率は設定画面で管理（デフォルト: 10%）
- 合計金額に消費税を表示

---

#### C3. バリデーションの厳格性（34）

**提案内容**
- `partQuantity`が0以下、`partUnitPrice`が0以下で警告とあるが、0は許容すべきケースも
- 例: 工賃のみの作業（部品なし）では`partQuantity=0, partUnitPrice=0`が正当

**現状確認**
- バリデーションロジックを確認が必要

**評価**
- **必要性**: ✅ **中** - 業務ロジックに合わせたバリデーションのため重要
- **優先度**: ⚠️ **中** - UX向上のため推奨
- **実装難易度**: ✅ **低** - バリデーションルールの修正のみ
- **推奨**: ✅ **推奨** - 実装を推奨

**実装方針**
- 負の数のみエラー（0は許容）
- 部品代と技術量の両方が0の場合は警告（「金額が0円です」）

---

#### C4. 工賃マスタ選択のUX（35）

**提案内容**
- 50項目以上の工賃マスタからの選択は煩雑
- 「カスタム」オプションの表示条件が複雑
- 提案: 入力フィールド + サジェストの組み合わせ

**現状確認**
- 工賃マスタ選択は`Select`コンポーネントで実装されている

**評価**
- **必要性**: ✅ **中** - UX向上のため重要
- **優先度**: ⚠️ **中** - 現状でも動作しているが、改善の余地がある
- **実装難易度**: ⚠️ **中** - サジェスト機能の実装が必要
- **推奨**: ✅ **推奨** - 実装を推奨

**実装方針**
- 数値入力フィールド + サジェスト（入力に応じて工賃マスタをフィルタリング）
- よく使う工賃マスタを上部に表示

---

#### C5. セクション別合計の表示（36）

**提案内容**
- 必須・推奨・任意の3セクションそれぞれに合計行
- 全体合計の表示位置・フォーマットが不明
- 提案: 全体合計を画面下部に固定表示（スクロールしても見える）

**現状確認**
- 見積画面での合計表示を確認が必要

**評価**
- **必要性**: ✅ **中** - ユーザーが常に合計金額を確認できるようにするため重要
- **優先度**: ⚠️ **中** - UX向上のため推奨
- **実装難易度**: ⚠️ **中** - 固定表示の実装が必要
- **推奨**: ✅ **推奨** - 実装を推奨

**実装方針**
- 画面下部に固定表示（`sticky bottom-0`）
- セクション別合計 + 全体合計を表示

---

#### C6. 部分承認のワークフロー（43）

**提案内容**
- 推奨・任意項目を一部だけ選択した場合、`selectedItems`にはどう反映されるか
- 全項目を含めて`approved: true/false`フラグを持つべきか

**現状確認**
- 部分承認の実装を確認が必要

**評価**
- **必要性**: ✅ **中** - 部分承認のワークフローを明確にするため重要
- **優先度**: ⚠️ **中** - UX向上のため推奨
- **実装難易度**: ⚠️ **中** - ワークフローの実装が必要
- **推奨**: ✅ **推奨** - 実装を推奨

**実装方針**
- `selectedItems`には選択された項目のみを含める
- または、全項目を含めて`approved: true/false`フラグを持つ（推奨）

---

#### C7. 承認項目の保存形式（42）

**提案内容**
- `field13`にテキスト形式で保存とあるが、構造化データ（JSON）のほうが後続処理しやすい
- 提案: `field13`にJSON形式で保存、または別フィールドに移動

**現状確認**
- 承認項目の保存形式を確認が必要

**評価**
- **必要性**: ⚠️ **中** - データ構造の改善のため重要だが、現状でも動作している
- **優先度**: ⚠️ **低** - 現状でも動作しているため、緊急ではない
- **実装難易度**: ⚠️ **中** - データ構造の変更が必要
- **推奨**: ⚠️ **検討** - 現時点では実装不要。ただし、後続処理で問題が発生したら検討

**代替案**
- 現状のテキスト形式を維持（シンプルで分かりやすい）

---

### D. データ管理・マスタデータ

#### D1. マスタデータのサーバー側移行（統合: 2, 48）

**提案内容**
- 「お知らせ」や「整備士スキル」、「テンプレート」などを localStorage に保存する設計
- リスク: 店舗全体での標準化ができない、PCを変えたらデータが消える
- 提案: Google Sheetsをマスタデータストレージとして使用

**現状確認**
- `localStorage`を使用している箇所: 85箇所
- 主な用途: お知らせ設定、整備士スキル、テンプレート、見積変更履歴、検索履歴など

**評価**
- **必要性**: ✅ **高** - 店舗全体での標準化は重要
- **優先度**: ⚠️ **中** - 現時点では動作しているが、将来的に問題になる
- **実装難易度**: ⚠️ **中** - 既存のlocalStorage使用箇所をサーバー側に移行する必要がある
- **推奨**: ✅ **推奨** - ただし、段階的に実装

**実装方針**
- **Phase 1**: 重要なマスタデータ（テンプレート、お知らせ）をGoogle SheetsまたはZoho CRMに移行
- **Phase 2**: ユーザー固有データ（整備士スキル、検索履歴）はlocalStorageのままでも可（個人設定として）

---

#### D2. データ構造の改善（Zoho CRMへのJSON保存）（1）

**提案内容**
- `field7`, `field26` 等のテキストフィールドにJSON形式でデータを保存する設計は、業務システムとして破綻するリスクが高い
- 検索・集計不可、同時編集の競合問題
- 改善案: Zoho CRMのカスタムモジュール（関連リスト）を使用するか、基幹データは専用のRDBに持ち、ZohoとはID連携のみにする構成

**現状確認**
- `field26`に部品情報（PartsInfo）をJSON形式で保存している（`src/lib/parts-info-utils.ts`）
- `field7`に見積提示日時を保存している（`【見積提示】ISO 8601形式`）
- 同時編集の競合制御は実装済み（バージョン番号による競合検知）

**評価**
- **必要性**: ⚠️ **中** - 現時点では問題が顕在化していないが、将来的に問題になる可能性は高い
- **優先度**: ⚠️ **中** - 現行システムで動作しているため、緊急ではない
- **実装難易度**: ❌ **高** - データ構造の大幅な変更が必要
- **推奨**: ⚠️ **検討** - 現時点では実装不要。ただし、以下の条件が揃ったら検討：
  - Zoho CRM側で検索・集計が必要になった時
  - 同時編集の競合が頻発するようになった時
  - データ量が増えてパフォーマンス問題が発生した時

**代替案**
- 現状の競合制御を強化（バージョン番号による楽観的ロック）
- 重要なデータのみZoho CRMのカスタムモジュールに移行（段階的移行）

---

#### D3. 走行距離の更新タイミング（24）

**提案内容**
- `saveDiagnosis()`で`mileage`も更新されるが、入庫時に既に入力されている場合の上書き
- 提案: 入庫時と診断時の走行距離を別フィールドで管理

**現状確認**
- 走行距離の保存場所を確認が必要

**評価**
- **必要性**: ⚠️ **低** - 入庫時と診断時の走行距離が異なることは稀
- **優先度**: ⚠️ **低** - 現状でも動作している
- **実装難易度**: ⚠️ **中** - データ構造の変更が必要
- **推奨**: ⚠️ **検討** - 現時点では実装不要。ただし、走行距離の履歴管理が必要になったら検討

**代替案**
- 診断時の走行距離が入庫時と異なる場合のみ更新（差分チェック）

---

#### D4. 計算ロジックの確認（数量と技術量の関係）（31）

**提案内容**
- 現状: `小計 = 部品代 + 技術量`（数量が技術量に影響しない）
- 同じ作業を2台分行う場合、技術量も2倍になるべきでは？

**現状確認**
- 計算ロジック: `const partTotal = (partQuantity || 0) * (partUnitPrice || 0); const subtotal = partTotal + laborCost;`
- 数量が技術量に影響しない（技術量は固定値）

**評価**
- **必要性**: ⚠️ **低** - 業務ロジックによる（1台分の工賃 × 数量 vs 固定工賃）
- **優先度**: ⚠️ **低** - 業務要件による
- **実装難易度**: ⚠️ **中** - 計算ロジックの変更が必要
- **推奨**: ⚠️ **検討** - 業務要件を確認してから決定

**実装方針**
- 業務要件を確認:
  - オプション1: 技術量も数量に連動（`laborCost * quantity`）
  - オプション2: 技術量は固定（現状維持、複数台の場合は行を分ける）

---

### E. 認証・セキュリティ

#### E1. 顧客IDの取得方法（セッション管理）（39）

**提案内容**
- `fetchCustomerJobs(customerId)`を呼び出すが、`customerId`の取得元が不明
- マジックリンク認証後のセッション管理が不明確

**現状確認**
- マジックリンク認証の実装を確認が必要

**評価**
- **必要性**: ✅ **高** - セキュリティのため重要
- **優先度**: ✅ **高** - 認証・認可の基本機能
- **実装難易度**: ⚠️ **中** - セッション管理の実装が必要
- **推奨**: ✅ **推奨** - 早急に実装すべき

**実装方針**
- マジックリンク認証後にセッションを確立
- `customerId`をセッションから取得

---

### F. 本番環境への移行

#### F1. モックAPIの本番対応（49）

**提案内容**
- 現状はすべてモックデータを返す実装
- 本番環境ではZoho CRM APIへの接続が必要だが、切り替え方法が不明
- 提案: 環境変数で切り替え可能なアダプターパターンを実装

**現状確認**
- API実装を確認が必要

**評価**
- **必要性**: ✅ **高** - 本番環境への移行のため必須
- **優先度**: ✅ **高** - 本番環境への移行のため重要
- **実装難易度**: ⚠️ **中** - アダプターパターンの実装が必要
- **推奨**: ✅ **推奨** - 早急に実装すべき

**実装方針**
- 環境変数（`NEXT_PUBLIC_API_MODE`）で切り替え
- `mock` / `production`の2モード
- アダプターパターンで実装

---

### G. 新機能実装

#### G1. 通知・アラート機能の具体化（51）

**提案内容**
- 承認待ち3日超過、部品待ち7日超過、本日出庫予定などの通知機能
- `NotificationBell`コンポーネントで通知一覧を表示
- ポーリング（30秒ごと）で通知を更新

**現状確認**
- 通知システム: 未実装
- `Bell`アイコンは使用されているが、通知機能は未実装
- 長期化承認待ち、長期化部品調達の計算ロジックは実装済み（`today-summary-card.tsx`）

**評価**
- **必要性**: ✅ **高** - 重要な案件を見逃さないため必須
- **優先度**: ✅ **高** - 業務効率化のため重要
- **実装難易度**: ⚠️ **中** - 通知システムの実装が必要
- **推奨**: ✅ **推奨** - 早急に実装すべき

**実装方針**
- 通知トリガーの実装（承認待ち3日超過、部品待ち7日超過、本日出庫予定）
- `NotificationBell`コンポーネントの実装
- 通知の既読管理
- ポーリングまたはServer-Sent Eventsで通知を更新

**注意点**
- ポーリングは30秒ごとではなく、SWRの`refreshInterval`を使用（より効率的）
- 通知の保存先: Zoho CRMのカスタムモジュールまたはGoogle Sheets

---

#### G2. PDF生成エンジンの実装（53）

**提案内容**
- `jsPDF`を使用した見積書PDF生成
- 見積書プレビュー・印刷コンポーネント
- 日本語フォント対応

**現状確認**
- PDF生成: 未実装
- 請求書PDFの表示: 実装済み（Google Driveから取得）
- 見積書PDF生成: 未実装

**評価**
- **必要性**: ✅ **高** - 見積書の印刷・保存は必須
- **優先度**: ✅ **高** - 業務上重要な機能
- **実装難易度**: ⚠️ **中** - `jsPDF`の日本語フォント対応が必要
- **推奨**: ✅ **推奨** - 早急に実装すべき

**実装方針**
- `jsPDF`と`jspdf-autotable`を使用
- 日本語フォント（Noto Sans JP）の追加
- 見積書のレイアウト設計（ヘッダー、顧客情報、明細テーブル、合計、フッター）
- プレビュー・印刷・ダウンロード機能

**注意点**
- 日本語フォントファイルのサイズが大きいため、CDNまたはフォントサブセット化を検討
- PDF生成はクライアント側で行う（サーバー負荷を軽減）

---

#### G3. オフライン・同期機能の完全実装（52）

**提案内容**
- IndexedDBを使用したオフラインストレージ
- 同期キューによる自動同期
- オンライン復帰時の自動同期

**現状確認**
- オフラインストレージ: `offline-storage.ts`で実装済み（IndexedDB）
- オフラインバナー: `offline-banner.tsx`で実装済み
- オンライン状態監視: `use-online-status.ts`で実装済み
- 自動同期: `use-auto-sync.ts`で実装済み
- 同期キュー: `upload-queue.ts`で実装済み

**評価**
- **必要性**: ✅ **高** - オフライン対応は必須
- **優先度**: ⚠️ **中** - 既に実装済みだが、完全性を確認する必要がある
- **実装難易度**: ⚠️ **中** - 既存実装の確認と改善が必要
- **推奨**: ✅ **推奨** - 既存実装を確認し、不足している機能を追加

**実装方針**
- 既存実装の確認と動作テスト
- 提案された`syncOfflineActions`関数の実装（既存の`use-auto-sync.ts`と統合）
- エラーハンドリングとリトライロジックの強化

**注意点**
- 既存の`offline-storage.ts`と`use-auto-sync.ts`を確認し、提案された機能が既に実装されているか確認
- 重複実装を避ける

---

#### G4. 代車管理のステータス追加（10）

**提案内容**
- 代車が「返却済み」になっても、実際は洗車待ちで貸せない場合がある
- 改善案: ステータスに「清掃・点検中（インターバル）」を追加

**現状確認**
- 代車管理: `src/app/inventory/courtesy-cars/page.tsx`
- ステータス: 確認が必要

**評価**
- **必要性**: ✅ **中** - 実際の業務フローを反映するため重要
- **優先度**: ⚠️ **中** - 業務効率化のため推奨
- **実装難易度**: ✅ **低** - ステータスの追加のみ
- **推奨**: ✅ **推奨** - 実装を推奨

**実装方針**
- 代車ステータスに「清掃・点検中」を追加
- ステータス遷移: 返却済み → 清掃・点検中 → 利用可能

---

#### G5. 車両作成APIの使用タイミング（45）

**提案内容**
- `createVehicle(customerId, vehicleName, licensePlate)`があるが、事前チェックインで新規車両を作成するタイミングが不明
- 車検証画像アップロード後に自動作成？手動で「車両登録」ボタン？

**現状確認**
- 事前チェックイン画面での車両作成タイミングを確認が必要

**評価**
- **必要性**: ✅ **中** - ワークフローを明確にするため重要
- **優先度**: ⚠️ **中** - UX向上のため推奨
- **実装難易度**: ✅ **低** - UIの改善のみ
- **推奨**: ✅ **推奨** - 実装を推奨

**実装方針**
- 車検証画像アップロード後に「車両登録」ボタンを表示
- または、自動で車両を作成（推奨）

---

#### G6. 作業データの取得（WorkDataとの連携）（44）

**提案内容**
- `useWorkOrders(jobId)`で作業データを取得するが、`completeWork`で保存された`WorkData`との連携が不明

**現状確認**
- 作業データの取得方法を確認が必要

**評価**
- **必要性**: ✅ **中** - データ整合性のため重要
- **優先度**: ⚠️ **中** - コード品質向上のため推奨
- **実装難易度**: ⚠️ **中** - データ取得ロジックの確認と修正が必要
- **推奨**: ✅ **推奨** - 実装を推奨

**実装方針**
- `useWorkOrders`と`completeWork`のデータ連携を確認
- 必要に応じて修正

---

### H. 低優先度・将来検討項目

#### H1. 承認フローの複雑化（3）

**提案内容**
- 「必須項目」を顧客が拒否した場合の処理（法的・安全上の理由で作業不可とするか、免責同意書を取るか）
- 改善案: 「必須項目を外すなら作業をお断りする」フラグや、免責同意の電子署名フローの追加

**現状確認**
- 見積項目に`priority: 'required' | 'recommended' | 'optional'`が定義されている
- 顧客承認画面では、必須項目を外すことはできない（UI上で選択不可）

**評価**
- **必要性**: ⚠️ **低** - 現時点では必須項目を外すことができないため、問題は発生していない
- **優先度**: ⚠️ **低** - 将来的に「必須項目を外して作業する」というケースが発生したら検討
- **実装難易度**: ⚠️ **中** - 電子署名フローの実装が必要
- **推奨**: ⚠️ **検討** - 現時点では実装不要

**代替案**
- 現状の仕様（必須項目は外せない）を維持
- 必須項目を外す場合は、見積を再作成するフローを維持

---

#### H2. 音声入力のトランシーバー形式（14）

**提案内容**
- 「手が汚れている」前提なら、画面タップすら避けたい場合がある
- 提案: 「長押ししている間だけ録音（離すと送信）」のようなトランシーバー形式の操作モードも検討

**現状確認**
- 音声入力: `audio-input-button.tsx`で実装済み
- 操作モード: 確認が必要

**評価**
- **必要性**: ⚠️ **低** - 現状の操作で問題が発生していない
- **優先度**: ⚠️ **低** - 将来的に要望があれば検討
- **実装難易度**: ⚠️ **中** - 長押し検知機能の実装が必要
- **推奨**: ⚠️ **検討** - 現時点では実装不要

**実装方針**
- 現状の操作（タップで録音開始/停止）を維持
- 将来的に要望があれば、トランシーバー形式の操作モードを追加

---

#### H3. 7段階の状態選択UI（26）

**提案内容**
- OK / Warning / Critical / Adjust / Clean / Skip / Not Applicable
- 7つのオプションをどう表示するか（ドロップダウン？ボタングループ？）
- 提案: TrafficLightButton + ドロップダウンの組み合わせ

**現状確認**
- `TrafficLightButton`コンポーネントは実装済み（3段階: OK / Warning / Critical）
- 7段階の状態選択は未実装

**評価**
- **必要性**: ⚠️ **低** - 現状の3段階（OK / Warning / Critical）で十分機能している
- **優先度**: ⚠️ **低** - 7段階が必要になるケースが不明確
- **実装難易度**: ⚠️ **中** - UIコンポーネントの実装が必要
- **推奨**: ⚠️ **検討** - 現時点では実装不要

**代替案**
- 現状の3段階（TrafficLightButton）を維持
- 必要に応じて、コメント欄で詳細を記録

---

#### H4. 監査ログ（Audit Log）（54）

**提案内容**
- ユーザーアクションの記録（ステータス更新、データ変更など）
- 変更履歴の追跡（`oldValue`、`newValue`）
- IPアドレス、ユーザーエージェントの記録

**現状確認**
- 監査ログ: 未実装
- 変更履歴: 一部実装済み（見積変更履歴など）

**評価**
- **必要性**: ⚠️ **中** - セキュリティとコンプライアンスのため重要だが、MVPでは必須ではない
- **優先度**: ⚠️ **低** - 本番環境での運用開始後に実装を検討
- **実装難易度**: ⚠️ **中** - ログ保存先の設計が必要（Zoho CRM、Google Sheets、専用DB）
- **推奨**: ⚠️ **検討** - 現時点では実装不要。ただし、本番環境での運用開始前に実装を検討

**実装方針**
- ログ保存先: Zoho CRMのカスタムモジュールまたはGoogle Sheets
- 重要なアクションのみ記録（全アクションを記録するとデータ量が膨大になる）
- ログの保持期間を設定（例: 1年）

**注意点**
- 個人情報保護法に準拠したログ管理が必要
- ログの削除・修正機能は実装しない（改ざん防止）

---

#### H5. パフォーマンス最適化（仮想スクロール）（55）

**提案内容**
- `@tanstack/react-virtual`を使用した仮想スクロール
- 大量のジョブリスト（100件以上）のパフォーマンス最適化

**現状確認**
- 仮想スクロール: 未実装
- ジョブリスト: 通常のスクロールで表示
- TEST_PLAN.mdに「仮想スクロールは実装されていないが、100件程度のデータでは問題なし」と記載

**評価**
- **必要性**: ⚠️ **低** - 現時点では100件程度のデータで問題なし
- **優先度**: ⚠️ **低** - データ量が増えたら検討
- **実装難易度**: ⚠️ **中** - 仮想スクロールの実装が必要
- **推奨**: ⚠️ **検討** - 現時点では実装不要。ただし、以下の条件が揃ったら検討：
  - 1日の案件数が200件以上になった時
  - パフォーマンス問題が発生した時

**実装方針**
- `@tanstack/react-virtual`を使用
- カードの高さを推定（`estimateSize`）
- オーバースキャンを設定（`overscan: 5`）

**注意点**
- 仮想スクロールは実装が複雑で、バグが発生しやすい
- 現時点では不要な最適化の可能性がある（YAGNI原則）

---

### I. 非推奨項目

#### I1. 受付画面のサマリーカード定義（進行中案件数）（18）

**提案内容**
- 「進行中案件数」が`field5 = 作業待ち`のみだが、実際には「入庫済み」「見積提示済み」「部品調達待ち」なども進行中では？
- 提案: 進行中の定義を「入庫待ち」「出庫済み」以外すべてに拡張

**現状確認**
- `today-summary-card.tsx`を確認: 「進行中案件数」という統合された数値は存在しない
- 各ステータス別に件数を表示している（入庫待ち、診断待ち、見積作成待ち、お客様承認待ち、作業待ち、引渡待ち、部品調達待ち、部品発注待ち）
- 合計数（`totalCount`）は表示されているが、これは「本日の全案件数」

**評価**
- **必要性**: ❌ **低** - 「進行中案件数」という概念が現在のUIに存在しない
- **優先度**: ❌ **低** - 既存のステータス別表示で十分機能している
- **実装難易度**: ✅ **低** - 計算ロジックの追加のみ
- **推奨**: ❌ **非推奨** - 現在のUI設計（ステータス別表示）の方が情報が明確で、ユーザーにとって有用。統合された「進行中案件数」を追加すると、どのステータスが含まれるか不明確になり、混乱を招く可能性がある。

**代替案**
- 現状のステータス別表示を維持（情報が明確で使いやすい）

---

## 総合評価と優先順位（統合・最終版）

### 高優先度（早急に実装すべき）- 12項目

1. **見積画面のモバイル対応**（A1）
2. **診断画面の縦スクロール問題**（A2）
3. **受付画面のオフライン対応**（A3）
4. **日本語フォントスタックの追加**（A4）
5. **アイコンの視認性向上**（A5）
6. **「戻る」挙動とDirty Check**（A6）
7. **チェックインAPIの整合性（トランザクション処理）**（B1）
8. **消費税計算の実装**（C2）
9. **モックAPIの本番対応**（F1）
10. **顧客IDの取得方法（セッション管理）**（E1）
11. **通知・アラート機能の具体化**（G1）
12. **PDF生成エンジンの実装**（G2）

### 中優先度（実装を推奨）- 24項目

13. **「保存」のアクションフィードバック**（A7）
14. **診断画面の写真連携**（A8）
15. **Z-Index管理の定義**（A10）
16. **入力フォームのIME対応**（A11）
17. **API設計の一貫性（WorkOrderベースへの統一）**（B2）
18. **診断完了時のステータス更新ロジック**（B3）
19. **completeWork APIの設計課題**（B4）
20. **WorkData型の不整合**（B5）
21. **Before写真の取得元**（B6）
22. **checkOut APIの設計（代車返却処理）**（B7）
23. **タグ使用中エラーの業務対応**（B8）
24. **代車の二重貸出防止**（B9）
25. **関数名の統一**（B10）
26. **画像アップロードAPI（Google Driveへのアップロード）**（B11）
27. **API関数とAPIルートの関係**（B12）
28. **見積行の構造に関する矛盾**（C1）
29. **バリデーションの厳格性**（C3）
30. **工賃マスタ選択のUX**（C4）
31. **セクション別合計の表示**（C5）
32. **部分承認のワークフロー**（C6）
33. **マスタデータのサーバー側移行**（D1）
34. **オフライン・同期機能の完全実装**（G3）
35. **代車管理のステータス追加**（G4）
36. **車両作成APIの使用タイミング**（G5）

### 低優先度（将来的に検討）- 9項目

37. **作業画面のゴースト機能**（A9）
38. **データ構造の改善（Zoho CRM）**（D2）
39. **走行距離の更新タイミング**（D3）
40. **計算ロジックの確認（数量と技術量の関係）**（D4）
41. **承認項目の保存形式**（C7）
42. **承認フローの複雑化**（H1）
43. **音声入力のトランシーバー形式**（H2）
44. **7段階の状態選択UI**（H3）
45. **監査ログ（Audit Log）**（H4）
46. **パフォーマンス最適化（仮想スクロール）**（H5）

### 非推奨 - 1項目

47. **受付画面のサマリーカード定義（進行中案件数）**（I1）- 既存のステータス別表示で十分

---

## 実装計画（統合・最終版）

### Phase 1: 緊急対応（1-2週間）- 12項目

**UI/UX改善**
- 見積画面のモバイル対応
- 診断画面のアコーディオンUI
- 受付画面のオフライン対応
- 日本語フォントスタック
- アイコンの視認性向上
- Dirty Check機能

**API設計・データ整合性**
- チェックインAPIの整合性（トランザクション処理）

**見積・承認機能**
- 消費税計算の実装

**認証・セキュリティ**
- 顧客IDの取得方法（セッション管理）

**本番環境への移行**
- モックAPIの本番対応

**新機能実装**
- 通知・アラート機能の具体化
- PDF生成エンジンの実装

### Phase 2: UX向上（2-4週間）- 24項目

**UI/UX改善**
- 保存フィードバックの強化
- 診断画面の写真連携
- Z-Index管理の定義
- IME対応

**API設計・データ整合性**
- API設計の一貫性（WorkOrderベースへの統一）
- 診断完了時のステータス更新ロジック
- completeWork APIの設計課題
- WorkData型の不整合
- Before写真の取得元
- checkOut APIの設計（代車返却処理）
- タグ使用中エラーの業務対応
- 代車の二重貸出防止
- 関数名の統一
- 画像アップロードAPI（Google Driveへのアップロード）
- API関数とAPIルートの関係

**見積・承認機能**
- 見積行の構造に関する矛盾
- バリデーションの厳格性
- 工賃マスタ選択のUX
- セクション別合計の表示
- 部分承認のワークフロー

**データ管理・マスタデータ**
- マスタデータのサーバー側移行

**新機能実装**
- オフライン・同期機能の完全実装
- 代車管理のステータス追加
- 車両作成APIの使用タイミング

### Phase 3: データ構造改善（1-2ヶ月）- 必要に応じて

- データ構造の改善（Zoho CRMへのJSON保存）
- 承認項目の保存形式（必要に応じて）

### Phase 4: 将来の拡張（必要に応じて）- 9項目

- 作業画面のゴースト機能
- 走行距離の更新タイミング
- 計算ロジックの確認（数量と技術量の関係）
- 承認フローの複雑化
- 音声入力のトランシーバー形式
- 7段階の状態選択UI
- 監査ログ（Audit Log）
- パフォーマンス最適化（仮想スクロール）

---

## 結論（統合・最終版）

**42項目中、12項目が高優先度、24項目が中優先度、6項目が低優先度、1項目が非推奨**

### 重要な発見

1. **API設計の一貫性**: 複数のAPIがJobIDベースで実装されているが、WorkOrderベースに統一すべき（B2）
2. **トランザクション処理**: チェックインAPIなど、複数の処理を同時実行するAPIでロールバック処理が未実装（B1）
3. **本番環境への移行**: モックAPIから本番APIへの切り替え方法が不明確（F1）
4. **消費税計算**: 日本の業務システムとして必須だが、未実装（C2）
5. **通知機能**: 重要な案件を見逃さないため必須だが、未実装（G1）
6. **PDF生成**: 見積書の印刷・保存は必須だが、未実装（G2）

### 優先すべき項目

現時点で最も重要なのは、以下の4つです：

1. **モバイル対応とUX向上**: 見積画面のモバイル対応、診断画面の操作性向上
2. **API設計の改善**: WorkOrderベースへの統一、トランザクション処理の実装
3. **本番環境への移行準備**: モックAPIから本番APIへの切り替え、セッション管理の実装
4. **必須機能の実装**: 通知機能、PDF生成、消費税計算

### 非推奨項目

- **進行中案件数の統合表示**（I1）: 既存のステータス別表示の方が情報が明確で有用

### 既存実装の確認が必要な項目

- **オフライン・同期機能**（G3）: 既に実装済みの可能性があるため、既存実装を確認してから追加機能を検討

### 重複項目の統合結果

- **4と12**: 見積行のモバイル対応 → A1に統合
- **6と25**: 診断画面の縦スクロール問題 → A2に統合
- **2と48**: マスタデータのサーバー側移行 → D1に統合
- **37と38**: 代車返却処理 → B7に統合
- **22, 33, 41**: WorkOrderベースへの統一 → B2に統合
- **40と47**: 関数名の統一 → B10に統合

データ構造の改善については、現時点では問題が顕在化していないため、将来的に必要になったら検討する方針で問題ありません。

---

**最終更新日**: 2025-01-20
