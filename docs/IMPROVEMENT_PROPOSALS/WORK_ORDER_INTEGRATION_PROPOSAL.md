# 作業指示書の統合・名称明確化提案

**提案日:** 2025-12-23  
**優先度:** 高（業務効率化・UX改善）  
**実装工数見積:** 2-3日  
**影響範囲:** メカニック、受付スタッフ、管理者

---

## 現状の問題点

### 1. 名称の混乱

| 現在の名称 | 実体 | 保存場所 | 用途 |
|---------|------|---------|------|
| **作業指示** | スタッフからの簡易メモ | `job.field` | 社内スタッフが記入する業務メモ |
| **作業指示書PDF** | 正式なPDF文書 | 生成時に作成 | 診断前・作業前の指示書 |

**問題:** 名称が似ていて混乱しやすい。「作業指示」と「作業指示書」の違いが不明確。

### 2. 情報の分散

メカニックが作業前に確認すべき情報が複数の場所に分散している：

- **JOBカード上の「作業指示」セクション**: `job.field`（スタッフからのメモのみ）
- **JOBカード上の「お客様入力情報」セクション**: `job.field7`（顧客からの申し送り）
- **基本情報**: 顧客名、車両、入庫日時など（別セクション）
- **車両情報**: 車名、ナンバープレート、走行距離など（別セクション）
- **作業内容**: `job.field13`（承認済み見積明細、作業待ち以降）

**問題:** メカニックが作業前に複数のセクションを見回る必要があり、情報を見落とすリスクがある。

### 3. PDFの不完全性

現在の「作業指示書PDF」には以下が含まれている：
- ✅ 基本情報（顧客名、車両、入庫日時、サービス種別、担当整備士）
- ✅ 作業指示内容（`job.field`）
- ✅ 顧客からの申し送り事項（`job.field7`の一部）

**不足している情報:**
- ❌ 走行距離（`job.field10`）
- ❌ 承認済み作業内容（`job.field13`、作業待ち以降）
- ❌ タグ情報（スマートタグID）
- ❌ 代車情報（貸出中の場合）
- ❌ 過去の作業履歴（関連情報）

---

## 提案：統合された「作業指示書」の設計

### 1. 名称の明確化

| 旧名称 | 新名称 | 説明 |
|-------|--------|------|
| **作業指示** (`job.field`) | **社内メモ** / **スタッフメモ** | 受付スタッフが記入する簡易メモ。JOBカード上では「⚠社内メモ」として表示。 |
| **作業指示書PDF** | **作業指示書PDF**（名称維持） | メカニック向けの統合された正式な作業指示書。すべての情報を網羅。 |

### 2. 統合された作業指示書PDFの構成

メカニックが作業前に必要な**すべての情報を1枚のPDFに集約**：

```
┌─────────────────────────────────────────┐
│         作業指示書                       │
├─────────────────────────────────────────┤
│ 【基本情報】                             │
│ ・顧客名: 鈴木一郎様                     │
│ ・車両: アウディ A4 / 世田谷 580 た 9012 │
│ ・入庫日時: 2025/12/23 08:00            │
│ ・サービス種別: 車検                     │
│ ・担当整備士: 田中太郎                   │
│ ・走行距離: 50,000 km                   │
│ ・タグNo.: 03                           │
│ ・代車: アウディ A3（貸出中）            │
├─────────────────────────────────────────┤
│ 【顧客からの申し送り事項】               │
│ ・ブレーキを踏むと異音がする             │
│ ・エアコンの効きが悪い                   │
│ ・車検のため代車希望（コンパクトカー）   │
├─────────────────────────────────────────┤
│ 【社内メモ】                             │
│ ・車検のため代車必要。コンパクトカー希望。│
│ ・前回点検から1年経過。                   │
├─────────────────────────────────────────┤
│ 【承認済み作業内容】（作業待ち以降）     │
│ ・エンジンオイル交換: ¥8,000             │
│ ・エアコンフィルター交換: ¥5,000         │
│ ・ブレーキパッド交換: ¥15,000            │
│ 合計: ¥28,000                            │
├─────────────────────────────────────────┤
│ 【過去の作業履歴】（関連情報）           │
│ ・2024/12/20: 定期点検実施               │
│ ・2024/06/15: エンジンオイル交換         │
├─────────────────────────────────────────┤
│ 生成日時: 2025/12/23 09:00              │
│ ページ: 1 / 1                            │
└─────────────────────────────────────────┘
```

### 3. 情報の階層化と優先順位

#### フェーズ別の情報表示

**Phase 2（診断前）:**
- 基本情報
- 顧客からの申し送り事項
- 社内メモ
- 走行距離
- タグ情報
- 代車情報

**Phase 4以降（作業待ち以降）:**
- 上記すべて
- **承認済み作業内容**（`job.field13`）を追加表示

**Phase 5以降（作業中・出庫待ち）:**
- 上記すべて
- **過去の作業履歴**（同一顧客・同一車両の過去の案件）を追加表示（オプション）

---

## 実装方法

### 1. 名称変更（UI表示のみ）

**変更箇所:**
- `src/components/features/job-card.tsx`: 「作業指示」→「社内メモ」
- `src/lib/work-order-pdf-generator.ts`: コメント・変数名の明確化

**影響範囲:** UI表示のみ。データ構造（`job.field`）は変更不要。

### 2. 統合された作業指示書PDFの実装

**`src/lib/work-order-pdf-generator.ts`の拡張:**

```typescript
export interface WorkOrderPDFData {
  // 既存フィールド
  jobId: string;
  customerName: string;
  vehicleInfo: {
    name: string;
    licensePlate: string;
  };
  entryDate: string;
  workOrder: string | null; // 社内メモ（旧: 作業指示）
  serviceKind: ServiceKind;
  assignedMechanic: string | null;
  customerNotes: string | null;
  generatedAt: string;
  
  // 新規追加フィールド
  mileage?: number | null; // 走行距離
  tagId?: string | null; // スマートタグID
  courtesyCar?: { // 代車情報
    name: string;
    licensePlate?: string;
  } | null;
  approvedWorkItems?: string | null; // 承認済み作業内容（作業待ち以降）
  historicalJobs?: Array<{ // 過去の作業履歴（オプション）
    date: string;
    serviceKind: string;
    summary: string;
  }> | null;
}
```

**PDF生成ロジックの拡張:**

```typescript
export function createWorkOrderPDFDataFromJob(job: {
  // ... 既存のパラメータ
  field10?: number | null; // 走行距離
  tagId?: string | null; // タグID
  // ... その他
}): WorkOrderPDFData | null {
  // ... 既存の処理
  
  return {
    // ... 既存フィールド
    mileage: job.field10 || null,
    tagId: job.tagId || null,
    courtesyCar: job.courtesyCar || null, // 代車情報（要実装）
    approvedWorkItems: job.field13 || null, // 承認済み作業内容
    historicalJobs: null, // 過去の作業履歴（将来実装）
  };
}
```

### 3. PDFレイアウトの改善

**セクション構成:**

1. **【基本情報】** - 必須情報をコンパクトに
2. **【顧客からの申し送り事項】** - 背景色: 薄い黄色
3. **【社内メモ】** - 背景色: 薄いオレンジ（スタッフからの指示を強調）
4. **【承認済み作業内容】** - 背景色: 薄い青（作業待ち以降のみ表示）
5. **【過去の作業履歴】** - 背景色: 薄いグレー（オプション、将来実装）

**視覚的な階層化:**
- セクションタイトル: 太字、背景色付き
- 重要情報: アイコン付き
- 情報の優先順位に応じたフォントサイズ調整

---

## 期待される効果

### 1. 業務効率の向上

- **情報の一元化**: メカニックが1枚のPDFで全体を把握可能
- **見落とし防止**: 分散していた情報を1箇所に集約
- **作業時間の短縮**: 複数の画面を見回る必要がなくなる

### 2. UXの改善

- **名称の明確化**: 「社内メモ」と「作業指示書」で役割が明確
- **情報の階層化**: 重要度に応じた視覚的な整理
- **印刷の利便性**: 1枚の紙で作業に必要な情報をすべて確認可能

### 3. エラーの削減

- **情報の欠落防止**: すべての情報を1箇所に集約することで見落としを防止
- **確認の徹底**: 印刷したPDFを手元に置いて作業することで、確認漏れを防止

---

## 実装スケジュール

### Phase 1: 名称変更とUI改善（0.5日）
- JOBカード上の「作業指示」→「社内メモ」に変更
- アイコン・色の調整（⚠ → 📝 など）

### Phase 2: PDFデータ構造の拡張（0.5日）
- `WorkOrderPDFData`インターフェースの拡張
- `createWorkOrderPDFDataFromJob`関数の拡張
- 走行距離、タグ情報、代車情報の追加

### Phase 3: PDFレイアウトの改善（1日）
- 新しいセクションの追加（社内メモ、承認済み作業内容）
- 視覚的な階層化の実装
- フェーズ別の情報表示ロジック

### Phase 4: 過去の作業履歴の追加（0.5-1日、オプション）
- 同一顧客・同一車両の過去の案件を取得
- PDFに過去の作業履歴セクションを追加

**合計:** 2.5-3日

---

## ベストプラクティス参考

### 自動車整備業界の標準的な作業指示書

1. **基本情報**: 顧客名、車両情報、入庫日時、走行距離
2. **顧客からの要望**: 不具合、希望事項
3. **社内指示**: スタッフからの特別な指示
4. **作業内容**: 承認済みの作業項目
5. **過去履歴**: 関連する過去の作業履歴（オプション）

### 他業界の参考事例

- **製造業**: 作業指示書にすべての情報を集約し、1枚で作業を完結
- **医療業界**: 診療指示書に患者情報、症状、処置内容をすべて記載
- **建設業界**: 工事指示書に図面、仕様、注意事項をすべて含める

---

## 移行計画

### 段階的な実装

1. **Step 1**: 名称変更のみ実施（影響範囲が小さい）
2. **Step 2**: PDFの拡張（新規フィールドの追加）
3. **Step 3**: レイアウトの改善（視覚的な階層化）
4. **Step 4**: 過去履歴の追加（オプション機能）

### 後方互換性

- 既存の`job.field`（社内メモ）はそのまま使用
- 既存のPDF生成機能は維持（新機能を追加する形）
- 段階的な移行により、既存のワークフローを壊さない

---

## 関連ドキュメント

- [`SPECIFICATION.md`](../SPECIFICATION.md) - システム仕様書
- [`06_HISTORICAL_ESTIMATE_REFERENCE.md`](./06_HISTORICAL_ESTIMATE_REFERENCE.md) - 過去の見積参照機能

---

## 更新履歴

- 2025-12-23: 作業指示書の統合・名称明確化提案を作成



