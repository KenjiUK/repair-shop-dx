# 車検の「追加見積もり内容」仕様（最終版）

**作成日**: 2025-01-XX  
**最終更新**: 2025-01-XX（実務フィードバック反映）  
**目的**: 車検の受入れ点検における「追加見積もり内容」セクションの役割を明確化（実務向けに最適化）

---

## 📋 実務フィードバックの反映

### 総評

**✅ 業務理解のレベル**
- 「3つの入口 × 2つの判断 × 2つの分岐」
- 「3つの箱（Must / Should / Optional）」
- 「新しい作業＝判断軸が変わる」

→ 現場感として完全に成立。机上の空論ではない。

**✅ フロー全体の一貫性**
- 受付 → 診断 → 見積 → 承認 → 作業 → 報告 → 請求
- 車検と別作業を WorkOrderレベルで分離
- 後工程（請求・帳票・Drive保存）とも論理的に整合

**⚠️ 実装で詰まるポイント（3つ）**
1. 箱②と箱③の判断が現場では曖昧
2. 「追加見積内容」と「新しい作業」の二択が重い
3. 見積履歴が「比較UI」がないと意味がない

---

## 🎯 改善後の推奨仕様

### 1. 車検の「3つの箱」の整理（実務向け）

**箱①: 法定必須（Must）**
- 車検NG、やらない選択肢なし
- **判断①: 法的に必須**
- **分岐A: 車検という枠の中で完結**
- **点検項目のステータス（×、△、Aなど）で記録**
- 見積画面で自動的に見積項目に追加される

**箱②: 車検推奨（Should）**
- 今やるべき、車検と一緒が合理的
- **判断②: 商売として提案**
- **分岐A: 車検という枠の中で完結**
- **点検項目のステータス（×、△、Aなど）で記録**
- 見積画面で自動的に見積項目に追加される
- **UIでの説明: 「車検の説明の中でそのまま伝えられる内容」**

**箱③: 車検外提案（Optional / Separate）**
- 別案件、別予算、別判断
- **判断②: 商売として提案**
- **分岐B: 車検とは切り分けるべき**
- **「追加見積内容」セクションで記録**
- **UIでの説明: 「車検とは切り分けて説明した方が分かりやすい内容」**

#### ⚠️ 重要な改善点（箱②と箱③の判断基準）

**変更前（問題点）:**
- 判断軸（安全・法令 vs 快適・予算）で分類
- 現場では判断が曖昧で、人によってブレる

**変更後（改善案）:**
- **判断基準を「判断軸」ではなく「説明文脈」に落とす**
- UIでは「判断軸」という言葉を使わない

**分類と説明:**

| 分類 | 現場での説明（UI表示） |
|------|----------------------|
| 箱② 車検推奨 | 「車検の説明の中でそのまま伝えられる内容」 |
| 箱③ 車検外 | 「車検とは切り分けて説明した方が分かりやすい内容」 |

**例:**
- バッテリー（点検項目にもある／でも"次回でも可"）→ 箱②（車検の説明の中で伝えられる）
- ワイパー → 箱②（車検の説明の中で伝えられる）
- エアフィルター → 箱②（車検の説明の中で伝えられる）
- エアコンの不具合 → 箱③（車検とは切り分けて説明した方が分かりやすい）

**注意:**
- 「判断軸」という言葉は仕様書内部だけに使い、UIでは使わない
- 現場の判断基準は「説明文脈」に統一

---

### 2. 「追加見積内容」セクションの役割（段階化）

**役割:**
- **「車検外提案（Optional / Separate）」に特化**
- 車検とは切り分けて説明した方が分かりやすい内容を記録する

**段階化のアプローチ（改善案）:**

**Step 1: まずはすべて「追加見積内容」で記録**
- 整備士は迷わず「追加見積内容」に入力
- 判断の負担を軽減

**Step 2: 後から「独立作業に昇格」**
- 追加見積内容の各項目に「独立作業にする」ボタンを追加
- フロントが判断して昇格できる
- 作業粒度を後から調整できる

**UI案:**
```
追加見積内容
├── エアコンの不具合 [独立作業にする] ボタン
├── ナビゲーションの故障 [独立作業にする] ボタン
└── ドアの開閉不良 [独立作業にする] ボタン
```

**メリット:**
- 入力時は迷わない
- フロント判断で昇格できる
- 作業粒度を後から調整できる

**使用例:**
- エアコンの不具合 → まず「追加見積内容」で入力 → 後から「独立作業にする」ボタンで昇格
- ナビゲーションの故障 → まず「追加見積内容」で入力 → 後から「独立作業にする」ボタンで昇格

**使用しない例:**
- ブレーキパッドの摩耗 → 点検項目のステータスで記録（箱①・②）
- タイヤの溝の深さ不足 → 点検項目のステータスで記録（箱①・②）
- エンジンオイルの劣化 → 点検項目のステータスで記録（箱①・②）

---

### 3. 「独立作業にする」ボタンの役割

**役割:**
- **追加見積内容の各項目を、後から独立したワークオーダーに昇格させる**
- ボタンをクリックすると、新しい作業（ワークオーダー）が作成される
- 新しい作業は、案件カードの下に各作業単独でワークフローが動く

**使用例:**
- エアコンの不具合（追加見積内容で入力済み）→ 「独立作業にする」ボタン → 「エアコン修理」という新しいワークオーダーが作成される
- ナビゲーションの故障（追加見積内容で入力済み）→ 「独立作業にする」ボタン → 「ナビゲーション修理」という新しいワークオーダーが作成される

**UI実装:**
- 追加見積内容の各項目に「独立作業にする」ボタンを表示
- ボタンをクリックすると確認ダイアログを表示
- 確認後、新しいワークオーダーを作成し、追加見積内容から該当項目を削除

---

### 4. 点検項目のステータスの役割

**役割:**
- **車検の点検項目で発見された問題を記録する**
- **説明文脈: 車検の説明の中でそのまま伝えられる内容（箱①・②）**
- 見積画面で自動的に見積項目に追加される
- **「追加見積内容」には入力しない**

**使用例:**
- ブレーキパッドの摩耗（×=交換、箱①: 法定必須）
- タイヤの溝の深さ不足（×=交換、箱①: 法定必須）
- エンジンオイルの劣化（×=交換、箱②: 車検推奨）
- ブレーキフルードの劣化（×=交換、箱②: 車検推奨）

---

### 5. 見積履歴の管理（差分表示）

**役割:**
- **見積回数が増えることは正常な業務フロー**
- 見積 v1（事前）、v2（受入れ）、v3（作業中）を履歴として記録
- **重要: 履歴は"一覧"ではなく"差分"で表示**

#### ⚠️ 重要な改善点（見積履歴の表示）

**変更前（問題点）:**
- 見積履歴を一覧で表示
- お客さんが「なんで金額増えたんですか？」と聞かれた時に説明が困難

**変更後（改善案）:**
- **履歴は"一覧"ではなく"差分"で表示**
- 最低限必要な表示:
  - v2 → v3 の変更点
  - 追加された項目
  - 削除された項目
  - 金額差分
  - 変更理由（必須入力）

**UI実装例:**
```
見積履歴
├── v1（事前）: ¥50,000
├── v2（受入れ）: ¥80,000
│   └── 差分: +¥30,000
│       ├── 追加: ブレーキパッド交換 +¥30,000
│       └── 理由: 受入れ点検で発見
└── v3（作業中）: ¥90,000
    └── 差分: +¥10,000
        ├── 追加: バッテリー交換 +¥10,000
        └── 理由: 作業中に発見
```

**メリット:**
- クレーム回避
- 説明品質の向上
- 信頼性の向上

**実装要件:**
- 見積変更時に変更理由を必須入力
- 差分表示UIを実装
- 金額差分を自動計算

---

## 📝 実装チェックリスト

### UI改善
- [ ] 「追加見積内容」セクションのタイトルを「車検外提案（車検とは切り分けて説明した方が分かりやすい内容）」に変更
- [ ] 箱②の説明を「車検の説明の中でそのまま伝えられる内容」に変更
- [ ] 箱③の説明を「車検とは切り分けて説明した方が分かりやすい内容」に変更
- [ ] 「判断軸」という言葉をUIから削除
- [ ] 追加見積内容の各項目に「独立作業にする」ボタンを追加
- [ ] 「独立作業にする」ボタンのクリック時に、新しい作業（ワークオーダー）を作成する機能を実装
- [ ] 見積履歴機能を実装（見積 v1、v2、v3を履歴として表示）
- [ ] **見積履歴を差分表示で実装（追加・削除・金額差分・変更理由）**

### 機能改善
- [ ] 「独立作業にする」ボタンのクリック時に、新しい作業（ワークオーダー）を作成するAPIを実装
- [ ] 新しい作業（ワークオーダー）が作成されたら、案件カードの下に表示されるようにする
- [ ] 新しい作業（ワークオーダー）のワークフローが正しく動作することを確認
- [ ] 見積履歴機能の実装（見積 v1、v2、v3を履歴として記録・表示）
- [ ] **見積変更時に変更理由を必須入力する機能を実装**
- [ ] **見積履歴の差分表示機能を実装（追加・削除・金額差分）**

### ドキュメント更新
- [ ] `PAGE_SPECIFICATION.md`を更新（「追加見積内容」セクションの役割を明確化）
- [ ] `USER_WORKFLOW_DETAILED_DESIGN_V2.md`を更新（車検のフローを更新）
- [ ] ユーザー向けマニュアルを更新（「追加見積内容」の使用方法を説明）

---

## 🔗 関連ドキュメント

- [VEHICLE_INSPECTION_ADDITIONAL_ESTIMATE_SPEC_PROPOSAL.md](./VEHICLE_INSPECTION_ADDITIONAL_ESTIMATE_SPEC_PROPOSAL.md) - 元の提案書
- [VEHICLE_INSPECTION_ADDITIONAL_ESTIMATE_SPEC_REVIEW.md](./VEHICLE_INSPECTION_ADDITIONAL_ESTIMATE_SPEC_REVIEW.md) - レビュー結果
- [VEHICLE_INSPECTION_PROCESS_FLOW.md](./VEHICLE_INSPECTION_PROCESS_FLOW.md) - プロセスフロー
- [PAGE_SPECIFICATION.md](./PAGE_SPECIFICATION.md) - ページ単位詳細設計仕様書
- [USER_WORKFLOW_DETAILED_DESIGN_V2.md](./USER_WORKFLOW_DETAILED_DESIGN_V2.md) - ユーザーワークフロー詳細設計

---

## 📊 改善のまとめ

### 改善前の問題点

1. **箱②と箱③の判断が曖昧**
   - 判断軸（安全・法令 vs 快適・予算）で分類
   - 現場では判断が曖昧で、人によってブレる

2. **「追加見積内容」と「新しい作業」の二択が重い**
   - 整備士が迷う
   - 判断の負担が高い

3. **見積履歴が「比較UI」がないと意味がない**
   - 一覧表示だけでは説明が困難
   - お客さんに「なんで金額増えたんですか？」と聞かれた時に説明できない

### 改善後の解決策

1. **判断基準を「説明文脈」に変更**
   - 箱②: 「車検の説明の中でそのまま伝えられる内容」
   - 箱③: 「車検とは切り分けて説明した方が分かりやすい内容」
   - UIでは「判断軸」という言葉を使わない

2. **段階化のアプローチ**
   - まずはすべて「追加見積内容」で記録
   - 後から「独立作業にする」ボタンで昇格
   - 判断の負担を軽減

3. **見積履歴を差分表示**
   - 追加・削除・金額差分・変更理由を表示
   - クレーム回避・説明品質・信頼性に直結

---

**End of Document**

