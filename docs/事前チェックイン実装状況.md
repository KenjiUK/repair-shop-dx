# 事前チェックイン画面の実装状況

## 実装済み機能

### ✅ 仕様書通りの実装

1. **車両選択**
   - 既存車両リスト表示・選択 ✅
   - 新規車両登録（車種名入力・車検証画像アップロード）✅
   - 車両IDの更新（field6）✅

2. **顧客情報確認**
   - 住所・電話番号の表示（初期値設定）✅
   - 変更時の「変更あり」バッジ表示 ✅
   - Descriptionへの追記（変更申請）✅

3. **メール配信同意**
   - チェックボックス表示 ✅
   - Email_Opt_Outの更新処理 ✅（実装済み）

4. **問診**
   - 走行距離入力（初期値設定）✅
   - 不具合・気になるところ（テキストエリア）✅
   - 代車希望（チェックボックス）✅

5. **データ保存**
   - 走行距離更新（field10）✅
   - 不具合内容追記（field7）✅
   - 代車希望追記（field7）✅
   - 新規車両画像アップロード（field12）✅

---

## 仕様書に記載がないが実装されている機能

1. **初期値の自動設定**
   - 住所・電話番号・走行距離は顧客・ジョブデータから自動設定 ✅
   - 仕様書には「表示」とあるが、初期値として設定されている

---

## 仕様書には記載されていないが、UX向上のために実装すべき機能

### 🔍 改善提案

1. **メール同意の初期値設定**
   - **現在の実装**: 常に `false`（同意していない）で初期化
   - **改善案**: 顧客の現在の `Email_Opt_Out` 値を読み取り、初期値を設定
   - **理由**: 顧客が既に同意している場合、再度チェックする必要がない

2. **既存車両IDの初期値設定**
   - **現在の実装**: 常に `null` で初期化
   - **改善案**: ジョブに既に `field6`（車両ID）が設定されている場合、初期値として設定
   - **理由**: 予約時に既に車両が選択されている場合、その車両を初期選択状態にする

3. **不具合内容・代車希望の初期値復元**
   - **現在の実装**: 常に空で初期化
   - **改善案**: 既に `field7` に【事前入力】の記録がある場合、それを読み取って表示
   - **理由**: 顧客が一度入力して保存した後、再度編集したい場合に既存データを表示

---

## コード上の確認事項

### 初期値設定の実装箇所

```typescript
// src/app/customer/pre-checkin/[id]/page.tsx (91-100行目)
useEffect(() => {
  if (job && customer) {
    setFormData((prev) => ({
      ...prev,
      address: customer.mailingStreet || "",
      phone: customer.phone || customer.mobile || "",
      mileage: job.field10?.toString() || "",
    }));
  }
}, [job, customer]);
```

### 未設定の初期値

- `emailOptIn`: 常に `false`（顧客の現在の `Email_Opt_Out` 値を反映していない）
- `vehicleId`: 常に `null`（既に `job.field6` が設定されている場合でも反映していない）
- `issues`: 常に空（既に `field7` に記録がある場合でも反映していない）
- `courtesyCarRequested`: 常に `false`（既に `field7` に記録がある場合でも反映していない）

---

## 推奨改善

1. **メール同意の初期値設定**（優先度: 中）
   - 顧客の `Email_Opt_Out` 値を読み取り、`emailOptIn = !customer.Email_Opt_Out` で初期化

2. **既存車両IDの初期値設定**（優先度: 低）
   - `job.field6?.id` があれば、`vehicleId` に設定

3. **既存入力内容の復元**（優先度: 低）
   - `field7` から【事前入力】の記録をパースして復元




