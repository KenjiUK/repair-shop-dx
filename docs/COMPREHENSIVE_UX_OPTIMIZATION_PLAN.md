# 統合UX最適化計画

**作成日:** 2024年
**目的:** 最高UXを実現するための全機能の統合設計

---

## 設計原則

### 1. 顧客視点を最優先
- 簡単に操作できる
- 混乱しない
- 自動化できる部分は自動化

### 2. スタッフ視点の効率化
- 手動入力の手間を最小化
- データの整合性を保つ
- 自動化できる部分は自動化

### 3. システム視点のシンプルさ
- 画面数を増やさない
- 既存機能を最大限活用
- データの整合性を保つ

---

## 機能別UX最適化提案

### 1. 2回予約フロー ✅ **最高UX版確定**

**推奨案: 2回目の予約もZoho Bookingsを使う + 自動紐付け**

**実装内容:**
- 全部品到着時に顧客にZoho Bookings予約リンクを送信
- 顧客がZoho Bookingsで予約
- Zoho CRMワークフローで自動的に既存ジョブと紐付け
- スタッフの手間がゼロ

**詳細:** `docs/DOUBLE_BOOKING_FLOW_UX_OPTIMIZATION.md` を参照

**工数:** 約1日（Zoho CRMワークフロー設定 + アプリ側の表示改善）

---

### 2. 診断料金の管理 ✅ **最高UX版確定**

**推奨案: 見積画面で一元管理 + 診断完了時に簡易入力**

**実装内容:**
- 見積画面で診断料金を一元管理（メイン）
- 診断完了時に簡易入力（補助・忘れ防止）
- 常連顧客は自動で¥0に設定
- 作業実施時は自動で割引

**詳細:** `docs/DIAGNOSIS_FEE_MANAGEMENT_OPTIMIZED.md` を参照

**工数:** 約2.5日

---

### 3. 診断後の一時帰宅管理

#### 現在の提案の問題点
- ❌ 新規画面を作ると画面数が増える
- ❌ 既存機能で十分対応可能

#### ✅ 最高UXのアプローチ

**コンセプト:**
- 既存ステータスを活用（画面数を増やさない）
- 自動判定で手間を削減

**実装内容:**
1. **診断完了時の自動判定**
   - 診断完了時に「一時帰宅」か「入庫」を選択
   - 一時帰宅の場合、ステータスを「見積作成待ち」に自動更新
   - 再入庫予定日時を `field7` に記録

2. **トップページでの表示**
   - ステータス「見積作成待ち」を「一時帰宅中」として表示
   - 再入庫予定日時を表示

**実装場所:**
- `src/app/mechanic/diagnosis/[id]/page.tsx` - 一時帰宅判定
- `src/app/page.tsx` - 表示改善

**工数:** 約0.5日（既存機能の拡張のみ）

---

### 4. 部品管理システム

#### 現在の提案の問題点
- ❌ 新規画面を作ると画面数が増える
- ❌ 見積画面から離れた場所で管理するのは不便

#### ✅ 最高UXのアプローチ

**コンセプト:**
- 見積画面に統合（1画面で完結）
- 部品到着確認は簡単な操作で
- 全部品到着時に自動通知

**実装内容:**
1. **見積画面での部品管理**
   - 部品リストに「発注先」「到着状況」「在庫場所」を追加
   - 部品ごとに「到着済み」チェックボックス
   - 到着時に「在庫場所」を入力（例: "A-1"）

2. **全部品到着時の自動処理**
   - 全部品到着時に自動で通知を表示
   - 顧客への連絡ダイアログを自動表示
   - Zoho Bookings予約リンクを含める

**UIイメージ:**
```
┌─────────────────────────────────────┐
│ 見積作成 - 田中様  BMW X3           │
├─────────────────────────────────────┤
│                                     │
│  📋 見積項目                        │
│  ...                                │
│                                     │
│  ────────────────────────────────  │
│                                     │
│  📦 部品管理                        │
│                                     │
│  ┌─────────────────────────────┐  │
│  │ ブレーキパッド  F型          │  │
│  │ 発注先: A商事                 │  │
│  │ ☑️ 到着済み                   │  │
│  │ 在庫場所: [A-1]               │  │
│  └─────────────────────────────┘  │
│                                     │
│  ┌─────────────────────────────┐  │
│  │ ブレーキローター  F型        │  │
│  │ 発注先: B商事                 │  │
│  │ ☐ 到着待ち                   │  │
│  └─────────────────────────────┘  │
│                                     │
│  📊 発注状況: 2点中1点到着済み     │
│                                     │
│  ✅ 全部品到着時に自動で顧客連絡   │
└─────────────────────────────────────┘
```

**実装場所:**
- `src/app/admin/estimate/[id]/page.tsx` - 部品管理セクション追加

**工数:** 約1週間（見積画面統合版）

---

### 5. ホワイトボード機能

#### 現在の提案の問題点
- ❌ 新規画面を作ると画面数が増える
- ❌ トップページと重複する

#### ✅ 最高UXのアプローチ

**コンセプト:**
- トップページを拡張（新規画面を作らない）
- 担当整備士別のビューを追加
- 既存のフィルター機能を活用

**実装内容:**
1. **トップページの拡張**
   - 「担当整備士別」タブを追加
   - 担当整備士ごとに車両をグループ化
   - 作業状況を色分け表示

2. **表示の改善**
   - 進捗バーで作業進捗を可視化
   - 明日の作業予定を別セクションで表示

**UIイメージ:**
```
┌─────────────────────────────────────┐
│ 本日の入庫予定                      │
├─────────────────────────────────────┤
│                                     │
│  [全体] [担当別] [再入庫予定]      │
│                                     │
│  👤 山田整備士                       │
│  ┌─────────────────────────────┐  │
│  │ 🔧 作業中                     │  │
│  │ 田中様  BMW X3               │  │
│  │ 進捗: ████████░░ 80%         │  │
│  └─────────────────────────────┘  │
│                                     │
│  👤 鈴木整備士                       │
│  ┌─────────────────────────────┐  │
│  │ ⏳ 待機中                     │  │
│  │ 佐藤様  Mercedes C-Class     │  │
│  └─────────────────────────────┘  │
│                                     │
└─────────────────────────────────────┘
```

**実装場所:**
- `src/app/page.tsx` - タブ追加、担当別ビュー

**工数:** 約2-3日（トップページ拡張のみ）

---

### 6. メカニックのダブルチェック機能

#### 現在の提案の問題点
- ❌ 新規画面を作ると画面数が増える
- ❌ 見積画面から離れた場所でチェックするのは不便

#### ✅ 最高UXのアプローチ

**コンセプト:**
- 見積画面に統合（1画面で完結）
- チェック機能は「承認ボタン」程度で十分

**実装内容:**
1. **見積画面での承認**
   - 見積画面の下部に「メカニック承認」セクションを追加
   - 「承認済み」チェックボックス + 承認者名入力
   - 承認後に「顧客に送信」ボタンを有効化

2. **承認フロー**
   - 見積作成後、メカニックに通知
   - メカニックが見積画面で承認
   - 承認後に顧客に送信可能

**UIイメージ:**
```
┌─────────────────────────────────────┐
│ 見積作成 - 田中様  BMW X3           │
├─────────────────────────────────────┤
│                                     │
│  📋 見積項目                        │
│  ...                                │
│                                     │
│  ────────────────────────────────  │
│                                     │
│  ✅ メカニック承認                  │
│                                     │
│  ☑️ 承認済み                        │
│  承認者: [山田整備士]               │
│  承認日時: 2024/01/10 14:30        │
│                                     │
│  [顧客に送信] ボタン（承認後に有効）│
└─────────────────────────────────────┘
```

**実装場所:**
- `src/app/admin/estimate/[id]/page.tsx` - 承認セクション追加

**工数:** 約1-2日（見積画面統合版）

---

### 7. 発注完了後の入庫連絡機能

#### 現在の提案の問題点
- ❌ 新規画面を作ると画面数が増える
- ❌ 部品到着確認から離れた場所で連絡するのは不便

#### ✅ 最高UXのアプローチ

**コンセプト:**
- 全部品到着時に自動でダイアログを表示
- 見積画面から直接連絡できる
- Zoho Bookings予約リンクを含める

**実装内容:**
1. **全部品到着時の自動処理**
   - 全部品到着時に自動で通知を表示
   - 顧客への連絡ダイアログを自動表示
   - Zoho Bookings予約リンクを含める

2. **連絡送信**
   - 連絡方法を選択（LINE、メール）
   - メッセージテンプレートを使用
   - 送信後にZoho Bookings予約リンクを送信

**UIイメージ:**
```
┌─────────────────────────────────────┐
│ 全部品到着 - 顧客への連絡           │
├─────────────────────────────────────┤
│                                     │
│  ✅ 全部品到着確認                  │
│                                     │
│  📦 到着部品一覧                    │
│  • ブレーキパッド  F型 ✓            │
│  • ブレーキローター  F型 ✓          │
│                                     │
│  ────────────────────────────────  │
│                                     │
│  📞 顧客への連絡                    │
│                                     │
│  連絡方法:                          │
│  ○ LINE                            │
│  ● メール                          │
│                                     │
│  メッセージ:                        │
│  ┌─────────────────────────────┐  │
│  │ 田中様                      │  │
│  │                             │  │
│  │ お待たせしております。      │  │
│  │ 発注していた部品が全て       │  │
│  │ 到着いたしました。          │  │
│  │                             │  │
│  │ 以下のリンクから、ご都合の  │  │
│  │ 良い日時で再入庫の予約を     │  │
│  │ お願いいたします。           │  │
│  │                             │  │
│  │ [Zoho Bookings予約リンク]   │  │
│  └─────────────────────────────┘  │
│                                     │
│  [連絡を送信] ボタン                │
└─────────────────────────────────────┘
```

**実装場所:**
- `src/app/admin/estimate/[id]/page.tsx` - 全部品到着時の自動処理
- `src/components/features/parts-arrival-dialog.tsx` - 新規コンポーネント

**工数:** 約2-3日（ダイアログ版）

---

## 実装優先順位（最高UX版）

### 第1フェーズ（高優先度・業務の痛みポイント）

1. **2回予約フロー** - 約1日
   - 最高UX版確定
   - Zoho CRMワークフローで自動紐付け

2. **部品管理システム** - 約1週間
   - 見積画面に統合
   - 全部品到着時の自動連絡

### 第2フェーズ（中優先度・業務効率向上）

3. **発注完了後の入庫連絡機能** - 約2-3日
   - ダイアログ版
   - Zoho Bookings予約リンクを含める

4. **診断料金の管理** - 約2.5日
   - 見積画面で一元管理
   - 診断完了時に簡易入力
   - 自動化機能（常連顧客、割引処理）

### 第3フェーズ（低優先度・既存機能拡張）

5. **ホワイトボード機能（簡易版）** - 約2-3日
   - トップページ拡張のみ

6. **メカニックのダブルチェック機能（簡易版）** - 約1-2日
   - 見積画面に統合

7. **診断後の一時帰宅管理** - 約0.5日
   - 既存ステータス活用

8. **車検チェックリスト機能** - 約1-2日
   - 車検入庫時チェックリスト
   - 車検出庫時チェックリスト

9. **作業指示書PDF出力機能** - 約1-2日
   - 診断前・作業前のPDF出力
   - クライアント側でPDF生成

10. **ジョブメモ機能** - 約1-2日
   - スタッフ間での情報共有
   - 作業中の気づきを記録
   - 時系列でメモを表示

---

## 総工数見積

- **第1フェーズ:** 約1週間 + 1日 = 約1.5週間
- **第2フェーズ:** 約2-3日 + 2.5日 = 約1週間
- **第3フェーズ:** 約2-3日 + 1-2日 + 0.5日 + 1-2日 + 1-2日 + 1-2日 = 約2週間

**合計:** 約4.5週間（最高UX版）

---

## 設計原則の適用

### ✅ 画面数を増やさない
- 新規画面は最小限（部品管理画面、ホワイトボード画面は作成しない）
- 既存画面に機能を統合（見積画面、トップページ）

### ✅ シンプルな操作
- 複雑なワークフローは避ける
- 1画面で完結できるように

### ✅ 既存機能の活用
- ステータス管理、フィルター機能など既存機能を最大限活用
- 新規機能は最小限に

### ✅ 自動化の推進
- 手動入力の手間を最小化
- 自動判定・自動計算・自動通知

---

## 結論

### ✅ **最高UXを実現する統合設計:**

1. **2回予約フロー** - Zoho Bookings + 自動紐付け ✅
2. **部品管理システム** - 見積画面に統合 ✅
3. **発注完了後の入庫連絡機能** - ダイアログ + Zoho Bookings予約リンク ✅
4. **診断料金の管理** - 見積画面で一元管理 + 診断完了時に簡易入力 ✅
5. **ホワイトボード機能** - トップページ拡張 ✅
6. **メカニックのダブルチェック機能** - 見積画面に統合 ✅
7. **診断後の一時帰宅管理** - 既存ステータス活用 ✅
8. **車検チェックリスト機能** - 入庫時・出庫時チェックリスト ✅
9. **作業指示書PDF出力機能** - 診断前・作業前のPDF出力 ✅
10. **ジョブメモ機能** - スタッフ間での情報共有、作業中の気づきを記録 ✅

### **実装のポイント:**
- ✅ 顧客視点: 簡単に操作できる、自動化
- ✅ スタッフ視点: 手動入力の手間が最小、自動化
- ✅ システム視点: 画面数を増やさない、既存機能を活用

---

## 次のステップ

1. **第1フェーズの実装開始**
   - 2回予約フロー（Zoho CRMワークフロー設定）
   - 部品管理システム（見積画面統合）

2. **Zoho CRMワークフローの設定可否を確認**
   - 2回目の予約を検知して既存ジョブと自動紐付けできるか

3. **データ構造の拡張**
   - `ID_BookingId_2` を追加
   - 部品管理のデータ構造を追加







