# 車検（法定24ヶ月点検）画面設計書

## ドキュメント情報

- **作成日**: 2025-01-XX
- **バージョン**: 1.1
- **対象**: 車検（法定24ヶ月点検）の各画面の詳細設計
- **設計方針**: 世界最高のUI/UX、ITコンサルの目線での推奨を元に設計

---

## 複数作業管理対応

この画面設計書は、1つの入庫に対して複数の作業（車検、オイル交換、コーティングなど）を管理する「複数作業管理」に対応しています。

**対応内容**:
- 各画面は特定のワークオーダー（作業）に対応
- URLパラメータ `workOrderId` で対象ワークオーダーを識別
- 画面ヘッダーに現在の作業名を表示
- 「他の作業を表示」ボタンで同じJobの他のワークオーダーに切替可能
- データはZoho CRM `field_work_orders` フィールドに作業ごとに保存

**詳細は [統合仕様書](./INTEGRATED_SPECIFICATION.md) の「2-4. 複数作業管理の実装」を参照してください。**

---

## 1. 画面一覧

### 1-1. 整備士向け画面

1. **診断画面** (`/mechanic/diagnosis/[id]`)
   - 検査項目の入力
   - 測定値の入力
   - 写真撮影
   - 交換部品の記録（作業時）

2. **作業画面** (`/mechanic/work/[id]`)
   - 承認された作業項目の表示
   - Before/After写真の撮影
   - 交換部品の記録

### 1-2. フロントスタッフ向け画面

3. **見積もり画面** (`/admin/estimate/[id]`)
   - 法定費用の表示（自動取得）
   - 部品代・工賃の入力
   - 顧客への送信

### 1-3. 顧客向け画面

4. **承認画面** (`/customer/approval/[id]`)
   - 見積もりの確認
   - 項目の選択/解除
   - 承認

5. **レポート画面** (`/customer/report/[id]`)
   - 整備完了報告
   - 分解整備記録簿（PDF）の表示
   - 請求書の表示

---

## 2. 診断画面の詳細設計

### 2-1. 画面構成

#### レイアウト構造

```
┌─────────────────────────────────────────┐
│ [←] 田中様 BMW X3 車検診断               │
│ 整備士: 中村                             │
├─────────────────────────────────────────┤
│ 📋 車両情報（自動入力済み・編集不可）     │
│ ┌─────────────────────────────────────┐ │
│ │ 登録番号: 堺 330 す 1669            │ │
│ │ 車台番号: VF3CUHNZTHY061316         │ │
│ │ 初度登録: H29.10                    │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ [タブ] エンジン・ルーム | 室内 | 足廻り  │
│        | 下廻り | 外廻り | 日常点検      │
│ ─────────────────────────────────────── │
│                                          │
│ [カテゴリ: エンジン・ルーム点検]         │
│ 進捗: ████████░░ 15/20項目完了 (75%)   │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ パワー・ステアリング                │ │
│ │ [OK] [注意] [要交換] [調整] [清掃]   │ │
│ │ [📷 写真] [🎥 動画] [💬 コメント]   │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ 冷却装置                            │ │
│ │ [OK] [注意] [要交換] [調整] [清掃]   │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ ...（スクロール可能）                    │
│                                          │
│ [測定値入力] [交換部品リスト] [その他]   │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ 🔧 診断時の交換部品リスト            │ │
│ │ [＋部品を追加] [🎤 音声入力]        │ │
│ │                                      │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ フロントブレーキパッド          │ │ │
│ │ │ [緊急] 残り2mm                  │ │ │
│ │ │ [📷写真] [🎥動画] [削除]        │ │ │
│ │ └────────────────────────────────┘ │ │
│ │                                      │ │
│ │ ...（スクロール可能）                │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ [一時保存] [診断完了]                    │
└─────────────────────────────────────────┘
```

### 2-2. コンポーネント設計

#### 2-2-1. 車両情報カード

**目的**: 診断対象の車両情報を表示（誤操作防止のため編集不可）

**表示項目**:
- 依頼者(使用者)の氏名又は名称
- 車名及び型式
- 自動車登録番号又は車両番号
- 原動機の型式
- 初度登録年又は初度検査年
- 車台番号

**データソース**: Google Sheets「【DB】車両マスタ」から自動取得

**UI/UXのポイント**:
- 背景色を薄くして、編集不可であることを視覚的に示す
- アイコン（🔒）で編集不可であることを示す

#### 2-2-2. カテゴリタブ

**目的**: PDFテンプレート（24か月点検用テンプレート.pdf）に基づく6つのカテゴリを表示

**カテゴリ**:
- **車検の場合**: PDFテンプレートに基づき、6つのカテゴリ全てが表示される
  1. エンジン・ルーム点検（デフォルト選択）
  2. 室内点検
  3. 足廻り点検
  4. 下廻り点検
  5. 外廻り点検
  6. 日常点検

**UI/UXのポイント**:
- **自動設定**: 入庫区分が「車検」の場合、6つのカテゴリ全てが自動で表示される
- **デフォルト選択**: 「エンジン・ルーム点検」がデフォルトで選択される
- **手動切り替え**: タブをタップして手動で切り替え可能
- タブは横スクロール可能（モバイル対応）
- 完了したカテゴリにはチェックマーク（✓）を表示
- 現在のカテゴリは強調表示
- 未完了のカテゴリはバッジで未入力項目数を表示

#### 2-2-3. 進捗バー

**目的**: 現在のカテゴリの進捗を可視化

**表示内容**:
- 完了項目数 / 全項目数
- 進捗パーセンテージ
- プログレスバー（視覚的）

**UI/UXのポイント**:
- 色で進捗を表現（0-50%: 赤、50-80%: 黄、80-100%: 緑）
- 数値と視覚的表現の両方で進捗を表示

#### 2-2-4. 検査項目カード

**目的**: 各検査項目の状態を入力

**表示内容**:
- 項目名（例: 「パワー・ステアリング」）
- 状態選択ボタン（OK/注意/要交換/調整/清掃/省略/該当なし）
- 写真追加ボタン
- 動画追加ボタン
- コメント入力ボタン
- 省略規則の表示（該当する場合: ☆/★）

**状態選択ボタンのデザイン**:
- **OK（正常）**: 緑色、チェックマークアイコン
- **注意**: 黄色、警告アイコン
- **要交換**: 赤色、Xアイコン
- **調整**: 青色、レンチアイコン
- **清掃**: 水色、ブラシアイコン
- **省略**: グレー、スキップアイコン
- **該当なし**: グレー、マイナスアイコン

**UI/UXのポイント**:
- ボタンは画面幅いっぱいに配置（タッチしやすい）
- 選択された状態は明確に表示（背景色、アイコン）
- 写真ボタンは撮影済みの場合、サムネイルを表示
- **動画ボタン**: 撮影済みの場合、サムネイル（動画の最初のフレーム）を表示、再生アイコンを重ねて表示
- **動画撮影**: 最大15秒、録画中はタイマー表示、録画停止ボタンを大きく表示
- コメントがある場合、アイコンで表示

#### 2-2-5. 測定値入力ボタン

**目的**: 測定値入力画面への遷移

**表示内容**:
- アイコン（📏）
- ラベル「測定値入力」
- 未入力の場合、バッジで「未入力」を表示

#### 2-2-6. 交換部品ボタン

**目的**: 交換部品記録画面への遷移（作業時のみ有効）

**表示内容**:
- アイコン（🔧）
- ラベル「交換部品」
- 記録済み部品数（バッジ）

#### 2-2-7. その他ボタン

**目的**: その他の点検項目等の自由記述入力

**表示内容**:
- アイコン（📝）
- ラベル「その他」

#### 2-2-8. 一時保存ボタン

**目的**: 現在の入力内容を保存（自動保存も実施）

**UI/UXのポイント**:
- 保存成功時にトースト通知（邪魔にならない程度に）
- オフライン時も保存可能（ローカルストレージ）

#### 2-2-9. 診断完了ボタン

**目的**: 診断を完了し、フロントスタッフに通知

**UI/UXのポイント**:
- 全てのカテゴリが完了していない場合、警告を表示
- 確認ダイアログを表示
- 完了後、フロントスタッフに通知

### 2-3. 測定値入力画面

#### 2-3-1. 画面構成

```
┌─────────────────────────────────────────┐
│ [←] 測定値入力                          │
├─────────────────────────────────────────┤
│ CO、HC濃度（アイドリング時）            │
│ ┌─────────────────────────────────────┐ │
│ │ CO:  [____] %                       │ │
│ │ HC:  [____] ppm                     │ │
│ │ [📷 測定値の写真を追加]             │ │
│ │ [🎥 測定値の動画を追加]             │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ タイヤの溝の深さ（1.6mm以上）            │
│ ┌─────────────────────────────────────┐ │
│ │ 前輪左: [____] mm                   │ │
│ │ 前輪右: [____] mm                   │ │
│ │ 後輪左: [____] mm                   │ │
│ │ 後輪右: [____] mm                   │ │
│ │ [📷 タイヤの写真を追加]             │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ ブレーキ・パッド、ライニングの厚さ       │
│ ┌─────────────────────────────────────┐ │
│ │ 前輪左: [____] mm                   │ │
│ │ 前輪右: [____] mm                   │ │
│ │ 後輪左: [____] mm                   │ │
│ │ 後輪右: [____] mm                   │ │
│ │ [📷 ブレーキパッドの写真を追加]     │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ [保存] [診断画面に戻る]                  │
└─────────────────────────────────────────┘
```

#### 2-3-2. UI/UXのポイント

1. **数値入力の簡易化**
   - 数字キーパッドを表示（テンキー）
   - 単位を明示（mm、%、ppm）
   - 範囲チェック（リアルタイムバリデーション）
     - タイヤ溝深さ: 1.6mm以上
     - CO濃度: 0-100%
     - HC濃度: 0-10000ppm

2. **写真との紐付け**
   - 各測定値セクションに写真追加ボタン
   - 撮影済みの場合、サムネイルを表示
   - 複数枚撮影可能

3. **入力支援**
   - 前回の測定値を表示（参考用、編集可能）
   - 推奨値の表示（例: タイヤ溝深さは1.6mm以上推奨）

### 2-4. 交換部品記録画面（作業時）

#### 2-4-1. 画面構成

```
┌─────────────────────────────────────────┐
│ [←] 交換部品記録                        │
├─────────────────────────────────────────┤
│ [＋部品を追加]                           │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ エンジン・オイル                     │ │
│ │ 数量: [____] l                       │ │
│ │ [削除]                               │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ オイルフィルタ                      │ │
│ │ 数量: [____] 個                     │ │
│ │ [削除]                               │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ ...（スクロール可能）                    │
│                                          │
│ [保存] [作業画面に戻る]                  │
└─────────────────────────────────────────┘
```

#### 2-4-2. UI/UXのポイント

1. **部品名の入力**
   - テキスト入力
   - よく使う部品は候補表示（オートコンプリート）

2. **数量の入力**
   - 数字キーパッドを表示
   - 単位を選択（l、個、本、など）

3. **削除機能**
   - 各項目に削除ボタン
   - 削除時に確認ダイアログ

### 2-5. その他の点検項目等入力画面

#### 2-5-1. 画面構成

```
┌─────────────────────────────────────────┐
│ [←] その他の点検項目等                   │
├─────────────────────────────────────────┤
│ ┌─────────────────────────────────────┐ │
│ │                                     │ │
│ │  自由記述欄                          │ │
│ │  （複数行入力可能）                  │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ [💬 音声入力]                            │
│                                          │
│ [保存] [診断画面に戻る]                  │
└─────────────────────────────────────────┘
```

#### 2-5-2. UI/UXのポイント

1. **音声入力対応**
   - マイクボタンで音声入力
   - 手が汚れている状態でも入力可能
   - 音声認識結果をテキストに変換

2. **自由記述**
   - 複数行入力可能
   - 文字数制限なし（ただし、PDF出力時のレイアウトを考慮）

---

## 3. 見積もり画面の詳細設計

### 3-1. 画面構成

```
┌─────────────────────────────────────────┐
│ [←] 田中様 BMW X3 見積もり              │
├─────────────────────────────────────────┤
│ 📋 法定費用（自動取得・編集不可）         │
│ ┌─────────────────────────────────────┐ │
│ │ 車検（24ヶ月）        ¥66,000      │ │
│ │ 自動車重量税          ¥24,600      │ │
│ │ 自賠責保険料          ¥17,650      │ │
│ │ 印紙代                ¥2,300       │ │
│ │ 代行手数料            ¥19,800      │ │
│ │ テスター代            ¥4,400       │ │
│ │ ──────────────────────────────── │ │
│ │ 法定費用合計          ¥135,750     │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 🔧 部品代・工賃                          │
│ [＋項目を追加]                           │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ フロントブレーキパッド交換          │ │
│ │ [📷] [要交換] 残り2mm               │ │
│ │ 金額: [¥33,000]                    │ │
│ │ [削除]                               │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ ...（スクロール可能）                    │
├─────────────────────────────────────────┤
│ 💰 合計（税込）                          │
│        ¥168,750                         │
│                                          │
│ [プレビュー] [LINEで送信] [メールで送信] │
└─────────────────────────────────────────┘
```

### 3-2. コンポーネント設計

#### 3-2-1. 法定費用カード

**目的**: 法定費用を表示（自動取得、編集不可）

**データソース**: Google Sheets「【DB】車両マスタ」内の「車両_同期用」シート

**表示項目**:
- 車検（24ヶ月）
- 自動車重量税
- 自賠責保険料
- 印紙代
- 代行手数料（該当する場合）
- テスター代（該当する場合）
- 法定費用合計

**UI/UXのポイント**:
- 背景色を薄くして、編集不可であることを視覚的に示す
- 各項目の説明をツールチップで表示（必要に応じて）
- 合計金額を大きく表示

#### 3-2-2. 部品代・工賃セクション

**目的**: 診断結果から部品代・工賃の項目を追加・編集

**機能**:
- 診断結果から自動で項目を追加（「要交換」「注意」と判定された項目）
- 手動で項目を追加
- 金額を入力（基幹システムから転記）
- 写真とコメントを紐付け
- 項目を削除

**基幹システム連携フロー**:
1. アドバイザー（フロントスタッフ）がWebアプリの見積作成画面を開く
2. 診断結果を確認（整備士がリストアップした部品と緊急度を確認）
3. **基幹システム（スマートカーディーラー）で該当作業の見積書を作成**（アドバイザーが実施）
4. **Webアプリに「品名」と「金額（税込）」を転記**（アドバイザーが実施）
5. 見積情報を保存（Zoho CRM field_work_orders内の該当作業の見積情報を更新）

**制約**:
- 見積計算は基幹システムで実施（Webアプリは転記のみ）
- 法定費用は自動取得、部品代・工賃はアドバイザーが手動入力

**UI/UXのポイント**:
- 診断結果から自動追加された項目は、写真とコメントを自動で紐付け
- 金額入力欄は数字キーパッドを表示
- 削除時は確認ダイアログを表示

#### 3-2-3. 合計金額表示

**目的**: 法定費用と部品代・工賃の合計を表示

**UI/UXのポイント**:
- 合計金額を大きく表示
- 法定費用と部品代・工賃を明確に区分
- 税込であることを明示

#### 3-2-4. プレビューボタン

**目的**: 顧客の見え方を確認

**機能**:
- 顧客向けの見積もり画面をプレビュー
- 写真、コメント、金額を確認

#### 3-2-5. 送信ボタン

**目的**: 顧客に見積もりを送信

**送信方法**:
- LINE（推奨）
- メール
- SMS（フォールバック）

**UI/UXのポイント**:
- 送信成功時にトースト通知
- 送信失敗時はエラーメッセージを表示

---

## 4. 作業画面の詳細設計

### 4-1. 画面構成

```
┌─────────────────────────────────────────┐
│ [←] 田中様 BMW X3 作業中                │
├─────────────────────────────────────────┤
│ 📋 承認された作業項目                    │
│ 進捗: ████████░░ 2/3項目完了 (67%)     │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ ✅ フロントブレーキパッド交換        │ │
│ │ [完了]                              │ │
│ │                                     │ │
│ │ Before: [📷写真1] [📷写真2]        │ │
│ │ After:  [📷写真1] [📷写真2]        │ │
│ │ [📷 Before写真を追加]              │ │
│ │ [📷 After写真を追加]                │ │
│ │                                     │ │
│ │ 💬 コメント: パッド残量2mm、ローター│ │
│ │    も段付き摩耗あり。セット交換実施。│ │
│ └─────────────────────────────────────┘ │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ ⏳ エアフィルター交換                 │ │
│ │ [完了]                              │ │
│ │                                     │ │
│ │ Before: [📷写真1]                  │ │
│ │ After:  [未撮影]                    │ │
│ │ [📷 Before写真を追加]              │ │
│ │ [📷 After写真を追加]                │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ [交換部品を記録]                        │
│                                          │
│ [作業完了]                               │
└─────────────────────────────────────────┘
```

### 4-2. コンポーネント設計

#### 4-2-1. 作業項目カード

**目的**: 承認された作業項目を表示・管理

**表示内容**:
- 項目名
- 状態（作業中/完了）
- Before写真（複数枚可能）
- After写真（複数枚可能）
- コメント
- 完了ボタン

**UI/UXのポイント**:
- 完了した項目はチェックマーク（✅）を表示
- 作業中の項目は時計アイコン（⏳）を表示
- Before/After写真は並べて比較表示
- 写真はタップで拡大表示
- 写真追加ボタンは大きく表示（タッチしやすい）

#### 4-2-2. 進捗バー

**目的**: 作業全体の進捗を可視化

**表示内容**:
- 完了項目数 / 全項目数
- 進捗パーセンテージ
- プログレスバー

#### 4-2-3. 交換部品記録ボタン

**目的**: 交換部品記録画面への遷移

**表示内容**:
- アイコン（🔧）
- ラベル「交換部品を記録」
- 記録済み部品数（バッジ）

#### 4-2-4. 作業完了ボタン

**目的**: 作業を完了し、分解整備記録簿（PDF）を生成

**UI/UXのポイント**:
- 全ての項目が完了していない場合、警告を表示
- 確認ダイアログを表示
- 完了後、PDFを生成してGoogle Driveに保存
- フロントスタッフに通知

---

## 5. 顧客向け承認画面の詳細設計

### 5-1. 画面構成

```
┌─────────────────────────────────────────┐
│ 田中様 BMW X3 お見積もり                │
├─────────────────────────────────────────┤
│ 📋 法定費用（必須）                      │
│ ┌─────────────────────────────────────┐ │
│ │ 車検（24ヶ月）        ¥66,000      │ │
│ │ 自動車重量税          ¥24,600      │ │
│ │ 自賠責保険料          ¥17,650      │ │
│ │ 印紙代                ¥2,300       │ │
│ │ 代行手数料            ¥19,800      │ │
│ │ ──────────────────────────────── │ │
│ │ 法定費用合計          ¥135,750     │ │
│ │ 🔒 この項目は必須です                │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 🔧 推奨整備（選択可能）                  │
│ ┌─────────────────────────────────────┐ │
│ │ ☑ フロントブレーキパッド交換         │ │
│ │    [📷写真] 残り2mm                  │ │
│ │    💬 パッド残量2mm。危険です。      │ │
│ │    ¥33,000                           │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ ☐ エアフィルター交換                 │ │
│ │    [📷写真] 汚れあり                  │ │
│ │    💬 交換推奨です。                 │ │
│ │    ¥5,000                            │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ ...（スクロール可能）                    │
├─────────────────────────────────────────┤
│ 💰 お支払い合計（税込）                  │
│        ¥168,750                         │
│                                          │
│ [この内容で作業を依頼する]                │
└─────────────────────────────────────────┘
```

### 5-2. UI/UXのポイント

1. **法定費用の明確な表示**
   - 必須であることを明示（🔒アイコン）
   - 編集不可であることを視覚的に示す

2. **推奨整備の選択**
   - チェックボックスで選択/解除
   - デフォルトはON（推奨）
   - 写真とコメントを表示
   - 金額を表示

3. **リアルタイム計算**
   - 項目の選択/解除で合計金額がリアルタイムに更新
   - アニメーションで金額が変わる

4. **承認ボタン**
   - 画面下部に固定（スティッキーフッター）
   - 大きなボタンでタッチしやすい
   - 承認時に確認ダイアログ

---

## 6. データフロー詳細

### 6-1. 診断開始から完了まで

```
1. 整備士が診断画面を開く
   ↓
2. 車両情報を自動取得
   - Google Sheets「【DB】車両マスタ」から取得
   - 車両ID（ZohoJob.field6.Name）をキーに検索
   ↓
3. 検査項目テンプレートを取得
   - PDFテンプレートから解析、またはマスタデータから取得
   - 6つのカテゴリに分類
   ↓
4. 整備士が各項目を入力
   - カテゴリごとに入力
   - 各項目の状態を選択
   - 測定値を入力
   - 写真を撮影
   - 自動保存（各項目入力時）
   ↓
5. 診断完了ボタンを押す
   ↓
6. バリデーション
   - 必須項目のチェック
   - 測定値の範囲チェック
   ↓
7. データを保存
   - Zoho CRMのfield7（詳細情報）に診断結果を保存
   - 写真をGoogle Driveにアップロード
   - field19（お客様共有フォルダ）にフォルダURLを保存
   ↓
8. ステータス更新
   - Zoho CRMのfield5（工程ステージ）を「見積作成待ち」に更新
   ↓
9. フロントスタッフに通知
```

### 6-2. 見積もり作成から顧客承認まで

```
1. フロントスタッフが見積もり画面を開く
   ↓
2. 法定費用を自動取得
   - Google Sheets「【DB】車両マスタ」内の「車両_同期用」シートから取得
   - 車両IDをキーに検索
   ↓
3. 診断結果を取得
   - Zoho CRMのfield7（詳細情報）から取得
   ↓
4. 部品代・工賃の項目を追加
   - 診断結果から自動で項目を追加（「要交換」「注意」と判定された項目）
   - フロントスタッフが手動で項目を追加・編集
   ↓
5. 金額を入力
   - 基幹システムから転記
   - 各項目に写真とコメントを紐付け
   ↓
6. プレビューで確認
   ↓
7. 顧客に送信
   - LINE/メール/SMSで送信
   ↓
8. 顧客が承認
   ↓
9. 承認された項目を保存
   - Zoho CRMのfield13（作業内容）に承認された項目を保存
   - field5（工程ステージ）を「作業待ち」に更新
   ↓
10. 整備士に通知
```

### 6-3. 作業完了からPDF出力まで

```
1. 整備士が作業画面を開く
   ↓
2. 承認された項目のみ表示
   - Zoho CRMのfield13（作業内容）から取得
   ↓
3. 各項目の作業を実施
   - Before/After写真を撮影
   - コメントを入力
   ↓
4. 交換部品を記録
   - 実際に交換した部品を記録
   ↓
5. 作業完了ボタンを押す
   ↓
6. 分解整備記録簿（PDF）を生成
   - 入力した検査項目をPDFテンプレートに転記
   - 測定値を転記
   - 交換部品を転記
   - 車両情報を自動入力
   - 整備主任者の氏名を記録
   - 点検(整備)時の総走行距離を記録
   ↓
7. PDFをGoogle Driveに保存
   - フォルダ構造: Drive/車両写真/[年]/[月]/[日付]_[顧客名]_[車両]_[ナンバー]/00_書類/
   - ファイル名: 分解整備記録簿_[日付]_[車両名].pdf
   ↓
8. Zoho CRMに保存
   - field19（お客様共有フォルダ）にPDFのURLを保存
   - field5（工程ステージ）を「出庫待ち」に更新
   ↓
9. フロントスタッフに通知
```

---

## 7. エラーハンドリング

### 7-1. データ取得エラー

**車両情報が取得できない場合**:
- エラーメッセージを表示
- 手動で車両情報を入力可能にする（フォールバック）

**法定費用が取得できない場合**:
- エラーメッセージを表示
- 手動で法定費用を入力可能にする（フォールバック）

### 7-2. 入力エラー

**必須項目が未入力の場合**:
- リアルタイムバリデーション
- エラーメッセージを表示
- エラーがある項目をハイライト

**測定値の範囲外の場合**:
- リアルタイムバリデーション
- 警告メッセージを表示
- 推奨値を表示

### 7-3. ネットワークエラー

**オフライン時**:
- オフライン状態を明示的に表示
- ローカルストレージに保存
- オンライン復帰時に自動同期

**アップロード失敗時**:
- エラーメッセージを表示
- リトライボタンを表示
- バックグラウンドで再試行

---

## 8. パフォーマンス最適化

### 8-1. データ読み込み

- **遅延読み込み**: カテゴリごとにデータを読み込む
- **キャッシュ**: 検査項目テンプレートをキャッシュ
- **プリフェッチ**: 次のカテゴリのデータを事前に読み込む

### 8-2. 画像処理

- **圧縮**: クライアント側で画像を圧縮（300KB〜500KB）
- **サムネイル**: 一覧表示ではサムネイルを使用
- **遅延読み込み**: 画像は必要になったタイミングで読み込む

### 8-3. オフライン対応

- **Service Worker**: オフライン時もアプリが動作
- **IndexedDB**: ローカルストレージにデータを保存
- **Background Sync**: オンライン復帰時に自動同期

---

## 9. アクセシビリティ

### 9-1. 視覚的アクセシビリティ

- **コントラスト比**: WCAG AA基準を満たす（4.5:1以上）
- **フォントサイズ**: 最小16px（モバイル）
- **色だけで情報を伝えない**: アイコンとテキストを併用

### 9-2. 操作のアクセシビリティ

- **タッチターゲット**: 最低48x48px
- **キーボード操作**: 可能な限りキーボード操作をサポート
- **音声入力**: コメント入力で音声入力をサポート

### 9-3. 理解のアクセシビリティ

- **明確なラベル**: 各項目に明確なラベルを表示
- **エラーメッセージ**: 分かりやすいエラーメッセージ
- **ヘルプ**: 必要に応じてヘルプテキストを表示

---

## 10. セキュリティ

### 10-1. データ保護

- **認証**: 整備士の認証（既存の整備士選択機能を活用）
- **認可**: 各ユーザーの権限に応じたアクセス制御
- **暗号化**: 通信はHTTPS、保存データは暗号化

### 10-2. データ整合性

- **バリデーション**: サーバー側でもバリデーション
- **トランザクション**: 重要な操作はトランザクションで保護
- **監査ログ**: 重要な操作はログに記録

---

## 11. 関連ドキュメント

- [統合仕様書](./INTEGRATED_SPECIFICATION.md): システム全体の統合仕様
  - 「2-3. データフローの統一」: マスタデータ同期の制約と対応方法
  - 「2-4. 複数作業管理の実装」: 複数作業管理の実装方法
  - 「4-2-6. 請求書統合フロー」: 基幹システムでの統合請求書作成手順
- [システム進化計画](./SYSTEM_EVOLUTION_PLAN.md): 基幹システム制約下での設計変更方針
- [ユーザーワークフロー詳細設計 v2.0](./USER_WORKFLOW_DETAILED_DESIGN_V2.md): ユーザー別業務・システム利用詳細設計

**マスタデータ同期の制約**:
- 車両マスタ・顧客マスタはGoogle Sheets経由で取得（基幹システムからGAS経由で同期）
- マスタデータの更新は基幹システムで実施（Webアプリからは更新不可）
- データ不整合が発生した場合は、「Human Middleware」（スタッフ）が基幹システムを修正

---

## 更新履歴

- 2025-01-XX: 初版作成
- 2025-01-XX: 動画機能と診断時の部品リストアップ機能を追加
- 2025-01-XX: 基幹システム連携フローを追加、関連ドキュメントへの参照を追加



























