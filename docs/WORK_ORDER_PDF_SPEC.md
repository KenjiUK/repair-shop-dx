# 作業指示書PDF出力機能仕様

**作成日:** 2024年
**目的:** 診断前・作業前の作業指示書PDF出力機能の詳細仕様

---

## 概要

入庫時の診断前、作業前に内容をPDFで作業指示書を印刷できるようにします。アナログ整備士もいるため、導入時は紙とダブルで使用する運用を想定します。

---

## 業務要件

### 使用タイミング

1. **診断前**
   - 入庫後、診断を開始する前
   - 作業指示内容を整備士に伝えるため

2. **作業前**
   - 見積承認後、作業を開始する前
   - 作業内容を整備士に伝えるため

### 運用方針

- **導入時:** 紙とダブルで使用（アナログ整備士への配慮）
- **将来的:** デジタル化が進めば紙は不要になる可能性

---

## 実装仕様

### PDF内容

#### 基本情報
- 顧客名
- 車両情報（車名、ナンバープレート）
- 入庫日時
- サービス種別
- 担当整備士（設定されている場合）

#### 作業指示内容
- 作業指示書（`field` フィールドの内容）
- 顧客からの申し送り事項（`field7` の内容）
- 診断結果（診断前の場合は空欄）

#### レイアウト
- A4サイズ
- 印刷しやすいレイアウト
- 既存の請求書PDFと統一感のあるデザイン

### 実装場所

#### PDF生成ライブラリ
- `src/lib/work-order-pdf-generator.ts` - 新規ファイル

#### PDF出力ボタン
- `src/components/features/job-card.tsx` - ジョブカードに「作業指示書を印刷」ボタン
- `src/app/mechanic/diagnosis/[id]/page.tsx` - 診断画面に「作業指示書を印刷」ボタン
- `src/app/mechanic/work/[id]/page.tsx` - 作業画面に「作業指示書を印刷」ボタン

### UI構成

```
┌─────────────────────────────────────┐
│ ジョブカード                        │
├─────────────────────────────────────┤
│                                     │
│  田中様  BMW X3                     │
│                                     │
│  [📄 作業指示書を印刷] ボタン       │
│                                     │
└─────────────────────────────────────┘
```

### PDF生成ライブラリ

#### 推奨ライブラリ
- `react-pdf` / `@react-pdf/renderer` - ReactでPDFを生成（推奨）
- または `jspdf` - シンプルなPDF生成

#### 実装方針
- クライアント側でPDFを生成（サーバー負荷を減らす）
- 既存のPDF生成機能（請求書PDFなど）を参考にする
- ブラウザの印刷機能（window.print()）も検討

### PDFレイアウトイメージ

```
┌─────────────────────────────────────┐
│ 作業指示書                          │
├─────────────────────────────────────┤
│                                     │
│  顧客名: 田中 太郎                   │
│  車両: BMW X3 / 品川 300 あ 1234    │
│  入庫日時: 2024年1月10日 10:00     │
│  サービス種別: 車検                  │
│  担当整備士: 山田整備士             │
│                                     │
│  ────────────────────────────────  │
│                                     │
│  📋 作業指示内容                    │
│                                     │
│  [作業指示書の内容をここに表示]    │
│                                     │
│  ────────────────────────────────  │
│                                     │
│  📝 顧客からの申し送り事項          │
│                                     │
│  [申し送り事項の内容をここに表示]  │
│                                     │
│  ────────────────────────────────  │
│                                     │
│  生成日時: 2024年1月10日 10:15    │
│                                     │
└─────────────────────────────────────┘
```

---

## データ構造

### WorkOrderPDFData型

```typescript
export interface WorkOrderPDFData {
  /** ジョブID */
  jobId: string;
  
  /** 顧客名 */
  customerName: string;
  
  /** 車両情報 */
  vehicleInfo: {
    name: string; // 車名
    licensePlate: string; // ナンバープレート
  };
  
  /** 入庫日時 */
  entryDate: string; // ISO8601
  
  /** 作業指示内容 */
  workOrder: string | null;
  
  /** サービス種別 */
  serviceKind: ServiceKind;
  
  /** 担当整備士 */
  assignedMechanic?: string | null;
  
  /** 顧客からの申し送り事項 */
  customerNotes?: string | null;
  
  /** 生成日時 */
  generatedAt: string; // ISO8601
}
```

---

## 実装優先順位

### 第3フェーズ（低優先度・既存機能拡張）

- **作業指示書PDF出力機能** - 約1-2日
  - PDF生成ライブラリの導入
  - 作業指示書PDF生成
  - PDF出力ボタンの追加

---

## 実装のポイント

- ✅ クライアント側でPDFを生成（サーバー負荷を減らす）
- ✅ 印刷しやすいレイアウト（A4サイズ）
- ✅ 既存のPDF生成機能を参考にする
- ✅ 診断前・作業前の両方に対応
- ✅ アナログ整備士への配慮（紙とダブルで使用）

---

## 参照

- 既存のPDF生成機能: `src/lib/inspection-pdf-generator.ts` などを参考にする







