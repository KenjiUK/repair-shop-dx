# 「その他」業務 画面設計書

## ドキュメント情報

- **作成日**: 2025-01-XX
- **バージョン**: 1.0
- **対象**: 「その他」業務の各画面の詳細設計
- **設計方針**: 世界最高のUI/UX、ITコンサルの目線での推奨を元に設計
- **業務フローパターン**: パターンA（入庫→診断→見積→承認→作業）
- **注意**: 必要最小限の構造で多様な業務に対応、カスタマイズ可能な診断項目・見積項目・作業項目、自由入力形式、PDF生成不要

---

## 複数作業管理対応

この画面設計書は、1つの入庫に対して複数の作業を管理する「複数作業管理」に対応しています。

**対応内容**:
- 各画面は特定のワークオーダー（作業）に対応
- URLパラメータ `workOrderId` で対象ワークオーダーを識別
- 画面ヘッダーに現在の作業名を表示
- 「他の作業を表示」ボタンで同じJobの他のワークオーダーに切替可能
- データはZoho CRM `field_work_orders` フィールドに作業ごとに保存
- **柔軟な対応**: 「その他」業務は多様な作業に対応するため、柔軟なデータ構造を採用

**詳細は [統合仕様書](./INTEGRATED_SPECIFICATION.md) の「2-4. 複数作業管理の実装」を参照してください。**

---

## 1. 画面一覧

### 1-1. フロントスタッフ向け画面

1. **受付画面** (`/admin/reception/[id]`)
   - 業務内容の種類入力（自由入力）
   - 業務内容の詳細入力（自由入力）
   - 走行距離の入力

### 1-2. 整備士向け画面

1. **診断画面** (`/mechanic/diagnosis/[id]`)
   - カスタマイズ可能な診断項目の入力（自由入力）
   - 必要に応じて写真を撮影（任意）
   - コメント入力

2. **見積画面** (`/admin/estimate/[id]`)
   - カスタマイズ可能な見積項目の入力（自由入力）
   - 必要に応じて部品リストを追加（任意）
   - 見積金額の自動計算

3. **作業画面** (`/mechanic/work/[id]`)
   - 作業内容の自由入力
   - 必要に応じて写真を撮影（任意）
   - 必要に応じて部品を記録（任意）
   - 作業時間の記録

### 1-3. 特徴

- **汎用的なフォーマット**: 必要最小限の構造で、多様な業務に対応
- **カスタマイズ可能**: 診断項目・見積項目・作業項目を動的に設定
- **自由入力形式**: 必須項目は最小限に抑える
- **柔軟な対応**: 写真撮影、部品管理などは任意
- **シンプルなフロー**: 基本的なフロー（入庫→診断→見積→承認→作業→引渡）
- **PDF生成不要**: 作業記録はシステム内で管理

---

## 2. 受付画面の詳細設計

### 2-1. 画面構成

#### レイアウト構造

```
┌─────────────────────────────────────────┐
│ [←] 田中様 BMW X3 「その他」業務受付       │
├─────────────────────────────────────────┤
│ 📋 車両情報（自動入力済み・編集不可）     │
│ ┌─────────────────────────────────────┐ │
│ │ 登録番号: 堺 330 す 1669            │ │
│ │ 車台番号: VF3CUHNZTHY061316         │ │
│ │ 初度登録: H29.10                    │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📝 業務内容                             │
│ ┌─────────────────────────────────────┐ │
│ │ 業務内容の種類:                     │ │
│ │ [________________________]         │ │
│ │                                      │ │
│ │ 例: 洗車・ワックス、名義変更代行、   │ │
│ │     その他の一般的な修理など         │ │
│ │                                      │ │
│ │ 業務内容の詳細:                     │ │
│ │ ─────────────────────────────────── │ │
│ │                                     │ │
│ │  どのような業務を希望しますか？      │ │
│ │  業務内容の詳細を入力してください。  │ │
│ │                                     │ │
│ │  （複数行入力可能）                 │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📏 走行距離                            │
│ ┌─────────────────────────────────────┐ │
│ │ 現在の走行距離: [____] km           │ │
│ │                                      │ │
│ │ 前回「その他」業務履歴:              │ │
│ │ 2024年8月: 洗車・ワックス            │ │
│ │ 2024年3月: 名義変更代行             │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📝 備考                                │
│ ┌─────────────────────────────────────┐ │
│ │                                     │ │
│ │  その他の情報、特記事項など          │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│           [入庫確定]                    │
└─────────────────────────────────────────┘
```

### 2-2. コンポーネント設計

#### 業務内容セクション

**目的**: 業務内容の種類と詳細を自由入力で記録

**UI要素**:
- **業務内容の種類入力**: テキスト入力（自由入力）
  - 例: 洗車・ワックス、名義変更代行、その他の一般的な修理など
- **業務内容の詳細入力**: テキストエリア（自由入力、複数行入力可能）

**バリデーション**:
- 業務内容の種類は必須
- 業務内容の詳細は推奨（任意）

**動作**:
- 業務内容の種類と詳細を記録
- 後続の診断・見積・作業画面で参照可能

#### 走行距離セクション

**目的**: 現在の走行距離を記録し、前回の「その他」業務履歴を表示

**UI要素**:
- **走行距離入力**: 数値入力フィールド（km単位）
- **前回履歴表示**: 過去の「その他」業務履歴をリスト表示

**データソース**:
- 前回履歴: Zoho CRMから取得（同じ車両IDの過去の「その他」ジョブ）

### 2-3. データフロー

1. **画面表示時**:
   - 車両情報を自動入力（編集不可）
   - 前回「その他」業務履歴を取得して表示

2. **入庫確定時**:
   - 業務内容の種類、業務内容の詳細、走行距離を保存
   - Jobステータスを「診断中」に更新

---

## 3. 診断画面の詳細設計

### 3-1. 画面構成

#### レイアウト構造

```
┌─────────────────────────────────────────┐
│ [←] 田中様 BMW X3 「その他」業務診断        │
├─────────────────────────────────────────┤
│ 📋 車両情報（参照のみ）                  │
│ ┌─────────────────────────────────────┐ │
│ │ 登録番号: 堺 330 す 1669            │ │
│ │ 走行距離: 45,000 km                 │ │
│ │ 業務内容: 洗車・ワックス             │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 🔍 診断項目                             │
│ ┌─────────────────────────────────────┐ │
│ │ [+ 診断項目を追加]                  │ │
│ │                                      │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ 診断項目 #1                     │ │ │
│ │ │                                │ │ │
│ │ │ 項目名: [________________]      │ │ │
│ │ │                                │ │ │
│ │ │ 状態: [________________]        │ │ │
│ │ │                                │ │ │
│ │ │ 📷 写真: [写真を撮影]          │ │ │
│ │ │ [画像プレビュー]                │ │ │
│ │ │  （任意）                       │ │ │
│ │ │                                │ │ │
│ │ │ コメント:                       │ │ │
│ │ │ ────────────────────────────── │ │ │
│ │ │                                │ │ │
│ │ │ [削除]                          │ │ │
│ │ └────────────────────────────────┘ │ │
│ │                                      │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ 診断項目 #2                     │ │ │
│ │ │ ...                            │ │ │
│ │ └────────────────────────────────┘ │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📷 診断写真（全体）                     │
│ ┌─────────────────────────────────────┐ │
│ │ [写真を撮影]                        │ │
│ │                                      │ │
│ │ [画像1] [画像2]                     │ │
│ │                                      │ │
│ │ （任意）                             │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📝 整備士の所見                        │
│ ┌─────────────────────────────────────┐ │
│ │                                     │ │
│ │  診断結果、特記事項など              │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│           [診断完了]                    │
└─────────────────────────────────────────┘
```

### 3-2. コンポーネント設計

#### 診断項目セクション

**目的**: カスタマイズ可能な診断項目を自由入力で記録

**UI要素**:
- **診断項目追加ボタン**: 「+ 診断項目を追加」ボタン
- **診断項目カード**: 各項目ごとにカード表示
  - **項目名入力**: テキスト入力（自由入力）
  - **状態入力**: テキスト入力（自由入力）
  - **写真撮影**: カメラボタン（任意）
    - 画像プレビュー表示
  - **コメント入力**: テキストエリア（任意）
  - **削除ボタン**: 項目を削除

**バリデーション**:
- 診断項目は最低1項目推奨（任意）
- 項目名と状態は推奨（任意）

**動作**:
- 診断項目を動的に追加・削除可能
- 業務内容に応じて、診断項目を自由に設定

#### 診断写真（全体）セクション

**目的**: 診断時の写真を撮影（任意）

**UI要素**:
- **写真撮影ボタン**: カメラボタン
- **画像プレビュー**: 撮影した写真をプレビュー表示

**動作**:
- 写真撮影は任意（必須ではない）
- 必要に応じて複数枚撮影可能

### 3-3. データフロー

1. **画面表示時**:
   - 車両情報を表示
   - 業務内容を表示
   - 既存の診断情報を表示（あれば）

2. **診断項目追加時**:
   - 新しい診断項目カードを追加

3. **診断完了時**:
   - 診断項目、診断写真、コメントを保存
   - Jobステータスを「見積作成待ち」に更新

---

## 4. 見積画面の詳細設計

### 4-1. 画面構成

#### レイアウト構造

```
┌─────────────────────────────────────────┐
│ [←] 田中様 BMW X3 「その他」業務見積        │
├─────────────────────────────────────────┤
│ 📋 車両情報（参照のみ）                  │
│ ┌─────────────────────────────────────┐ │
│ │ 登録番号: 堺 330 す 1669            │ │
│ │ 走行距離: 45,000 km                 │ │
│ │ 業務内容: 洗車・ワックス             │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 💰 見積もり項目                         │
│ ┌─────────────────────────────────────┐ │
│ │ [+ 見積もり項目を追加]              │ │
│ │                                      │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ 項目名: [洗車]                  │ │ │
│ │ │ 数量: [1] 単価: [3,000] 円     │ │ │
│ │ │ 金額: [3,000] 円               │ │ │
│ │ │                                │ │ │
│ │ │ 備考:                           │ │ │
│ │ │ ────────────────────────────── │ │ │
│ │ │                                │ │ │
│ │ │ [削除]                          │ │ │
│ │ └────────────────────────────────┘ │ │
│ │                                      │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ 項目名: [ワックス]              │ │ │
│ │ │ 数量: [1] 単価: [5,000] 円     │ │ │
│ │ │ 金額: [5,000] 円               │ │ │
│ │ │                                │ │ │
│ │ │ 備考:                           │ │ │
│ │ │ ────────────────────────────── │ │ │
│ │ │                                │ │ │
│ │ │ [削除]                          │ │ │
│ │ └────────────────────────────────┘ │ │
│ │                                      │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ 小計: 8,000円                   │ │ │
│ │ │ 消費税(10%): 800円             │ │ │
│ │ │ ────────────────────────────── │ │ │
│ │ │ 合計: 8,800円                   │ │ │
│ │ └────────────────────────────────┘ │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 🔧 部品リスト（必要に応じて）            │
│ ┌─────────────────────────────────────┐ │
│ │ [+ 部品を追加]                      │ │
│ │                                      │ │
│ │ （部品が必要な場合のみ使用）          │ │
│ │                                      │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ 部品名: [ワックス剤]            │ │ │
│ │ │ 数量: [1] 単価: [2,000] 円    │ │ │
│ │ │ 金額: [2,000] 円               │ │ │
│ │ │                                │ │ │
│ │ │ 備考:                           │ │ │
│ │ │ ────────────────────────────── │ │ │
│ │ │                                │ │ │
│ │ │ [削除]                          │ │ │
│ │ └────────────────────────────────┘ │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📝 備考                                │
│ ┌─────────────────────────────────────┐ │
│ │                                     │ │
│ │  顧客への説明事項など                │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│           [見積もり確定]                │
└─────────────────────────────────────────┘
```

### 4-2. コンポーネント設計

#### 見積もり項目セクション

**目的**: カスタマイズ可能な見積項目を自由入力で記録

**基幹システム連携フロー**:
1. アドバイザー（フロントスタッフ）がWebアプリの見積作成画面を開く
2. 業務内容と診断情報を確認
3. **基幹システム（スマートカーディーラー）で該当作業の見積書を作成**（アドバイザーが実施）
4. **Webアプリに「品名」と「金額（税込）」を転記**（アドバイザーが実施）
5. 見積情報を保存（Zoho CRM field_work_orders内の該当作業の見積情報を更新）

**制約**:
- 見積計算は基幹システムで実施（Webアプリは転記のみ）
- 「その他」業務のため、柔軟な見積項目入力が必要

**UI要素**:
- **見積もり項目追加ボタン**: 「+ 見積もり項目を追加」ボタン
- **見積もり項目カード**: 各項目ごとにカード表示
  - **項目名入力**: テキスト入力（自由入力）
  - **数量入力**: 数値入力
  - **単価入力**: 数値入力（円単位）
  - **金額表示**: 自動計算（数量 × 単価）
  - **備考入力**: テキストエリア（任意）
  - **削除ボタン**: 項目を削除
- **小計表示**: 自動計算
- **消費税表示**: 自動計算（小計 × 10%）
- **合計表示**: 自動計算（小計 + 消費税）

**バリデーション**:
- 見積もり項目は最低1項目必須
- 各項目の項目名、数量、単価は必須
- 数量と単価は0より大きい値

**動作**:
- 見積項目を動的に追加・削除可能
- 業務内容に応じて、見積項目を自由に設定
- 金額は自動計算

#### 部品リストセクション

**目的**: 必要に応じて部品リストを追加（任意）

**UI要素**:
- **部品追加ボタン**: 「+ 部品を追加」ボタン
- **部品カード**: 各部品ごとにカード表示
  - **部品名入力**: テキスト入力（自由入力）
  - **数量入力**: 数値入力
  - **単価入力**: 数値入力（円単位）
  - **金額表示**: 自動計算（数量 × 単価）
  - **備考入力**: テキストエリア（任意）
  - **削除ボタン**: 部品を削除

**バリデーション**:
- 部品名、数量、単価は必須（部品を追加した場合）
- 数量と単価は0より大きい値

**動作**:
- 部品リストは任意（必要に応じて追加）
- 部品を追加した場合、見積合計に含める（オプション）

**表示条件**:
- 部品リストセクションは、部品を追加した場合のみ表示（または常に表示して、必要に応じて使用）

### 4-3. データフロー

1. **画面表示時**:
   - 車両情報を表示
   - 業務内容を表示
   - 診断情報を表示（参照のみ）
   - 既存の見積もり情報を表示（あれば）

2. **見積もり項目追加時**:
   - 新しい見積もり項目カードを追加
   - 金額を自動計算

3. **部品追加時**:
   - 新しい部品カードを追加
   - 金額を自動計算

4. **見積もり確定時**:
   - 見積もり情報を保存
   - Jobステータスを「顧客承認待ち」に更新

---

## 5. 作業画面の詳細設計

### 5-1. 画面構成

#### レイアウト構造

```
┌─────────────────────────────────────────┐
│ [←] 田中様 BMW X3 「その他」業務作業        │
├─────────────────────────────────────────┤
│ 📋 車両情報（参照のみ）                  │
│ ┌─────────────────────────────────────┐ │
│ │ 登録番号: 堺 330 す 1669            │ │
│ │ 走行距離: 45,000 km                 │ │
│ │ 業務内容: 洗車・ワックス             │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📄 見積もり内容（参照のみ）              │
│ ┌─────────────────────────────────────┐ │
│ │ 見積合計: 8,800円                   │ │
│ │                                      │ │
│ │ 見積項目:                            │ │
│ │ - 洗車: 3,000円                      │ │
│ │ - ワックス: 5,000円                  │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 🔧 作業内容                             │
│ ┌─────────────────────────────────────┐ │
│ │                                     │ │
│ │  実施した作業内容を入力してください。 │ │
│ │                                     │ │
│ │  例:                                 │ │
│ │  - 車体の洗車を実施                  │ │
│ │  - ワックスを塗布                    │ │
│ │  - 内装のクリーニングを実施          │ │
│ │                                     │ │
│ │  （複数行入力可能）                  │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📷 作業写真（任意）                     │
│ ┌─────────────────────────────────────┐ │
│ │ [写真を撮影]                        │ │
│ │                                      │ │
│ │ [画像1] [画像2]                     │ │
│ │                                      │ │
│ │ （任意）                             │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 🔧 使用した部品（必要に応じて）           │
│ ┌─────────────────────────────────────┐ │
│ │ [+ 部品を追加]                      │ │
│ │                                      │ │
│ │ （部品を使用した場合のみ記録）        │ │
│ │                                      │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ 部品名: [ワックス剤]            │ │ │
│ │ │ 数量: [1] 単価: [2,000] 円    │ │ │
│ │ │ 金額: [2,000] 円               │ │ │
│ │ │                                │ │ │
│ │ │ 備考:                           │ │ │
│ │ │ ────────────────────────────── │ │ │
│ │ │                                │ │ │
│ │ │ [削除]                          │ │ │
│ │ └────────────────────────────────┘ │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ ⏱️ 作業時間                             │
│ ┌─────────────────────────────────────┐ │
│ │ 作業時間: [2.5] 時間                 │ │
│ │                                      │ │
│ │ （実施した作業にかかった時間）        │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📝 作業メモ                             │
│ ┌─────────────────────────────────────┐ │
│ │                                     │ │
│ │  作業時の特記事項、注意事項など      │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│           [作業完了]                    │
└─────────────────────────────────────────┘
```

### 5-2. コンポーネント設計

#### 作業内容セクション

**目的**: 実施した作業内容を自由入力で記録

**UI要素**:
- **作業内容入力**: テキストエリア（自由入力、複数行入力可能）

**バリデーション**:
- 作業内容は必須

**動作**:
- 作業内容を自由に入力
- 箇条書きや詳細な説明など、自由な形式で記録可能

#### 作業写真セクション

**目的**: 作業時の写真を撮影（任意）

**UI要素**:
- **写真撮影ボタン**: カメラボタン
- **画像プレビュー**: 撮影した写真をプレビュー表示

**動作**:
- 写真撮影は任意（必須ではない）
- 必要に応じて複数枚撮影可能

#### 使用した部品セクション

**目的**: 必要に応じて使用した部品を記録（任意）

**UI要素**:
- **部品追加ボタン**: 「+ 部品を追加」ボタン
- **部品カード**: 各部品ごとにカード表示
  - **部品名入力**: テキスト入力（自由入力）
  - **数量入力**: 数値入力
  - **単価入力**: 数値入力（円単位）
  - **金額表示**: 自動計算（数量 × 単価）
  - **備考入力**: テキストエリア（任意）
  - **削除ボタン**: 部品を削除

**バリデーション**:
- 部品名、数量、単価は必須（部品を追加した場合）
- 数量と単価は0より大きい値

**動作**:
- 使用した部品は任意（必要に応じて記録）
- 見積画面で登録した部品から選択することも可能（オプション）

#### 作業時間セクション

**目的**: 実施した作業にかかった時間を記録

**UI要素**:
- **作業時間入力**: 数値入力（時間単位、小数点以下も可）

**バリデーション**:
- 作業時間は必須
- 作業時間は0より大きい値

### 5-3. データフロー

1. **画面表示時**:
   - 車両情報を表示
   - 業務内容を表示
   - 見積もり内容を表示（参照のみ）
   - 既存の作業情報を表示（あれば）

2. **作業完了時**:
   - 作業内容、作業写真、使用した部品、作業時間、作業メモを保存
   - Jobステータスを「出庫待ち」に更新

---

## 6. 引渡画面の詳細設計

### 6-1. 画面構成

#### レイアウト構造

```
┌─────────────────────────────────────────┐
│ [←] 田中様 BMW X3 「その他」業務引渡       │
├─────────────────────────────────────────┤
│ 📋 車両情報（参照のみ）                  │
│ ┌─────────────────────────────────────┐ │
│ │ 登録番号: 堺 330 す 1669            │ │
│ │ 走行距離: 45,000 km                 │ │
│ │ 業務内容: 洗車・ワックス             │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📄 作業完了サマリー                     │
│ ┌─────────────────────────────────────┐ │
│ │ 業務内容: 洗車・ワックス             │ │
│ │ 作業時間: 2.5時間                    │ │
│ │ 見積合計: 8,800円                   │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 🔧 実施した作業内容                     │
│ ┌─────────────────────────────────────┐ │
│ │ - 車体の洗車を実施                  │ │
│ │ - ワックスを塗布                    │ │
│ │ - 内装のクリーニングを実施          │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📷 作業写真（撮影した場合）              │
│ ┌─────────────────────────────────────┐ │
│ │ [画像1] [画像2]                     │ │
│ │                                      │ │
│ │ （作業時に撮影した写真）             │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 💰 見積もり内容                         │
│ ┌─────────────────────────────────────┐ │
│ │ 見積項目:                            │ │
│ │ - 洗車: 3,000円                      │ │
│ │ - ワックス: 5,000円                  │ │
│ │                                      │ │
│ │ 小計: 8,000円                        │ │
│ │ 消費税(10%): 800円                  │ │
│ │ ──────────────────────────────      │ │
│ │ 合計: 8,800円                        │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📝 引渡時の説明                         │
│ ┌─────────────────────────────────────┐ │
│ │                                     │ │
│ │  顧客への説明事項、注意事項など      │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│           [引渡完了]                    │
└─────────────────────────────────────────┘
```

### 6-2. コンポーネント設計

#### 作業完了サマリーセクション

**目的**: 作業完了のサマリーを表示

**UI要素**:
- **業務内容表示**: テキスト表示
- **作業時間表示**: テキスト表示
- **見積合計表示**: テキスト表示

**データソース**:
- 受付画面で入力した業務内容
- 作業画面で入力した作業時間
- 見積画面で作成した見積合計

#### 実施した作業内容セクション

**目的**: 実施した作業内容を表示

**UI要素**:
- **作業内容表示**: テキスト表示（作業画面で入力した内容）

#### 作業写真セクション

**目的**: 作業時に撮影した写真を表示（撮影した場合）

**UI要素**:
- **画像ギャラリー**: 作業画面で撮影した写真を表示

**表示条件**:
- 作業時に写真を撮影した場合のみ表示

#### 見積もり内容セクション

**目的**: 見積もり内容を表示

**UI要素**:
- **見積項目リスト**: 見積画面で作成した見積項目をリスト表示
- **小計表示**: テキスト表示
- **消費税表示**: テキスト表示
- **合計表示**: テキスト表示

### 6-3. データフロー

1. **画面表示時**:
   - 車両情報を表示
   - 業務内容を表示
   - 作業完了サマリーを表示
   - 実施した作業内容を表示
   - 作業写真を表示（撮影した場合）
   - 見積もり内容を表示

2. **引渡完了時**:
   - Jobステータスを「出庫待ち」に更新

---

## 7. データモデル

### 7-1. OtherServiceJob

```typescript
/**
 * 「その他」ジョブ
 */
export interface OtherServiceJob {
  /** Job ID */
  jobId: string;
  /** 入庫区分 */
  serviceKind: "その他";
  
  /** 車両情報 */
  vehicle: {
    /** 車両ID */
    vehicleId: string;
    /** 走行距離 */
    mileage: number;
  };
  
  /** 業務内容 */
  serviceContent: {
    /** 業務内容の種類（自由入力） */
    type: string;
    /** 業務内容の詳細（自由入力） */
    description: string;
  };
  
  /** 診断情報 */
  diagnosis: {
    /** 診断項目（カスタマイズ可能） */
    items: CustomDiagnosisItem[];
    /** 診断写真 */
    photos: Photo[];
    /** コメント（整備士の所見） */
    comments: string;
  };
  
  /** 見積情報 */
  estimate: {
    /** 見積もり項目（カスタマイズ可能） */
    items: EstimateItem[];
    /** 部品リスト（必要に応じて） */
    parts?: PartItem[];
    /** 小計 */
    subtotal: number;
    /** 消費税 */
    tax: number;
    /** 合計金額 */
    total: number;
    /** 承認日時 */
    approvedAt?: Date;
  };
  
  /** 作業情報 */
  work: {
    /** 作業内容（自由入力） */
    workContent: string;
    /** 作業写真 */
    photos: Photo[];
    /** 使用した部品（必要に応じて） */
    usedParts?: PartItem[];
    /** 作業時間 */
    workDuration: number;
    /** 作業メモ */
    notes: string;
  };
  
  /** ステータス */
  status: "入庫待ち" | "診断中" | "見積作成待ち" | "顧客承認待ち" | "作業待ち" | "作業中" | "出庫待ち";
}

/**
 * カスタム診断項目
 */
export interface CustomDiagnosisItem {
  /** 項目名（自由入力） */
  name: string;
  /** 状態（自由入力） */
  condition: string;
  /** 写真 */
  photo?: Photo;
  /** コメント */
  comment?: string;
}

/**
 * 見積もり項目
 */
export interface EstimateItem {
  /** 項目名 */
  name: string;
  /** 数量 */
  quantity: number;
  /** 単価 */
  unitPrice: number;
  /** 金額 */
  amount: number;
  /** 備考 */
  note?: string;
}

/**
 * 部品項目
 */
export interface PartItem {
  /** 部品名 */
  name: string;
  /** 数量 */
  quantity: number;
  /** 単価 */
  unitPrice: number;
  /** 金額 */
  amount: number;
  /** 備考 */
  note?: string;
}

/**
 * 写真
 */
export interface Photo {
  /** 写真ID */
  photoId: string;
  /** ファイルパス（Google Drive） */
  filePath: string;
  /** 撮影日時 */
  takenAt: Date;
  /** 説明 */
  description?: string;
}
```

---

## 8. API設計

### 8-1. 受付画面

#### POST /api/jobs/[id]/reception

**目的**: 「その他」業務の受付情報を保存

**リクエストボディ**:
```typescript
{
  serviceContent: {
    type: string;
    description: string;
  };
  mileage: number;
  notes?: string;
}
```

**レスポンス**:
```typescript
{
  success: boolean;
  job: OtherServiceJob;
}
```

### 8-2. 診断画面

#### GET /api/jobs/[id]/diagnosis

**目的**: 診断情報を取得

**レスポンス**:
```typescript
{
  job: OtherServiceJob;
  diagnosis: OtherServiceJob["diagnosis"];
}
```

#### POST /api/jobs/[id]/diagnosis

**目的**: 診断情報を保存

**リクエストボディ**:
```typescript
{
  items: CustomDiagnosisItem[];
  photos: Photo[];
  comments: string;
}
```

**レスポンス**:
```typescript
{
  success: boolean;
  job: OtherServiceJob;
}
```

### 8-3. 見積画面

#### GET /api/jobs/[id]/estimate

**目的**: 見積情報を取得

**レスポンス**:
```typescript
{
  job: OtherServiceJob;
  estimate: OtherServiceJob["estimate"];
}
```

#### POST /api/jobs/[id]/estimate

**目的**: 見積情報を保存

**リクエストボディ**:
```typescript
{
  items: EstimateItem[];
  parts?: PartItem[];
  notes?: string;
}
```

**レスポンス**:
```typescript
{
  success: boolean;
  job: OtherServiceJob;
}
```

### 8-4. 作業画面

#### GET /api/jobs/[id]/work

**目的**: 作業情報を取得

**レスポンス**:
```typescript
{
  job: OtherServiceJob;
  work: OtherServiceJob["work"];
}
```

#### POST /api/jobs/[id]/work

**目的**: 作業情報を保存

**リクエストボディ**:
```typescript
{
  workContent: string;
  photos: Photo[];
  usedParts?: PartItem[];
  workDuration: number;
  notes: string;
}
```

**レスポンス**:
```typescript
{
  success: boolean;
  job: OtherServiceJob;
}
```

### 8-5. 引渡画面

#### GET /api/jobs/[id]/handover

**目的**: 引渡情報を取得

**レスポンス**:
```typescript
{
  job: OtherServiceJob;
}
```

#### POST /api/jobs/[id]/handover

**目的**: 引渡処理を実行

**レスポンス**:
```typescript
{
  success: boolean;
  job: OtherServiceJob;
}
```

---

## 9. ユーザージャーニー

### 9-1. 洗車・ワックスの場合

1. **受付** (フロントスタッフ)
   - 車両情報を確認
   - 業務内容の種類を「洗車・ワックス」と入力
   - 業務内容の詳細を入力
   - 走行距離を入力
   - 入庫確定

2. **診断** (整備士)
   - 車体の状態を確認
   - 診断項目を追加（例: 車体の状態、汚れの程度など）
   - 必要に応じて写真を撮影
   - 診断完了

3. **見積作成** (フロントスタッフ)
   - 見積項目を追加（例: 洗車、ワックス、内装クリーニングなど）
   - 見積金額を計算
   - 見積もり確定

4. **顧客承認** (顧客)
   - 見積もりを確認して承認

5. **作業実施** (整備士)
   - 作業内容を入力（例: 車体の洗車、ワックス塗布、内装クリーニングなど）
   - 必要に応じて写真を撮影
   - 使用した部品を記録（例: ワックス剤など）
   - 作業時間を記録
   - 作業完了

6. **引渡** (フロントスタッフ)
   - 作業完了サマリーを確認
   - 実施した作業内容を説明
   - 顧客に引渡

### 9-2. 名義変更代行の場合

1. **受付** (フロントスタッフ)
   - 車両情報を確認
   - 業務内容の種類を「名義変更代行」と入力
   - 業務内容の詳細を入力
   - 走行距離を入力
   - 入庫確定

2. **診断** (フロントスタッフ)
   - 書類の確認
   - 診断項目を追加（例: 書類の確認、必要書類の確認など）
   - 診断完了

3. **見積作成** (フロントスタッフ)
   - 見積項目を追加（例: 名義変更代行費用）
   - 見積金額を計算
   - 見積もり確定

4. **顧客承認** (顧客)
   - 見積もりを確認して承認

5. **作業実施** (フロントスタッフ)
   - 作業内容を入力（例: 書類手続きの実施）
   - 作業時間を記録
   - 作業完了

6. **引渡** (フロントスタッフ)
   - 作業完了サマリーを確認
   - 実施した作業内容を説明
   - 顧客に引渡

---

## 10. 実装上の注意点

### 10-1. 汎用的なフォーマット

- 必要最小限の構造で、多様な業務に対応
- カスタマイズ可能な診断項目・見積項目・作業項目
- 自由入力形式を基本とする

### 10-2. 柔軟な対応

- 業務内容に応じて、診断項目・見積項目・作業項目を動的に設定
- 必須項目は最小限に抑える
- 写真撮影、部品管理などは任意

### 10-3. シンプルなフロー

- 基本的なフロー（入庫→診断→見積→承認→作業→引渡）を採用
- 複雑な業務フローは避ける
- 事前見積が必要な場合は、口頭見積や簡易見積として扱う

### 10-4. PDF生成

- 「その他」業務ではPDF生成は不要
- 作業記録はシステム内で管理

---

## 11. 関連ドキュメント

- [統合仕様書](./INTEGRATED_SPECIFICATION.md): システム全体の統合仕様
  - 「2-3. データフローの統一」: マスタデータ同期の制約と対応方法
  - 「2-4. 複数作業管理の実装」: 複数作業管理の実装方法
  - 「4-2-6. 請求書統合フロー」: 基幹システムでの統合請求書作成手順
- [システム進化計画](./SYSTEM_EVOLUTION_PLAN.md): 基幹システム制約下での設計変更方針
- [ユーザーワークフロー詳細設計 v2.0](./USER_WORKFLOW_DETAILED_DESIGN_V2.md): ユーザー別業務・システム利用詳細設計

**マスタデータ同期の制約**:
- 車両マスタ・顧客マスタはGoogle Sheets経由で取得（基幹システムからGAS経由で同期）
- マスタデータの更新は基幹システムで実施（Webアプリからは更新不可）
- データ不整合が発生した場合は、「Human Middleware」（スタッフ）が基幹システムを修正

---

## 12. 更新履歴

- 2025-01-XX: 初版作成
- 2025-01-XX: 基幹システム連携フローを追加、関連ドキュメントへの参照を追加
- 2025-01-XX: マスタデータ同期の制約を追加

























