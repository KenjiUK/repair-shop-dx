# 車検（法定24ヶ月点検）完全設計仕様書

## ドキュメント情報

- **作成日**: 2025-01-XX
- **バージョン**: 1.0 Final
- **対象**: 車検（法定24ヶ月点検）の完全なシステム設計
- **設計方針**: 世界最高のUI/UX、ITコンサルの目線での推奨を元に設計
- **ステータス**: 設計完了（実装準備完了）

---

## 1. エグゼクティブサマリー

### 1-1. 設計の目的

車検（法定24ヶ月点検）業務を効率化し、整備士の作業負荷を軽減しながら、正確な記録と顧客への説明を実現する。

### 1-2. 主要な設計決定

1. **カテゴリごとの入力**: 100項目以上を6つのカテゴリに分けて入力
2. **自動保存**: 各項目入力時に自動保存、オフライン対応
3. **測定値専用画面**: 測定値は専用画面で一括入力
4. **写真は必要時のみ**: 不具合が見つかった項目のみ写真撮影
5. **PDFは作業完了時**: 全ての情報が揃った状態でPDF生成（決まったフォーマット）
6. **法定費用は自動取得**: Google Sheetsから自動取得、編集不可

**重要**: PDF生成は車検と12ヶ月点検のみ実施。その他の入庫区分（エンジンオイル交換など）ではPDF生成は不要。

### 1-3. 技術スタック

- **フロントエンド**: Next.js 16 (App Router), React, TypeScript
- **UIライブラリ**: shadcn/ui (Radix UI), Tailwind CSS 4
- **状態管理**: SWR (データフェッチ), useState (UI状態)
- **ストレージ**: Google Drive (写真・PDF), IndexedDB (オフライン)
- **データソース**: Zoho CRM, Google Sheets

---

## 2. 業務フロー詳細

### 2-1. 全体フロー

```
[Phase 0] 予約・事前準備
    ↓
[Phase 1] 来店・受付
    ↓
[Phase 2] 診断・撮影 ← 本設計の対象
    ├── 検査項目の入力（6カテゴリ）
    ├── 測定値の入力
    ├── 写真撮影（不具合箇所）
    └── 診断完了
    ↓
[Phase 3] 見積作成 ← 本設計の対象
    ├── 法定費用の自動取得
    ├── 部品代・工賃の入力
    └── 顧客への送信
    ↓
[Phase 4] 承認 ← 本設計の対象
    ├── 見積もりの確認
    ├── 項目の選択/解除
    └── 承認
    ↓
[Phase 5] 作業・出庫 ← 本設計の対象
    ├── 承認された項目のみ作業
    ├── Before/After写真
    ├── 交換部品の記録
    └── PDF生成
    ↓
[Phase 6] アフターフォロー
```

### 2-2. 各フェーズの詳細

#### Phase 2: 診断・撮影

**担当者**: 整備士

**所要時間**: 2-3時間（複数日に分散可能）

**作業内容**:
1. 車両をピットに入れる
2. 診断画面を開く
3. **6つのカテゴリごとに検査項目を入力**（タブでカテゴリを切り替え、各カテゴリの項目を入力）
   - エンジン・ルーム点検
   - 室内点検
   - 足廻り点検
   - 下廻り点検
   - 外廻り点検
   - 日常点検
4. 測定値を入力（専用画面で一括入力）
5. 不具合箇所の写真・動画を撮影
6. **交換が必要な部品をリストアップ**（音声入力対応、レコメンド機能）
   - 部品名、緊急度、推奨理由、写真・動画を入力
   - これがフロントスタッフへの「何が必要か」のインプットになる
7. 診断完了

**データ保存**:
- Zoho CRM `field7` (詳細情報): 診断結果のJSON（部品リスト含む）
- Google Drive: 写真・動画をアップロード
- Zoho CRM `field19` (お客様共有フォルダ): フォルダURL

**ステータス更新**:
- Zoho CRM `field5` (工程ステージ): 「見積作成待ち」

#### Phase 3: 見積作成

**担当者**: フロントスタッフ

**所要時間**: 30分

**作業内容**:
1. 見積もり画面を開く
2. 法定費用を確認（自動取得済み）
3. 診断結果から部品代・工賃の項目を追加
4. **オプションメニューを提案**（車検と同時実施で10%割引）
   - エンジンオイル交換（下抜き）: ¥10,560 → ¥9,504
   - クーラント交換: ¥14,740 → ¥13,266
   - バッテリー交換: ¥27,500 → ¥24,750
   - タイヤ交換作業（4本）: ¥30,800 → ¥27,720
   - ブレーキフルード交換: ¥18,590 → ¥16,731
   - ブレーキパッド交換: ¥30,800 → ¥27,720
   - ミッションオイル交換: ¥12,540 → ¥11,286
   - ATフルード交換作業: ¥79,200 → ¥71,280
5. 基幹システムから金額を転記
6. プレビューで確認
7. 顧客に送信（LINE/メール/SMS）

**データ保存**:
- Zoho CRM `field13` (作業内容): 見積もり項目（顧客承認前、オプションメニュー含む）

**ステータス更新**:
- Zoho CRM `field5` (工程ステージ): 「見積提示済み」

#### Phase 4: 承認

**担当者**: 顧客

**所要時間**: 30分-1時間

**作業内容**:
1. 承認画面を開く（LINE/メール/SMSから）
2. 法定費用を確認（必須、編集不可）
3. 推奨整備を選択/解除
4. **オプションメニューを選択/解除**（車検と同時実施で10%割引適用）
   - 各オプション項目に「車検と同時実施で10%割引」のバッジを表示
   - 割引前価格と割引後価格を併記
5. 合計金額を確認
6. 承認

**データ保存**:
- Zoho CRM `field13` (作業内容): 承認された項目のみ（オプションメニュー含む）
- Zoho CRM `field5` (工程ステージ): 「作業待ち」

**通知**:
- 整備士に通知

#### Phase 5: 作業・出庫

**担当者**: 整備士、フロントスタッフ

**所要時間**: 2-4時間（作業）+ 数日（部品調達）

**作業内容（整備士）**:
1. 作業画面を開く
2. 承認された項目のみ表示
3. 各項目の作業を実施
4. Before/After写真を撮影
5. 交換部品を記録
6. 作業完了

**作業内容（フロントスタッフ）**:
1. 車検証更新手続き
2. 更新日時を記録
3. 次回車検予定日を自動計算（2年後）
4. Google Sheets「【DB】車両マスタ」の「車検有効期限」を更新

**データ保存**:
- Google Drive: 分解整備記録簿（PDF）を保存
- Zoho CRM `field19` (お客様共有フォルダ): PDFのURL
- Zoho CRM `field5` (工程ステージ): 「出庫待ち」

**PDF生成**:
- 入力した検査項目をPDFテンプレートに転記
- 測定値を転記
- 交換部品を転記
- 車両情報を自動入力
- 整備主任者の氏名を記録
- 点検(整備)時の総走行距離を記録

---

## 3. 画面設計詳細

### 3-1. 診断画面 (`/mechanic/diagnosis/[id]`)

#### 3-1-1. 画面レイアウト

```
┌─────────────────────────────────────────────┐
│ [←] 田中様 BMW X3 車検診断                  │
│ 整備士: 中村                                 │
├─────────────────────────────────────────────┤
│ 📋 車両情報（自動入力済み・編集不可）        │
│ ┌─────────────────────────────────────────┐ │
│ │ 登録番号: 堺 330 す 1669                │ │
│ │ 車台番号: VF3CUHNZTHY061316             │ │
│ │ 初度登録: H29.10                        │ │
│ └─────────────────────────────────────────┘ │
├─────────────────────────────────────────────┤
│ [タブ] エンジン・ルーム | 室内 | 足廻り      │
│        | 下廻り | 外廻り | 日常点検          │
│ ─────────────────────────────────────────── │
│                                             │
│ [カテゴリ: エンジン・ルーム点検]            │
│ 進捗: ████████░░ 15/20項目完了 (75%)      │
│                                             │
│ ┌─────────────────────────────────────────┐ │
│ │ パワー・ステアリング                    │ │
│ │ [OK] [注意] [要交換] [調整] [清掃]       │ │
│ │ [📷 写真を追加] [💬 コメント]            │ │
│ └─────────────────────────────────────────┘ │
│                                             │
│ ┌─────────────────────────────────────────┐ │
│ │ 冷却装置                                 │ │
│ │ [OK] [注意] [要交換] [調整] [清掃]       │ │
│ └─────────────────────────────────────────┘ │
│                                             │
│ ...（スクロール可能）                       │
│                                             │
│ [測定値入力] [交換部品] [その他]           │
│                                             │
│ [一時保存] [診断完了]                       │
└─────────────────────────────────────────────┘
```

#### 3-1-2. コンポーネント仕様

**車両情報カード**:
- **データソース**: Google Sheets「【DB】車両マスタ」
- **表示項目**: 登録番号、車台番号、初度登録年
- **編集**: 不可（背景色を薄く、🔒アイコンで表示）

**カテゴリタブ**:
- **タブ数**: 6つ（横スクロール可能）
- **完了状態**: チェックマーク（✓）を表示
- **未完了**: バッジで未入力項目数を表示
- **現在のタブ**: 強調表示（背景色、下線）

**進捗バー**:
- **表示内容**: 完了項目数 / 全項目数、パーセンテージ、プログレスバー
- **色**: 0-50%: 赤、50-80%: 黄、80-100%: 緑

**検査項目カード**:
- **状態ボタン**: 7種類（OK/注意/要交換/調整/清掃/省略/該当なし）
- **ボタンサイズ**: 画面幅いっぱい、高さ48px以上
- **写真ボタン**: 撮影済みの場合、サムネイルを表示
- **コメントボタン**: コメントがある場合、アイコンで表示

**測定値入力ボタン**:
- **遷移先**: `/mechanic/diagnosis/[id]/measurements`
- **未入力**: バッジで「未入力」を表示

**交換部品ボタン**:
- **遷移先**: `/mechanic/diagnosis/[id]/parts`（作業時のみ有効）
- **記録済み**: バッジで部品数を表示

**その他ボタン**:
- **遷移先**: `/mechanic/diagnosis/[id]/other`
- **自由記述**: 複数行入力可能、音声入力対応

**一時保存ボタン**:
- **機能**: 現在の入力内容を保存
- **フィードバック**: トースト通知（「保存しました」）

**診断完了ボタン**:
- **バリデーション**: 全てのカテゴリが完了しているかチェック
- **確認ダイアログ**: 「診断を完了しますか？」
- **完了後**: フロントスタッフに通知

#### 3-1-3. 状態管理

```typescript
interface DiagnosisPageState {
  // 車両情報
  vehicleInfo: VehicleInfo | null;
  
  // 検査項目テンプレート
  inspectionTemplate: InspectionTemplate | null;
  
  // 診断データ
  inspectionData: InspectionData | null;
  
  // 現在のカテゴリ
  currentCategory: InspectionCategory;
  
  // 読み込み状態
  isLoading: boolean;
  
  // エラー
  error: string | null;
  
  // オフライン状態
  isOffline: boolean;
}
```

#### 3-1-4. データフロー

```
1. ページ読み込み
   ↓
2. 車両情報を取得（Google Sheets）
   ↓
3. 検査項目テンプレートを取得（PDFまたはマスタデータ）
   ↓
4. 既存の診断データを取得（Zoho CRM、またはローカルストレージ）
   ↓
5. 画面を表示
   ↓
6. 整備士が項目を入力
   ↓
7. 自動保存（各項目入力時）
   - ローカルストレージに保存
   - オンライン時はAPIに送信
   ↓
8. 診断完了ボタンを押す
   ↓
9. バリデーション
   ↓
10. データを保存
    - Zoho CRMに保存
    - 写真をGoogle Driveにアップロード
    ↓
11. ステータス更新
    - Zoho CRM `field5`: 「見積作成待ち」
    ↓
12. フロントスタッフに通知
```

### 3-2. 測定値入力画面 (`/mechanic/diagnosis/[id]/measurements`)

#### 3-2-1. 画面レイアウト

```
┌─────────────────────────────────────────────┐
│ [←] 測定値入力                              │
├─────────────────────────────────────────────┤
│ CO、HC濃度（アイドリング時）                │
│ ┌─────────────────────────────────────────┐ │
│ │ CO:  [____] %                            │ │
│ │ HC:  [____] ppm                          │ │
│ │ [📷 測定値の写真を追加]                  │ │
│ └─────────────────────────────────────────┘ │
├─────────────────────────────────────────────┤
│ タイヤの溝の深さ（1.6mm以上）                │
│ ┌─────────────────────────────────────────┐ │
│ │ 前輪左: [____] mm                        │ │
│ │ 前輪右: [____] mm                        │ │
│ │ 後輪左: [____] mm                        │ │
│ │ 後輪右: [____] mm                        │ │
│ │ [📷 タイヤの写真を追加]                  │ │
│ └─────────────────────────────────────────┘ │
├─────────────────────────────────────────────┤
│ ブレーキ・パッド、ライニングの厚さ           │
│ ┌─────────────────────────────────────────┐ │
│ │ 前輪左: [____] mm                        │ │
│ │ 前輪右: [____] mm                        │ │
│ │ 後輪左: [____] mm                        │ │
│ │ 後輪右: [____] mm                        │ │
│ │ [📷 ブレーキパッドの写真を追加]          │ │
│ └─────────────────────────────────────────┘ │
├─────────────────────────────────────────────┤
│ [保存] [診断画面に戻る]                      │
└─────────────────────────────────────────────┘
```

#### 3-2-2. バリデーション

- **CO濃度**: 0-100%の範囲
- **HC濃度**: 0-10000ppmの範囲
- **タイヤ溝深さ**: 1.6mm以上（警告: 1.6mm未満の場合）
- **ブレーキパッド厚さ**: 0mm以上（警告: 2mm未満の場合）

#### 3-2-3. UI/UXのポイント

1. **数字キーパッド**: 数値入力時に数字キーパッドを表示
2. **単位の明示**: 各入力欄に単位を表示
3. **範囲チェック**: リアルタイムバリデーション
4. **写真との紐付け**: 各測定値セクションに写真追加ボタン

### 3-3. 見積もり画面 (`/admin/estimate/[id]`)

#### 3-3-1. 画面レイアウト

```
┌─────────────────────────────────────────────┐
│ [←] 田中様 BMW X3 見積もり                  │
├─────────────────────────────────────────────┤
│ 📋 法定費用（自動取得・編集不可）            │
│ ┌─────────────────────────────────────────┐ │
│ │ 車検（24ヶ月）            ¥66,000        │ │
│ │ 自動車重量税              ¥24,600        │ │
│ │ 自賠責保険料              ¥17,650        │ │
│ │ 印紙代                    ¥2,300         │ │
│ │ 代行手数料                ¥19,800        │ │
│ │ テスター代                ¥4,400         │ │
│ │ ────────────────────────────────────── │ │
│ │ 法定費用合計              ¥135,750       │ │
│ │ 🔒 この項目は必須です                    │ │
│ └─────────────────────────────────────────┘ │
├─────────────────────────────────────────────┤
│ 🔧 部品代・工賃                              │
│ [＋項目を追加]                               │
│                                              │
│ ┌─────────────────────────────────────────┐ │
│ │ フロントブレーキパッド交換                │ │
│ │ [📷] [要交換] 残り2mm                    │ │
│ │ 💬 パッド残量2mm。危険です。              │ │
│ │ 金額: [¥33,000]                         │ │
│ │ [削除]                                   │ │
│ └─────────────────────────────────────────┘ │
│                                              │
│ ...（スクロール可能）                        │
├─────────────────────────────────────────────┤
│ 🎁 オプションメニュー（車検と同時実施で10%割引）│
│                                              │
│ ┌─────────────────────────────────────────┐ │
│ │ ☐ エンジンオイル交換（下抜き）            │ │
│ │    SM規格全合成油3L使用+レベル点検        │ │
│ │    通常: ¥10,560 → 割引: ¥9,504          │ │
│ │    [詳細を見る]                           │ │
│ └─────────────────────────────────────────┘ │
│                                              │
│ ┌─────────────────────────────────────────┐ │
│ │ ☐ クーラント交換                          │ │
│ │    冷却水2L交換+冷却系統点検              │ │
│ │    通常: ¥14,740 → 割引: ¥13,266        │ │
│ │    [詳細を見る]                           │ │
│ └─────────────────────────────────────────┘ │
│                                              │
│ ...（その他のオプション: バッテリー、タイヤ、  │
│      ブレーキフルード、ブレーキパッド、        │
│      ミッションオイル、ATフルード）           │
│                                              │
│ ...（スクロール可能）                        │
├─────────────────────────────────────────────┤
│ 💰 合計（税込）                              │
│        ¥168,750                             │
│                                              │
│ [プレビュー] [LINEで送信] [メールで送信]    │
└─────────────────────────────────────────────┘
```

#### 3-3-2. データフロー

```
1. ページ読み込み
   ↓
2. 法定費用を取得（Google Sheets「車両_同期用」）
   ↓
3. 診断結果を取得（Zoho CRM `field7`）
   ↓
4. 診断結果から部品代・工賃の項目を自動追加
   - 「要交換」「注意」と判定された項目
   ↓
5. フロントスタッフが金額を入力（基幹システムから転記）
   ↓
6. プレビューで確認
   ↓
7. 顧客に送信（LINE/メール/SMS）
   ↓
8. ステータス更新
   - Zoho CRM `field5`: 「見積提示済み」
```

### 3-4. 顧客向け承認画面 (`/customer/approval/[id]`)

#### 3-4-1. 画面レイアウト

```
┌─────────────────────────────────────────────┐
│ 田中様 BMW X3 お見積もり                    │
├─────────────────────────────────────────────┤
│ 📋 法定費用（必須）                          │
│ ┌─────────────────────────────────────────┐ │
│ │ 車検（24ヶ月）            ¥66,000        │ │
│ │ 自動車重量税              ¥24,600        │ │
│ │ 自賠責保険料              ¥17,650        │ │
│ │ 印紙代                    ¥2,300         │ │
│ │ 代行手数料                ¥19,800        │ │
│ │ ────────────────────────────────────── │ │
│ │ 法定費用合計              ¥135,750       │ │
│ │ 🔒 この項目は必須です                    │ │
│ └─────────────────────────────────────────┘ │
├─────────────────────────────────────────────┤
│ 🔧 推奨整備（選択可能）                      │
│ ┌─────────────────────────────────────────┐ │
│ │ ☑ フロントブレーキパッド交換             │ │
│ │    [📷写真] 残り2mm                      │ │
│ │    💬 パッド残量2mm。危険です。           │ │
│ │    ¥33,000                               │ │
│ └─────────────────────────────────────────┘ │
│                                              │
│ ┌─────────────────────────────────────────┐ │
│ │ ☐ エアフィルター交換                     │ │
│ │    [📷写真] 汚れあり                      │ │
│ │    💬 交換推奨です。                      │ │
│ │    ¥5,000                                │ │
│ └─────────────────────────────────────────┘ │
│                                              │
│ ...（スクロール可能）                        │
├─────────────────────────────────────────────┤
│ 🎁 オプションメニュー（車検と同時実施で10%割引）│
│                                              │
│ ┌─────────────────────────────────────────┐ │
│ │ ☐ エンジンオイル交換（下抜き）            │ │
│ │    SM規格全合成油3L使用+レベル点検        │ │
│ │    通常: ¥10,560 → 割引: ¥9,504          │ │
│ │    [詳細を見る]                           │ │
│ └─────────────────────────────────────────┘ │
│                                              │
│ ┌─────────────────────────────────────────┐ │
│ │ ☐ クーラント交換                          │ │
│ │    冷却水2L交換+冷却系統点検              │ │
│ │    通常: ¥14,740 → 割引: ¥13,266        │ │
│ │    [詳細を見る]                           │ │
│ └─────────────────────────────────────────┘ │
│                                              │
│ ...（その他のオプション: バッテリー、タイヤ、  │
│      ブレーキフルード、ブレーキパッド、        │
│      ミッションオイル、ATフルード）           │
│                                              │
│ ...（スクロール可能）                        │
├─────────────────────────────────────────────┤
│ 💰 お支払い合計（税込）                      │
│        ¥168,750                             │
│                                              │
│ [この内容で作業を依頼する]                    │
└─────────────────────────────────────────────┘
```

#### 3-4-2. UI/UXのポイント

1. **スティッキーフッター**: 合計金額と承認ボタンを画面下部に固定
2. **リアルタイム計算**: 項目の選択/解除で合計金額がリアルタイムに更新
3. **写真の拡大表示**: タップでライトボックス表示
4. **承認時の確認**: 確認ダイアログを表示

### 3-5. 作業画面 (`/mechanic/work/[id]`)

#### 3-5-1. 画面レイアウト

```
┌─────────────────────────────────────────────┐
│ [←] 田中様 BMW X3 作業中                    │
├─────────────────────────────────────────────┤
│ 📋 承認された作業項目                        │
│ 進捗: ████████░░ 2/3項目完了 (67%)         │
│                                              │
│ ┌─────────────────────────────────────────┐ │
│ │ ✅ フロントブレーキパッド交換            │ │
│ │ [完了]                                   │ │
│ │                                          │ │
│ │ Before: [📷写真1] [📷写真2]            │ │
│ │ After:  [📷写真1] [📷写真2]            │ │
│ │ [📷 Before写真を追加]                   │ │
│ │ [📷 After写真を追加]                     │ │
│ │                                          │ │
│ │ 💬 コメント: パッド残量2mm、ローターも   │ │
│ │    段付き摩耗あり。セット交換実施。       │ │
│ └─────────────────────────────────────────┘ │
│                                              │
│ ┌─────────────────────────────────────────┐ │
│ │ ⏳ エアフィルター交換                     │ │
│ │ [完了]                                   │ │
│ │                                          │ │
│ │ Before: [📷写真1]                       │ │
│ │ After:  [未撮影]                         │ │
│ │ [📷 Before写真を追加]                   │ │
│ │ [📷 After写真を追加]                     │ │
│ └─────────────────────────────────────────┘ │
│                                              │
│ [交換部品を記録]                            │
│                                              │
│ [作業完了]                                   │
└─────────────────────────────────────────────┘
```

#### 3-5-2. データフロー

```
1. ページ読み込み
   ↓
2. 承認された項目を取得（Zoho CRM `field13`）
   ↓
3. 作業項目を表示
   ↓
4. 整備士が作業を実施
   - Before/After写真を撮影
   - コメントを入力
   ↓
5. 交換部品を記録
   ↓
6. 作業完了ボタンを押す
   ↓
7. 分解整備記録簿（PDF）を生成
   ↓
8. PDFをGoogle Driveに保存
   ↓
9. Zoho CRMに保存
   - field19: PDFのURL
   - field5: 「出庫待ち」
   ↓
10. フロントスタッフに通知
```

---

## 4. データモデル詳細

詳細は `docs/VEHICLE_INSPECTION_DATA_MODEL.md` を参照。

### 4-1. 主要なデータ構造

- **InspectionData**: 診断データ全体
- **InspectionItem**: 検査項目
- **Measurements**: 測定値
- **ReplacedPart**: 交換部品
- **VehicleInfo**: 車両情報
- **LegalFees**: 法定費用

### 4-2. データ保存先

- **Zoho CRM**: 診断結果、作業内容、ステータス
- **Google Drive**: 写真、PDF
- **Google Sheets**: 車両情報、法定費用
- **IndexedDB**: オフライン時の一時保存

---

## 5. API設計詳細

詳細は `docs/VEHICLE_INSPECTION_DATA_MODEL.md` を参照。

### 5-1. 主要なAPI

- `GET /api/inspection-templates/vehicle-inspection`: 検査項目テンプレート取得
- `GET /api/vehicles/:vehicleId`: 車両情報取得
- `GET /api/vehicles/:vehicleId/legal-fees`: 法定費用取得
- `POST /api/jobs/:jobId/inspection`: 診断データ保存
- `POST /api/jobs/:jobId/inspection/photos`: 写真アップロード
- `POST /api/jobs/:jobId/inspection/pdf`: PDF生成

---

## 6. UI/UX設計原則

### 6-1. モバイルファースト

- **タッチターゲット**: 最低48x48px
- **フォントサイズ**: 最小16px
- **スクロール**: 縦スクロールを基本
- **横スクロール**: タブなど、必要な場合のみ

### 6-2. 視覚的フィードバック

- **選択状態**: 明確に表示（背景色、アイコン）
- **進捗表示**: プログレスバー、パーセンテージ
- **完了状態**: チェックマーク、色の変化
- **エラー状態**: 赤色、エラーメッセージ

### 6-3. エラー防止

- **バリデーション**: リアルタイムバリデーション
- **確認ダイアログ**: 重要な操作には確認
- **自動保存**: データ損失を防止
- **オフライン対応**: ネットワークエラーに対応

### 6-4. 効率化

- **自動入力**: 車両情報、法定費用は自動取得
- **デフォルト値**: よく使う値をデフォルトに
- **ショートカット**: よく使う操作を簡単に
- **音声入力**: 手が汚れている状態でも入力可能

### 6-5. アクセシビリティ

- **コントラスト比**: WCAG AA基準（4.5:1以上）
- **色だけで情報を伝えない**: アイコンとテキストを併用
- **キーボード操作**: 可能な限りサポート
- **スクリーンリーダー**: 適切なラベルを設定

---

## 7. パフォーマンス最適化

### 7-1. データ読み込み

- **遅延読み込み**: カテゴリごとにデータを読み込む
- **キャッシュ**: 検査項目テンプレートをキャッシュ
- **プリフェッチ**: 次のカテゴリのデータを事前に読み込む

### 7-2. 画像処理

- **圧縮**: クライアント側で画像を圧縮（300KB〜500KB）
- **サムネイル**: 一覧表示ではサムネイルを使用
- **遅延読み込み**: 画像は必要になったタイミングで読み込む

### 7-3. オフライン対応

- **Service Worker**: オフライン時もアプリが動作
- **IndexedDB**: ローカルストレージにデータを保存
- **Background Sync**: オンライン復帰時に自動同期

---

## 8. セキュリティ

### 8-1. データ保護

- **認証**: 整備士の認証（既存の整備士選択機能を活用）
- **認可**: 各ユーザーの権限に応じたアクセス制御
- **暗号化**: 通信はHTTPS、保存データは暗号化

### 8-2. データ整合性

- **バリデーション**: サーバー側でもバリデーション
- **トランザクション**: 重要な操作はトランザクションで保護
- **監査ログ**: 重要な操作はログに記録

---

## 9. テスト計画

### 9-1. 単体テスト

- 各コンポーネントのテスト
- バリデーション関数のテスト
- データ変換関数のテスト

### 9-2. 統合テスト

- API連携のテスト
- データ保存のテスト
- PDF生成のテスト

### 9-3. E2Eテスト

- 診断開始から完了までのフロー
- 見積もり作成から顧客承認までのフロー
- 作業完了からPDF出力までのフロー

### 9-4. ユーザーテスト

- 整備士による実機テスト
- フロントスタッフによる実機テスト
- 顧客による実機テスト

---

## 10. 実装優先順位

### Phase 1: MVP（最小限の機能）

1. **診断画面の基本機能**
   - 検査項目の表示
   - 状態の選択
   - データの保存

2. **見積もり画面の基本機能**
   - 法定費用の表示
   - 部品代・工賃の入力
   - 顧客への送信

3. **承認画面の基本機能**
   - 見積もりの表示
   - 項目の選択/解除
   - 承認

### Phase 2: 拡張機能

1. **測定値入力画面**
2. **写真撮影機能**
3. **音声入力機能**
4. **オフライン対応**

### Phase 3: 高度な機能

1. **PDF生成機能**
2. **前回整備履歴の参照**
3. **自動解析機能（PDFテンプレート）**

---

## 11. リスクと対策

### 11-1. 技術的リスク

**リスク**: PDF生成が失敗する

**対策**:
- エラーハンドリングを実装
- リトライ機能を実装
- フォールバック（手動生成）を用意

### 11-2. 業務的リスク

**リスク**: 整備士が操作に慣れない

**対策**:
- 直感的なUI設計
- チュートリアル機能
- ヘルプ機能

### 11-3. データ整合性リスク

**リスク**: データが失われる

**対策**:
- 自動保存機能
- オフライン対応
- バックアップ機能

---

## 12. 次のステップ

1. **設計レビュー**: 本設計書のレビュー
2. **プロトタイプ作成**: 主要画面のプロトタイプ
3. **ユーザーテスト**: 整備士によるテスト
4. **実装開始**: フィードバックを反映して実装

---

## 更新履歴

- 2025-01-XX: 初版作成（完全設計仕様書）
- 2025-01-XX: 動画機能と診断時の部品リストアップ機能を追加
- 2025-01-XX: オプションメニュー（車検と同時実施で10%割引）を追加
- 2025-01-XX: PDF生成要件を明確化（車検と12ヶ月点検のみ、決まったフォーマット）

---

## 関連ドキュメント

- `docs/SERVICE_KIND_UNDERSTANDING.md`: 業務理解メモ
- `docs/DATA_SOURCE_STRUCTURE.md`: データソース構造
- `docs/VEHICLE_INSPECTION_DETAILED_SPEC.md`: 詳細設計仕様書
- `docs/VEHICLE_INSPECTION_SCREEN_DESIGN.md`: 画面設計書
- `docs/VEHICLE_INSPECTION_DATA_MODEL.md`: データモデル設計書
- `docs/VEHICLE_INSPECTION_DIAGNOSIS_PARTS_FEATURE.md`: 診断時の部品リストアップ機能詳細設計



























