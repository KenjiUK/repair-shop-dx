# 12ヶ月点検（法定12ヶ月点検）画面設計書

## ドキュメント情報

- **作成日**: 2025-01-XX
- **バージョン**: 1.1
- **対象**: 12ヶ月点検（法定12ヶ月点検）の各画面の詳細設計
- **設計方針**: 世界最高のUI/UX、ITコンサルの目線での推奨を元に設計

---

## 複数作業管理対応

この画面設計書は、1つの入庫に対して複数の作業（12ヶ月点検、オイル交換、コーティングなど）を管理する「複数作業管理」に対応しています。

**対応内容**:
- 各画面は特定のワークオーダー（作業）に対応
- URLパラメータ `workOrderId` で対象ワークオーダーを識別
- 画面ヘッダーに現在の作業名を表示
- 「他の作業を表示」ボタンで同じJobの他のワークオーダーに切替可能
- データはZoho CRM `field_work_orders` フィールドに作業ごとに保存

**詳細は [統合仕様書](./INTEGRATED_SPECIFICATION.md) の「2-4. 複数作業管理の実装」を参照してください。**

---

## 1. 画面一覧

### 1-1. 整備士向け画面

1. **診断画面** (`/mechanic/diagnosis/[id]`)
   - 検査項目の入力（29項目、5カテゴリ）
   - 測定値の入力（PDFテンプレートを確認、必要に応じて）
   - 写真・動画撮影
   - 診断時の部品リストアップ（問題がある場合）

2. **作業画面** (`/mechanic/work/[id]`)
   - 承認された作業項目の表示
   - Before/After写真の撮影
   - 交換部品の記録

### 1-2. フロントスタッフ向け画面

3. **見積もり画面** (`/admin/estimate/[id]`)
   - 法定費用の表示（自動取得、車両重量に応じて）
   - 部品代・工賃の入力
   - OBD診断結果のアップロード
   - 顧客への送信

### 1-3. 顧客向け画面

4. **承認画面** (`/customer/approval/[id]`)
   - 見積もりの確認
   - 項目の選択/解除
   - OBD診断結果の確認
   - 承認

5. **レポート画面** (`/customer/report/[id]`)
   - 整備完了報告
   - 12ヶ月点検記録簿（PDF）の表示
   - 請求書の表示
   - OBD診断結果の確認

---

## 2. 診断画面の詳細設計

### 2-1. 画面構成

#### レイアウト構造

```
┌─────────────────────────────────────────┐
│ [←] 田中様 BMW X3 12ヶ月点検診断        │
│ 整備士: 中村                             │
├─────────────────────────────────────────┤
│ 📋 車両情報（自動入力済み・編集不可）     │
│ ┌─────────────────────────────────────┐ │
│ │ 登録番号: 堺 330 す 1669            │ │
│ │ 車台番号: VF3CUHNZTHY061316         │ │
│ │ 初度登録: H29.10                    │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ [タブ] かじ取り装置 | 制動装置 | 走行装置│
│        | 緩衝装置 | 動力伝達装置          │
│ ─────────────────────────────────────── │
│                                          │
│ [カテゴリ: かじ取り装置（ステアリング）] │
│ 進捗: ████████░░ 5/6項目完了 (83%)    │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ ハンドル：操作具合                  │ │
│ │ [OK] [注意] [要交換] [調整] [清掃]   │ │
│ │ [📷 写真] [🎥 動画] [💬 コメント]   │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ ギヤ・ボックス：取付けの緩み（※1）  │ │
│ │ [OK] [注意] [要交換] [調整] [清掃]   │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ ...（スクロール可能）                    │
│                                          │
│ [測定値入力] [交換部品リスト] [その他]   │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ 🔧 診断時の交換部品リスト            │ │
│ │ [＋部品を追加] [🎤 音声入力]        │ │
│ │                                      │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ フロントブレーキパッド          │ │ │
│ │ │ [緊急] 残り2mm                  │ │ │
│ │ │ 💬 パッド残量2mm。危険です。    │ │ │
│ │ │ [📷写真] [🎥動画] [削除]        │ │ │
│ │ └────────────────────────────────┘ │ │
│ │                                      │ │
│ │ ...（スクロール可能）                │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ [一時保存] [診断完了]                    │
└─────────────────────────────────────────┘
```

### 2-2. コンポーネント設計

#### 2-2-1. 車両情報カード

**目的**: 診断対象の車両情報を表示（誤操作防止のため編集不可）

**表示項目**:
- 依頼者(使用者)の氏名又は名称
- 車名及び型式
- 自動車登録番号又は車両番号
- 原動機の型式
- 初度登録年又は初度検査年
- 車台番号

**データソース**: Google Sheets「【DB】車両マスタ」から自動取得

**UI/UXのポイント**:
- 背景色を薄くして、編集不可であることを視覚的に示す
- アイコン（🔒）で編集不可であることを示す

#### 2-2-2. カテゴリタブ

**目的**: PDFテンプレート（12カ月点検テンプレート.pdf）に基づく5つのカテゴリを表示

**カテゴリ**:
- **入庫区分が「12ヵ月点検」の場合**: PDFテンプレートに基づき、5つのカテゴリが表示される
  1. かじ取り装置（ステアリング）（デフォルト選択）
  2. 制動装置（ブレーキ）
  3. 走行装置
  4. 緩衝装置（サスペンション）
  5. 動力伝達装置（ドライブトレイン）

**UI/UXのポイント**:
- **自動設定**: 入庫区分が「12ヵ月点検」の場合、5つのカテゴリが自動で表示される
- **デフォルト選択**: 「かじ取り装置（ステアリング）」がデフォルトで選択される
- **手動切り替え**: タブをタップして手動で切り替え可能
- タブは横スクロール可能（モバイル対応）
- 完了したカテゴリにはチェックマーク（✓）を表示
- 現在のカテゴリは強調表示
- 未完了のカテゴリはバッジで未入力項目数を表示

#### 2-2-3. 進捗バー

**目的**: 現在のカテゴリの進捗を可視化

**表示内容**:
- 完了項目数 / 全項目数
- 進捗パーセンテージ
- プログレスバー（視覚的）

**UI/UXのポイント**:
- 色で進捗を表現（0-50%: 赤、50-80%: 黄、80-100%: 緑）
- 数値と視覚的表現の両方で進捗を表示

#### 2-2-4. 検査項目カード

**目的**: 各検査項目の状態を入力

**表示内容**:
- 項目名（例: 「ハンドル：操作具合」）
- 状態選択ボタン（OK/注意/要交換/調整/清掃/省略/該当なし）
- 写真追加ボタン
- 動画追加ボタン
- コメント入力ボタン
- 省略規則の表示（該当する場合: ※1）

**状態選択ボタンのデザイン**:
- **OK（正常）**: 緑色、チェックマークアイコン
- **注意**: 黄色、警告アイコン
- **要交換**: 赤色、Xアイコン
- **調整**: 青色、レンチアイコン
- **清掃**: 水色、ブラシアイコン
- **省略**: グレー、スキップアイコン
- **該当なし**: グレー、マイナスアイコン

**UI/UXのポイント**:
- ボタンは画面幅いっぱいに配置（タッチしやすい）
- 選択された状態は明確に表示（背景色、アイコン）
- 写真ボタンは撮影済みの場合、サムネイルを表示
- **動画ボタン**: 撮影済みの場合、サムネイル（動画の最初のフレーム）を表示、再生アイコンを重ねて表示
- **動画撮影**: 最大15秒、録画中はタイマー表示、録画停止ボタンを大きく表示
- コメントがある場合、アイコンで表示

#### 2-2-5. 測定値入力ボタン

**目的**: 測定値入力画面への遷移（PDFテンプレートを確認、必要に応じて）

**表示内容**:
- アイコン（📏）
- ラベル「測定値入力」
- 未入力の場合、バッジで「未入力」を表示

**注意**: PDFテンプレート（12カ月点検テンプレート.pdf）を確認して、測定値の入力が必要かどうかを判断

#### 2-2-6. 交換部品リストセクション

**目的**: 診断時に交換が必要な部品をリストアップ（問題がある場合）

**表示内容**:
- セクションタイトル「🔧 診断時の交換部品リスト」
- 「＋部品を追加」ボタン
- 「🎤 音声入力」ボタン
- 部品リスト（各部品カード）

**部品カードの表示内容**:
- 部品名
- 緊急度（緊急/推奨/任意）
- 推奨理由
- 関連する検査項目へのリンク
- 写真・動画のサムネイル
- 削除ボタン

**UI/UXのポイント**:
- **音声入力**: マイクボタンをタップすると音声認識が開始、部品名を自動入力
- **レコメンド機能**: カテゴリに応じてよく使う部品を候補として表示
- **自動提案**: 「要交換」と判定した検査項目から、関連する部品を自動提案
- **緊急度の設定**: 部品追加時に緊急度を選択（デフォルト: 推奨）
- **写真・動画の紐付け**: 各部品に写真・動画を紐付け可能

#### 2-2-7. その他ボタン

**目的**: その他の点検項目等の自由記述入力

**表示内容**:
- アイコン（📝）
- ラベル「その他」

#### 2-2-8. 一時保存ボタン

**目的**: 現在の入力内容を保存（自動保存も実施）

**UI/UXのポイント**:
- 保存成功時にトースト通知（邪魔にならない程度に）
- オフライン時も保存可能（ローカルストレージ）

#### 2-2-9. 診断完了ボタン

**目的**: 診断を完了し、フロントスタッフに通知

**UI/UXのポイント**:
- 全てのカテゴリが完了していない場合、警告を表示
- 確認ダイアログを表示
- 完了後、フロントスタッフに通知

### 2-3. 測定値入力画面（必要に応じて）

#### 2-3-1. 画面構成

**注意**: PDFテンプレート（12カ月点検テンプレート.pdf）を確認して、測定値の入力が必要かどうかを判断

```
┌─────────────────────────────────────────┐
│ [←] 測定値入力                          │
├─────────────────────────────────────────┤
│ （PDFテンプレートを確認して項目を追加）  │
│                                          │
│ [保存] [診断画面に戻る]                  │
└─────────────────────────────────────────┘
```

### 2-4. 交換部品記録画面（作業時）

#### 2-4-1. 画面構成

```
┌─────────────────────────────────────────┐
│ [←] 交換部品記録                        │
├─────────────────────────────────────────┤
│ [＋部品を追加]                           │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ エンジン・オイル                     │ │
│ │ 数量: [____] l                       │ │
│ │ [削除]                               │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ ...（スクロール可能）                    │
│                                          │
│ [保存] [作業画面に戻る]                  │
└─────────────────────────────────────────┘
```

#### 2-4-2. UI/UXのポイント

1. **部品名の入力**
   - テキスト入力
   - よく使う部品は候補表示（オートコンプリート）

2. **数量の入力**
   - 数字キーパッドを表示
   - 単位を選択（l、個、本、など）

3. **削除機能**
   - 各項目に削除ボタン
   - 削除時に確認ダイアログ

### 2-5. その他の点検項目等入力画面

#### 2-5-1. 画面構成

```
┌─────────────────────────────────────────┐
│ [←] その他の点検項目等                   │
├─────────────────────────────────────────┤
│ ┌─────────────────────────────────────┐ │
│ │                                     │ │
│ │  自由記述欄                          │ │
│ │  （複数行入力可能）                  │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ [💬 音声入力]                            │
│                                          │
│ [保存] [診断画面に戻る]                  │
└─────────────────────────────────────────┘
```

#### 2-5-2. UI/UXのポイント

1. **音声入力対応**
   - マイクボタンで音声入力
   - 手が汚れている状態でも入力可能
   - 音声認識結果をテキストに変換

2. **自由記述**
   - 複数行入力可能
   - 文字数制限なし（ただし、PDF出力時のレイアウトを考慮）

---

## 3. 見積もり画面の詳細設計

### 3-1. 画面構成

```
┌─────────────────────────────────────────┐
│ [←] 田中様 BMW X3 12ヶ月点検見積もり    │
├─────────────────────────────────────────┤
│ 📋 法定費用（自動取得・編集不可）         │
│ ┌─────────────────────────────────────┐ │
│ │ 12ヶ月点検費用        ¥26,400       │ │
│ │ （車両重量: 1500kg以下）              │ │
│ │ ──────────────────────────────── │ │
│ │ 法定費用合計          ¥26,400       │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 🔧 部品代・工賃                          │
│ [＋項目を追加]                           │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ フロントブレーキパッド交換          │ │
│ │ [📷] [🎥] [緊急] 残り2mm            │ │
│ │ 💬 パッド残量2mm。危険です。          │ │
│ │ 金額: [¥33,000]                    │ │
│ │ [削除]                               │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ ...（スクロール可能）                    │
├─────────────────────────────────────────┤
│ 🔍 OBD診断結果                           │
│ [📄 診断結果をアップロード]              │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ OBD診断結果.pdf                     │ │
│ │ [📄 表示] [🗑️ 削除]                 │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 💰 合計（税込）                          │
│        ¥59,400                          │
│                                          │
│ [プレビュー] [LINEで送信] [メールで送信] │
└─────────────────────────────────────────┘
```

### 3-2. コンポーネント設計

#### 3-2-1. 法定費用カード

**目的**: 法定費用を表示（自動取得、編集不可）

**データソース**: Google Sheets「【DB】車両マスタ」内の「車両_同期用」シートから車両重量を取得し、自動計算

**表示項目**:
- 12ヶ月点検費用（車両重量に応じた金額）
- 車両重量の表示（参考）
- 法定費用合計

**UI/UXのポイント**:
- 背景色を薄くして、編集不可であることを視覚的に示す
- 各項目の説明をツールチップで表示（必要に応じて）
- 合計金額を大きく表示

#### 3-2-2. 部品代・工賃セクション

**目的**: 診断結果から部品代・工賃の項目を追加・編集

**機能**:
- **診断時に整備士がリストアップした部品を自動表示**（整備士からのインプット）
- 手動で項目を追加
- **フロントスタッフが金額を入力**（基幹システムから転記）
- 写真・動画とコメントを紐付け
- 項目を削除

**基幹システム連携フロー**:
1. アドバイザー（フロントスタッフ）がWebアプリの見積作成画面を開く
2. 診断結果を確認（整備士がリストアップした部品と緊急度を確認）
3. **基幹システム（スマートカーディーラー）で該当作業の見積書を作成**（アドバイザーが実施）
4. **Webアプリに「品名」と「金額（税込）」を転記**（アドバイザーが実施）
5. 見積情報を保存（Zoho CRM field_work_orders内の該当作業の見積情報を更新）

**制約**:
- 見積計算は基幹システムで実施（Webアプリは転記のみ）
- 法定費用は自動取得、部品代・工賃はアドバイザーが手動入力

**データフロー**:
1. 整備士が診断時に「交換が必要な部品」をリストアップ（部品名、緊急度、推奨理由、写真・動画）
2. 診断完了後、見積もり画面を開くと、整備士がリストアップした部品が自動表示
3. フロントスタッフが各部品の金額を入力（基幹システムから転記）
4. 必要に応じて部品を追加・削除

**UI/UXのポイント**:
- 診断時に整備士がリストアップした部品は、写真・動画とコメントが自動で紐付け
- 金額入力欄は数字キーパッドを表示
- 削除時は確認ダイアログを表示

#### 3-2-3. OBD診断結果セクション

**目的**: 別システムで実施したOBD診断結果をアップロード・表示

**機能**:
- スタッフが診断結果をアップロード（PDFまたは画像形式）
- 診断結果を表示
- 診断結果を削除

**UI/UXのポイント**:
- 「診断結果をアップロード」ボタンを大きく表示
- アップロード済みの場合、ファイル名と「表示」「削除」ボタンを表示
- 顧客が診断結果を確認できるようにする

#### 3-2-4. 合計金額表示

**目的**: 法定費用と部品代・工賃の合計を表示

**UI/UXのポイント**:
- 合計金額を大きく表示
- 法定費用と部品代・工賃を明確に区分
- 税込であることを明示

#### 3-2-5. プレビューボタン

**目的**: 顧客の見え方を確認

**機能**:
- 顧客向けの見積もり画面をプレビュー
- 写真・動画、コメント、金額、OBD診断結果を確認

#### 3-2-6. 送信ボタン

**目的**: 顧客に見積もりを送信

**送信方法**:
- LINE（推奨）
- メール
- SMS（フォールバック）

**UI/UXのポイント**:
- 送信成功時にトースト通知
- 送信失敗時はエラーメッセージを表示

---

## 4. 作業画面の詳細設計

### 4-1. 画面構成

```
┌─────────────────────────────────────────┐
│ [←] 田中様 BMW X3 作業中                │
├─────────────────────────────────────────┤
│ 📋 承認された作業項目                    │
│ 進捗: ████████░░ 2/3項目完了 (67%)     │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ ✅ フロントブレーキパッド交換        │ │
│ │ [完了]                              │ │
│ │                                     │ │
│ │ Before: [📷写真1] [📷写真2]        │ │
│ │ After:  [📷写真1] [📷写真2]        │ │
│ │ [📷 Before写真を追加]              │ │
│ │ [📷 After写真を追加]                │ │
│ │                                     │ │
│ │ 💬 コメント: パッド残量2mm、ローター│ │
│ │    も段付き摩耗あり。セット交換実施。│ │
│ └─────────────────────────────────────┘ │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ ⏳ エアフィルター交換                 │ │
│ │ [完了]                              │ │
│ │                                     │ │
│ │ Before: [📷写真1]                  │ │
│ │ After:  [未撮影]                    │ │
│ │ [📷 Before写真を追加]              │ │
│ │ [📷 After写真を追加]                │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ [交換部品を記録]                        │
│                                          │
│ [作業完了]                               │
└─────────────────────────────────────────┘
```

### 4-2. コンポーネント設計

#### 4-2-1. 作業項目カード

**目的**: 承認された作業項目を表示・管理

**表示内容**:
- 項目名
- 状態（作業中/完了）
- Before写真（複数枚可能）
- After写真（複数枚可能）
- コメント
- 完了ボタン

**UI/UXのポイント**:
- 完了した項目はチェックマーク（✅）を表示
- 作業中の項目は時計アイコン（⏳）を表示
- Before/After写真は並べて比較表示
- 写真はタップで拡大表示
- 写真追加ボタンは大きく表示（タッチしやすい）

#### 4-2-2. 進捗バー

**目的**: 作業全体の進捗を可視化

**表示内容**:
- 完了項目数 / 全項目数
- 進捗パーセンテージ
- プログレスバー

#### 4-2-3. 交換部品記録ボタン

**目的**: 交換部品記録画面への遷移

**表示内容**:
- アイコン（🔧）
- ラベル「交換部品を記録」
- 記録済み部品数（バッジ）

#### 4-2-4. 作業完了ボタン

**目的**: 作業を完了し、12ヶ月点検記録簿（PDF）を生成

**UI/UXのポイント**:
- 全ての項目が完了していない場合、警告を表示
- 確認ダイアログを表示
- 完了後、PDFを生成してGoogle Driveに保存
- フロントスタッフに通知

---

## 5. 顧客向け承認画面の詳細設計

### 5-1. 画面構成

```
┌─────────────────────────────────────────┐
│ 田中様 BMW X3 お見積もり                │
├─────────────────────────────────────────┤
│ 📋 法定費用（必須）                      │
│ ┌─────────────────────────────────────┐ │
│ │ 12ヶ月点検費用        ¥26,400       │ │
│ │ （車両重量: 1500kg以下）              │ │
│ │ ──────────────────────────────── │ │
│ │ 法定費用合計          ¥26,400       │ │
│ │ 🔒 この項目は必須です                │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 🔧 推奨整備（選択可能）                  │
│ ┌─────────────────────────────────────┐ │
│ │ ☑ フロントブレーキパッド交換         │ │
│ │    [📷写真] [🎥動画] 残り2mm         │ │
│ │    💬 パッド残量2mm。危険です。      │ │
│ │    ¥33,000                           │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ ┌─────────────────────────────────────┐ │
│ │ ☐ エアフィルター交換                 │ │
│ │    [📷写真] 汚れあり                  │ │
│ │    💬 交換推奨です。                 │ │
│ │    ¥5,000                            │ │
│ └─────────────────────────────────────┘ │
│                                          │
│ ...（スクロール可能）                    │
├─────────────────────────────────────────┤
│ 🔍 OBD診断結果                           │
│ ┌─────────────────────────────────────┐ │
│ │ OBD診断結果.pdf                     │ │
│ │ [📄 診断結果を確認]                  │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 💰 お支払い合計（税込）                  │
│        ¥59,400                          │
│                                          │
│ [この内容で作業を依頼する]                │
└─────────────────────────────────────────┘
```

### 5-2. UI/UXのポイント

1. **法定費用の明確な表示**
   - 必須であることを明示（🔒アイコン）
   - 編集不可であることを視覚的に示す

2. **推奨整備の選択**
   - チェックボックスで選択/解除
   - デフォルトはON（推奨）
   - 写真・動画とコメントを表示
   - 金額を表示

3. **OBD診断結果の表示**
   - 診断結果をPDFまたは画像形式で表示
   - 「診断結果を確認」ボタンで表示

4. **リアルタイム計算**
   - 項目の選択/解除で合計金額がリアルタイムに更新
   - アニメーションで金額が変わる

5. **承認ボタン**
   - 画面下部に固定（スティッキーフッター）
   - 大きなボタンでタッチしやすい
   - 承認時に確認ダイアログ

---

## 6. データフロー詳細

### 6-1. 診断開始から完了まで

```
1. ページ読み込み
   ↓
2. 車両情報を取得（Google Sheets）
   ↓
3. 検査項目テンプレートを取得（PDFまたはマスタデータ）
   ↓
4. 既存の診断データを取得（Zoho CRM、またはローカルストレージ）
   ↓
5. 画面を表示
   ↓
6. 整備士が項目を入力
   ↓
7. 自動保存（各項目入力時）
   - ローカルストレージに保存
   - オンライン時はAPIに送信
   ↓
8. 診断完了ボタンを押す
   ↓
9. バリデーション
   ↓
10. データを保存
    - Zoho CRMに保存
    - 写真・動画をGoogle Driveにアップロード
    ↓
11. ステータス更新
    - Zoho CRM `field5`: 「見積作成待ち」
    ↓
12. フロントスタッフに通知
```

### 6-2. 見積もり作成から顧客承認まで

```
1. ページ読み込み
   ↓
2. 法定費用を取得（Google Sheets「車両_同期用」）
   - 車両重量に応じて自動計算
   ↓
3. 診断結果を取得（Zoho CRM `field7`）
   ↓
4. 診断時にリストアップされた部品を確認（自動表示）
   ↓
5. フロントスタッフが金額を入力（基幹システムから転記）
   ↓
6. OBD診断結果をアップロード（別システムから）
   ↓
7. プレビューで確認
   ↓
8. 顧客に送信（LINE/メール/SMS）
   ↓
9. ステータス更新
   - Zoho CRM `field5`: 「見積提示済み」
```

### 6-3. 作業完了からPDF出力まで

```
1. ページ読み込み
   ↓
2. 承認された項目のみ表示
   - Zoho CRMのfield13（作業内容）から取得
   ↓
3. 各項目の作業を実施
   - Before/After写真を撮影
   - コメントを入力
   ↓
4. 交換部品を記録
   - 実際に交換した部品を記録
   ↓
5. 作業完了ボタンを押す
   ↓
6. 12ヶ月点検記録簿（PDF）を生成
   - 入力した検査項目をPDFテンプレートに転記
   - 測定値を転記（必要に応じて）
   - 交換部品を転記
   - 車両情報を自動入力
   - 整備主任者の氏名を記録
   - 点検(整備)時の総走行距離を記録
   ↓
7. PDFをGoogle Driveに保存
   - フォルダ構造: Drive/車両写真/[年]/[月]/[日付]_[顧客名]_[車両]_[ナンバー]/00_書類/
   - ファイル名: 12ヶ月点検記録簿_[日付]_[車両名].pdf
   ↓
8. Zoho CRMに保存
   - field19: PDFのURL
   - field5: 「出庫待ち」
   ↓
9. フロントスタッフに通知
```

---

## 7. エラーハンドリング

### 7-1. データ取得エラー

**車両情報が取得できない場合**:
- エラーメッセージを表示
- 手動で車両情報を入力可能にする（フォールバック）

**法定費用が取得できない場合**:
- エラーメッセージを表示
- 手動で法定費用を入力可能にする（フォールバック）

### 7-2. 入力エラー

**必須項目が未入力の場合**:
- リアルタイムバリデーション
- エラーメッセージを表示
- エラーがある項目をハイライト

**測定値の範囲外の場合**:
- リアルタイムバリデーション
- 警告メッセージを表示
- 推奨値を表示

### 7-3. ネットワークエラー

**オフライン時**:
- オフライン状態を明示的に表示
- ローカルストレージに保存
- オンライン復帰時に自動同期

**アップロード失敗時**:
- エラーメッセージを表示
- リトライボタンを表示
- バックグラウンドで再試行

---

## 8. パフォーマンス最適化

### 8-1. データ読み込み

- **遅延読み込み**: カテゴリごとにデータを読み込む
- **キャッシュ**: 検査項目テンプレートをキャッシュ
- **プリフェッチ**: 次のカテゴリのデータを事前に読み込む

### 8-2. 画像処理

- **圧縮**: クライアント側で画像を圧縮（300KB〜500KB）
- **サムネイル**: 一覧表示ではサムネイルを使用
- **遅延読み込み**: 画像は必要になったタイミングで読み込む

### 8-3. オフライン対応

- **Service Worker**: オフライン時もアプリが動作
- **IndexedDB**: ローカルストレージにデータを保存
- **Background Sync**: オンライン復帰時に自動同期

---

## 9. アクセシビリティ

### 9-1. 視覚的アクセシビリティ

- **コントラスト比**: WCAG AA基準を満たす（4.5:1以上）
- **フォントサイズ**: 最小16px（モバイル）
- **色だけで情報を伝えない**: アイコンとテキストを併用

### 9-2. 操作のアクセシビリティ

- **タッチターゲット**: 最低48x48px
- **キーボード操作**: 可能な限りキーボード操作をサポート
- **音声入力**: コメント入力で音声入力をサポート

### 9-3. 理解のアクセシビリティ

- **明確なラベル**: 各項目に明確なラベルを表示
- **エラーメッセージ**: 分かりやすいエラーメッセージ
- **ヘルプ**: 必要に応じてヘルプテキストを表示

---

## 10. セキュリティ

### 10-1. データ保護

- **認証**: 整備士の認証（既存の整備士選択機能を活用）
- **認可**: 各ユーザーの権限に応じたアクセス制御
- **暗号化**: 通信はHTTPS、保存データは暗号化

### 10-2. データ整合性

- **バリデーション**: サーバー側でもバリデーション
- **トランザクション**: 重要な操作はトランザクションで保護
- **監査ログ**: 重要な操作はログに記録

---

## 11. 関連ドキュメント

- [統合仕様書](./INTEGRATED_SPECIFICATION.md): システム全体の統合仕様
  - 「2-3. データフローの統一」: マスタデータ同期の制約と対応方法
  - 「2-4. 複数作業管理の実装」: 複数作業管理の実装方法
  - 「4-2-6. 請求書統合フロー」: 基幹システムでの統合請求書作成手順
- [システム進化計画](./SYSTEM_EVOLUTION_PLAN.md): 基幹システム制約下での設計変更方針
- [ユーザーワークフロー詳細設計 v2.0](./USER_WORKFLOW_DETAILED_DESIGN_V2.md): ユーザー別業務・システム利用詳細設計

**マスタデータ同期の制約**:
- 車両マスタ・顧客マスタはGoogle Sheets経由で取得（基幹システムからGAS経由で同期）
- マスタデータの更新は基幹システムで実施（Webアプリからは更新不可）
- データ不整合が発生した場合は、「Human Middleware」（スタッフ）が基幹システムを修正

---

## 更新履歴

- 2025-01-XX: 初版作成
- 2025-01-XX: 基幹システム連携フローを追加、関連ドキュメントへの参照を追加



























