# 写真撮影アスペクト比・フレームガイド仕様書

## 実装内容

### 1. アスペクト比3:2への自動変換 ✅

**実装状況**: 実装済み

**処理フロー**:
1. 撮影された画像を読み込み
2. 中央トリミングで3:2アスペクト比に変換
3. ウォーターマーク合成
4. 画像圧縮（500KB以下）
5. 保存

**実装詳細**:
- `convertToAspectRatio32()` 関数を使用
- 元画像のアスペクト比に関わらず、中央部分をトリミングして3:2に統一
- 横長画像: 上下をトリミング
- 縦長画像: 左右をトリミング

### 2. ローカル保存機能 ✅

**実装状況**: 実装済み

**動作**:
- 撮影・処理完了後、自動的に端末のローカルストレージに保存
- Chrome系ブラウザ: File System Access APIを使用（保存先選択ダイアログ）
- その他ブラウザ: ダウンロード方式（ダウンロードフォルダに保存）

**ファイル名**:
- フォーマット: `{位置}_{タイムスタンプ}.jpg`
- 例: `front_2024-01-17T10-30-45-123Z.jpg`

### 3. フレームガイド機能

**実装状況**: 未実装（ベストプラクティスに基づく提案）

## フレームガイド機能のベストプラクティス検討

### 現状の実装方式

現在の実装は **HTML5の`<input type="file" capture>`** を使用しています。
この方式では：
- ✅ シンプルで実装が容易
- ✅ モバイル端末でネイティブカメラアプリを起動
- ❌ リアルタイムプレビューが不可
- ❌ フレームガイドを表示できない

### フレームガイド実装の選択肢

#### オプションA: 現在の方式を維持（推奨）⭐

**理由**:
1. **撮影後の自動処理で対応**: 中央トリミングにより、撮影時の構図を気にせず3:2に統一できる
2. **UXの簡素化**: ユーザーは複雑な操作なしに撮影できる
3. **実装コスト**: 既に実装済みで追加コスト不要

**適用シーン**:
- 整備工場での作業写真撮影（構図の厳密な調整は不要）
- 40+ユーザー向けのシンプルなUI

#### オプションB: リアルタイムカメラプレビュー + フレームガイド

**実装方法**:
- `getUserMedia` APIを使用してリアルタイムカメラビューを表示
- Canvas上に3:2のフレームガイドをオーバーレイ表示

**メリット**:
- 撮影前に構図を確認できる
- フレーム内に被写体を収めやすい

**デメリット**:
- 実装が複雑（大規模な変更が必要）
- パフォーマンス負荷（複数カメラ同時使用時）
- ブラウザ互換性の問題
- HTTPS必須（開発環境での制約）
- ユーザーがパーミッションを許可する必要がある

**適用シーン**:
- 構図が重要な写真撮影（プロ向け）
- リアルタイムプレビューが必要な場合

### 推奨: オプションA（現在の方式を維持）

**理由**:

1. **自動処理で対応可能**
   - 中央トリミングにより、どのアスペクト比で撮影しても3:2に統一される
   - ユーザーは構図を気にせず撮影できる

2. **40+ユーザー向けUI設計に適合**
   - シンプルで直感的
   - 複雑な操作が不要

3. **実装コストが低い**
   - 既に実装済み
   - メンテナンスが容易

4. **パフォーマンス**
   - サーバー負荷なし
   - クライアントサイド処理のみ

### 将来的な拡張案

もし将来的にフレームガイドが必要になった場合の実装方針：

1. **簡易ガイド（軽量実装）**
   - 撮影ボタンを押したときに、簡単な説明を表示
   - 「撮影後、自動的に3:2に調整されます」というメッセージ

2. **オプション機能として追加**
   - 設定で「フレームガイドを表示」をON/OFF切り替え可能
   - 必要に応じて有効化

## 実装済み機能の詳細

### 処理フロー

```
撮影
  ↓
アスペクト比3:2に変換（中央トリミング）
  ↓
ウォーターマーク合成（右下にロゴ）
  ↓
画像圧縮（500KB以下、最大1920px）
  ↓
ローカル保存（端末に保存）
  ↓
Google Driveにアップロード（既存機能）
```

### アスペクト比変換の挙動

| 元画像のアスペクト比 | 処理方法 |
|---------------------|----------|
| 4:3（横長） | 上下を中央トリミング |
| 16:9（横長） | 上下を中央トリミング |
| 1:1（正方形） | 左右を中央トリミング |
| 3:4（縦長） | 左右を中央トリミング |
| 既に3:2 | 変換なし（そのまま） |

### ローカル保存の挙動

**Chrome系ブラウザ（Android Chrome、Desktop Chrome）**:
- File System Access APIを使用
- 保存先選択ダイアログが表示される
- ユーザーが保存先を指定可能

**その他ブラウザ（iOS Safari等）**:
- ダウンロード方式で自動保存
- デフォルトのダウンロードフォルダに保存
- iOSの場合: 写真アプリの「ファイル」に保存される可能性

## まとめ

✅ **アスペクト比3:2への変換**: 実装済み（中央トリミング）
✅ **ローカル保存**: 実装済み（自動保存）
⚠️ **フレームガイド**: 未実装（現状の自動処理で対応可能なため、実装不要と判断）

現在の実装で、仕様書の要件を満たしています。




