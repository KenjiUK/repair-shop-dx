# 故障診断 業務理解・分析書

## ドキュメント情報

- **作成日**: 2025-01-XX
- **バージョン**: 1.0
- **対象**: 故障診断の業務理解・分析
- **ステータス**: 分析中

---

## 1. 業務の特徴

### 1-1. 基本的な特徴

- **所要日数**: 1日〜数日（原因特定の難易度による）
- **検査項目**: 不具合箇所に応じて変動
- **作業内容**: 原因特定が中心、必要に応じて修理
- **顧客の関心**: 「何が原因か」「修理費用」「修理期間」
- **業務フローパターン**: **パターンA（入庫してから見積もり）** の可能性が高い

### 1-2. 他の入庫区分との違い

| 項目 | 車検・12ヶ月点検 | エンジンオイル交換など | 故障診断 |
|------|-----------------|---------------------|---------|
| **業務フロー** | パターンA（入庫→見積→承認→作業） | パターンB（事前見積→了承→入庫→作業） | **パターンA（入庫→診断→見積→承認→作業）** |
| **検査項目** | 法定項目（固定） | 簡易検査（固定） | **症状に応じて変動** |
| **所要時間** | 1日（固定） | 1時間以内（固定） | **1日〜数日（変動）** |
| **見積タイミング** | 診断後 | 事前 | **診断後（原因特定後）** |
| **緊急度** | なし | なし | **あり（安全に関わる場合）** |

---

## 2. 業務フロー（あるべき姿）

### 2-1. Phase 0: 予約・事前準備

- **顧客の行動**: 不具合を感じたら予約
- **スタッフの行動**: 
  - 不具合内容の確認（電話・メール等）
  - 前回整備履歴の確認
  - 緊急度の判断（安全に関わる場合は優先対応）
- **システム要件**: 
  - 不具合内容の事前入力（field7: 詳細情報）
  - 前回整備履歴の表示
  - 緊急度の設定

### 2-2. Phase 1: 受付

- **所要時間**: 約5-10分
- **確認事項**: 
  - 不具合の詳細（いつから、どんな症状、頻度など）
  - 走行距離
  - 前回整備からの経過
  - 緊急度の確認（安全に関わる場合は強調）
- **記録内容**: 
  - 不具合の詳細（顧客の説明）
  - 走行距離
  - 前回整備履歴
  - 緊急度の設定

### 2-3. Phase 2: 診断・検査

- **所要時間**: 約1-3時間（原因特定の難易度による）
- **検査項目**: 
  - **症状に応じた検査**: 不具合箇所の特定
    - エンジン不調 → エンジン系統の検査（圧力、電圧、温度など）
    - ブレーキ不調 → ブレーキ系統の検査（パッド残量、フルード、ローターなど）
    - 異音 → 音源の特定（動画撮影、音声録音）
    - 電装系不調 → 電装系統の検査（電圧、抵抗など）
    - エアコン不調 → エアコン系統の検査（冷媒圧力、温度など）
  - **関連箇所の検査**: 原因の可能性がある箇所
- **記録内容**: 
  - 検査結果（正常/異常/要交換）
  - 測定値（圧力、電圧、温度など専門的な測定値）
  - 写真・動画（異音の録音、動作不良の動画撮影、異常箇所の撮影）
  - コメント（整備士の所見、原因の推測）
  - 緊急度の設定（安全に関わる場合は強調）

### 2-4. Phase 3: 見積作成

- **所要時間**: 約30分-1時間
- **作業内容**: 
  - 原因特定の結果報告
  - 修理方法の提案（複数の選択肢がある場合）
  - 費用見積もり
- **記録内容**: 
  - 原因の説明（写真・動画を交えた説明）
  - 修理方法の提案（複数の選択肢）
  - 部品代・工賃の見積もり
  - 写真・動画の紐付け
  - 緊急度の表示（安全に関わる場合は強調表示）

### 2-5. Phase 4: 顧客承認

- **所要時間**: 顧客の検討時間による（即決〜数日）
- **顧客の行動**: 
  - 原因の確認
  - 修理方法の確認（複数の選択肢がある場合）
  - 費用の確認
  - 承認・却下
- **システム要件**: 
  - 原因の明確な説明（写真・動画を交えた説明）
  - 修理方法の選択肢（複数の選択肢がある場合）
  - 緊急度の表示（安全に関わる場合は強調）

### 2-6. Phase 5: 作業実施

- **所要時間**: 承認後、約1-4時間（修理内容による）
- **作業内容**: 
  - 原因箇所の修理
  - 関連箇所の点検・調整
  - 動作確認
- **記録内容**: 
  - 実施した修理の記録
  - Before/After写真
  - 交換部品の記録
  - 動作確認の結果

### 2-7. Phase 6: 引渡・説明

- **所要時間**: 約15-30分
- **作業内容**: 
  - 修理内容の説明
  - 動作確認のデモ
  - 今後の注意事項
- **記録内容**: 
  - 引渡日時
  - 顧客への説明内容

---

## 3. システム要件（あるべき姿）

### 3-1. 診断画面での要件

#### 症状に応じた検査項目の表示
- **不具合内容から関連する検査項目を自動表示**
- 症状カテゴリ（エンジン、ブレーキ、異音、電装系、エアコンなど）を選択
- 選択されたカテゴリに応じて、関連する検査項目を自動表示

#### 動画撮影
- **異音の録音**: 音声録音機能
- **動作不良の動画撮影**: 動画撮影機能
- **異常箇所の撮影**: 写真撮影機能
- 動画はGoogle Driveに保存

#### 測定値の入力
- **専門的な測定値**: 圧力、電圧、温度など
- **測定値の単位**: kPa、V、℃、Ωなど
- **測定値の比較**: 正常値との比較表示

#### 原因の推測
- **整備士の所見を記録**: 音声入力対応
- **原因の推測**: 複数の可能性がある場合、複数記録可能
- **緊急度の設定**: 安全に関わる場合は緊急度を設定

### 3-2. 見積画面での要件

#### 原因の明確な説明
- **写真・動画を交えた説明**: 証拠写真・動画を紐付け
- **原因の説明**: わかりやすい説明文
- **修理方法の選択肢**: 複数の修理方法を提案可能

#### 緊急度の表示
- **安全に関わる場合は強調表示**: 赤色で強調
- **緊急度の説明**: なぜ緊急なのかを説明

### 3-3. 作業画面での要件

#### 作業記録
- **実施した修理の記録**: 修理内容を詳細に記録
- **Before/After写真**: 修理前後の写真
- **交換部品の記録**: 交換した部品の種類・型番・数量
- **動作確認の結果**: 動作確認の結果を記録

---

## 4. データモデル

### 4-1. 故障診断ジョブデータ

```typescript
/**
 * 故障診断ジョブ
 */
export interface FaultDiagnosisJob {
  /** Job ID */
  jobId: string;
  /** 入庫区分 */
  serviceKind: "故障診断";
  
  /** 不具合情報 */
  fault: {
    /** 不具合の詳細（顧客の説明） */
    description: string;
    /** 症状カテゴリ */
    symptomCategory: SymptomCategory;
    /** 緊急度 */
    urgency: UrgencyLevel;
    /** 走行距離 */
    mileage: number;
  };
  
  /** 診断情報 */
  diagnosis: {
    /** 検査項目の結果 */
    inspectionResults: InspectionResult[];
    /** 測定値 */
    measurements: Record<string, number>;
    /** 写真・動画 */
    photos: Photo[];
    videos: Video[];
    /** コメント（整備士の所見） */
    comments: string;
    /** 原因の推測 */
    suspectedCauses: SuspectedCause[];
  };
  
  /** 見積情報 */
  estimate: {
    /** 原因の説明 */
    causeExplanation: string;
    /** 修理方法の提案 */
    repairOptions: RepairOption[];
    /** 部品代・工賃の見積もり */
    parts: Part[];
    labor: number;
    total: number;
    /** 緊急度の表示 */
    urgency: UrgencyLevel;
  };
  
  /** 作業情報 */
  work: {
    /** 実施した修理の記録 */
    repairRecords: RepairRecord[];
    /** Before/After写真 */
    photos: Photo[];
    /** 交換部品 */
    replacedParts: ReplacedPart[];
    /** 動作確認結果 */
    operationCheck: OperationCheckResult;
  };
}

/**
 * 症状カテゴリ
 */
export type SymptomCategory =
  | "エンジン不調"
  | "ブレーキ不調"
  | "異音"
  | "電装系不調"
  | "エアコン不調"
  | "その他";

/**
 * 緊急度レベル
 */
export type UrgencyLevel = "normal" | "high" | "urgent";

/**
 * 原因の推測
 */
export interface SuspectedCause {
  /** 原因ID */
  id: string;
  /** 原因の説明 */
  description: string;
  /** 確信度（%） */
  confidence: number;
}

/**
 * 修理方法の選択肢
 */
export interface RepairOption {
  /** 選択肢ID */
  id: string;
  /** 修理方法の説明 */
  description: string;
  /** 費用 */
  cost: number;
  /** 所要時間 */
  duration: number;
  /** 推奨度 */
  recommendation: "recommended" | "alternative" | "optional";
}
```

---

## 5. 質問事項

以下の点について確認が必要です：

1. **業務フローパターン**: パターンA（入庫→診断→見積→承認→作業）で正しいか？
2. **症状カテゴリ**: どのような症状カテゴリがあるか？
3. **検査項目**: 症状カテゴリごとにどのような検査項目があるか？
4. **測定値**: どのような測定値が必要か？
5. **動画撮影**: 動画撮影は必須か、任意か？
6. **緊急度**: 緊急度の判断基準は何か？
7. **修理方法の選択肢**: 複数の修理方法を提案する場合の扱いは？
8. **所要日数**: 原因特定に時間がかかる場合の扱いは？
9. **PDF生成**: 故障診断でもPDFを生成するか？
10. **データソース**: 車両情報や費用情報の取得元は？

---

## 更新履歴

- 2025-01-XX: 初版作成


























