# 板金・塗装 画面設計書

## ドキュメント情報

- **作成日**: 2025-01-XX
- **バージョン**: 1.1
- **対象**: 板金・塗装の各画面の詳細設計
- **設計方針**: 世界最高のUI/UX、ITコンサルの目線での推奨を元に設計
- **業務フローパターン**: パターンA（入庫→診断→見積→承認→外注発注→外注作業→引き取り→引渡）
- **注意**: 自社で施工を行わず外注先に預ける、事故案件も多い（レッカー入庫、保険対応）、作業期間1-3カ月、Before/After写真必須

---

## 複数作業管理対応

この画面設計書は、1つの入庫に対して複数の作業を管理する「複数作業管理」に対応しています。

**対応内容**:
- 各画面は特定のワークオーダー（作業）に対応
- URLパラメータ `workOrderId` で対象ワークオーダーを識別
- 画面ヘッダーに現在の作業名を表示
- 「他の作業を表示」ボタンで同じJobの他のワークオーダーに切替可能
- データはZoho CRM `field_work_orders` フィールドに作業ごとに保存
- **長期作業の特性**: 板金・塗装は長期作業（1-3カ月）のため、他の作業と並行して管理される場合がある

**詳細は [統合仕様書](./INTEGRATED_SPECIFICATION.md) の「2-4. 複数作業管理の実装」を参照してください。**

---

## 1. 画面一覧

### 1-1. フロントスタッフ向け画面

1. **受付画面** (`/admin/reception/[id]`)
   - 事故案件の識別（事故/通常）
   - レッカー入庫の記録
   - 保険対応の有無
   - 走行距離の入力
   - 前回板金・塗装履歴の表示

### 1-2. 整備士向け画面

1. **診断画面** (`/mechanic/diagnosis/[id]`)
   - 損傷箇所の確認（板金箇所、塗装箇所）
   - Before写真・動画の撮影（必須）
   - 外注先への見積もり依頼（写真送付/持ち込み）
   - 外注先からの見積もり回答の記録

2. **見積画面** (`/admin/estimate/[id]`)
   - 外注先からの見積もり回答の表示
   - 自社見積もりの作成（板金費用、塗装費用、部品費用など）
   - 作業期間の表示（1-3カ月）
   - 保険対応の場合は保険会社への見積もり提出

3. **外注発注画面** (`/admin/outsourcing/[id]`)
   - 外注先名の入力（テキスト入力）
   - 発注方法の選択（写真送付/持ち込み）
   - 発注内容の確認
   - 預け日時の記録

4. **外注作業管理画面** (`/admin/outsourcing-progress/[id]`)
   - 外注先での作業進捗状況の表示
   - 作業完了連絡の受付
   - 作業期間の表示（1-3カ月）

5. **引き取り・品質確認画面** (`/admin/quality-check/[id]`)
   - 外注先からの引き取り
   - 品質確認チェックリスト
   - After写真の撮影（必須）
   - 品質確認結果の記録

### 1-3. 特徴

- **外注管理**: 自社で施工を行わず、外注先に預ける
- **外注先管理**: マスタ管理不要、テキスト入力で記録
- **事故案件**: 事故案件も多い（レッカー入庫、保険対応）
- **写真撮影**: Before写真・動画（必須）、After写真（必須）
- **作業期間**: 1-3カ月と長期間
- **代車提供**: ケースバイケース
- **PDF生成**: 不要

---

## 2. 受付画面の詳細設計

### 2-1. 画面構成

#### レイアウト構造

```
┌─────────────────────────────────────────┐
│ [←] 田中様 BMW X3 板金・塗装受付          │
├─────────────────────────────────────────┤
│ 📋 車両情報（自動入力済み・編集不可）     │
│ ┌─────────────────────────────────────┐ │
│ │ 登録番号: 堺 330 す 1669            │ │
│ │ 車台番号: VF3CUHNZTHY061316         │ │
│ │ 初度登録: H29.10                    │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 🚨 事故案件情報                         │
│ ┌─────────────────────────────────────┐ │
│ │ [✓] 事故案件                         │ │
│ │ [ ] 通常の板金・塗装                 │ │
│ │                                      │ │
│ │ [✓] レッカー入庫                     │ │
│ │ [ ] 通常入庫                         │ │
│ │                                      │ │
│ │ [✓] 保険対応あり                     │ │
│ │ [ ] 保険対応なし                     │ │
│ │                                      │ │
│ │ 保険会社名: [________________]       │ │
│ │                                      │ │
│ │ 事故の程度: [▼] 中程度              │ │
│ │  軽微 / 中程度 / 深刻 / 全損         │ │
│ │                                      │ │
│ │ 事故の種類: [▼] 追突                │ │
│ │  追突 / 出会い頭 / 側面衝突 /        │ │
│ │  単独事故 / その他                  │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📏 走行距離                            │
│ ┌─────────────────────────────────────┐ │
│ │ 現在の走行距離: [____] km           │ │
│ │                                      │ │
│ │ 前回板金・塗装履歴:                  │ │
│ │ 2023年8月: フロントバンパー塗装     │ │
│ │ 2022年3月: ドア板金・塗装           │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 🚗 代車提供                            │
│ ┌─────────────────────────────────────┐ │
│ │ [ ] 代車を提供する                   │ │
│ │                                      │ │
│ │ （チェックした場合のみ表示）          │ │
│ │ 代車: [▼] 選択してください          │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📝 備考                                │
│ ┌─────────────────────────────────────┐ │
│ │                                     │ │
│ │  その他の情報、特記事項など          │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│           [入庫確定]                    │
└─────────────────────────────────────────┘
```

### 2-2. コンポーネント設計

#### 事故案件情報セクション

**目的**: 事故案件か通常の板金・塗装かを識別し、レッカー入庫や保険対応の有無を記録

**UI要素**:
- **事故案件選択**: ラジオボタンまたはトグルスイッチ
  - 「事故案件」/「通常の板金・塗装」
- **レッカー入庫選択**: チェックボックス
  - 「レッカー入庫」/「通常入庫」
- **保険対応選択**: チェックボックス
  - 「保険対応あり」/「保険対応なし」
- **保険会社名入力**: テキスト入力（保険対応ありの場合のみ表示）
- **事故の程度選択**: ドロップダウン
  - 軽微 / 中程度 / 深刻 / 全損
- **事故の種類選択**: ドロップダウン
  - 追突 / 出会い頭 / 側面衝突 / 単独事故 / その他

**バリデーション**:
- 事故案件を選択した場合、事故の程度と種類は必須
- 保険対応ありを選択した場合、保険会社名は必須

#### 走行距離セクション

**目的**: 現在の走行距離を記録し、前回の板金・塗装履歴を表示

**UI要素**:
- **走行距離入力**: 数値入力フィールド（km単位）
- **前回履歴表示**: 過去の板金・塗装履歴をリスト表示

**データソース**:
- 前回履歴: Zoho CRMから取得（同じ車両IDの過去の板金・塗装ジョブ）

#### 代車提供セクション

**目的**: 代車の提供有無を記録（ケースバイケース）

**UI要素**:
- **代車提供チェックボックス**: チェックボックス
- **代車選択**: ドロップダウン（チェックした場合のみ表示）
  - 利用可能な代車のリストから選択

**データソース**:
- 代車リスト: Google Sheets「【DB】代車マスタ」から取得

### 2-3. データフロー

1. **画面表示時**:
   - 車両情報を自動入力（編集不可）
   - 前回板金・塗装履歴を取得して表示
   - 利用可能な代車リストを取得

2. **入庫確定時**:
   - 事故案件情報、走行距離、代車情報を保存
   - Jobステータスを「診断中」に更新

---

## 3. 診断画面の詳細設計

### 3-1. 画面構成

#### レイアウト構造

```
┌─────────────────────────────────────────┐
│ [←] 田中様 BMW X3 板金・塗装診断          │
├─────────────────────────────────────────┤
│ 📋 車両情報（参照のみ）                  │
│ ┌─────────────────────────────────────┐ │
│ │ 登録番号: 堺 330 す 1669            │ │
│ │ 走行距離: 45,000 km                 │ │
│ │ 事故案件: 事故案件（レッカー入庫）   │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 🔍 損傷箇所の確認                       │
│ ┌─────────────────────────────────────┐ │
│ │ [+ 損傷箇所を追加]                  │ │
│ │                                      │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ 損傷箇所 #1                     │ │ │
│ │ │                                │ │ │
│ │ │ 部位: [▼] フロントバンパー     │ │ │
│ │ │                                │ │ │
│ │ │ 損傷の種類:                     │ │ │
│ │ │ [✓] 板金                        │ │ │
│ │ │ [✓] 塗装                        │ │ │
│ │ │                                │ │ │
│ │ │ 損傷の程度: [▼] 中程度         │ │ │
│ │ │  軽微 / 中程度 / 深刻           │ │ │
│ │ │                                │ │ │
│ │ │ 📷 Before写真: [写真を撮影]    │ │ │
│ │ │ [画像プレビュー1] [画像2]      │ │ │
│ │ │                                │ │ │
│ │ │ 🎥 Before動画: [動画を撮影]    │ │ │
│ │ │ [動画プレビュー]                │ │ │
│ │ │                                │ │ │
│ │ │ コメント:                       │ │ │
│ │ │ ────────────────────────────── │ │ │
│ │ │                                │ │ │
│ │ │ [削除]                          │ │ │
│ │ └────────────────────────────────┘ │ │
│ │                                      │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ 損傷箇所 #2                     │ │ │
│ │ │ ...                            │ │ │
│ │ └────────────────────────────────┘ │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📤 外注先への見積もり依頼               │
│ ┌─────────────────────────────────────┐ │
│ │ 依頼方法:                           │ │
│ │ [✓] 写真送付                        │ │
│ │ [ ] 持ち込み                        │ │
│ │                                      │ │
│ │ 外注先名: [________________]         │ │
│ │                                      │ │
│ │ [見積もり依頼を送信]                │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📥 外注先からの見積もり回答             │
│ ┌─────────────────────────────────────┐ │
│ │ [外注先からの見積もり回答を入力]    │ │
│ │                                      │ │
│ │ （見積もり依頼後に表示）             │ │
│ │                                      │ │
│ │ 外注先名: [________________]         │ │
│ │                                      │ │
│ │ 見積もり項目:                        │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ [+ 項目を追加]                  │ │ │
│ │ │                                │ │ │
│ │ │ 項目名: [________]              │ │ │
│ │ │ 数量: [__] 単価: [____] 円     │ │ │
│ │ │ 金額: [______] 円               │ │ │
│ │ │                                │ │ │
│ │ │ [削除]                          │ │ │
│ │ └────────────────────────────────┘ │ │
│ │                                      │ │
│ │ 合計金額: [______] 円                │ │
│ │                                      │ │
│ │ 回答日時: [____/__/__ __:__]        │ │
│ │                                      │ │
│ │ 備考:                               │ │
│ │ ─────────────────────────────────── │ │
│ │                                      │ │
│ │ [見積もり回答を保存]                │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📝 整備士の所見                        │
│ ┌─────────────────────────────────────┐ │
│ │                                     │ │
│ │  診断結果、特記事項など              │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│           [診断完了]                    │
└─────────────────────────────────────────┘
```

### 3-2. コンポーネント設計

#### 損傷箇所の確認セクション

**目的**: 損傷箇所を記録し、Before写真・動画を撮影

**UI要素**:
- **損傷箇所追加ボタン**: 「+ 損傷箇所を追加」ボタン
- **損傷箇所カード**: 各損傷箇所ごとにカード表示
  - **部位選択**: ドロップダウン
    - フロントバンパー / リアバンパー / フロントドア / リアドア / フェンダー / ルーフ / トランク / その他
  - **損傷の種類**: チェックボックス
    - 板金 / 塗装 / 板金・塗装
  - **損傷の程度**: ドロップダウン
    - 軽微 / 中程度 / 深刻
  - **Before写真撮影**: カメラボタン（必須）
    - 複数枚撮影可能
    - 画像プレビュー表示
  - **Before動画撮影**: 動画ボタン（オプション）
    - 動画プレビュー表示
  - **コメント入力**: テキストエリア
  - **削除ボタン**: 損傷箇所を削除

**バリデーション**:
- 損傷箇所は最低1箇所必須
- 各損傷箇所でBefore写真は必須
- 部位、損傷の種類、損傷の程度は必須

#### 外注先への見積もり依頼セクション

**目的**: 外注先に写真を送付するか、車両を持ち込むかを選択し、見積もりを依頼

**UI要素**:
- **依頼方法選択**: ラジオボタン
  - 写真送付 / 持ち込み
- **外注先名入力**: テキスト入力（マスタ管理不要）
- **見積もり依頼送信ボタン**: ボタン

**動作**:
- 「写真送付」を選択した場合、撮影したBefore写真・動画を外注先に送信（実際の送信機能は実装しない、記録のみ）
- 「持ち込み」を選択した場合、車両を持ち込む旨を記録

#### 外注先からの見積もり回答セクション

**目的**: 外注先からの見積もり回答を記録

**UI要素**:
- **外注先名入力**: テキスト入力
- **見積もり項目追加**: 「+ 項目を追加」ボタン
- **見積もり項目カード**: 各項目ごとにカード表示
  - 項目名、数量、単価、金額を入力
  - 削除ボタン
- **合計金額表示**: 自動計算
- **回答日時入力**: 日時ピッカー
- **備考入力**: テキストエリア
- **見積もり回答保存ボタン**: ボタン

**バリデーション**:
- 見積もり項目は最低1項目必須
- 各項目の項目名、数量、単価は必須
- 合計金額は自動計算

### 3-3. データフロー

1. **画面表示時**:
   - 車両情報を表示
   - 既存の損傷箇所情報を表示（あれば）

2. **損傷箇所追加時**:
   - 新しい損傷箇所カードを追加
   - 写真・動画撮影機能を有効化

3. **見積もり依頼送信時**:
   - 依頼方法と外注先名を記録
   - 見積もり回答セクションを表示

4. **見積もり回答保存時**:
   - 外注先からの見積もり回答を保存
   - Jobステータスを「見積作成待ち」に更新

---

## 4. 見積画面の詳細設計

### 4-1. 画面構成

#### レイアウト構造

```
┌─────────────────────────────────────────┐
│ [←] 田中様 BMW X3 板金・塗装見積          │
├─────────────────────────────────────────┤
│ 📋 車両情報（参照のみ）                  │
│ ┌─────────────────────────────────────┐ │
│ │ 登録番号: 堺 330 す 1669            │ │
│ │ 走行距離: 45,000 km                 │ │
│ │ 事故案件: 事故案件（保険対応あり）   │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📥 外注先からの見積もり回答（参照）      │
│ ┌─────────────────────────────────────┐ │
│ │ 外注先名: ○○板金塗装店              │ │
│ │ 回答日時: 2025/01/15 14:30          │ │
│ │                                      │ │
│ │ 見積もり項目:                        │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ フロントバンパー板金            │ │ │
│ │ │ 数量: 1  単価: 50,000円        │ │ │
│ │ │ 金額: 50,000円                 │ │ │
│ │ └────────────────────────────────┘ │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ フロントバンパー塗装            │ │ │
│ │ │ 数量: 1  単価: 80,000円        │ │ │
│ │ │ 金額: 80,000円                 │ │ │
│ │ └────────────────────────────────┘ │ │
│ │                                      │ │
│ │ 合計金額: 130,000円                 │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 💰 自社見積もり                         │
│ ┌─────────────────────────────────────┐ │
│ │ [+ 見積もり項目を追加]              │ │
│ │                                      │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ 項目名: [フロントバンパー板金]  │ │ │
│ │ │ 数量: [1] 単価: [50,000] 円    │ │ │
│ │ │ 金額: [50,000] 円               │ │ │
│ │ │                                │ │ │
│ │ │ 備考:                           │ │ │
│ │ │ ────────────────────────────── │ │ │
│ │ │                                │ │ │
│ │ │ [削除]                          │ │ │
│ │ └────────────────────────────────┘ │ │
│ │                                      │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ 項目名: [フロントバンパー塗装]  │ │ │
│ │ │ 数量: [1] 単価: [90,000] 円    │ │ │
│ │ │ 金額: [90,000] 円               │ │ │
│ │ │                                │ │ │
│ │ │ 備考:                           │ │ │
│ │ │ ────────────────────────────── │ │ │
│ │ │                                │ │ │
│ │ │ [削除]                          │ │ │
│ │ └────────────────────────────────┘ │ │
│ │                                      │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ 小計: 140,000円                 │ │ │
│ │ │ 消費税(10%): 14,000円          │ │ │
│ │ │ ────────────────────────────── │ │ │
│ │ │ 合計: 154,000円                 │ │ │
│ │ └────────────────────────────────┘ │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ ⏱️ 作業期間                             │
│ ┌─────────────────────────────────────┐ │
│ │ 予定作業期間: [2] カ月              │ │
│ │                                      │ │
│ │ ⚠️ 作業期間が長いため、車両を預ける  │ │
│ │   必要があります。                  │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 🛡️ 保険対応（該当する場合）             │
│ ┌─────────────────────────────────────┐ │
│ │ 保険会社: ○○保険                    │ │
│ │                                      │ │
│ │ [保険会社への見積もり提出]          │ │
│ │                                      │ │
│ │ 保険承認状況:                        │ │
│ │ [✓] 承認済み                         │ │
│ │ [ ] 承認待ち                         │ │
│ │                                      │ │
│ │ 承認日時: [____/__/__ __:__]        │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📝 備考                                │
│ ┌─────────────────────────────────────┐ │
│ │                                     │ │
│ │  顧客への説明事項など                │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│           [見積もり確定]                │
└─────────────────────────────────────────┘
```

### 4-2. コンポーネント設計

#### 外注先からの見積もり回答セクション

**目的**: 外注先からの見積もり回答を参照（編集不可）

**UI要素**:
- **外注先名表示**: テキスト表示
- **回答日時表示**: テキスト表示
- **見積もり項目リスト**: リスト表示（編集不可）
  - 項目名、数量、単価、金額を表示
- **合計金額表示**: テキスト表示

#### 自社見積もりセクション

**目的**: 外注先からの見積もり回答を基に、自社で見積もりを作成

**基幹システム連携フロー**:
1. アドバイザー（フロントスタッフ）がWebアプリの見積作成画面を開く
2. 外注先からの見積もり回答を確認
3. **基幹システム（スマートカーディーラー）で該当作業の見積書を作成**（アドバイザーが実施）
4. **Webアプリに「品名」と「金額（税込）」を転記**（アドバイザーが実施）
5. 見積情報を保存（Zoho CRM field_work_orders内の該当作業の見積情報を更新）

**制約**:
- 見積計算は基幹システムで実施（Webアプリは転記のみ）
- 外注先からの見積もり回答は参照のみ（編集不可）

**UI要素**:
- **見積もり項目追加ボタン**: 「+ 見積もり項目を追加」ボタン
- **見積もり項目カード**: 各項目ごとにカード表示
  - **項目名入力**: テキスト入力
  - **数量入力**: 数値入力
  - **単価入力**: 数値入力（円単位）
  - **金額表示**: 自動計算（数量 × 単価）
  - **備考入力**: テキストエリア
  - **削除ボタン**: 項目を削除
- **小計表示**: 自動計算
- **消費税表示**: 自動計算（小計 × 10%）
- **合計表示**: 自動計算（小計 + 消費税）

**バリデーション**:
- 見積もり項目は最低1項目必須
- 各項目の項目名、数量、単価は必須
- 数量と単価は0より大きい値

#### 作業期間セクション

**目的**: 作業期間を表示し、顧客に長期間預ける必要があることを明示

**UI要素**:
- **予定作業期間入力**: 数値入力（カ月単位、1-3カ月）
- **警告メッセージ**: 作業期間が長いことを警告

**バリデーション**:
- 予定作業期間は1-3カ月の範囲内

#### 保険対応セクション

**目的**: 保険対応の場合、保険会社への見積もり提出と承認状況を管理

**UI要素**:
- **保険会社名表示**: テキスト表示（受付画面で入力済み）
- **見積もり提出ボタン**: ボタン（実際の提出機能は実装しない、記録のみ）
- **保険承認状況選択**: ラジオボタン
  - 承認済み / 承認待ち
- **承認日時入力**: 日時ピッカー（承認済みの場合のみ表示）

**表示条件**:
- 受付画面で「保険対応あり」を選択した場合のみ表示

### 4-3. データフロー

1. **画面表示時**:
   - 車両情報を表示
   - 外注先からの見積もり回答を表示（診断画面で入力済み）
   - 既存の自社見積もりを表示（あれば）

2. **見積もり項目追加時**:
   - 新しい見積もり項目カードを追加
   - 金額を自動計算

3. **見積もり確定時**:
   - 自社見積もりを保存
   - 作業期間を保存
   - 保険承認状況を保存（該当する場合）
   - Jobステータスを「顧客承認待ち」に更新

---

## 5. 外注発注画面の詳細設計

### 5-1. 画面構成

#### レイアウト構造

```
┌─────────────────────────────────────────┐
│ [←] 田中様 BMW X3 板金・塗装外注発注      │
├─────────────────────────────────────────┤
│ 📋 車両情報（参照のみ）                  │
│ ┌─────────────────────────────────────┐ │
│ │ 登録番号: 堺 330 す 1669            │ │
│ │ 走行距離: 45,000 km                 │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📄 見積もり内容（参照のみ）              │
│ ┌─────────────────────────────────────┐ │
│ │ 見積合計: 154,000円                 │ │
│ │ 作業期間: 2カ月                    │ │
│ │                                      │ │
│ │ 損傷箇所:                           │ │
│ │ - フロントバンパー（板金・塗装）    │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 🏭 外注先情報                           │
│ ┌─────────────────────────────────────┐ │
│ │ 外注先名: [________________]        │ │
│ │                                      │ │
│ │ ⚠️ 外注先のマスタ管理は不要です。    │ │
│ │   テキスト入力で記録します。          │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📤 発注方法                             │
│ ┌─────────────────────────────────────┐ │
│ │ [✓] 写真送付                        │ │
│ │ [ ] 持ち込み                        │ │
│ │                                      │ │
│ │ （写真送付を選択した場合）           │ │
│ │ Before写真・動画:                   │ │
│ │ [画像1] [画像2] [動画1]             │ │
│ │                                      │ │
│ │ [写真・動画を送信]                  │ │
│ │                                      │ │
│ │ （持ち込みを選択した場合）           │ │
│ │ 持ち込み予定日時:                    │ │
│ │ [____/__/__ __:__]                  │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📅 預け日時                             │
│ ┌─────────────────────────────────────┐ │
│ │ 預け日時: [____/__/__ __:__]        │ │
│ │                                      │ │
│ │ （車両を外注先に預けた日時）         │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📝 備考                                │
│ ┌─────────────────────────────────────┐ │
│ │                                     │ │
│ │  発注時の特記事項など                │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│           [外注発注確定]                │
└─────────────────────────────────────────┘
```

### 5-2. コンポーネント設計

#### 外注先情報セクション

**目的**: 外注先名をテキスト入力で記録（マスタ管理不要）

**UI要素**:
- **外注先名入力**: テキスト入力
- **注意メッセージ**: マスタ管理不要であることを明示

**バリデーション**:
- 外注先名は必須

#### 発注方法セクション

**目的**: 写真送付か持ち込みかを選択し、発注を実行

**UI要素**:
- **発注方法選択**: ラジオボタン
  - 写真送付 / 持ち込み
- **写真・動画表示**: 診断画面で撮影したBefore写真・動画を表示（写真送付の場合）
- **写真・動画送信ボタン**: ボタン（実際の送信機能は実装しない、記録のみ）
- **持ち込み予定日時入力**: 日時ピッカー（持ち込みの場合）

**動作**:
- 「写真送付」を選択した場合、診断画面で撮影したBefore写真・動画を表示
- 「持ち込み」を選択した場合、持ち込み予定日時を入力

#### 預け日時セクション

**目的**: 車両を外注先に預けた日時を記録

**UI要素**:
- **預け日時入力**: 日時ピッカー

**バリデーション**:
- 預け日時は必須

### 5-3. データフロー

1. **画面表示時**:
   - 車両情報を表示
   - 見積もり内容を表示
   - 診断画面で撮影したBefore写真・動画を表示

2. **外注発注確定時**:
   - 外注先名、発注方法、預け日時を保存
   - 外注作業進捗を「発注済み」に更新
   - Jobステータスを「外注作業中」に更新

---

## 6. 外注作業管理画面の詳細設計

### 6-1. 画面構成

#### レイアウト構造

```
┌─────────────────────────────────────────┐
│ [←] 田中様 BMW X3 板金・塗装外注作業管理  │
├─────────────────────────────────────────┤
│ 📋 車両情報（参照のみ）                  │
│ ┌─────────────────────────────────────┐ │
│ │ 登録番号: 堺 330 す 1669            │ │
│ │ 走行距離: 45,000 km                 │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 🏭 外注先情報                           │
│ ┌─────────────────────────────────────┐ │
│ │ 外注先名: ○○板金塗装店              │ │
│ │ 発注日時: 2025/01/20 10:00          │ │
│ │ 預け日時: 2025/01/20 14:00          │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📊 作業進捗状況                         │
│ ┌─────────────────────────────────────┐ │
│ │ 現在のステータス:                    │ │
│ │ [●] 発注済み                        │ │
│ │ [●] 作業中                          │ │
│ │ [ ] 作業完了                        │ │
│ │ [ ] 引き取り済み                    │ │
│ │                                      │ │
│ │ 作業期間: 2カ月                     │ │
│ │ 予定完了日: 2025/03/20              │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📞 作業完了連絡                         │
│ ┌─────────────────────────────────────┐ │
│ │ 外注先から作業完了の連絡を受けた場合 │ │
│ │ 以下のボタンを押してください。       │ │
│ │                                      │ │
│ │ [作業完了連絡を受付]                │ │
│ │                                      │ │
│ │ （ボタンを押すと、作業完了日時を     │ │
│ │   記録し、ステータスを更新します）   │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📝 進捗メモ                            │
│ ┌─────────────────────────────────────┐ │
│ │                                     │ │
│ │  外注先との連絡内容、進捗状況など    │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│           [進捗メモを保存]              │
└─────────────────────────────────────────┘
```

### 6-2. コンポーネント設計

#### 作業進捗状況セクション

**目的**: 外注先での作業進捗状況を視覚的に表示

**UI要素**:
- **ステータス表示**: ステップインジケーター
  - 発注済み / 作業中 / 作業完了 / 引き取り済み
- **作業期間表示**: テキスト表示
- **予定完了日表示**: テキスト表示（預け日時 + 作業期間）

**データソース**:
- 外注情報から取得（外注発注画面で入力済み）

#### 作業完了連絡セクション

**目的**: 外注先から作業完了の連絡を受けた際に、ステータスを更新

**UI要素**:
- **作業完了連絡受付ボタン**: ボタン
  - クリックすると、作業完了日時を記録し、ステータスを「作業完了」に更新

**動作**:
- ボタンをクリックすると、現在の日時を作業完了日時として記録
- 外注作業進捗を「作業完了」に更新
- Jobステータスを「引き取り待ち」に更新

#### 進捗メモセクション

**目的**: 外注先との連絡内容や進捗状況を記録

**UI要素**:
- **進捗メモ入力**: テキストエリア
- **進捗メモ保存ボタン**: ボタン

**動作**:
- 進捗メモを保存（履歴として記録）

### 6-3. データフロー

1. **画面表示時**:
   - 車両情報を表示
   - 外注先情報を表示
   - 現在の作業進捗状況を表示
   - 予定完了日を計算して表示

2. **作業完了連絡受付時**:
   - 作業完了日時を記録
   - 外注作業進捗を「作業完了」に更新
   - Jobステータスを「引き取り待ち」に更新

3. **進捗メモ保存時**:
   - 進捗メモを保存（履歴として記録）

---

## 7. 引き取り・品質確認画面の詳細設計

### 7-1. 画面構成

#### レイアウト構造

```
┌─────────────────────────────────────────┐
│ [←] 田中様 BMW X3 板金・塗装品質確認      │
├─────────────────────────────────────────┤
│ 📋 車両情報（参照のみ）                  │
│ ┌─────────────────────────────────────┐ │
│ │ 登録番号: 堺 330 す 1669            │ │
│ │ 走行距離: 45,000 km                 │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 🏭 外注先情報                           │
│ ┌─────────────────────────────────────┐ │
│ │ 外注先名: ○○板金塗装店              │ │
│ │ 作業完了日: 2025/03/18 15:00        │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📥 引き取り情報                         │
│ ┌─────────────────────────────────────┐ │
│ │ 引き取り日時: [____/__/__ __:__]    │ │
│ │                                      │ │
│ │ （外注先から車両を引き取った日時）   │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ ✅ 品質確認                             │
│ ┌─────────────────────────────────────┐ │
│ │ 品質確認結果:                       │ │
│ │ [✓] 合格                            │ │
│ │ [ ] 要修正                          │ │
│ │ [ ] 返品                            │ │
│ │                                      │ │
│ │ 確認項目:                           │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ [+ 確認項目を追加]              │ │ │
│ │ │                                │ │ │
│ │ │ ┌────────────────────────────┐ │ │ │
│ │ │ │ 項目名: [塗装の仕上がり]   │ │ │ │
│ │ │ │ 結果: [▼] 合格             │ │ │ │
│ │ │ │  合格 / 要修正 / 不適合     │ │ │ │
│ │ │ │                            │ │ │ │
│ │ │ │ コメント:                   │ │ │ │
│ │ │ │ ────────────────────────── │ │ │ │
│ │ │ │                            │ │ │ │
│ │ │ │ [削除]                      │ │ │ │
│ │ │ └────────────────────────────┘ │ │ │
│ │ └────────────────────────────────┘ │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📷 After写真（必須）                    │
│ ┌─────────────────────────────────────┐ │
│ │ ⚠️ After写真の撮影は必須です。       │ │
│ │                                      │ │
│ │ [写真を撮影]                        │ │
│ │                                      │ │
│ │ [画像プレビュー1] [画像2] [画像3]   │ │
│ │                                      │ │
│ │ （最低1枚以上撮影してください）      │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 📝 品質確認コメント                     │
│ ┌─────────────────────────────────────┐ │
│ │                                     │ │
│ │  品質確認の結果、特記事項など        │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│           [品質確認完了]                │
└─────────────────────────────────────────┘
```

### 7-2. コンポーネント設計

#### 引き取り情報セクション

**目的**: 外注先から車両を引き取った日時を記録

**UI要素**:
- **引き取り日時入力**: 日時ピッカー

**バリデーション**:
- 引き取り日時は必須

#### 品質確認セクション

**目的**: 作業内容の品質を確認し、結果を記録

**UI要素**:
- **品質確認結果選択**: ラジオボタン
  - 合格 / 要修正 / 返品
- **確認項目追加ボタン**: 「+ 確認項目を追加」ボタン
- **確認項目カード**: 各項目ごとにカード表示
  - **項目名入力**: テキスト入力
  - **結果選択**: ドロップダウン
    - 合格 / 要修正 / 不適合
  - **コメント入力**: テキストエリア
  - **削除ボタン**: 項目を削除

**バリデーション**:
- 品質確認結果は必須
- 確認項目は最低1項目推奨（任意）

#### After写真セクション

**目的**: 作業完了後の写真を撮影（必須）

**UI要素**:
- **写真撮影ボタン**: カメラボタン
- **画像プレビュー**: 撮影した写真をプレビュー表示
- **注意メッセージ**: After写真の撮影が必須であることを明示

**バリデーション**:
- After写真は最低1枚以上必須

### 7-3. データフロー

1. **画面表示時**:
   - 車両情報を表示
   - 外注先情報を表示
   - 既存の品質確認情報を表示（あれば）

2. **品質確認完了時**:
   - 引き取り日時、品質確認結果、確認項目、After写真を保存
   - 外注作業進捗を「引き取り済み」に更新
   - Jobステータスを「出庫待ち」に更新

---

## 8. データモデル

### 8-1. BodyPaintJob

```typescript
/**
 * 板金・塗装ジョブ
 */
export interface BodyPaintJob {
  /** Job ID */
  jobId: string;
  /** 入庫区分 */
  serviceKind: "板金・塗装";
  
  /** 車両情報 */
  vehicle: {
    /** 車両ID */
    vehicleId: string;
    /** 走行距離 */
    mileage: number;
  };
  
  /** 事故案件情報 */
  accident: {
    /** 事故案件かどうか */
    isAccident: boolean;
    /** レッカー入庫かどうか */
    isTowTruck: boolean;
    /** 保険対応の有無 */
    hasInsurance: boolean;
    /** 保険会社名（保険対応の場合） */
    insuranceCompany?: string;
    /** 事故の程度・種類 */
    severity?: "軽微" | "中程度" | "深刻" | "全損";
    /** 事故の種類 */
    type?: "追突" | "出会い頭" | "側面衝突" | "単独事故" | "その他";
  };
  
  /** 診断情報 */
  diagnosis: {
    /** 損傷箇所 */
    damageLocations: DamageLocation[];
    /** Before写真 */
    beforePhotos: Photo[];
    /** Before動画 */
    beforeVideos: Video[];
    /** 外注先への見積もり依頼方法 */
    estimateRequestMethod: "写真送付" | "持ち込み";
    /** 外注先名（見積もり依頼時） */
    estimateRequestVendorName?: string;
    /** 外注先からの見積もり回答 */
    vendorEstimate?: VendorEstimate;
    /** コメント（整備士の所見） */
    comments: string;
  };
  
  /** 見積情報 */
  estimate: {
    /** 見積もり項目 */
    items: EstimateItem[];
    /** 小計 */
    subtotal: number;
    /** 消費税 */
    tax: number;
    /** 合計金額 */
    total: number;
    /** 作業期間（月） */
    workDuration: number; // 1-3カ月
    /** 承認日時 */
    approvedAt?: Date;
    /** 保険承認状況（保険対応の場合） */
    insuranceApproval?: {
      /** 承認状況 */
      status: "承認済み" | "承認待ち";
      /** 承認日時 */
      approvedAt?: Date;
    };
  };
  
  /** 外注情報 */
  outsourcing: {
    /** 外注先名（テキスト入力） */
    vendorName: string;
    /** 発注日時 */
    orderDate?: Date;
    /** 発注方法 */
    orderMethod: "写真送付" | "持ち込み";
    /** 持ち込み予定日時（持ち込みの場合） */
    deliveryScheduledDate?: Date;
    /** 預け日時 */
    deliveryDate?: Date;
    /** 作業進捗状況 */
    progress: "発注済み" | "作業中" | "作業完了" | "引き取り済み";
    /** 作業完了日時 */
    completionDate?: Date;
    /** 引き取り日時 */
    pickupDate?: Date;
    /** 進捗メモ */
    progressNotes?: string[];
  };
  
  /** 品質確認情報 */
  qualityCheck: {
    /** 品質確認結果 */
    result?: "合格" | "要修正" | "返品";
    /** 確認項目 */
    checkItems?: QualityCheckItem[];
    /** After写真（必須） */
    afterPhotos: Photo[];
    /** コメント */
    comments?: string;
  };
  
  /** 代車情報 */
  courtesyCar: {
    /** 代車の提供有無 */
    provided: boolean;
    /** 代車ID（提供した場合） */
    courtesyCarId?: string;
  };
  
  /** ステータス */
  status: "入庫待ち" | "診断中" | "見積作成待ち" | "顧客承認待ち" | "外注発注待ち" | "外注作業中" | "引き取り待ち" | "品質確認中" | "出庫待ち";
}

/**
 * 損傷箇所
 */
export interface DamageLocation {
  /** 部位 */
  location: string;
  /** 損傷の種類（板金、塗装） */
  type: "板金" | "塗装" | "板金・塗装";
  /** 損傷の程度 */
  severity: "軽微" | "中程度" | "深刻";
  /** Before写真 */
  photos: Photo[];
  /** Before動画 */
  videos?: Video[];
  /** コメント */
  comment?: string;
}

/**
 * 外注先からの見積もり回答
 */
export interface VendorEstimate {
  /** 外注先名 */
  vendorName: string;
  /** 見積もり項目 */
  items: EstimateItem[];
  /** 合計金額 */
  total: number;
  /** 見積もり回答日時 */
  responseDate: Date;
  /** 備考 */
  note?: string;
}

/**
 * 見積もり項目
 */
export interface EstimateItem {
  /** 項目名 */
  name: string;
  /** 数量 */
  quantity: number;
  /** 単価 */
  unitPrice: number;
  /** 金額 */
  amount: number;
  /** 備考 */
  note?: string;
}

/**
 * 品質確認項目
 */
export interface QualityCheckItem {
  /** 項目名 */
  name: string;
  /** 確認結果 */
  result: "合格" | "要修正" | "不適合";
  /** コメント */
  comment?: string;
}

/**
 * 写真
 */
export interface Photo {
  /** 写真ID */
  photoId: string;
  /** ファイルパス（Google Drive） */
  filePath: string;
  /** 撮影日時 */
  takenAt: Date;
  /** 説明 */
  description?: string;
}

/**
 * 動画
 */
export interface Video {
  /** 動画ID */
  videoId: string;
  /** ファイルパス（Google Drive） */
  filePath: string;
  /** 撮影日時 */
  takenAt: Date;
  /** 説明 */
  description?: string;
}
```

---

## 9. API設計

### 9-1. 受付画面

#### POST /api/jobs/[id]/reception

**目的**: 板金・塗装の受付情報を保存

**リクエストボディ**:
```typescript
{
  mileage: number;
  accident: {
    isAccident: boolean;
    isTowTruck: boolean;
    hasInsurance: boolean;
    insuranceCompany?: string;
    severity?: "軽微" | "中程度" | "深刻" | "全損";
    type?: "追突" | "出会い頭" | "側面衝突" | "単独事故" | "その他";
  };
  courtesyCar?: {
    provided: boolean;
    courtesyCarId?: string;
  };
  notes?: string;
}
```

**レスポンス**:
```typescript
{
  success: boolean;
  job: BodyPaintJob;
}
```

### 9-2. 診断画面

#### GET /api/jobs/[id]/diagnosis

**目的**: 診断情報を取得

**レスポンス**:
```typescript
{
  job: BodyPaintJob;
  diagnosis: BodyPaintJob["diagnosis"];
}
```

#### POST /api/jobs/[id]/diagnosis

**目的**: 診断情報を保存

**リクエストボディ**:
```typescript
{
  damageLocations: DamageLocation[];
  beforePhotos: Photo[];
  beforeVideos: Video[];
  estimateRequestMethod: "写真送付" | "持ち込み";
  estimateRequestVendorName?: string;
  vendorEstimate?: VendorEstimate;
  comments: string;
}
```

**レスポンス**:
```typescript
{
  success: boolean;
  job: BodyPaintJob;
}
```

### 9-3. 見積画面

#### GET /api/jobs/[id]/estimate

**目的**: 見積情報を取得

**レスポンス**:
```typescript
{
  job: BodyPaintJob;
  estimate: BodyPaintJob["estimate"];
  vendorEstimate?: VendorEstimate;
}
```

#### POST /api/jobs/[id]/estimate

**目的**: 見積情報を保存

**リクエストボディ**:
```typescript
{
  items: EstimateItem[];
  workDuration: number;
  insuranceApproval?: {
    status: "承認済み" | "承認待ち";
    approvedAt?: Date;
  };
  notes?: string;
}
```

**レスポンス**:
```typescript
{
  success: boolean;
  job: BodyPaintJob;
}
```

### 9-4. 外注発注画面

#### GET /api/jobs/[id]/outsourcing

**目的**: 外注情報を取得

**レスポンス**:
```typescript
{
  job: BodyPaintJob;
  outsourcing: BodyPaintJob["outsourcing"];
}
```

#### POST /api/jobs/[id]/outsourcing

**目的**: 外注発注情報を保存

**リクエストボディ**:
```typescript
{
  vendorName: string;
  orderMethod: "写真送付" | "持ち込み";
  deliveryScheduledDate?: Date;
  deliveryDate: Date;
  notes?: string;
}
```

**レスポンス**:
```typescript
{
  success: boolean;
  job: BodyPaintJob;
}
```

### 9-5. 外注作業管理画面

#### GET /api/jobs/[id]/outsourcing-progress

**目的**: 外注作業進捗情報を取得

**レスポンス**:
```typescript
{
  job: BodyPaintJob;
  outsourcing: BodyPaintJob["outsourcing"];
}
```

#### POST /api/jobs/[id]/outsourcing-progress/completion

**目的**: 作業完了連絡を受付

**レスポンス**:
```typescript
{
  success: boolean;
  job: BodyPaintJob;
}
```

#### POST /api/jobs/[id]/outsourcing-progress/notes

**目的**: 進捗メモを保存

**リクエストボディ**:
```typescript
{
  note: string;
}
```

**レスポンス**:
```typescript
{
  success: boolean;
  job: BodyPaintJob;
}
```

### 9-6. 引き取り・品質確認画面

#### GET /api/jobs/[id]/quality-check

**目的**: 品質確認情報を取得

**レスポンス**:
```typescript
{
  job: BodyPaintJob;
  qualityCheck: BodyPaintJob["qualityCheck"];
}
```

#### POST /api/jobs/[id]/quality-check

**目的**: 品質確認情報を保存

**リクエストボディ**:
```typescript
{
  pickupDate: Date;
  result: "合格" | "要修正" | "返品";
  checkItems?: QualityCheckItem[];
  afterPhotos: Photo[];
  comments?: string;
}
```

**レスポンス**:
```typescript
{
  success: boolean;
  job: BodyPaintJob;
}
```

---

## 10. ユーザージャーニー

### 10-1. 通常の板金・塗装の場合

1. **受付** (フロントスタッフ)
   - 車両情報を確認
   - 事故案件を「通常の板金・塗装」に設定
   - 走行距離を入力
   - 入庫確定

2. **診断** (整備士)
   - 損傷箇所を確認
   - Before写真・動画を撮影
   - 外注先に写真を送付して見積もり依頼
   - 外注先からの見積もり回答を記録
   - 診断完了

3. **見積作成** (フロントスタッフ)
   - 外注先からの見積もり回答を確認
   - 自社見積もりを作成
   - 作業期間（1-3カ月）を設定
   - 見積もり確定

4. **顧客承認** (顧客)
   - 見積もりを確認して承認

5. **外注発注** (フロントスタッフ)
   - 外注先名を入力
   - 発注方法を選択（写真送付/持ち込み）
   - 車両を外注先に預ける
   - 外注発注確定

6. **外注作業管理** (フロントスタッフ)
   - 外注先での作業進捗を確認
   - 作業完了連絡を受付
   - 進捗メモを記録

7. **引き取り・品質確認** (フロントスタッフ)
   - 外注先から車両を引き取る
   - 品質確認を実施
   - After写真を撮影（必須）
   - 品質確認完了

8. **引渡** (フロントスタッフ)
   - 顧客に引渡

### 10-2. 事故案件の場合

1. **受付** (フロントスタッフ)
   - 車両情報を確認
   - 事故案件を「事故案件」に設定
   - レッカー入庫を記録
   - 保険対応ありを選択し、保険会社名を入力
   - 事故の程度・種類を記録
   - 走行距離を入力
   - 入庫確定

2. **診断** (整備士)
   - 損傷箇所を確認（事故による損傷）
   - Before写真・動画を撮影
   - 外注先に写真を送付して見積もり依頼
   - 外注先からの見積もり回答を記録
   - 診断完了

3. **見積作成** (フロントスタッフ)
   - 外注先からの見積もり回答を確認
   - 自社見積もりを作成
   - 作業期間（1-3カ月）を設定
   - 保険会社への見積もり提出
   - 保険承認を待つ
   - 保険承認後、見積もり確定

4. **顧客承認** (顧客)
   - 見積もりを確認して承認

5. **外注発注** (フロントスタッフ)
   - 外注先名を入力
   - 発注方法を選択（写真送付/持ち込み）
   - 車両を外注先に預ける
   - 外注発注確定

6. **外注作業管理** (フロントスタッフ)
   - 外注先での作業進捗を確認
   - 作業完了連絡を受付
   - 進捗メモを記録

7. **引き取り・品質確認** (フロントスタッフ)
   - 外注先から車両を引き取る
   - 品質確認を実施
   - After写真を撮影（必須）
   - 品質確認完了

8. **引渡** (フロントスタッフ)
   - 顧客に引渡

---

## 11. 実装上の注意点

### 11-1. 外注先管理

- 外注先のマスタ管理は不要
- 外注先名はテキスト入力で記録
- 外注先への発注時に、外注先名を入力

### 11-2. 写真・動画管理

- Before写真・動画は診断画面で撮影
- After写真は品質確認画面で撮影（必須）
- 写真・動画はGoogle Driveに保存

### 11-3. 作業期間管理

- 作業期間は1-3カ月と長期間
- 作業期間をステータス管理で管理
- 作業期間が長いことを見積時に明示

### 11-4. 事故案件の管理

- 事故案件の識別（事故/通常）を記録
- レッカー入庫の対応を記録
- 保険対応の有無を記録
- 事故の程度・種類を記録
- 保険対応の場合は、保険会社への見積もり提出と承認の管理

### 11-5. 代車提供管理

- 代車の提供はケースバイケース
- 代車の提供有無を記録
- 代車を提供した場合、代車IDを記録

### 11-6. PDF生成

- 板金・塗装ではPDF生成は不要
- 作業記録はシステム内で管理

---

## 12. 関連ドキュメント

- [統合仕様書](./INTEGRATED_SPECIFICATION.md): システム全体の統合仕様
  - 「2-3. データフローの統一」: マスタデータ同期の制約と対応方法
  - 「2-4. 複数作業管理の実装」: 複数作業管理の実装方法
  - 「4-2-6. 請求書統合フロー」: 基幹システムでの統合請求書作成手順
- [システム進化計画](./SYSTEM_EVOLUTION_PLAN.md): 基幹システム制約下での設計変更方針
- [ユーザーワークフロー詳細設計 v2.0](./USER_WORKFLOW_DETAILED_DESIGN_V2.md): ユーザー別業務・システム利用詳細設計

**マスタデータ同期の制約**:
- 車両マスタ・顧客マスタはGoogle Sheets経由で取得（基幹システムからGAS経由で同期）
- マスタデータの更新は基幹システムで実施（Webアプリからは更新不可）
- データ不整合が発生した場合は、「Human Middleware」（スタッフ）が基幹システムを修正

---

## 13. 更新履歴

- 2025-01-XX: 初版作成
- 2025-01-XX: 基幹システム連携フローを追加、関連ドキュメントへの参照を追加
- 2025-01-XX: マスタデータ同期の制約を追加

























