# ワークフローナビゲーション修正提案

**作成日**: 2025-01-XX  
**目的**: 戻るボタンとフェーズの＜＞ボタンの競合を解消し、入庫区分別の正しいナビゲーションを実装

---

## 📋 現状の問題

1. **戻るボタンと＜＞ボタンの競合**:
   - 戻るボタン: 履歴に基づいて前の画面に戻る
   - ＜＞ボタン: 前後のフェーズに移動
   - 役割が異なるが、ユーザーが混乱する可能性がある

2. **入庫区分別のプロセスが考慮されていない**:
   - 車検・12ヵ月点検で追加見積もりがない場合、Phase 3（見積）とPhase 4（承認）をスキップ
   - しかし、`PHASE_ROUTES`は固定で、スキップを考慮していない
   - 実際の遷移先が正しくない可能性がある

3. **ナビゲーションロジックの問題**:
   - `handlePreviousPhase`と`handleNextPhase`は`visiblePhases`を使っているが、実際の遷移先が正しいか確認が必要

---

## 🎯 修正方針

### 1. 戻るボタンと＜＞ボタンの役割を明確化

- **戻るボタン**: 履歴に基づいて前の画面に戻る（ナビゲーション履歴を使用）
- **＜＞ボタン**: ワークフロー内の前後のフェーズに移動（スキップを考慮）

### 2. 入庫区分別の動的ルート生成

- 入庫区分と追加見積もりの有無を考慮した`PHASE_ROUTES`の動的生成
- スキップされたフェーズを考慮した前後フェーズの計算

### 3. 実際の遷移先の修正

- 車検・12ヵ月点検で追加見積もりがない場合、Phase 2（診断）からPhase 5（作業）に直接遷移
- その他の入庫区分では、通常のフェーズ遷移を維持

---

## 🔧 実装手順

### Step 1: 入庫区分を判定する関数を追加

`WorkflowStepIndicator`に、入庫区分を判定するロジックを追加

### Step 2: 動的ルート生成関数を実装

スキップを考慮した動的ルート生成関数を実装

### Step 3: 前後フェーズの計算を修正

スキップされたフェーズを考慮した前後フェーズの計算を修正

### Step 4: ナビゲーションロジックを修正

実際の遷移先が正しいことを確認

---

## ✅ 確認事項

- [ ] 戻るボタンと＜＞ボタンが競合していないか確認
- [ ] 入庫区分別の正しい遷移先が設定されているか確認
- [ ] スキップされたフェーズが正しく考慮されているか確認
- [ ] 動作確認




