# UI/UXレビューと改善提案（業務実態を考慮した再検討版）

## 業務実態の理解

### 実際の作業フロー

**シナリオ: 車検 + 板金修理の複合作業**

1. **担当者の違い**
   - 車検担当: 整備士A（自社）
   - 板金修理担当: 板金業者B（外注先）
   - それぞれ別のスタッフが対応

2. **作業の独立性**
   - 車検と板金修理は完全に独立した作業
   - それぞれ別の担当者が並行して進める
   - お互いの作業に影響しない
   - 担当者は「自分の担当作業」だけに集中したい

3. **現在のシステムの問題**
   - 診断画面で作業グループを選択する必要がある
   - 担当者が「自分の担当作業」をすぐに見つけられない
   - 複数の作業が混在していると混乱する
   - 車検担当の整備士が板金修理の情報を見る必要がない

---

## 改善提案（業務実態を考慮）

### 提案A: ジョブカードからの直接アクセス（最推奨）

**フロー:**
```
トップページ（ジョブカード一覧）
    ↓
┌─────────────────────────────────┐
│ 単体作業の場合                  │
│ → ジョブカードをクリック         │
│ → 直接診断画面に遷移            │
└─────────────────────────────────┘
    ↓
┌─────────────────────────────────┐
│ 複合作業の場合                  │
│ → ジョブカードをクリック         │
│ → 作業グループ選択画面          │
│   - 各作業グループのカード表示  │
│   - ステータス表示              │
│   - 担当者表示（あれば）        │
│   - 「この作業を開始」ボタン    │
│ → 選択した作業の診断画面に遷移 │
│   - URL: /mechanic/diagnosis/{jobId}?workOrder={workOrderId}
│   - または: /mechanic/diagnosis/{jobId}/{workOrderId}
└─────────────────────────────────┘
```

**メリット:**
- ✅ 担当者が「自分の担当作業」をすぐに見つけられる
- ✅ 各作業グループが独立した画面として扱える
- ✅ 車検担当の整備士は板金修理の情報を見る必要がない
- ✅ 作業グループごとにURLが分かれるため、ブックマークや共有が可能
- ✅ 担当者別のフィルタリングが将来的に可能

**デメリット:**
- ❌ ページ数が1つ増える（ただし、複合作業の場合のみ）
- ❌ 画面遷移が1回増える（ただし、明確な目的があるため問題なし）

**実装イメージ:**
```
/mechanic/diagnosis/{jobId}/select
  - 作業グループ一覧をカード形式で表示
  - 各カードに「診断を開始」ボタン
  - 進捗状況を視覚的に表示
  - 担当者情報を表示（あれば）
  - 「すべての作業を確認」ボタン（オプション）
```

**URL設計:**
```
単体作業:
  /mechanic/diagnosis/{jobId}
  
複合作業（作業グループ選択）:
  /mechanic/diagnosis/{jobId}/select
  
複合作業（特定の作業グループ）:
  /mechanic/diagnosis/{jobId}?workOrder={workOrderId}
  または
  /mechanic/diagnosis/{jobId}/{workOrderId}
```

---

### 提案B: 診断画面内での改善（現状維持 + 担当者別ビュー）

**フロー:**
```
トップページ（ジョブカード一覧）
    ↓
ジョブカードをクリック
    ↓
診断画面
    ├─ 単体作業: 直接診断入力
    └─ 複合作業: 
        - WorkOrderListを画面中央に大きく表示
        - タブ形式で作業グループを切り替え
        - 担当者別フィルタリング（将来的に）
        - 選択中の作業グループを強調表示
```

**改善点:**
1. **WorkOrderListの配置を改善**
   - ヘッダーの下ではなく、画面の中央上部に配置
   - より目立つデザイン（カード形式、大きなアイコン）
   - 担当者情報を表示（あれば）

2. **タブ形式の導入**
   - 作業グループをタブで表示
   - 選択中のタブを強調
   - 各タブに進捗状況を表示（バッジ）

3. **デフォルト選択の改善**
   - 最初に未完了の作業グループを自動選択
   - 担当者が設定されている場合は、その担当者の作業を優先表示
   - すべて完了している場合は、最初の作業グループを選択

4. **担当者別フィルタリング（将来的に）**
   - 「自分の担当作業のみ表示」フィルタ
   - 「すべての作業を表示」フィルタ

**メリット:**
- ✅ ページ数を増やさない
- ✅ 既存の実装を大きく変更しない
- ✅ 診断画面内で完結する

**デメリット:**
- ❌ 複合作業の場合、診断画面が複雑になる
- ❌ 作業グループの選択と診断入力が同じ画面にあるため、焦点が分散する可能性
- ❌ 担当者が「自分の担当作業」を見つけるのに時間がかかる

---

### 提案C: ハイブリッドアプローチ（担当者別ビュー対応版）

**フロー:**
```
トップページ（ジョブカード一覧）
    ↓
ジョブカードをクリック
    ↓
┌─────────────────────────────────┐
│ 単体作業の場合                  │
│ → 直接診断画面に遷移            │
└─────────────────────────────────┘
    ↓
┌─────────────────────────────────┐
│ 複合作業の場合                  │
│ → 診断画面（WorkOrderListを強調）│
│   - 画面中央上部に大きなカード  │
│   - 「作業を選択してください」   │
│   - 担当者情報を表示（あれば）  │
│   - 選択後、診断入力エリア表示  │
│   - 作業グループ切り替えタブ   │
│   - 担当者別フィルタリング     │
└─────────────────────────────────┘
```

**実装イメージ:**
1. **診断画面の初期状態**
   - 複合作業の場合、WorkOrderListを画面中央上部に大きく表示
   - 「どの作業を進めますか？」というメッセージ
   - 各作業グループのカードをクリック可能に
   - 担当者情報を表示（あれば）

2. **作業グループ選択後**
   - 選択した作業グループの診断入力エリアを表示
   - WorkOrderListは上部に固定（常に表示）
   - タブ形式で作業グループを切り替え可能
   - 担当者別フィルタリング（将来的に）

3. **視覚的階層**
   - 選択中の作業グループを強調（背景色、ボーダー）
   - 未完了の作業グループを優先表示
   - 担当者が設定されている場合は、その担当者の作業を強調
   - 完了した作業グループはグレーアウト

**メリット:**
- ✅ ページ数を増やさない
- ✅ ユーザーが「何をすべきか」を明確に理解できる
   - 担当者情報を表示することで、「自分の担当作業」を識別しやすい
- ✅ 作業グループの切り替えが簡単
- ✅ 単体作業と複合作業で一貫した体験を提供

**デメリット:**
- ❌ 診断画面がやや複雑になる（ただし、視覚的階層で解決可能）
- ❌ 担当者が「自分の担当作業」を見つけるのに時間がかかる可能性

---

## 推奨案: 提案A（ジョブカードからの直接アクセス）

### 理由

1. **担当者別の作業管理に対応**
   - 各担当者が「自分の担当作業」をすぐに見つけられる
   - 車検担当の整備士は板金修理の情報を見る必要がない
   - 作業グループごとに独立した画面として扱える

2. **作業の独立性を反映**
   - 車検と板金修理は完全に独立した作業
   - それぞれ別の担当者が並行して進める
   - お互いの作業に影響しない

3. **将来の拡張性**
   - 担当者別のフィルタリングが容易
   - 作業グループごとにURLが分かれるため、ブックマークや共有が可能
   - 通知やアサイン機能の追加が容易

4. **ユーザー体験**
   - 単体作業と複合作業で一貫した体験
   - 複合作業の場合でも、迷わず操作できる
   - 担当者が「自分の担当作業」を明確に識別できる

---

## 具体的な改善内容

### 1. 作業グループ選択画面の追加

**URL:**
```
/mechanic/diagnosis/{jobId}/select
```

**表示内容:**
- ジョブ情報（顧客名、車両情報）
- 作業グループ一覧（カード形式）
  - 各カードに作業名、ステータス、担当者（あれば）を表示
  - 「診断を開始」ボタン
  - 進捗状況を視覚的に表示
- 「すべての作業を確認」ボタン（オプション）

**実装イメージ:**
```typescript
// 作業グループ選択画面
function WorkOrderSelectPage({ jobId }: { jobId: string }) {
  const { workOrders } = useWorkOrders(jobId);
  const router = useRouter();
  
  return (
    <div>
      <h1>作業を選択してください</h1>
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        {workOrders.map((wo) => (
          <Card key={wo.id}>
            <CardHeader>
              <CardTitle>{wo.serviceKind}</CardTitle>
              <Badge>{wo.status}</Badge>
              {wo.diagnosis?.mechanicName && (
                <p>担当: {wo.diagnosis.mechanicName}</p>
              )}
            </CardHeader>
            <CardContent>
              <Button
                onClick={() => {
                  router.push(`/mechanic/diagnosis/${jobId}?workOrder=${wo.id}`);
                }}
              >
                診断を開始
              </Button>
            </CardContent>
          </Card>
        ))}
      </div>
    </div>
  );
}
```

### 2. 診断画面のURL設計

**単体作業:**
```
/mechanic/diagnosis/{jobId}
```

**複合作業（特定の作業グループ）:**
```
/mechanic/diagnosis/{jobId}?workOrder={workOrderId}
```

**実装イメージ:**
```typescript
// 診断画面
function DiagnosisPage({ jobId }: { jobId: string }) {
  const searchParams = useSearchParams();
  const workOrderId = searchParams.get('workOrder');
  
  // workOrderIdがある場合は、その作業グループを選択
  // ない場合は、最初の作業グループを選択（単体作業の場合）
  
  // ...
}
```

### 3. ジョブカードの遷移ロジック

**単体作業の場合:**
```typescript
// 直接診断画面に遷移
router.push(`/mechanic/diagnosis/${jobId}`);
```

**複合作業の場合:**
```typescript
// 作業グループ選択画面に遷移
router.push(`/mechanic/diagnosis/${jobId}/select`);
```

### 4. 担当者情報の表示

**WorkOrder型に担当者情報を追加:**
```typescript
export interface WorkOrder {
  // ...
  /** 診断担当者名 */
  diagnosisMechanic?: string | null;
  /** 作業担当者名 */
  workMechanic?: string | null;
  // ...
}
```

**作業グループ選択画面で表示:**
```typescript
{workOrder.diagnosisMechanic && (
  <p className="text-sm text-slate-600">
    担当: {workOrder.diagnosisMechanic}
  </p>
)}
```

---

## 実装優先度

### 高優先度（即座に実装）
1. 作業グループ選択画面の追加
2. 診断画面のURL設計（workOrderパラメータ対応）
3. ジョブカードの遷移ロジック（単体/複合の判定）

### 中優先度（次期リリース）
1. 担当者情報の表示
2. 作業グループ選択画面のデザイン改善
3. 進捗状況の視覚的表示

### 低優先度（将来検討）
1. 担当者別フィルタリング
2. 作業グループの並び替え機能
3. 作業グループの一括操作機能
4. 通知機能（担当者へのアサイン通知）

---

## まとめ

**業務実態を考慮した改善:**
- 担当者別の作業管理に対応
- 作業の独立性を反映
- 各担当者が「自分の担当作業」をすぐに見つけられる

**推奨解決策:**
- **提案A（ジョブカードからの直接アクセス）**を採用
- 複合作業の場合、作業グループ選択画面を追加
- 診断画面のURL設計を改善（workOrderパラメータ対応）

**実装方針:**
- ページ数を1つ増やす（ただし、複合作業の場合のみ）
- 担当者別の作業管理に対応
- 将来の拡張性を考慮した設計

