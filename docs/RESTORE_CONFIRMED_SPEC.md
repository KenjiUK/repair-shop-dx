# レストア 確認済み仕様書

## ドキュメント情報

- **作成日**: 2025-01-XX
- **バージョン**: 1.0
- **対象**: レストアの確認済み仕様
- **ステータス**: 実装準備完了

---

## 1. 確認済み事項

### 1-1. 業務フローパターン

**質問**: 業務フローパターンはどのようになりますか？

**回答**: ✅ **パターンA（入庫→診断→見積→承認→作業）**

**詳細**:
- **まずはざっくり口頭で見積するが、実際は車を見てから決めるのでパターンA**
- 入庫してから診断を実施し、見積を作成して承認を得てから作業を実施

**設計決定**:
- パターンA（入庫→診断→見積→承認→作業）を採用
- 事前の口頭見積は参考程度として扱う

### 1-2. 診断内容

**質問**: 診断時に確認する内容について

**回答**: ✅ **ケースバイケースですが写真はとる**

**設計決定**:
- 診断内容はケースバイケース（フルレストア、部分レストアなど）
- 写真の撮影は必須
- 現状確認、修復箇所の確認、修復内容の決定

### 1-3. 見積もり

**質問**: 見積もりの作成方法について

**回答**: ✅ **ケースバイケース。古い車をゼロからフルレストアすることもあれば、変わシートだけなど部分レストアもある**

**詳細**:
- **フルレストア**: 古い車をゼロから完全に修復・復元
- **部分レストア**: シートだけなど、特定の箇所のみを修復・復元

**設計決定**:
- 見積もりはケースバイケース（フルレストア、部分レストアなど）
- 修復内容、部品、作業内容に基づいて見積もりを作成
- 部品の取り寄せが必要な場合の管理
- 長期プロジェクトの場合は、段階的な見積もり

### 1-4. 作業実施

**質問**: 作業実施の流れについて

**回答**: ✅ **ベストプラクティスに基づく実装**

**設計決定（ベストプラクティスに基づく）**:
- **フェーズ管理**: レストア作業を複数のフェーズに分割（分解、修復、組み立て、仕上げなど）
- **マイルストーン管理**: 各フェーズの完了をマイルストーンとして管理
- **進捗管理**: 作業進捗を0-100%で管理
- **部品の取り寄せ管理**: 部品の状態管理（在庫あり、発注済み、取り寄せ中、到着済み、遅延）、到着予定日管理、遅延アラート
- **段階的な作業管理**: 長期プロジェクトの場合は、段階的な作業管理が必要

### 1-5. 写真撮影

**質問**: 写真撮影について

**回答**: ✅ **必要**

**設計決定**:
- Before写真の撮影は必須（現状の記録）
- 作業中の写真撮影は必要（進捗記録）
- After写真の撮影は必須（修復完了後の記録）

### 1-6. 測定値

**質問**: 測定値の入力について

**回答**: ✅ **不要**

**設計決定**:
- 測定値の入力は不要
- 作業時間の記録は必要

### 1-7. PDF生成

**質問**: PDF生成について

**回答**: ✅ **独自フォーマットを提案**

**設計決定（独自フォーマット提案）**:
- レストア専用のPDFフォーマットを生成
- 車検・12ヶ月点検とは異なる独自のPDF
- 内容: Before/After写真、修復内容の詳細、部品リスト、作業記録、見積もりの変更履歴、作業進捗

### 1-8. 部品の管理

**質問**: 部品の管理について

**回答**: ✅ **必要**

**設計決定**:
- 部品の管理は必要
- 部品の取り寄せが必要な場合の管理
- 部品の在庫管理が必要

### 1-9. 作業期間

**質問**: 作業期間について

**回答**: ✅ **かなり長期**

**設計決定**:
- レストアの作業期間はかなり長期（数週間から数カ月、場合によっては数年）
- 顧客は車を預ける必要がある
- 作業期間が長いことを見積時に明示

### 1-10. 代車の提供

**質問**: 代車の提供について

**回答**: ✅ **ケースバイケースだがみんなセカンドカーが多いので大抵はない**

**設計決定**:
- 代車の提供はケースバイケース
- セカンドカーが多いので大抵は代車の提供は不要
- 代車の提供有無を記録

### 1-11. 長期プロジェクトの管理

**質問**: 長期プロジェクトの管理について

**回答**: ✅ **長期プロジェクトでイレギュラーが多い**

**詳細**:
- **長期プロジェクト**: レストアは長期プロジェクトになる可能性が高い
- **イレギュラーが多い**: 予定通りに進まないことが多く、追加作業や見積もりの変更が発生することが多い

**設計決定**:
- レストアは長期プロジェクトとして管理
- イレギュラー対応が必要（追加作業、見積もりの変更、部品の取り寄せ遅延など）
- 段階的な作業管理が必要
- 追加作業の管理機能が必要
- 見積もりの変更管理機能が必要
- 作業期間の延長管理が必要

---

## 2. 確定した仕様サマリー

### 2-1. 入庫区分の設定

**入庫区分**: `レストア`

**設計決定**:
- システム上は「レストア」として1つの入庫区分で管理
- フルレストア、部分レストアなど、ケースバイケースに対応

### 2-2. 業務フロー（パターンA）

```
1. 予約・受付: レストア希望の車両の受付（5-10分）
   - まずはざっくり口頭で見積（参考程度）
2. 診断: 現状確認、修復箇所の確認、修復内容の決定、Before写真の撮影（30分-数時間）
3. 見積作成: 修復内容、部品、作業内容に基づいて見積もりを作成（30分-数時間）
4. 顧客承認: 見積内容を確認して承認
5. 作業実施: 修復作業を実施（かなり長期、イレギュラーが多い）
6. 引渡: 修復完了後、顧客に引渡（15-30分）
```

### 2-3. レストアの種類

**設計決定**:
- **フルレストア**: 古い車をゼロから完全に修復・復元
- **部分レストア**: シートだけなど、特定の箇所のみを修復・復元
- ケースバイケースに対応

### 2-4. 診断内容

**設計決定**:
- 診断内容はケースバイケース（フルレストア、部分レストアなど）
- 現状確認（車体、エンジン、内装、電装系など）
- 修復箇所の確認
- 修復内容の決定
- Before写真の撮影（必須）

### 2-5. 見積もり

**設計決定**:
- 見積もりはケースバイケース（フルレストア、部分レストアなど）
- 修復内容、部品、作業内容に基づいて見積もりを作成
- 部品の取り寄せが必要な場合の管理（ベストプラクティスに基づく）
- 長期プロジェクトの場合は、段階的な見積もり
- イレギュラー対応（追加作業、見積もりの変更、部品の取り寄せ遅延など）

### 2-6. 作業管理（ベストプラクティスに基づく）

**設計決定**:
- **フェーズ管理**: レストア作業を複数のフェーズに分割
  - フェーズ例: 分解、診断・評価、部品発注、修復、組み立て、仕上げ、最終確認
- **マイルストーン管理**: 各フェーズの完了をマイルストーンとして管理
- **進捗管理**: 作業進捗を0-100%で管理
- **段階的な作業管理**: 長期プロジェクトの場合は、段階的な作業管理が必要
- **作業記録**: 各フェーズごとに作業記録を残す

### 2-7. 部品の取り寄せ管理（ベストプラクティスに基づく）

**設計決定**:
- **部品の状態管理**: 在庫あり、発注済み、取り寄せ中、到着済み、遅延
- **到着予定日管理**: 部品の到着予定日を管理
- **遅延アラート**: 部品の到着が遅延した場合、アラートを表示
- **部品の在庫管理**: 部品の在庫状況を管理
- **自動発注機能（将来実装）**: 在庫が一定レベル以下になったら自動発注（将来実装）

### 2-8. 作業期間

**設計決定**:
- レストアの作業期間はかなり長期（数週間から数カ月、場合によっては数年）
- 顧客は車を預ける必要がある
- 作業期間が長いことを見積時に明示
- イレギュラーが多いため、作業期間の延長管理が必要

### 2-9. 代車の提供

**設計決定**:
- 代車の提供はケースバイケース
- セカンドカーが多いので大抵は代車の提供は不要
- 代車の提供有無を記録

### 2-10. 写真撮影

**設計決定**:
- Before写真の撮影は必須（現状の記録）
- 作業中の写真撮影は必要（進捗記録）
- After写真の撮影は必須（修復完了後の記録）

### 2-11. PDF生成（独自フォーマット）

**設計決定**:
- レストア専用のPDFフォーマットを生成
- 車検・12ヶ月点検とは異なる独自のPDF
- **PDFの内容**:
  - 表紙: 車両情報、レストアの種類、作業期間
  - Before/After写真: 修復前後の比較写真
  - 修復内容の詳細: 修復箇所、修復内容、修復前後の状態
  - 部品リスト: 使用した部品の一覧（部品名、数量、単価、金額）
  - 作業記録: 各フェーズごとの作業記録（作業日、作業内容、作業時間、写真）
  - 見積もりの変更履歴: 見積もりの変更内容と理由
  - 作業進捗: 各フェーズの進捗状況
  - 総括: 修復完了の総括、今後のメンテナンス推奨事項

### 2-12. 長期プロジェクトとイレギュラー対応

**設計決定**:
- レストアは長期プロジェクトとして管理
- イレギュラー対応が必要（追加作業、見積もりの変更、部品の取り寄せ遅延など）
- 段階的な作業管理が必要
- 追加作業の管理機能が必要
- 見積もりの変更管理機能が必要
- 作業期間の延長管理が必要

### 2-11. データソース

**設計決定**:
- 車両情報: Google Sheets「【DB】車両マスタ」の「車両_同期用」シートから取得
- 部品情報: 部品マスタから取得（今後実装）

---

## 3. 画面設計

### 3-1. 受付画面（Phase 1）

#### 入庫処理

**設計**:
- レストア希望の車両の受付
- 走行距離を入力
- 前回レストア履歴の表示
- 口頭見積の記録（参考程度）

**UI要素**:
- 走行距離入力欄
- 前回レストア履歴表示
- 口頭見積メモ入力欄（参考程度）

### 3-2. 診断画面（Phase 2）

#### 現状確認と修復内容の決定

**設計**:
- 現状確認（車体、エンジン、内装、電装系など）
- 修復箇所の確認
- 修復内容の決定（フルレストア、部分レストアなど）
- Before写真の撮影（必須）

**UI要素**:
- 現状確認チェックリスト（ケースバイケース）
- 修復箇所の選択（部位、程度）
- レストアの種類選択（フルレストア、部分レストアなど）
- Before写真撮影ボタン（必須）
- コメント入力欄

### 3-3. 見積作成画面（Phase 3）

#### 見積もりの作成

**設計**:
- 修復内容、部品、作業内容に基づいて見積もりを作成
- 部品の取り寄せが必要な場合の管理
- 長期プロジェクトの場合は、段階的な見積もり
- **イレギュラー対応**: 追加作業、見積もりの変更、部品の取り寄せ遅延などの管理

**UI要素**:
- 見積もり項目の入力（修復費用、部品費用、作業費用など）
- 部品リストの表示・入力
- 見積金額表示
- 作業期間の表示（かなり長期）
- **追加作業の追加ボタン**
- **見積もりの変更履歴表示**
- **部品の取り寄せ状況表示**

### 3-4. 作業画面（Phase 5）

#### 作業記録（フェーズ管理）

**設計**:
- **フェーズ管理**: レストア作業を複数のフェーズに分割（分解、診断・評価、部品発注、修復、組み立て、仕上げ、最終確認）
- **マイルストーン管理**: 各フェーズの完了をマイルストーンとして管理
- **進捗管理**: 作業進捗を0-100%で管理
- 実施した作業の記録（フェーズごと）
- 作業中の写真撮影（必要）
- 使用した部品の記録
- 作業時間の記録
- **イレギュラー対応**: 追加作業の記録、見積もりの変更、部品の取り寄せ遅延などの管理

**UI要素**:
- **フェーズ選択タブ**（分解、診断・評価、部品発注、修復、組み立て、仕上げ、最終確認）
- **マイルストーン表示**（各フェーズの完了状況）
- **進捗バー**（0-100%）
- 作業記録入力欄（フェーズごと）
- 作業中の写真撮影ボタン（必要）
- 使用した部品入力欄
- 作業時間入力欄
- 作業メモ入力欄
- **追加作業の追加ボタン**
- **見積もりの変更ボタン**
- **部品の取り寄せ状況表示**（部品の状態、到着予定日、遅延アラート）

### 3-5. 引渡画面（Phase 7）

#### 顧客への引渡

**設計**:
- 修復内容を説明して引渡
- After写真の表示（必須）

**UI要素**:
- 修復内容の表示
- After写真の表示（必須）
- 引渡ボタン

---

## 4. データモデル

### 4-1. レストアジョブデータ

```typescript
/**
 * レストアジョブ
 */
export interface RestoreJob {
  /** Job ID */
  jobId: string;
  /** 入庫区分 */
  serviceKind: "レストア";
  
  /** 車両情報 */
  vehicle: {
    /** 車両ID */
    vehicleId: string;
    /** 走行距離 */
    mileage: number;
  };
  
  /** 診断情報 */
  diagnosis: {
    /** レストアの種類 */
    restoreType: "フルレストア" | "部分レストア" | "その他";
    /** 現状確認結果 */
    currentCondition: ConditionCheck[];
    /** 修復箇所 */
    restoreLocations: RestoreLocation[];
    /** Before写真 */
    beforePhotos: Photo[];
    /** コメント（整備士の所見） */
    comments: string;
  };
  
  /** 見積情報 */
  estimate: {
    /** 見積もり項目 */
    items: EstimateItem[];
    /** 部品リスト */
    parts: PartItem[];
    /** 合計金額 */
    total: number;
    /** 作業期間 */
    workDuration: string;
    /** 承認日時 */
    approvedAt?: Date;
    /** 追加作業リスト（イレギュラー対応） */
    additionalWork: AdditionalWorkItem[];
    /** 見積もりの変更履歴 */
    changeHistory: EstimateChange[];
  };
  
  /** 作業情報 */
  work: {
    /** フェーズ管理 */
    phases: WorkPhase[];
    /** 実施した作業の記録 */
    workRecords: WorkRecord[];
    /** 作業中の写真 */
    progressPhotos: Photo[];
    /** 使用した部品 */
    usedParts: PartItem[];
    /** 作業時間 */
    workDuration: number;
    /** 作業メモ */
    notes: string;
    /** 作業進捗 */
    progress: number; // 0-100%
    /** 追加作業の記録（イレギュラー対応） */
    additionalWorkRecords: WorkRecord[];
    /** 作業期間の延長記録 */
    extensionHistory: WorkExtension[];
  };
  
  /** 代車情報 */
  courtesyCar: {
    /** 代車の提供有無 */
    provided: boolean;
    /** 代車ID（提供した場合） */
    courtesyCarId?: string;
  };
  
  /** ステータス */
  status: "入庫待ち" | "診断中" | "見積作成待ち" | "顧客承認待ち" | "作業待ち" | "作業中" | "出庫待ち";
}

/**
 * 現状確認結果
 */
export interface ConditionCheck {
  /** 箇所 */
  location: string;
  /** 状態 */
  condition: "良好" | "軽微な劣化" | "中程度の劣化" | "深刻な劣化" | "修復必要";
  /** 写真 */
  photo?: Photo;
  /** コメント */
  comment?: string;
}

/**
 * 修復箇所
 */
export interface RestoreLocation {
  /** 部位 */
  location: string;
  /** 修復内容 */
  restoreType: "修復" | "交換" | "塗装" | "その他";
  /** 修復の程度 */
  severity: "軽微" | "中程度" | "深刻";
  /** 写真 */
  photo: Photo;
  /** コメント */
  comment?: string;
}

/**
 * 部品項目（ベストプラクティスに基づく）
 */
export interface PartItem {
  /** 部品名 */
  name: string;
  /** 数量 */
  quantity: number;
  /** 単価 */
  unitPrice: number;
  /** 金額 */
  amount: number;
  /** 取り寄せ状況（ベストプラクティスに基づく） */
  status: "在庫あり" | "発注済み" | "取り寄せ中" | "到着済み" | "遅延";
  /** 到着予定日 */
  expectedArrivalDate?: Date;
  /** 実際の到着日 */
  actualArrivalDate?: Date;
  /** 遅延アラート（到着予定日を過ぎている場合） */
  isDelayed?: boolean;
  /** 備考 */
  note?: string;
}

/**
 * 作業フェーズ（ベストプラクティスに基づく）
 */
export interface WorkPhase {
  /** フェーズID */
  id: string;
  /** フェーズ名 */
  name: "分解" | "診断・評価" | "部品発注" | "修復" | "組み立て" | "仕上げ" | "最終確認";
  /** フェーズの順序 */
  order: number;
  /** フェーズの状態 */
  status: "未開始" | "作業中" | "完了" | "保留";
  /** フェーズの開始日 */
  startDate?: Date;
  /** フェーズの完了日 */
  completionDate?: Date;
  /** フェーズの進捗 */
  progress: number; // 0-100%
  /** フェーズの作業記録 */
  workRecords: WorkRecord[];
  /** フェーズで使用した部品 */
  usedParts: PartItem[];
  /** マイルストーン（フェーズ完了） */
  isMilestone: boolean;
  /** 備考 */
  note?: string;
}

/**
 * 作業記録
 */
export interface WorkRecord {
  /** 作業日 */
  date: Date;
  /** 作業内容 */
  content: string;
  /** 作業時間 */
  duration: number;
  /** 写真 */
  photos?: Photo[];
  /** コメント */
  comment?: string;
}

/**
 * 追加作業項目（イレギュラー対応）
 */
export interface AdditionalWorkItem {
  /** 追加作業ID */
  id: string;
  /** 追加作業内容 */
  content: string;
  /** 追加費用 */
  additionalCost: number;
  /** 追加作業の承認日時 */
  approvedAt?: Date;
  /** 追加作業の実施日時 */
  completedAt?: Date;
  /** 備考 */
  note?: string;
}

/**
 * 見積もりの変更履歴
 */
export interface EstimateChange {
  /** 変更日時 */
  changedAt: Date;
  /** 変更内容 */
  changeContent: string;
  /** 変更前の金額 */
  previousTotal: number;
  /** 変更後の金額 */
  newTotal: number;
  /** 変更理由 */
  reason: string;
}

/**
 * 作業期間の延長記録
 */
export interface WorkExtension {
  /** 延長日時 */
  extendedAt: Date;
  /** 延長前の期間 */
  previousDuration: string;
  /** 延長後の期間 */
  newDuration: string;
  /** 延長理由 */
  reason: string;
}
```

---

## 5. 実装方針

### 5-1. レストアの種類管理

**設計**:
- フルレストア、部分レストアなど、ケースバイケースに対応
- 診断時にレストアの種類を選択
- 種類に応じて診断項目・見積項目・作業項目が動的に変化

### 5-2. 診断の実装

**設計**:
- 診断内容はケースバイケース（フルレストア、部分レストアなど）
- 現状確認、修復箇所の確認、修復内容の決定
- Before写真の撮影（必須）

### 5-3. 見積もりの実装

**設計**:
- 見積もりはケースバイケース（フルレストア、部分レストアなど）
- 修復内容、部品、作業内容に基づいて見積もりを作成
- 部品の取り寄せが必要な場合の管理
- 長期プロジェクトの場合は、段階的な見積もり
- イレギュラー対応（追加作業、見積もりの変更、部品の取り寄せ遅延など）

### 5-4. 作業期間の管理

**設計**:
- レストアの作業期間はかなり長期（数週間から数カ月、場合によっては数年）
- 作業期間をステータス管理で管理
- 作業期間が長いことを見積時に明示
- イレギュラーが多いため、作業期間の延長管理が必要

### 5-5. 代車の提供管理

**設計**:
- 代車の提供はケースバイケース
- セカンドカーが多いので大抵は代車の提供は不要
- 代車の提供有無を記録

### 5-6. 部品の管理（ベストプラクティスに基づく）

**設計**:
- 部品の管理は必要
- **部品の状態管理**: 在庫あり、発注済み、取り寄せ中、到着済み、遅延
- **到着予定日管理**: 部品の到着予定日を管理
- **遅延アラート**: 部品の到着が遅延した場合、アラートを表示
- **部品の在庫管理**: 部品の在庫状況を管理
- **自動発注機能（将来実装）**: 在庫が一定レベル以下になったら自動発注（将来実装）

### 5-7. 作業管理（ベストプラクティスに基づく）

**設計**:
- **フェーズ管理**: レストア作業を複数のフェーズに分割
  - フェーズ例: 分解、診断・評価、部品発注、修復、組み立て、仕上げ、最終確認
- **マイルストーン管理**: 各フェーズの完了をマイルストーンとして管理
- **進捗管理**: 作業進捗を0-100%で管理
- **段階的な作業管理**: 長期プロジェクトの場合は、段階的な作業管理が必要
- **作業記録**: 各フェーズごとに作業記録を残す

### 5-8. 長期プロジェクトとイレギュラー対応

**設計**:
- レストアは長期プロジェクトとして管理
- イレギュラー対応が必要（追加作業、見積もりの変更、部品の取り寄せ遅延など）
- 段階的な作業管理が必要
- 追加作業の管理機能が必要
- 見積もりの変更管理機能が必要
- 作業期間の延長管理が必要

### 5-9. PDF生成（独自フォーマット）

**設計**:
- レストア専用のPDFフォーマットを生成
- 車検・12ヶ月点検とは異なる独自のPDF
- **PDFの構成**:
  1. **表紙**: 車両情報、レストアの種類、作業期間、作業完了日
  2. **Before/After写真**: 修復前後の比較写真（車体全体、修復箇所）
  3. **修復内容の詳細**: 修復箇所、修復内容、修復前後の状態
  4. **部品リスト**: 使用した部品の一覧（部品名、数量、単価、金額、到着日）
  5. **作業記録**: 各フェーズごとの作業記録（作業日、作業内容、作業時間、写真）
  6. **見積もりの変更履歴**: 見積もりの変更内容と理由
  7. **作業進捗**: 各フェーズの進捗状況（開始日、完了日、進捗率）
  8. **総括**: 修復完了の総括、今後のメンテナンス推奨事項

---

## 6. PDFフォーマット提案（独自フォーマット）

### 6-1. レストア完了報告書PDF

**フォーマット構成**:

```
【表紙】
- レストア完了報告書
- 車両情報（車名、登録番号、走行距離）
- レストアの種類（フルレストア/部分レストア）
- 作業期間（開始日～完了日）
- 作業完了日

【Before/After写真】
- 修復前後の比較写真（車体全体、修復箇所）
- 各修復箇所のBefore/After写真

【修復内容の詳細】
- 修復箇所一覧
- 各修復箇所の詳細（部位、修復内容、修復前後の状態）
- 修復前後の状態比較

【部品リスト】
- 使用した部品の一覧
  - 部品名、数量、単価、金額、到着日
- 部品の合計金額

【作業記録】
- 各フェーズごとの作業記録
  - フェーズ名、作業日、作業内容、作業時間、写真
- 作業時間の合計

【見積もりの変更履歴】
- 見積もりの変更内容と理由
- 変更前後の金額比較

【作業進捗】
- 各フェーズの進捗状況
  - フェーズ名、開始日、完了日、進捗率
- 全体の進捗率

【総括】
- 修復完了の総括
- 今後のメンテナンス推奨事項
- 保証内容（該当する場合）
```

### 6-2. PDF生成のタイミング

**設計決定**:
- レストア作業完了時にPDFを生成
- 顧客への引渡時にPDFを提供

---

## 7. 次のステップ

1. **診断画面の実装**: 現状確認、修復箇所の確認、修復内容の決定、Before写真の撮影
2. **見積作成画面の実装**: 修復内容、部品、作業内容に基づいて見積もりを作成、イレギュラー対応
3. **作業画面の実装**: フェーズ管理、マイルストーン管理、進捗管理、作業記録、作業中の写真撮影、部品の記録、イレギュラー対応
4. **部品管理画面の実装**: 部品の状態管理、到着予定日管理、遅延アラート、在庫管理
5. **引渡画面の実装**: 修復内容の説明、After写真の表示
6. **PDF生成機能の実装**: レストア専用のPDFフォーマットの実装

---

## 更新履歴

- 2025-01-XX: 初版作成（確認済み仕様書）
- 2025-01-XX: 作業管理と部品管理のベストプラクティスを追加、PDFフォーマットを提案

































