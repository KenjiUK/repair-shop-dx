# 板金・塗装 確認済み仕様書

## ドキュメント情報

- **作成日**: 2025-01-XX
- **バージョン**: 1.0
- **対象**: 板金・塗装の確認済み仕様
- **ステータス**: 実装準備完了

---

## 1. 確認済み事項

### 1-1. 業務フローパターン

**質問**: 業務フローパターンはどのようになりますか？

**回答**: ✅ **パターンA（入庫→診断→見積→承認→外注発注→外注作業→引き取り→引渡）が基本**

**詳細**:
- **基本パターン**: 入庫してから診断を実施し、見積を作成して承認を得てから外注先に発注
- **パターンBも存在**: 事前見積→承認→入庫→外注発注のパターンもあるが、基本はパターンA

**設計決定**:
- パターンA（入庫→診断→見積→承認→外注発注→外注作業→引き取り→引渡）を基本として実装
- パターンBにも対応可能な設計とする

### 1-2. 外注先の管理

**質問**: 外注先の管理方法について

**回答**: ✅ **外注先のマスタ管理は不要**

**設計決定**:
- 外注先のマスタ管理は不要
- 外注先への発注時に、外注先を選択する必要はない（手動で管理）
- システム上は外注先名をテキスト入力で記録する程度

### 1-3. 診断内容

**質問**: 診断時に確認する内容について

**回答**: ✅ **基本は外注先の見積もりを元に請求します**

**設計決定**:
- 診断時に損傷箇所の確認、Before写真・動画の撮影を実施
- 外注先への見積もり依頼（写真送付または持ち込み）
- 外注先からの見積もり回答を基に、自社で見積もりを作成

### 1-4. 見積もり

**質問**: 見積もりの作成方法について

**回答**: ✅ **外注先のものをベースにこちらでやります**

**設計決定**:
- 外注先からの見積もり回答を基に、自社で見積もりを作成
- 見積もり項目（板金費用、塗装費用、部品費用など）を入力
- 外注先の見積もりを参考にしながら、顧客への見積もりを作成

### 1-5. 外注先への発注・預け

**質問**: 外注先への発注・預けの流れについて

**回答**: ✅ **実際に写真送ったり普通に持ち込んだりします**

**設計決定**:
- 外注先への発注は、顧客承認後に行う
- 写真を送付する場合と、車両を持ち込む場合がある
- 外注先での作業進捗は、電話連絡などで管理（システム連携は不要）

### 1-6. 写真撮影

**質問**: 写真撮影について

**回答**: ✅ **Beforeの写真や動画が必要**

**設計決定**:
- Before写真・動画の撮影は必須（損傷箇所の記録）
- 外注先への見積もり依頼時に使用
- After写真の撮影については品質確認時に実施（詳細は要確認）

### 1-7. 作業期間

**質問**: 作業期間について

**回答**: ✅ **作業時間は何件に応じて1カ月から3カ月**

**設計決定**:
- 外注先での作業期間は1カ月から3カ月（損傷の程度による）
- 顧客は車を預ける必要がある
- 作業期間が長いことを見積時に明示

### 1-8. 代車の提供

**質問**: 代車の提供について

**回答**: ✅ **ケースバイケース**

**設計決定**:
- 代車の提供はケースバイケース
- 作業期間が長い場合や、顧客の要望に応じて提供
- 代車の提供有無を記録

### 1-9. 品質確認

**質問**: 品質確認の内容について

**回答**: ✅ **After写真の撮影は必須**

**詳細**:
- **After写真**: 作業完了後の写真撮影は必須

**設計決定**:
- After写真の撮影は必須
- 品質確認時にAfter写真を撮影
- 不具合があった場合の対応については今後確認（現時点では実装しない）

### 1-10. PDF生成

**質問**: PDF生成について

**回答**: ✅ **不要。PDFで出すのは車検と12ヶ月点検のみ**

**設計決定**:
- 板金・塗装ではPDF生成は不要
- 作業記録はシステム内で管理

### 1-11. 測定値

**質問**: 測定値の入力について

**回答**: ✅ **不要**

**設計決定**:
- 測定値の入力は不要
- 損傷箇所の記録は写真・動画で十分

### 1-12. 部品の管理

**質問**: 部品の管理について

**回答**: ✅ **不要**

**設計決定**:
- 部品の管理は不要（外注先で管理）
- 部品費用は見積もりに含める

### 1-13. 事故案件

**質問**: 事故案件について

**回答**: ✅ **事故案件も多い。レッカーで入庫する場合もある**

**詳細**:
- **事故案件**: 板金・塗装は事故修理として事故案件も多い
- **レッカー入庫**: 事故でレッカーで入庫したりする場合もある
- **保険対応**: 事故の場合は保険対応が必要な場合がある

**設計決定**:
- 事故案件の識別（事故か通常の板金・塗装か）を記録
- レッカー入庫の対応（レッカーで入庫した場合の記録）
- 保険対応の有無を記録
- 事故の程度・種類を記録
- 事故の場合は、緊急度が高い可能性があるため、優先度を管理

---

## 2. 確定した仕様サマリー

### 2-1. 入庫区分の設定

**入庫区分**: `板金・塗装`

**設計決定**:
- システム上は「板金・塗装」として1つの入庫区分で管理
- 自社で施工を行わず、外注先に預ける

### 2-2. 業務フロー（パターンA基本）

```
1. 予約・受付: 板金・塗装が必要な車両の受付（5-10分）
2. 診断: 損傷箇所の確認、Before写真・動画の撮影、外注先への見積もり依頼（30分-1時間）
3. 見積作成: 外注先からの見積もり回答を基に、自社で見積もりを作成（30分-1時間）
4. 顧客承認: 見積内容を確認して承認
5. 外注発注: 外注先に発注、車両を預ける（写真送付または持ち込み）
6. 外注作業: 外注先で作業実施（1-3カ月、自社では作業しない）
7. 引き取り: 外注先から車両を引き取る
8. 品質確認: 作業内容の確認（詳細は要確認）
9. 引渡: 顧客に引渡（15-30分）
```

### 2-3. 診断内容

**設計決定**:
- 損傷箇所の確認（板金箇所、塗装箇所）
- Before写真・動画の撮影（必須）
- 外注先への見積もり依頼（写真送付または持ち込み）
- 外注先からの見積もり回答を受ける

### 2-4. 見積もり

**設計決定**:
- 外注先からの見積もり回答を基に、自社で見積もりを作成
- 見積もり項目（板金費用、塗装費用、部品費用など）を入力
- 顧客への見積もりを作成

### 2-5. 外注先への発注

**設計決定**:
- 顧客承認後、外注先に発注
- 写真を送付する場合と、車両を持ち込む場合がある
- 外注先での作業進捗は、電話連絡などで管理（システム連携は不要）

### 2-6. 作業期間

**設計決定**:
- 外注先での作業期間は1カ月から3カ月（損傷の程度による）
- 顧客は車を預ける必要がある
- 作業期間が長いことを見積時に明示

### 2-7. 代車の提供

**設計決定**:
- 代車の提供はケースバイケース
- 作業期間が長い場合や、顧客の要望に応じて提供
- 代車の提供有無を記録

### 2-8. 写真撮影

**設計決定**:
- Before写真・動画の撮影は必須（損傷箇所の記録）
- 外注先への見積もり依頼時に使用
- After写真の撮影については品質確認時に実施（詳細は要確認）

### 2-9. PDF生成

**設計決定**:
- 板金・塗装ではPDF生成は不要
- 作業記録はシステム内で管理

### 2-10. 事故案件の対応

**設計決定**:
- 事故案件の識別（事故か通常の板金・塗装か）を記録
- レッカー入庫の対応（レッカーで入庫した場合の記録）
- 保険対応の有無を記録
- 事故の程度・種類を記録（軽微、中程度、深刻、全損など）
- 事故の場合は、緊急度が高い可能性があるため、優先度を管理

### 2-11. データソース

**設計決定**:
- 車両情報: Google Sheets「【DB】車両マスタ」の「車両_同期用」シートから取得

---

## 3. 画面設計

### 3-1. 受付画面（Phase 1）

#### 入庫処理

**設計**:
- 板金・塗装が必要な車両の受付
- 事故案件の識別（事故か通常の板金・塗装か）
- レッカー入庫の記録（レッカーで入庫した場合）
- 保険対応の有無を記録
- 走行距離を入力
- 前回板金・塗装履歴の表示

**UI要素**:
- 事故案件の選択（事故、通常の板金・塗装）
- レッカー入庫の選択（レッカー入庫、通常入庫）
- 保険対応の選択（保険対応あり、保険対応なし）
- 走行距離入力欄
- 前回板金・塗装履歴表示

### 3-2. 診断画面（Phase 2）

#### 損傷箇所の確認と外注先への見積もり依頼

**設計**:
- 損傷箇所の確認（板金箇所、塗装箇所）
- Before写真・動画の撮影（必須）
- 外注先への見積もり依頼（写真送付または持ち込み）
- 外注先からの見積もり回答の記録

**UI要素**:
- 損傷箇所の選択（部位、程度）
- Before写真・動画撮影ボタン
- 外注先への見積もり依頼ボタン（写真送付または持ち込み）
- 外注先からの見積もり回答入力欄
- コメント入力欄

### 3-3. 見積作成画面（Phase 3）

#### 見積もりの作成

**設計**:
- 外注先からの見積もり回答を基に、自社で見積もりを作成
- 見積もり項目（板金費用、塗装費用、部品費用など）を入力
- 顧客への見積もりを作成
- 保険対応の場合は、保険会社への見積もり提出

**UI要素**:
- 外注先からの見積もり回答の表示
- 見積もり項目の入力（板金費用、塗装費用、部品費用など）
- 見積金額表示
- 作業期間の表示（1-3カ月）
- 保険対応の場合は、保険会社への見積もり提出ボタン

### 3-4. 外注発注画面（Phase 4）

#### 外注先への発注

**設計**:
- 顧客承認後、外注先に発注
- 写真を送付する場合と、車両を持ち込む場合がある
- 外注先名を記録（マスタ管理不要）

**UI要素**:
- 外注先名入力欄（テキスト入力）
- 発注方法の選択（写真送付、持ち込み）
- 発注内容の確認
- 発注ボタン

### 3-5. 外注作業管理画面（Phase 5）

#### 外注先での作業進捗管理

**設計**:
- 外注先での作業進捗を管理
- 作業完了の連絡を受ける（電話連絡など）
- 作業期間の表示（1-3カ月）

**UI要素**:
- 作業進捗状況の表示
- 作業完了連絡の受付ボタン
- 作業期間の表示

### 3-6. 引き取り・品質確認画面（Phase 6）

#### 外注先からの引き取りと品質確認

**設計**:
- 外注先から車両を引き取る
- 品質確認を実施
- After写真の撮影（必須）

**UI要素**:
- 品質確認チェックリスト
- After写真撮影ボタン（必須）
- コメント入力欄

### 3-7. 引渡画面（Phase 7）

#### 顧客への引渡

**設計**:
- 作業内容を説明して引渡

**UI要素**:
- 作業内容の表示
- 引渡ボタン

---

## 4. データモデル

### 4-1. 板金・塗装ジョブデータ

```typescript
/**
 * 板金・塗装ジョブ
 */
export interface BodyPaintJob {
  /** Job ID */
  jobId: string;
  /** 入庫区分 */
  serviceKind: "板金・塗装";
  
  /** 車両情報 */
  vehicle: {
    /** 車両ID */
    vehicleId: string;
    /** 走行距離 */
    mileage: number;
  };
  
  /** 事故案件情報 */
  accident: {
    /** 事故案件かどうか */
    isAccident: boolean;
    /** レッカー入庫かどうか */
    isTowTruck: boolean;
    /** 保険対応の有無 */
    hasInsurance: boolean;
    /** 保険会社名（保険対応の場合） */
    insuranceCompany?: string;
    /** 事故の程度・種類 */
    severity?: "軽微" | "中程度" | "深刻" | "全損";
    /** 事故の種類 */
    type?: "追突" | "出会い頭" | "側面衝突" | "単独事故" | "その他";
  };
  
  /** 診断情報 */
  diagnosis: {
    /** 損傷箇所 */
    damageLocations: DamageLocation[];
    /** Before写真 */
    beforePhotos: Photo[];
    /** Before動画 */
    beforeVideos: Video[];
    /** 外注先への見積もり依頼方法 */
    estimateRequestMethod: "写真送付" | "持ち込み";
    /** 外注先からの見積もり回答 */
    vendorEstimate?: VendorEstimate;
    /** コメント（整備士の所見） */
    comments: string;
  };
  
  /** 見積情報 */
  estimate: {
    /** 見積もり項目 */
    items: EstimateItem[];
    /** 合計金額 */
    total: number;
    /** 作業期間（月） */
    workDuration: number; // 1-3カ月
    /** 承認日時 */
    approvedAt?: Date;
  };
  
  /** 外注情報 */
  outsourcing: {
    /** 外注先名（テキスト入力） */
    vendorName: string;
    /** 発注日時 */
    orderDate?: Date;
    /** 発注方法 */
    orderMethod: "写真送付" | "持ち込み";
    /** 預け日時 */
    deliveryDate?: Date;
    /** 作業進捗状況 */
    progress: "発注済み" | "作業中" | "作業完了" | "引き取り済み";
    /** 作業完了日時 */
    completionDate?: Date;
    /** 引き取り日時 */
    pickupDate?: Date;
  };
  
  /** 品質確認情報 */
  qualityCheck: {
    /** 品質確認結果 */
    result?: "合格" | "要修正" | "返品";
    /** 確認項目 */
    checkItems?: QualityCheckItem[];
    /** After写真（必須） */
    afterPhotos: Photo[];
    /** コメント */
    comments?: string;
  };
  
  /** 代車情報 */
  courtesyCar: {
    /** 代車の提供有無 */
    provided: boolean;
    /** 代車ID（提供した場合） */
    courtesyCarId?: string;
  };
  
  /** ステータス */
  status: "入庫待ち" | "診断中" | "見積作成待ち" | "顧客承認待ち" | "外注発注待ち" | "外注作業中" | "引き取り待ち" | "品質確認中" | "出庫待ち";
}

/**
 * 損傷箇所
 */
export interface DamageLocation {
  /** 部位 */
  location: string;
  /** 損傷の種類（板金、塗装） */
  type: "板金" | "塗装" | "板金・塗装";
  /** 損傷の程度 */
  severity: "軽微" | "中程度" | "深刻";
  /** 写真 */
  photo: Photo;
  /** 動画 */
  video?: Video;
  /** コメント */
  comment?: string;
}

/**
 * 外注先からの見積もり回答
 */
export interface VendorEstimate {
  /** 外注先名 */
  vendorName: string;
  /** 見積もり項目 */
  items: EstimateItem[];
  /** 合計金額 */
  total: number;
  /** 見積もり回答日時 */
  responseDate: Date;
  /** 備考 */
  note?: string;
}

/**
 * 見積もり項目
 */
export interface EstimateItem {
  /** 項目名 */
  name: string;
  /** 数量 */
  quantity: number;
  /** 単価 */
  unitPrice: number;
  /** 金額 */
  amount: number;
  /** 備考 */
  note?: string;
}

/**
 * 品質確認項目（詳細は要確認）
 */
export interface QualityCheckItem {
  /** 項目名 */
  name: string;
  /** 確認結果 */
  result: "合格" | "要修正" | "不適合";
  /** コメント */
  comment?: string;
}
```

---

## 5. 実装方針

### 5-1. 外注先管理の実装

**設計**:
- 外注先のマスタ管理は不要
- 外注先名はテキスト入力で記録
- 外注先への発注時に、外注先名を入力

### 5-2. 診断の実装

**設計**:
- 損傷箇所の確認、Before写真・動画の撮影
- 外注先への見積もり依頼（写真送付または持ち込み）
- 外注先からの見積もり回答を記録

### 5-3. 見積もりの実装

**設計**:
- 外注先からの見積もり回答を基に、自社で見積もりを作成
- 見積もり項目（板金費用、塗装費用、部品費用など）を入力
- 作業期間（1-3カ月）を表示

### 5-4. 外注発注の実装

**設計**:
- 顧客承認後、外注先に発注
- 写真を送付する場合と、車両を持ち込む場合がある
- 外注先での作業進捗は、電話連絡などで管理（システム連携は不要）

### 5-5. 作業期間の管理

**設計**:
- 外注先での作業期間は1カ月から3カ月（損傷の程度による）
- 作業期間をステータス管理で管理
- 作業期間が長いことを見積時に明示

### 5-6. 代車の提供管理

**設計**:
- 代車の提供はケースバイケース
- 代車の提供有無を記録
- 代車を提供した場合、代車IDを記録

### 5-7. 事故案件の管理

**設計**:
- 事故案件の識別（事故か通常の板金・塗装か）を記録
- レッカー入庫の対応（レッカーで入庫した場合の記録）
- 保険対応の有無を記録
- 事故の程度・種類を記録（軽微、中程度、深刻、全損など）
- 事故の場合は、緊急度が高い可能性があるため、優先度を管理
- 保険対応の場合は、保険会社への見積もり提出と承認の管理

---

## 6. 要確認事項

以下の点について確認が必要です：

1. **不具合があった場合の対応**: 品質確認で不具合があった場合の具体的な対応方法（現時点では実装しない）

---

## 7. 次のステップ

1. **診断画面の実装**: 損傷箇所の確認、Before写真・動画の撮影、外注先への見積もり依頼
2. **見積作成画面の実装**: 外注先からの見積もり回答を基に、自社で見積もりを作成
3. **外注発注画面の実装**: 外注先への発注、写真送付または持ち込みの管理
4. **外注作業管理画面の実装**: 外注先での作業進捗管理
5. **引き取り・品質確認画面の実装**: 外注先からの引き取り、品質確認、After写真の撮影（必須）

---

## 更新履歴

- 2025-01-XX: 初版作成（確認済み仕様書）
- 2025-01-XX: After写真の撮影を必須に更新


























