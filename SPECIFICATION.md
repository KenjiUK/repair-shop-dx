# 整備工場DXプラットフォーム：開発仕様書 (v3.0 Final)

**Project Name:** Repair Shop DX Platform (YM Works Edition)

**Tech Stack:** Next.js (App Router), Tailwind/Shadcn, Vercel

**External Systems:** Zoho CRM (The Truth), Google Sheets (Master Cache), Google Drive (Storage)

**Infrastructure:** No additional license costs (Free Tier / Existing Plans optimization)

## 重要なシステム設定

### タイムゾーン
**本システムはすべて日本時間（JST: Asia/Tokyo）で動作します。**
- 日付・時刻の表示はすべて日本時間で表示されます
- APIからのデータ取得、保存も日本時間を基準とします
- ブラウザのタイムゾーン設定に関わらず、システム内のすべての時間は日本時間として扱われます

## 0. データアーキテクチャ & API定義 (The Truth)

本システムは、**「スマートカーディーラー（基幹システム）」を絶対的な正（Master）**とし、ZohoとWebアプリが連携する構成とする。

### 0-1. システム役割とデータ権限 (Master Definition)

| **システム** | **具体名** | **役割** | **データ権限 (App側)** | **備考** |
| --- | --- | --- | --- | --- |
| **基幹システム** | スマートカーディーラー | **The Truth (絶対正)** | **No Access** | 顧客・車両・売上の最終保管場所。API連携せず、CSV/Excel経由で連携する（MVP）。 |
| **マスタ参照用** | Google Sheets | Mirror (鏡) | Read Only | スマートカーディーラーから毎日出力されるデータを格納。アプリはここを見て車両検索する。 |
| **CRM** | Zoho CRM | Transaction | Read / Write | 顧客対応、予約、進捗ステータス管理、アプリ用データハブ。 |
| **ストレージ** | Google Drive | Storage | Read / Write | 写真、動画、PDF（スマートカーディーラーから出力した請求書等）。<br>※重要: 画像はクライアント側で圧縮保存する（容量対策）。 |

### 0-2. Zoho CRM モジュール・フィールド・APIマッピング

**【重要】** 開発時は以下のAPI名を使用すること。（提供リスト準拠）

### A. 入庫管理 (CustomModule2)

本システムのメイン。案件(Job)を管理する。

- **Key ID:** `id` (Record ID)
- **検索キー:** `field22` (入庫日時), `field4` (顧客名Lookup), `field6` (車両ID Lookup)

| **項目名** | **API名** | **データ型** | **用途・ロジック** |
| --- | --- | --- | --- |
| 入庫日時 | field22 | DateTime | Phase 0/1: 「今日」のデータを取得するクエリに使用。 |
| 工程ステージ | field5 | PickList | ステータス管理（入庫済み / 見積作成待ち / 作業待ち / 出庫待ち / 出庫済み）。 |
| 顧客名 | field4 | Lookup | 顧客モジュール(Contacts)への参照。 |
| 車両ID | field6 | Lookup | 車両モジュール(CustomModule1)への参照。 |
| **作業指示書** | **field** | **Multi-Line** | **Phase 0: 社内からの申し送り事項（CRM直接入力またはアプリ入力）。アプリで「⚠」アイコンを表示。** |
| 詳細情報 | field7 | Multi-Line | Phase 0: 顧客が事前入力した不具合・問診内容をここに追記。 |
| 走行距離 | field10 | Number | Phase 0: 顧客入力値 / Phase 2: メカニック入力値。 |
| **作業内容** | **field13** | **Multi-Line** | **Phase 4/5: 顧客承認済みの見積もり明細（テキスト）をここに書き込む。**<br>※field14(一覧)は選択リスト型のため使用しない。 |
| 作業内容一覧 | field14 | Multi-Select | ※使用しない（APIエラー回避のため）。 |
| お客様共有フォルダ | field19 | URL | Phase 2: 作成したGoogle DriveフォルダのURLを書き戻す。 |
| 予約ID | ID_BookingId | Text | Zoho Bookingsとの紐付け用。 |
| 関連ファイル | field12 | Upload | 車検証画像などを格納。 |

### B. 顧客 (Contacts)

顧客情報。アプリからの差分更新対象。

- **Key ID:** `id` (Record ID), `ID1` (顧客ID - 基幹連携用)

| **項目名** | **API名** | **データ型** | **用途・ロジック** |
| --- | --- | --- | --- |
| 顧客ID | ID1 | Text | 最重要キー。スプレッドシート（マスタ）との突合に使用。<br>※基幹ID（例: K1001）が格納されている前提。 |
| 氏名 | Last_Name, First_Name | Text | 表示用。 |
| LINE ID | Business_Messaging_Line_Id | Text | Phase 1: LINE連携時にアプリから書き込む（直接更新OK）。 |
| メール同意 | Email_Opt_Out | Boolean | Phase 0: 事前チェックインで同意なら `false` に更新（直接更新OK）。 |
| 誕生日 | Date_of_Birth | Date | Phase 0: 入力があれば更新（直接更新OK）。 |
| 住所 | Mailing_Street, field4 | Text | **直接更新NG**。変更がある場合は `Description` へ追記。<br>※Mailing_Street(町名・番地), field4(番地), field6(建物名等) |
| 電話番号 | Phone, Mobile | Text | **直接更新NG**。変更がある場合は `Description` へ追記。 |
| 備考 | Description | Text | アプリからの「住所・電話変更依頼」をここに追記する。 |
| **予約時連絡先** | **Booking_Phone_Temp** | **Text** | **(新規追加) Bookingsからの電話番号一時保存用（上書き防止）。** |

### C. 車両 (CustomModule1)

Zoho内の簡易車両データ。

- **Key ID:** `Name` (車両ID - 基幹連携用)

| **項目名** | **API名** | **データ型** | **用途・ロジック** |
| --- | --- | --- | --- |
| 車両ID | Name | Text | 最重要キー。スプレッドシート（マスタ）との突合に使用。 |
| 登録番号連結 | field44 | Text | ナンバープレート情報。検索・表示用。 |
| 顧客ID | ID1 | Text | 所有者紐付け用。 |
| 車検有効期限 | field7 | Date | Phase 6: 次回リマインド用。 |

### D. その他利用モジュール

- **商談 (Deals):** 新規問い合わせ管理。アプリからは参照しない（入庫管理にコンバートされたものだけ扱う）。
- **予約 (Appointments__s):** Zoho Bookingsデータ。Read Only。
- **予定 (Events):** カレンダー連携。
    - Work_Order_ID: 作業指示書ID
    - field4: 作業内容
- **タスク (Tasks):** Todo管理。

### 0-3. データの同期フロー (Data Pipeline)

**A. マスタデータの流れ（下り：Smart Car Dealer → App）**

1. **Export:** 事務員が毎日、スマートカーディーラーからCSV/Excelで書き出し、Driveへアップロード。
2. **Import:** GAS (Google Apps Script) がファイルを検知し、Google Sheetsに上書き展開する。
3. **Read:** Webアプリ（Next.js）は、このSheetsをAPI経由で参照し、予約時の車両特定などに利用する。
    - **【事前タスク】:** 基幹システムの「顧客ID（例: K1001）」とZohoの「ID1」のフォーマットが完全一致しているか、開発前にデータクレンジングを行うこと。

**B. 更新データの流れ（上り：App → Smart Car Dealer）**

1. **Input:** 顧客が Webアプリ（事前チェックイン画面） で「新住所」を入力。
2. **Pool:** WebアプリはZoho CRM (Contacts) の `Description` (詳細情報) にデータを書き込む。
3. **Update:** 事務員がZohoの変更通知を見て、**手動で**スマートカーディーラーの登録情報を修正する。
    - ※ここを自動化するのはリスクが高いため、MVPでは人間が介在する運用とする。

**C. 社内作業指示の流れ (Internal Order)**

1. **Input:** スタッフが電話対応時などに **Zoho CRM画面へ直接入力**、または **新アプリ** から入力。
2. **Sync:** 入力内容は Zoho CRM `CustomModule2` の **field (作業指示書)** に集約される。
3. **Output:** 新アプリの受付・診断画面に「⚠作業指示あり」アイコンとして表示される。

**D. APIレート制限対策 (Architecture)**

- **Caching:** Next.js側で `SWR` または `TanStack Query` を使用し、マスタデータ等のAPIレスポンスを適切にキャッシュする（TTL設定）。
- **Optimization:** 不要なポーリングを避け、Webhookや適切な再検証間隔（Revalidation）を設定する。

### 0-4. マスタデータ構造 (Smart Car Dealer出力準拠)

Google Sheetsのカラム名は、提供されたデータのヘッダー行に基づく。

- **車両マスタ (SheetID_Vehicle):** 検索キー=顧客ID。
    - 主要カラム: `車両ID` (Key), `顧客ID`, `登録番号連結`, `車名`, `型式`, `車検有効期限`, `次回点検日`
- **顧客マスタ (SheetID_Customer):** 検索キー=顧客ID。
    - 主要カラム: `顧客ID` (Key), `顧客名`, `住所連結`, `電話番号`, `携帯番号`

## Phase 0. 予約・事前準備（家・オフィス）詳細設計

**コンセプト：** 入り口（Web/電話/メール）はバラバラでも、最終的にZoho CRMの**「入庫管理 (CustomModule2)」**モジュールでデータが一本化され、それが現場アプリに同期される。

### 0-1. 新規顧客のフロー（まずは見積もりから）

**「問い合わせ → 概算見積 → 合意 → 予約確定」**

- **Step 1: 問い合わせ (Action)**
    - 🚗 **顧客:** Webサイトのフォーム、または電話で問い合わせ。
    - 🔧 **スタッフ:** 電話等の場合、Zoho CRM `Deals` (商談) レコードを作成。（ステータス：見積提示待ち）
    - **データ連携ロジック:**
        - **HPフォームの場合:** WordPressの連携プラグインにより、自動的にZoho CRMの**「商談 (Deals)」**にレコードが作成される。
        - **見積進行の場合:** 商談が進み、見積もりを出す段階で事務員が**「スマートカーディーラー（基幹）」**に顧客・車両情報を登録する（翌朝Zohoへ同期）。
- **Step 2: 商談・追跡 (System: 商談管理)**
    - 🔧 **スタッフ:** 概算見積もりを作成し提示。ステータスを「検討中」として追跡。
- **Step 3: 受注・予約確定 (Conversion)**
    - 🚗 **顧客:** 金額合意後、Zoho Bookingsで日時を選択して予約。
    - 🖥 **System (Zoho):**
        - 予約完了トリガーにより、該当する `Deals` を「受注」に変更。
        - 自動ワークフローにより、商談データをコピーして `CustomModule2` (入庫管理) へ新規レコードを作成。（これが「確定予約」となる）

### 0-2. 既存顧客のフロー（リピーター・車検）

**「メール通知 → 即予約 → 確定」**

- **Step 1: きっかけ (Trigger)**
    - 🚗 **顧客:** 車の調子が悪い、または Zoho Campaigns からの「車検/12ヶ月点検のお知らせ」が届く。
- **Step 2: 予約アクション (Action)**
    - 🚗 **顧客:** メール内リンクから Zoho Bookings で即時予約。
    - **【不整合対策（電話番号）】:**
        - Bookingsのフォーム項目（電話番号）は、CRMの **「予約時連絡先 (Booking_Phone_Temp)」** にマッピングする。
        - **理由:** 顧客が自宅番号などを入力して、CRM上の正しい「携帯番号 (Mobile)」が上書きされるのを防ぐため。
- **Step 3: 自動連携 (System: 入庫管理)**
    - 🖥 **System (Zoho):** 予約完了と同時に、Bookings連携で `CustomModule2` (入庫管理) レコードが自動生成される。（商談フェーズを経由せず、直接「入庫」として扱う）

### 0-3. システム連携＆事前チェックイン

**「Zohoで決まった予定が、現場アプリに降りてくる」**

**同期 (Sync)**

- 🖥 **統合Webアプリ:** 定期的（またはWebhook）にZoho `CustomModule2` をAPI参照。
- **Query:** 「入庫日時 (field22) ＝ 今日 or 明日」のデータを取得し、アプリ内のリストにキャッシュする。

**事前チェックイン (Pre-Check-in)**

- 🖥 **System (Zoho Automation):** 予約確定時 / 入庫前日にメール自動送信。アクションとして**「事前チェックイン（Web受付票）」**のリンクを記載。
- 🚗 **顧客:** スマホでリンクを開く。
- 📝 **確認・入力フロー (Web App Logic):**
    1. **車両の特定 (Vehicle Selection):**
        - **解決策:** Zohoの顧客ID (ID1) をキーに、Google Sheets (SheetID_Vehicle) を検索。
        - **UI:** 「今回ご入庫のお車はどちらですか？」→ 保有車両リスト（車名・登録番号連結）を表示し選択させる。
        - **※新規客またはリストにない車の場合:**
            - *「別の車（新規）」**を選択。
            - **「車種名（例: BMW X3）」をテキスト入力**させ、車検証の写真をアップロードさせる。（→ 画像は `field12` へ保存）
    2. **顧客情報の確認 (Identity Verification):**
        - 現在登録の住所・電話番号を表示（Source: Zoho `Contacts`）。
        - 「変更はありますか？」→ ある場合、新住所を入力。
    3. **パーミッション (Consent):**
        - メール配信同意（Opt-in）のチェックボックス。
    4. **問診 (Details):**
        - 現在の走行距離（概算）。
        - 不具合・気になるところ（選択または自由記述）。
        - 代車の希望（有無）。
- 🖥 **System (Data Write-back):**
    - **顧客データの反映:**
        - メール同意: Zoho `Contacts` の `Email_Opt_Out` を即時更新（Direct Update）。
        - 住所・電話変更: Zoho `Contacts` の `Description` (詳細情報) 欄に「【アプリ変更届】住所変更: ...」と追記。事務員が後日基幹システムを手動修正する。
    - **入庫データの反映:**
        - 選択された車両を `CustomModule2` の `field6` (車両ID) に紐付け。
        - 走行距離を `field10`、不具合内容を `field7` (詳細情報) に追記。
        - 新規車両画像は `field12` (関連ファイル) に保存。
    - **統合Webアプリ:**
        - これらの情報を読み込み、当日の受付画面に**「📝事前入力あり（住所変更あり/不具合あり）」**とアイコン表示し、スタッフに注意を促す。

**社内作業指示書 (Internal Order)**

- 🔧 **スタッフ（フロント営業）:**
    - 予約確定後、電話等で追加の要望（ETCセットアップ等）を受けた場合。
- **入力手段:**
    - **PCの場合:** Zoho CRMの画面を開き、該当案件の `field` (作業指示書) に直接入力する。
    - **現場の場合:** 新アプリの受付画面から入力する。
- 🖥 **System:**
    - 入力内容は Zoho `CustomModule2` (入庫管理) の `field` (作業指示書) 欄に保存される。
    - 統合Webアプリの受付画面にも**「⚠ 作業指示あり」**アイコンが表示される。

---

### 💡 このフェーズの重要ポイント（開発のツボ）

**開発者（あなた）が認識すべき「データ整合性とリスク回避」**

1. **マスタ検索キーの完全一致 (Strict Matching):**
    - 車両検索は、Zohoの `ID1` と Google Sheetsの `顧客ID` を突合します。
    - **リスク:** 基幹システムが「K1001」、Zohoが「1001」のようにフォーマットがズレていると検索がヒットしません。開発前に必ず**データクレンジング（IDフォーマット統一）**を行ってください。
2. **更新権限の分離 (Field Level Security):**
    - アプリからの書き込みにおいて、「メール同意 (Email_Opt_Out)」は**上書き更新**ですが、「住所 (Mailing_Street)」は**備考 (Description) への追記**のみ許可します。
    - これをコードレベルで厳密に分岐させてください。誤って住所を上書きすると、基幹システムとの整合性が取れなくなります。
3. **新規車両の画像処理 (New Vehicle Logic):**
    - 顧客が「別の車（新規）」を選んで車検証をアップロードした場合、Zoho APIの `field12` (関連ファイル) へのアップロード処理（multipart/form-data）が必要です。
    - この画像は、後で事務員が基幹システムへ車両登録する際の重要な参照資料となります。

---

## Phase 1. 来店・受付（フロント）詳細設計

**コンセプト：** 「名前を聞いて検索する」を廃止。タブレット1タップで、アナログ（車の鍵）とデジタル（Zohoの案件データ）を結合する。

### 1-1. 来店・本人確認 (Identification)

**「いらっしゃいませ」の瞬間に、画面には既に答えが出ている。」**

- **Step 1: アプリ確認 (Action)**
    - 🔧 **受付スタッフ:** カウンターのタブレット（新アプリ）を見る。
    - 🖥 **新アプリ:**
        - **Query:** Zoho `CustomModule2` (入庫管理) から「入庫日時 (field22) = 今日」のデータをAPI取得し、カード形式で一覧表示。
        - **Alert Icon Logic:**
            - **「📝事前入力あり」:** Phase 0で顧客が不具合（field7）を入力、または住所変更希望がある場合。
            - **「⚠作業指示あり」:** フロントスタッフが **Zoho CRMまたはアプリ** から社内指示（field）を入力済みの場合。
- **Step 2: 接客 (Communication)**
    - 🚗 **顧客:** 来店。「予約の田中です」
    - 🔧 **受付スタッフ:** 検索不要。「田中様、お待ちしておりました。事前に入力いただいたブレーキの音、重点的に拝見しますね」
    - **Action:** リスト上の **[Check-in (受付開始)]** ボタンをタップ。
    - ※もしPhase 0で車両未特定だった場合、このタイミングで車両選択モーダル（Google Sheets参照）を表示し、車両を確定させる。

### 1-2. スマートタグ紐付け (Pairing)

**ここがシステム上の最重要ポイント。物理タグとデジタルデータの結合。**

- **Step 1: タグ選定 (Physical)**
    - 🔧 **受付スタッフ:** 手元にあるカラビナ付きの「空きスマートタグ（例: No.05）」を手に取り、顧客から預かった車の鍵に取り付ける。
- **Step 2: 紐付け (Digital - Hybrid UI)**
    - 🔧 **受付スタッフ:** アプリ画面に**「空いているタグ一覧（01, 02, 05...）」**がボタンとして表示される。
        - **方法A（推奨）:** 画面上の [05] ボタンをタップする。（※カメラ起動不要で最速）
        - **方法B（確実）:** [QR Scan] ボタンを押し、タグのQRコードを読み取る。（※目視確認ミスを防ぎたい場合）
- **Step 3: リンク確立 (System)**
    - 🖥 **新アプリ (Internal DB):**
        - **Infrastructure:** Vercel Postgres / Supabase (Free Tier) を利用。
        - **Mapping:** Tag ID: 05 ⇔ Zoho Job ID (CustomModule2.id)
        - **重要ロジック:** タグNo.05に関連する過去のセッションステータスを全て `closed` に更新し、**「現在、タグNo.05は田中様の車である (active)」**と定義を上書きする。

### 1-3. LINEコネクト (Connection)

**後の「見積承認」をスムーズにするための導線確保。**

- **Step 1: 案内 (Action)**
    - 🔧 **受付スタッフ:** 「点検結果やお見積もりは、スマホで確認できるようLINEにお送りします」
    - カウンターのPOP（店舗公式LINEのQR）を指差す。
- **Step 2: 登録・紐付け (Scenario分岐)**
    - **シナリオA：MVP（初期・SMS代替）**
        - 🚗 **顧客:** （形式上）QRを読み込み友達追加。
        - 🔧 **受付スタッフ:** 「後ほど、お客様の電話番号（SMS）宛に、専用の確認ページをお送りします」と伝える。
        - 🖥 **System:** Zoho `Contacts` の `Mobile` (携帯電話) が存在するか確認し、送信ターゲットとする。
    - **シナリオB：本番（LINE ID連携）**
        - 🚗 **顧客:** QRを読み込み、リッチメニューの「アカウント連携」をタップし、アプリへのログインを許可する。
        - 🖥 **System:** 顧客のLINE User IDを取得し、Zoho `Contacts` の `Business_Messaging_Line_Id` に保存する。以降、自動通知が可能になる。

### 1-4. 受付完了 (Complete)

**「それでは、お預かりします」**

- **Step 1: ステータス更新**
    - 🔧 **受付スタッフ:** アプリの **[受付完了]** ボタンを押す。
    - 🖥 **System:**
        - Zoho `CustomModule2` の 工程ステージ (field5) を「入庫待ち」から**「入庫済み」**にAPI経由で自動更新する。
- **Step 2: 引き継ぎ**
    - 🔧 **受付スタッフ:** 鍵（タグNo.05付き）をピット（整備工場）の指定場所に置く、またはメカニックに手渡す。
    - 🚗 **顧客:** 代車に乗るか、そのまま外出。所要時間はここまで約1分。

---

### 💡 このフェーズの重要ポイント（開発のツボ）

**開発者（あなた）が認識すべき「データの流れと排他制御」**

1. **タグのステータス管理 (Tag Lifecycle):**
    - タグNo.05は「使い回し」です。DB設計上、Tags テーブルと Sessions テーブルを分け、Sessions には `status: 'active' | 'closed'` を持たせてください。
    - **Transaction:** 紐付け時は必ず `UPDATE sessions SET status='closed' WHERE tag_id='05'` を実行してから、新しい `INSERT` を行う**トランザクション処理**を実装してください。
2. **Zohoへの書き込み (Sync Trigger):**
    - 受付完了時に Zoho API (CustomModule2 PUT) を叩いてステータス (field5) を更新します。これがトリガーとなり、事務所にいる他のスタッフも「田中様が来店した」とZoho上で認識できます。
3. **オフライン対応 (Local Storage):**
    - 万が一ネットが切れていても「タグ番号の選択」と「受付」だけは進められるように、`localStorage` に一時保存し、オンライン復帰時にZohoへ同期する仕組み（Background Sync / Service Worker）を実装してください。

## Phase 2. 診断・撮影（ピット）詳細設計

**コンセプト：** 「汚れた手でPCを触らない」。スマホ一台で、診断・撮影・報告・ブログ素材収集までをワンストップで完結させる。

### 2-1. 車両特定 (Identification)

**「どの車を作業するか、スマホに教える」**

- **Step 1: アプリ起動 (Action)**
    - 🔧 **メカニック:** 自分のスマホ（または社用端末）でWebアプリを開く。
    - **WebApp:** ホーム画面には**「本日の入庫予定リスト（簡易タイムライン）」**が表示されている。
- **Step 2: スキャン or 選択 (Hybrid UI)**
    - 🔧 **メカニック:**
        - **方法A (QR Scan):** アプリのカメラボタンを押し、鍵についているタグNo.05のQRを読み取る。
        - **方法B (List):** 画面のリストから「BMW X3 (タグ05)」をタップする。
- **Step 3: 情報表示 (System)**
    - 🖥 **新アプリ:**
        - *「田中様 BMW X3 診断モード」**が起動。
        - **Alert:** Phase 0で入力されたZohoデータを元に、画面上部にアラートを表示。
            - 「📝申し送り：ブレーキから異音 (CustomModule2.field7 詳細情報)」
            - 「⚠作業指示書：オイルフィルター在庫確認 (CustomModule2.field 作業指示書)」
        - (メカニック心理：「お、ブレーキを見ればいいんだな」「フロントからの指示も忘れないようにしよう」)

### 2-2. 撮影 (Capture) - ブログ機能統合

**「入庫時の4点バースト撮影 ＋ 広報活動の自動化」**

- **Step 1: モード選択 (UI)**
    - 画面上部のタブで撮影モードを切り替える。
    - **【整備モード (Default)】:** 顧客への報告・記録用。
    - **【広報/ブログモード】:** 集客用（SNS/ブログ素材）。
- **Step 2: 整備撮影フロー (Standard)**
    - **Action:** 画面ガイド「📸 前面」→「📸 後面」→「左」→「右」に従い、リズムよく4枚撮影。
    - **System (Client):**
        1. 撮影直後、アプリ内で**「会社ロゴのウォーターマーク（透かし）」**を画像の右下に合成。
        2. **【圧縮処理】:** Google Drive容量節約のため、ブラウザ側で画像を**300KB〜500KB程度にリサイズ・圧縮**する。（ライブラリ: `browser-image-compression` 等を使用）
    - **System (Background):** バックグラウンドでGoogle Driveへアップロード（Optimistic UI）。
    - **保存先:** Drive/車両写真/[年]/[月]/[日付]_[顧客名]_[車両]_[ナンバー]/01_入庫写真/
    - **命名規則:** {位置番号}_{位置名}_{日付}_{サービス名}_{車両名}.jpg
- **Step 3: ブログ撮影フロー (Marketing)**
    - **Scenario:** 「お、この旧車は珍しい。ブログに載せよう」
    - **Action:** モードを【ブログ】に切り替え撮影。
    - **Metadata:** 撮影後にタグ選択（「作業風景」「入庫車両」）、公開可否（「ナンバー隠せばOK」等）。
    - **保存先:** Drive/ブログ素材/[年]/[月]/[日付]_[カテゴリ]_[テーマ]/
    - ※顧客フォルダとは明確に分離し、後で広報担当が素材として使いやすくする。

### 2-3. 診断・所見入力 (Diagnosis)

**「信号機方式（Traffic Light）で直感入力」**

- **Step 1: 点検項目チェック (Checklist)**
    - **System:** Zohoのサービス種別（車検/点検/修理）に応じて、表示するチェックリストを自動で切り替える。
    - **Action:** 各パーツ（タイヤ、バッテリー、オイル等）をタップ判定。
        - 🟢 **緑 (Good):** 異常なし
        - 🟡 **黄 (Warning):** 注意・経過観察（そろそろ交換）
        - 🔴 **赤 (Bad):** 要交換・不具合
- **Step 2: 証拠撮影 (Evidence)**
    - **Action:** 「🔴 ブレーキ」や「🟡 オイル漏れ」を選択すると、自動でカメラが起動。
    - **Media:**
        - **写真:** 基本はこちら。不具合箇所を接写。（※ここも同様に自動圧縮）
        - **動画 (MVP仕様):** 「異音」など写真で伝わらない場合のみ「15秒動画」ボタンを押す。
    - **保存先:** Drive/.../02_証拠写真/
- **Step 3: コメント入力 (Voice Input)**
    - **Action:** 手が汚れているためキーボードは打たない。マイクボタンを押す。
    - **Voice:** 「パッド残量2ミリ。ローターも段付き摩耗あり。セット交換推奨」
    - **System:** OpenAI Whisper API 等でテキスト化し、コメント欄に入力。
- **Step 4: 走行距離入力 (Mileage)**
    - **Action:** 実際のオドメーターを見て数値を入力。
    - **System:** Zoho `CustomModule2` の `field10` (走行距離) を更新対象とする。

### 2-4. 診断完了・送信 (Submit)

**「事務員への伝達完了」**

- **Step 1: 完了アクション**
    - 🔧 **メカニック:** 一通り見終わったら **[診断完了 (Send to Front)]** ボタンをスワイプ。
- **Step 2: データ同期**
    - 🖥 **System:**
        - 診断結果（JSON）と写真のリンク一覧（Drive URL）をまとめ、アプリのDBに保存。
        - Google DriveのフォルダURL（ルート）を Zoho `CustomModule2` の `field19` (お客様共有フォルダ) に書き戻す。
        - Zoho `CustomModule2` の 工程ステージ (field5) を「作業中」から**「見積作成待ち」**に更新。
        - 事務所のアドバイザー（フロント）に「診断完了通知」が飛ぶ。

---

### 💡 このフェーズの重要ポイント（開発のツボ）

**開発者（あなた）が認識すべき「現場のリアリティとリソース管理」**

1. **写真の自動圧縮 (Compression is Mandatory):**
    - Google Driveの容量（30GB/user）を守るため、**「圧縮しないとアップロードできない」**ロジックにしてください。
    - 目安は1枚あたり300KB〜500KBです。画質よりも「証拠として見えること」と「軽さ」を優先します。
2. **ファイル名とフォルダの完全自動化:**
    - メカニックにファイル名変更やフォルダ移動を一切させないでください。
    - プログラム側で、仕様書の命名規則（{位置}_{日付}_{車両}.jpg）に従って自動保存・リネーム処理を実装してください。ここが崩れるとPhase 6（顧客閲覧）で写真が表示されません。
3. **オフライン耐性 (PWA / Background Sync):**
    - 工場の奥や車内はWi-Fiが届かないことがあります。
    - 「撮影」と「入力」はオフラインでもサクサク動作し、電波が戻った瞬間に一気にアップロードされる仕組み（Service Worker）が必須です。

---

## Phase 3. 見積作成（事務所）詳細設計

**コンセプト：** 「ハイブリッド運用」。計算はスマートカーディーラー（基幹）で行い、顧客へのプレゼン（見せ方）だけをWebアプリで作る。

### 3-1. 診断結果の確認 (Review)

**「現場から上がってきた『生のデータ』を受け取る」**

- **Step 1: 通知・着手 (Trigger)**
    - 🔧 **アドバイザー（フロント）:**
        - 事務所のPCで作業中。Zohoのステータス変更通知、またはアプリのダッシュボードで**「見積待ちリスト」**を確認。
        - リストから「田中様 BMW X3」をクリック。
- **Step 2: 内容チェック (Check)**
    - 🔧 **アドバイザー:** Webアプリの診断結果ビューを見る。
        - **画面左側:** メカニックが撮った**「写真（入庫時＋証拠）」**（Source: Google Drive）。
        - **画面右側:** メカニックの**「所見コメント（パッド残2mmなど）」と「赤/黄判定」**（Source: Web App DB）。
    - (アドバイザー心理：「なるほど、今回はブレーキとオイルが提案ポイントだな」と把握)

### 3-2. 正確な計算 (Core System Calculation)

**「お金のことは、餅は餅屋（スマートカーディーラー）へ」**

- **Step 1: 基幹システム入力 (Offline Task)**
    - 🔧 **アドバイザー:**
        - 横にある**スマートカーディーラー（基幹システム）**を操作する。
        - 部品商のサイトで正確な型番と価格を調べ、正式な見積書を作成する。
        - 例：Fパッド ¥24,500 + 工賃 ¥5,500 + 消費税 = **¥33,000**
- **Step 2: 松竹梅の検討 (Strategy)**
    - 🔧 **アドバイザー:** 顧客の予算感や車の年式に合わせて、提案プランを練る。
        - 「必須」：法定費用、基本点検料
        - 「推奨」：ブレーキ（危険なので強く推す）
        - 「任意」：ワイパー（まだいけるが、ついでなら）

### 3-3. カート画面の作成 (Digital Menu Creation)

**「Amazonのような『買い物リスト』を作る」**

- **Step 1: Webアプリへ転記 (Data Entry)**
    - 🔧 **アドバイザー:**
        - Webアプリの**「見積作成画面」**に戻る。
        - *「＋項目を追加」**ボタンを押し、スマートカーディーラーで作った内容をシンプルに入力していく。
        - **※重要:** 「品番」などの細かい情報は不要。**「品名」と「金額（税込）」だけでOK**。
- **Step 2: 項目設定 (Item Config)**
    - **【項目A：基本整備（必須）】**
        - 名称：「12ヶ月点検一式」 / 金額：¥25,000
        - 設定：**「選択必須（外せない）」**にチェック。
    - **【項目B：ブレーキ交換（推奨）】**
        - 名称：「フロントブレーキパッド交換」 / 金額：¥33,000
        - 設定：「選択可能（デフォルトON）」。
        - **証拠紐付け:**
            - **写真:** Phase 2でメカニックが撮った写真をドラッグ＆ドロップで紐付ける。
            - **動画 (MVP):** 動画ファイルがある場合は「動画リンクアイコン」が表示されるので、それを選択して紐付ける（顧客はリンク経由で閲覧）。
    - **【項目C：ワイパー交換（任意）】**
        - 名称：「ワイパーブレード交換」 / 金額：¥8,000
        - 設定：「選択可能（デフォルトOFF）」。
- **Step 3: テンプレート活用 (Optional)**
    - 🔧 **アドバイザー:**
        - 「オイル交換セット」など、よく使う項目はアプリ内のテンプレートから一発呼び出しも可能にする（入力負荷軽減）。

### 3-4. 送信 (Send to Customer)

**「電話ではなく、相手に合わせた通知を送る」**

- **Step 1: プレビュー (Confirmation)**
    - 🔧 **アドバイザー:**
        - 「顧客からどう見えるか」をプレビュー画面で確認。
        - 写真や動画リンクが正しく紐付いているか、金額合計が基幹システムと合っているかチェック。
- **Step 2: 送信手段の選択 (Select Channel)**
    - 🔧 **アドバイザー:** 顧客の希望や連絡手段に合わせてボタンを選択する。
        - **[LINEで送信]:** 通常はこちら。Phase 1で連携済みなら自動送信。
        - **[メールで送信]:** 法人客など。Zoho `Contacts` の `Email` アドレスを自動参照。
- **Step 3: システム処理 (System)**
    - 🖥 **System:**
        - 見積もりページの一意なURL（例: `app.ymworks.com/quote/uuid...`）を発行。
        - 選択されたチャネル（LINE / メール / SMS）に向けてメッセージを自動送信。
        - **Message:** 「田中様、点検が終了しました。お見積りと写真をご確認ください。（URL）」
        - **Zoho Sync:** Zoho `CustomModule2` の 工程ステージ (field5) を**「見積提示済み (Quote Sent)」**に更新。

---

### 💡 このフェーズの重要ポイント（開発のツボ）

**開発者（あなた）が認識すべき「通知ロジックとハイブリッド運用」**

1. **メール送信の実装:**
    - 「メールで送信」が選ばれた場合、Zoho API経由で `Contacts` の `Email` (メイン) または `Secondary_Email` (サブ) を取得し、宛先にセットしてください。
    - Phase 0の事前チェックインでメールアドレスが変わっている可能性があるため、必ず最新のZohoデータを参照すること。
2. **ハイブリッド運用の肝 (Anti-Pattern Avoidance):**
    - スマートカーディーラーへの入力とWebアプリへの入力、二度手間になりますが、Webアプリ側は**「品名と金額（税込）」だけでOK**という運用ルールにすることで、負担を最小限に抑えます。
    - Webアプリ側で「消費税計算」や「工賃計算」ロジックを実装しないでください。金額の正解は常に基幹システムにあります。
3. **テンプレート機能:**
    - 毎回「ブレーキパッド交換」と打つのは面倒です。よくある作業項目はマスタ化（テンプレート化）しておく機能を、MVPの次のステップで優先的に実装しましょう。

---

## Phase 4. 承認（顧客体験）詳細設計

**コンセプト：** 「電話説明の廃止」。Amazonで買い物をするように、自分の車の整備内容をスマホで選び、ポチッと注文する。

### 4-1. アクセス・認証 (Access)

**「アプリのインストール不要。URLを開くだけ」**

- **Step 1: 通知タップ (Trigger)**
    - 🚗 **顧客:** LINE / メール に届いたメッセージを開く。
    - ✉️ **文面:** 「【ワイエムワークス】田中様、お見積もりの準備ができました。以下のリンクからご確認ください」
- **Step 2: ページ表示 (View)**
    - 🚗 **顧客:** URL（.../quote/uuid-12345）をタップ。
    - **Auth:** **ログイン不要（マジックリンク方式）**で、自分専用の見積もり画面が開く。
    - **UI:** トップには**「田中様 BMW X3 御見積」のタイトルと、現在の「合計金額（税込）」**が大きく出ている。

### 4-2. 選択・検討 (Shopping Experience)

**「写真があるから、素人でも判断できる」**

画面は3つのセクション（松・竹・梅）に分かれています。

- **Section A: 必須整備 (Mandatory)**
    - **表示:** 「法定24ヶ月点検」「諸費用」など。
    - **動作:** チェックボックスは**ONのまま固定（ロック）**されており、外せない。「車検を通すために必須です」と注釈がある。
- **Section B: 推奨整備 (Recommended)**
    - **表示:** 「フロントブレーキパッド交換」「ファンベルト交換」など、メカニックが**「🔴 要交換」**と判定したもの。
    - **証拠体験 (Evidence):**
        - **写真:** 項目の中に、Phase 2で撮影しPhase 3で紐付けられた**「すり減ったパッドの写真」**が埋め込まれている。タップすると拡大表示（Lightbox）される。
        - **動画 (MVP仕様):** 動画が存在する場合は「▶ 動画を確認」ボタンを表示し、タップすると別タブでGoogle Drive/ブラウザが開き再生される（アプリ内埋め込みはしない）。
        - **コメント:** 「残り2mmです。危険です」といったメカニックの所見も併記。
    - **動作:** デフォルトはON。顧客が「今回は予算がない」と思えば**OFF（削除）**にできる。
    - **UX:** OFFにすると、「安全に関わる部品です。見送りますか？」と軽い警告モーダルを出す。
- **Section C: 任意整備 (Optional)**
    - **表示:** 「ワイパー交換」「エアコンフィルター」「添加剤」など。
    - **動作:** デフォルトはOFF。顧客が「あ、ついでにやっておこう」と思えば**ON（追加）**にする。

### 4-3. リアルタイム計算 (Calculator)

**「予算に合わせて、自分で調整できる」**

- **Step 1: 金額変動 (Reactive)**
    - 🚗 **顧客:**
        - 「ワイパーは自分でやるからOFF（-¥8,000）」
        - 「エアコン臭いからフィルターはON（+¥5,000）」
    - 画面下部の**「お支払い合計」**がリアルタイムに再計算され、アニメーションで金額が変わる。
    - (顧客心理：電話だと聞きづらい「安くしたい」という調整を、自分のペースで納得いくまでできる)

### 4-4. 注文確定 (Checkout)

**「言った言わないのトラブルゼロへ」**

- **Step 1: 確定アクション**
    - 🚗 **顧客:**
        - 内容が決まったら、画面最下部の大きなボタン **[この内容で作業を依頼する]** をタップ。
        - （オプション）確認ダイアログで「追加の要望・質問」をテキスト入力可能にする。
- **Step 2: 完了画面**
    - 📱 **画面:** 「ありがとうございます。作業を開始いたします。完了まで今しばらくお待ち下さい」
- **Step 3: 工場へ通知＆データ保存 (Notification & Save)**
    - 🖥 **System (WebApp):**
        - Webアプリ上の見積もりデータを「確定（Locked）」ステータスにする（これ以降、顧客は変更できない）。
        - 承認された項目だけを抽出し、内部DBに保存。
    - 🤖 **Zoho連携 (API Sync):**
        - **Target:** `CustomModule2` (入庫管理)
        - **Action 1:** 承認された作業項目リスト（テキスト整形済み）を **field13 (作業内容)** に書き込む。
            - ※field14 (作業内容一覧) は選択リスト型のため、自由入力を含む見積もりの保存には不向きと判断し、テキスト型の field13 を使用する。
            - 例：「・12ヶ月点検一式\n・Fブレーキパッド交換\n（合計: ¥58,000）」
        - **Action 2:** field5 (工程ステージ) を **「作業待ち (Approved)」** に更新する。
    - 🔔 **通知:**
        - 事務所（アドバイザー）と現場（メカニック）の端末に**「田中様：承認完了（パッド交換あり）」**と通知を飛ばす。

---

### 💡 このフェーズの重要ポイント（開発のツボ）

**開発者（あなた）が認識すべき「UI実装の肝」**

1. **スティッキーフッター (Sticky Footer):**
    - 見積もりが長くなっても、**「現在の合計金額」と「承認ボタン」**は常に画面の一番下に固定表示させてください。顧客が迷子になりません。
2. **画像の拡大表示 (Lightbox):**
    - スマホ画面は小さいです。証拠写真はサムネイルだけでなく、タップしたら画面いっぱいに広がり、ピンチイン/アウトで拡大できるライブラリ（yet-another-react-lightboxなど）を使ってください。ここが信頼感の源泉です。
3. **セキュリティ (UUID & Locking):**
    - ログイン画面を作らない代わりに、URLのUUID（乱数）は十分に長く予測不可能なものにしてください。
    - また、注文確定後は「編集不可」にするロジックを忘れないでください（後から勝手にOFFにされると、発注した部品が無駄になる等のトラブルに繋がります）。

---

## Phase 5. 作業・出庫（完了）詳細設計

**コンセプト：** 「やったことの証拠を残す」。作業指示書は紙ではなくアプリ。そして出庫時はタブレットを見せながら、プロとして「何をしたか」を語る。

### 5-1. 作業指示の確認 (Work Order)

**「顧客が選んだものだけをやる（ミス防止）」**

- **Step 1: 通知・リスト更新 (Trigger)**
    - 🔧 **メカニック:**
        - Phase 4で顧客が承認すると、スマホに通知が届く。
        - **WebApp:** アプリの作業リストを開く。
        - **Logic:** Zoho `CustomModule2.field13` (作業内容) またはアプリ内部DBの「承認済み項目」のみを表示する。
        - （例：ブレーキパッド交換は表示されるが、見送られたワイパー交換はグレーアウトまたは非表示）
- **Step 2: 作業開始 (Start)**
    - 🔧 **メカニック:** 必要な部品（フロントが手配済み）を持って作業に取り掛かる。

### 5-2. 作業実施・証拠撮影 (Execution & Evidence)

**「後で説明するための『ネタ』を集める」**

- **Step 1: 整備作業 (Work)**
    - 🔧 **メカニック:** 承認された部品交換を行う。
- **Step 2: 証拠撮影 (Evidence Capture)**
    - 🔧 **メカニック:**
        - アプリの当該項目の横にある **[証拠撮影 (Capture After)]** ボタンをタップ。
        - **構図:** 「外した古い部品（摩耗状態）」と「取り付けた新品（または箱）」を並べて撮るのがベスト。
    - 🖥 **System:**
        - **Compression:** Phase 2同様、**クライアントサイドで画像を圧縮（300KB〜500KB）**してからアップロードする。
        - **Save:** 写真は Google Drive の `.../03_作業報告/` フォルダへ自動保存される。これが出庫時のプレゼン資料になる。

### 5-3. 作業完了・請求確定 (Completion & Invoice)

**「整備完了通知と、PDF請求書のアップロード」**

- **Step 1: 完了チェック (Finish)**
    - 🔧 **メカニック:** 全ての承認項目にチェックを入れ、**[作業完了 (Job Done)]** ボタンをスワイプ。
    - 🖥 **System:**
        - 事務所へ「作業終了」通知。
        - Zoho `CustomModule2` の 工程ステージ (field5) を **「出庫待ち (Ready for Pickup)」** に更新。
- **Step 2: 請求書発行・アップロード (Admin Task)**
    - 🔧 **事務員/アドバイザー:**
        1. *基幹システム（スマートカーディーラー）**で最終的な請求書を作成・確定させる。
        2. 請求書をPDFで書き出す。
        3. **Naming:** ファイル名に**「請求書」「invoice」「seikyu」**のいずれかを含める（例: `田中様_請求書.pdf`）。
        4. **Upload:** 新アプリの管理画面から **[請求書PDF登録]** ボタンを押し、保存したPDFをアップロードする。
            - *(※Google Driveへ直接D&Dする運用はミス防止のため廃止)*
        - **重要:** これを行わないと、次のPhase 6で顧客が請求書を見られません。
- **Step 3: 引取予約・通知 (Notification)**
    - 🔧 **アドバイザー:** 顧客へLINE/メールで完了通知を送る。
    - 🖥 **System (Zoho Automation):**
        - メッセージ内に**「お引取り予約リンク（Zoho Bookings）」**を自動挿入。
        - 「作業完了しました。説明と引渡しを行いますので、ご来店の時間を予約してください：[リンク]」
    - 🚗 **顧客:** リンクから「明日 18:00」を選択 → Zoho `Appointments__s` (予約) および `Events` (予定) に連携される。

### 5-4. 来店・対面説明 (Presentation & Handover)

**「ここが今回のハイライト（信頼構築）」**

- **Step 1: プレゼンテーション (Storytelling)**
    - 🚗 **顧客:** 予約時間に来店。「引き取りに来ました」
    - 🔧 **メカニック/アドバイザー:**
        - カウンターのタブレット（またはスマホ）でWebアプリの**「完了報告画面（ギャラリーモード）」**を見せる。
        - **UI:** 画面左に「Before（Phase 2）」、右に「After（Phase 5）」の写真を並べて比較表示。
        - **会話例:** 「田中様、お待たせしました。こちらが交換したブレーキパッドの写真です。新品と比べると、もう2ミリしかなくてギリギリでしたよ」
        - **顧客:** 「うわ、本当だ。交換してよかった！」
- **Step 2: 決済・鍵返却 (Payment)**
    - 🔧 **アドバイザー:**
        - 「という内容で整備いたしました」と締めくくり、会計へ。
        - 会計後、鍵を返す前に**「タグNo.05」**を外す。

### 5-5. 出庫・タグ解除 (Unlink Action)

**「物理タグの解放とシステム完了処理」**

- **Step 1: タグ解除 (Manual Unlink)**
    - 🔧 **アドバイザー:**
        - 顧客を見送った後、手元のタグNo.05を回収ボックスに戻す。
        - アプリのリスト（引取待ち一覧）から「田中様」の **[出庫完了]** ボタンを1回タップ。
        - ※QRスキャンでも良いが、リストからのタップの方が速い。
- **Step 2: システム処理 (System Cleanup)**
    - 🖥 **System:**
        - **Tag Logic:** DB上の紐付け Session ID ⇔ Tag ID: 05 を解除（Archive化/Status: `closed`）。タグNo.05は**「空車 (Available)」**ステータスに戻り、即座に次の入庫客に使えるようになる。
        - **Zoho Logic:** Zoho `CustomModule2` の 工程ステージ (field5) を「出庫待ち」から**「出庫済み (Closed)」**に更新。

---

### 💡 このフェーズの重要ポイント（開発のツボ）

**開発者（あなた）が認識すべき「UXとデータの整合性」**

1. **出庫待ちリストの分離 (Dashboard UI):**
    - アプリのトップ画面で、「作業中の車」と「作業終わって引取待ちの車（field5 = 出庫待ち）」はタブを分けるか、エリアを分けて表示してください。
    - 「引取待ち」リストには、Zoho Bookingsで予約された**「来店予定時間」**を表示すると、スタッフが心の準備（掃除・洗車など）をしやすくなります。
2. **PDF連携の実装 (File Watcher):**
    - Webアプリ側では、対象のGoogle Driveフォルダ（00_書類）をAPIで参照し、**「invoice」「seikyu」「請求書」のいずれかの文字列を含むPDFファイル**が存在すれば「請求書あり」アイコンを表示するロジックを組んでください（部分一致検索）。
3. **Zohoステータスの正確性:**
    - 「出庫待ち」と「出庫済み」をシステム上で明確に分けることで、**「今、工場の駐車場に何台あるか？（預かり車両数）」**がデータ上で正確に把握できるようになります。

## Phase 6. アフターフォロー（デジタル整備手帳・顧客ポータル）詳細設計

**コンセプト：** 「捨てられる紙の請求書」から、「ずっと残るデジタルの記録」へ。今回の整備データが、そのまま顧客の資産になる。

### 6-1. レポート送信 (Digital Handover)

**「家に帰ったタイミングで、スマホに届く」**

- **Step 1: 送信トリガー (Trigger)**
    - 🖥 **System:**
        - Phase 5でスタッフが **[出庫完了]** ボタンを押したこと（Zoho `CustomModule2` ステータス：出庫済み (Closed)）をトリガーにする。
        - **Timing:** 即時、または指定時間（例：その日の20時）にLINE/メールを自動送信。
- **Step 2: メッセージ内容 (Content)**
    - ✉️ **Message:**
        - 「田中様、本日はご来店ありがとうございました。担当整備士の鈴木です。」
        - 「本日の整備内容と、交換部品の写真を**『デジタル整備手帳』**にまとめました。いつでもこちらからご確認いただけます：[リンク]」
        - 「また、Googleマップへの口コミ投稿も励みになります！：[Google Mapリンク]」

### 6-2. デジタル整備手帳の閲覧 (View Report)

**「さっき店頭で説明された内容が、手元にある」**

- **Step 1: 閲覧 (Access)**
    - 🚗 **顧客:** 夕食後、自宅でリンクを開く。
- **Step 2: 画面構成 (UI/UX)**
    - **A. ヘッダー:**
        - 「整備完了報告書（デジタル整備手帳）」 / 日付 / 担当：鈴木（アイコン付き）
    - **B. ギャラリー (The Hero Content):**
        - 店頭のタブレットで見せてもらった**「Before / After」の写真**が並んでいる。
        - **キャプション:** 「摩耗したブレーキパッド（残2mm） → 新品（10mm）」
        - (顧客心理：「妻（夫）にも『ほら、こんなに危なかったんだよ』と見せて説明できる（納得感の共有）」)
    - **C. 請求書・作業明細 (Invoice - PDF Integration):**
        - **Concept:** 基幹システムで発行された法的な請求書を表示する。
        - **Logic:**
            - アプリは Google Drive API を叩き、当該車両の `00_書類` フォルダ内を検索する。
            - **Condition:** ファイル名に**「invoice」「seikyu」「請求書」のいずれかを含むPDFファイル**（大文字小文字区別なし）を検知し、**[請求書PDFを表示]** ボタンを表示する。
        - **Viewer:** ボタンを押すと、ブラウザ標準のPDFビューワー、またはアプリ内のモーダルで請求書が表示される。
    - **D. メカニックからのコメント (Advisory):**
        - 「今回はブレーキをリフレッシュしました。タイヤはまだ溝がありますが、来年の車検時には交換時期かもしれません」
        - (※Phase 2の音声入力コメントを、アドバイザーが少し整えてここに表示する)

### 6-3. 次回リマインドとデータ活用 (Retention)

**「『そろそろ時期ですよ』を自動化する」**

- **Step 1: データ蓄積 (Data Store)**
    - 🖥 **System:** 今回の作業内容に基づき、Zoho CRMのデータを更新する。
        - **顧客:** `Last_Mailing_Date` (最終入庫日) 等を更新。
        - **車両:** `field7` (車検有効期限) や `field13` (次回点検日) を更新。
- **Step 2: 自動追客 (Zoho Automation)**
    - 🖥 **System:**
        - **【1ヶ月後】:** 「お車の調子はいかがですか？」の自動フォローメール（不具合があればすぐ連絡できるように）。
        - **【12ヶ月点検の時期】:** （11ヶ月後）「法定12ヶ月点検のご案内」
            - **Killer Content:** 「前回（1年前）の整備記録はこちら：[リンク]」 を添えて、当時の写真を見せることで「しっかり管理してくれている」安心感を与える。
        - **【車検の時期】:** （23ヶ月後）「車検のご案内」。

---

### 💡 このフェーズの重要ポイント（開発のツボ）

**開発者（あなた）が認識すべき「PDF連携」と「ポータル化」**

1. **PDFのファイル名ルール (Flexible Matching):**
    - Webアプリが迷わずPDFを見つけられるよう、検索ロジックを柔軟にしてください。
    - **Rule:** 完全一致ではなく、**「部分一致（Contains）」**で実装します。事務員が「田中様_請求書.pdf」としても「202510_invoice.pdf」としてもヒットするようにします。
2. **「見積もり」と「レポート」は同じデータソース (Component Reuse):**
    - 新しくページを作る必要はありません。Phase 4の「見積もり画面」コンポーネントを再利用し、`mode` プロパティで切り替えます。
        - **見積もりモード:** 選択可能（Checkbox）、金額変動。
        - **レポートモード:** 選択不可（Read Only）、実施項目のみ表示、**＋PDF表示エリア追加**。
3. **SEO/MEO対策 (Google Review):**
    - レポート画面のフッター（一番下）に、目立つように**「Googleでレビューを書く（⭐⭐⭐⭐⭐）」**ボタンを配置してください。
    - 「写真付きでしっかり説明してくれた」という体験直後は、高評価レビューを貰える確率が最も高い瞬間です。
